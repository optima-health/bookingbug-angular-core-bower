(function(){'use strict';var e=String.prototype,t;t=angular.module("BB",["BB.Controllers","BB.Filters","BB.Models","BB.Services","BB.Directives","ngStorage","angular-hal","ui.bootstrap","ngSanitize","ui.map","ui.router.util","ngLocalData","ngAnimate","angular-data.DSCacheFactory","ngFileUpload","schemaForm","uiGmapgoogle-maps","angular.filter","ui-rangeSlider","ngCookies","pascalprecht.translate","vcRecaptcha","slickCarousel"]),t.value("AppConfig",{appId:"f6b16c23",appKey:"f0bc4f65f4fbfe7b4b3b7264b655f5eb"}),window.use_no_conflict?(window.bbjq=$.noConflict(),t.value("$bbug",jQuery.noConflict(!0))):t.value("$bbug",jQuery),t.constant("UriTemplate",window.UriTemplate),t.config(function(e,t,s,o){var i,n,d,l,c,p,m;return t.defaults.headers.common={"App-Id":"f6b16c23","App-Key":"f0bc4f65f4fbfe7b4b3b7264b655f5eb"},n=function(e){return parseInt(e,10)},d=function(e){return angular.isString(e)?e.toLowerCase():e},l=n((/msie (\d+)/.exec(d(navigator.userAgent))||[])[1]),isNaN(l)&&(l=n((/trident\/.*; rv:(\d+)/.exec(d(navigator.userAgent))||[])[1])),c=/Safari\/([\d.]+)/,p=c.exec(navigator.userAgent),p&&(m=parseFloat(p[1])),(l&&9>=l||m&&537>m)&&s.provider({$httpBackend:o}),(i=moment.fn).toISODate||(i.toISODate=function(){return this.locale("en").format("YYYY-MM-DD")})}),t.run(function(e,t,s,o,i,n,d){if(e.$log=t,e.$setIfUndefined=o.setIfUndefined,e.bb||(e.bb={}),e.bb.api_url=d.getItem("host"),!1===i.support.opacity)return document.createElement("header"),document.createElement("nav"),document.createElement("section"),document.createElement("footer")}),angular.module("BB.Services",["ngResource","ngSanitize","ngLocalData"]),angular.module("BB.Controllers",["ngLocalData","ngSanitize"]),angular.module("BB.Directives",[]),angular.module("BB.Filters",[]),angular.module("BB.Models",[]),window.bookingbug={logout:function(e){var t;if(e||(e={}),!1!==e.reload&&(e.reload=!0),t={app_id:"f6b16c23",app_key:"f0bc4f65f4fbfe7b4b3b7264b655f5eb"},e.root&&(t.root=e.root),angular.injector(["BB.Services","BB.Models","ng"]).get("LoginService").logout(t),e.reload)return window.location.reload()}},e.includes||(e.includes=function(e,t){return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),e.parameterise=function(e){return null==e&&(e="-"),this.trim().replace(/\s/g,e).toLowerCase()}}).call(this),angular.module("BB.Services").provider("ie8HttpBackend",function(){function e(e,t,s,o,i,n,d,l){function c(t,s,o,i){var d=d||e.url(),l=(d.match(/^([^:]+):\/\/(\w+:{0,1}\w*@)?(\{?[\w\.-]*\}?)(:([0-9]+))?(\/[^\?#]*)?(\?([^#]*))?(#(.*))?$/)||["",n])[1];s="file"==l?o?200:404:s,s=1223==s?204:s,t(s,o,i),e.$$completeOutstandingRequest(angular.noop)}if(d.msie&&9>=d.msie||d.webkit&&537>d.webkit);else return null;var p=function(e){var t=document.createElement("a");return t.href=e,t.hostname},m=function(t){var s=p(t),o=p(e.url());return!(""!=s)||(patt=new RegExp(o+"$","i"),patt.test(s))},u=function(e,t,s,o,i){var n=$("[name=\""+p(t)+"\"]")[0].id;pm({target:window.frames[n],type:"xhrRequest",data:{headers:i,method:e,data:s,url:t},success:function(e){i="Content-Type: "+e.contentType,e.authToken&&(i+="\r\nAuth-Token: "+e.authToken),c(o,e.statusCode.status,e.responseText,i)},error:function(){c(o,500,"Error","Content-Type: text/plain")}})};return function(t,o,i,n,d,c,p){e.$$incOutstandingRequestCount(),o=o||e.url(),m(o)?l(t,o,i,n,d,c,p):u(t,o,i,n,d,c,p),0<c&&s(function(){status=-1,xdr.abort()},c)}}function t(e){return parseInt(e,10)}function s(e){if(8>=d&&(!e.match(/^(get|post|head|put|delete|options)$/i)||!window.XMLHttpRequest))return new window.ActiveXObject("Microsoft.XMLHTTP");if(window.XMLHttpRequest)return new window.XMLHttpRequest;throw minErr("$httpBackend")("noxhr","This browser does not support XMLHttpRequest.")}function o(e){return e&&isFunction(e.then)}function i(e,t,s,i,d,l,c){function p(e,t,s){var o=d.createElement("script"),n=null;return o.type="text/javascript",o.src=e,o.async=!0,n=function(e){removeEventListenerFn(o,"load",n),removeEventListenerFn(o,"error",n),d.body.removeChild(o),o=null;var l=-1,c="unknown";e&&("load"===e.type&&!i[t].called&&(e={type:"error"}),c=e.type,l="error"===e.type?404:200),s&&s(l,c)},addEventListenerFn(o,"load",n),addEventListenerFn(o,"error",n),8>=c&&(o.onreadystatechange=function(){isString(o.readyState)&&/loaded|complete/.test(o.readyState)&&(o.onreadystatechange=null,n({type:"load"}))}),d.body.appendChild(o),n}return function(d,l,m,u,b,g,h,y){function f(){k=-1,S&&S(),B&&B.abort()}function v(t,o,i,n,d){P&&s.cancel(P),S=B=null,0===o&&(o=i?200:"file"==urlResolve(l).protocol?404:0),o=1223===o?204:o,d=d||"",t(o,i,n,d),e.$$completeOutstandingRequest(angular.noop)}var k;if(e.$$incOutstandingRequestCount(),l=l||e.url(),"jsonp"==n(d)){var w="_"+(i.counter++).toString(36);i[w]=function(e){i[w].data=e,i[w].called=!0};var S=p(l.replace("JSON_CALLBACK","angular.callbacks."+w),w,function(e,t){v(u,e,i[w].data,"",t),i[w]=angular.noop})}else{var B=t(d);if(B.open(d,l,!0),angular.forEach(b,function(e,t){angular.isDefined(e)&&B.setRequestHeader(t,e)}),B.onreadystatechange=function(){if(B&&4==B.readyState){var e=null,t=null,s="";-1!==k&&(e=B.getAllResponseHeaders(),t="response"in B?B.response:B.responseText),-1===k&&10>c||(s=B.statusText),v(u,k||B.status,t,e,s)}},h&&(B.withCredentials=!0),y)try{B.responseType=y}catch(t){if("json"!==y)throw t}B.send(m||null)}if(0<g)var P=s(f,g);else o(g)&&g.then(f)}}this.$get=["$browser","$window","$document","$sniffer",function(t,o,n,d){var l=[t,s,t.defer,o.angular.callbacks,n[0],o.location.protocol.replace(":",""),d],c=l.concat([i.apply(this,l)]);return e&&e.apply(this,c)||i.apply(this,l)}];var n=function(e){return angular.isString(e)?e.toLowerCase():e},d=t((/msie (\d+)/.exec(n(navigator.userAgent))||[])[1]);isNaN(d)&&(d=t((/trident\/.*; rv:(\d+)/.exec(n(navigator.userAgent))||[])[1]));var n=function(e){return angular.isString(e)?e.toLowerCase():e}});var NO_JQUERY={};(function(e,t){if(!("console"in e)){var s=e.console={};s.log=s.warn=s.error=s.debug=function(){}}t===NO_JQUERY&&(t={fn:{},extend:function(){for(var e=arguments[0],t=1,s=arguments.length,o;t<s;t++)for(var n in o=arguments[t],o)e[n]=o[n];return e}}),t.fn.pm=function(){return console.log("usage: \nto send:    $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])"),this},t.pm=e.pm=function(e){n.send(e)},t.pm.bind=e.pm.bind=function(e,t,s,o,i){n.bind(e,t,s,o,!0===i)},t.pm.unbind=e.pm.unbind=function(e,t){n.unbind(e,t)},t.pm.origin=e.pm.origin=null,t.pm.poll=e.pm.poll=200;var n={send:function(e){var s=t.extend({},n.defaults,e),o=s.target;if(!s.target)return void console.warn("postmessage target window required");if(!s.type)return void console.warn("postmessage type required");var i={data:s.data,type:s.type};s.success&&(i.callback=n._callback(s.success)),s.error&&(i.errback=n._callback(s.error)),"postMessage"in o&&!s.hash?(n._bind(),o.postMessage(JSON.stringify(i),s.origin||"*")):"postMessage"in o.contentWindow&&!s.hash?(n._bind(),o.contentWindow.postMessage(JSON.stringify(i),s.origin||"*")):(n.hash._bind(),n.hash.send(s,i))},bind:function(e,t,s,o,i){n._replyBind(e,t,s,o,i)},_replyBind:function(s,o,i,d,c){"postMessage"in e&&!d?n._bind():n.hash._bind();var p=n.data("listeners.postmessage");p||(p={},n.data("listeners.postmessage",p));var m=p[s];m||(m=[],p[s]=m),m.push({fn:o,callback:c,origin:i||t.pm.origin})},unbind:function(e,t){var s=n.data("listeners.postmessage");if(s)if(!e)for(var d in s)delete s[d];else if(t){var l=s[e];if(l){for(var c=[],d=0,p=l.length,m;d<p;d++)m=l[d],m.fn!==t&&c.push(m);s[e]=c}}else delete s[e]},data:function(e,t){return void 0===t?n._data[e]:(n._data[e]=t,t)},_data:{},_CHARS:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],_random:function(){for(var e=[],t=0;32>t;t++)e[t]=n._CHARS[0|32*Math.random()];return e.join("")},_callback:function(e){var t=n.data("callbacks.postmessage");t||(t={},n.data("callbacks.postmessage",t));var s=n._random();return t[s]=e,s},_bind:function(){n.data("listening.postmessage")||(e.addEventListener?e.addEventListener("message",n._dispatch,!1):e.attachEvent&&e.attachEvent("onmessage",n._dispatch),n.data("listening.postmessage",1))},_dispatch:function(t){try{var e=JSON.parse(t.data)}catch(e){return void console.warn("postmessage data invalid json: ",e)}if(!e.type)return void console.warn("postmessage message type required");var s=n.data("callbacks.postmessage")||{},d=s[e.type];if(d)d(e.data);else for(var c=n.data("listeners.postmessage")||{},l=c[e.type]||[],p=0,m=l.length,u;p<m;p++){function s(s){e.callback&&n.send({target:t.source,data:s,type:e.callback})}if(u=l[p],u.origin&&"*"!==u.origin&&t.origin!==u.origin){if(console.warn("postmessage message origin mismatch",t.origin,u.origin),e.errback){var b={message:"postmessage origin mismatch",origin:[t.origin,u.origin]};n.send({target:t.source,data:b,type:e.errback})}continue}try{u.callback?u.fn(e.data,s,t):s(u.fn(e.data,t))}catch(s){if(e.errback)n.send({target:t.source,data:s,type:e.errback});else throw s}}}};n.hash={send:function(t,s){var o=t.target,d=t.url;if(!d)return void console.warn("postmessage target window url is required");d=n.hash._url(d);var l=n.hash._url(e.location.href),c;if(e==o.parent)c="parent";else try{for(var p=0,m=parent.frames.length,u;p<m;p++)if(u=parent.frames[p],u==e){c=p;break}}catch(t){c=e.name}if(null==c)return void console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list");var b={"x-requested-with":"postmessage",source:{name:c,url:l},postmessage:s},g="#x-postmessage-id="+n._random();o.location=d+g+encodeURIComponent(JSON.stringify(b))},_regex:/^\#x\-postmessage\-id\=(\w{32})/,_regex_len:18+32,_bind:function(){n.data("polling.postmessage")||(setInterval(function(){var t=""+e.location.hash,s=n.hash._regex.exec(t);if(s){var o=s[1];n.hash._last!==o&&(n.hash._last=o,n.hash._dispatch(t.substring(n.hash._regex_len)))}},t.pm.poll||200),n.data("polling.postmessage",1))},_dispatch:function(t){if(t){try{if(t=JSON.parse(decodeURIComponent(t)),!("postmessage"===t["x-requested-with"]&&t.source&&null!=t.source.name&&t.source.url&&t.postmessage))return}catch(e){return}var s=t.postmessage,d=n.data("callbacks.postmessage")||{},c=d[s.type];if(c)c(s.data);else{var p="parent"===t.source.name?e.parent:e.frames[t.source.name];for(var m=n.data("listeners.postmessage")||{},l=m[s.type]||[],u=0,b=l.length,g;u<b;u++){function e(e){s.callback&&n.send({target:p,data:e,type:s.callback,hash:!0,url:t.source.url})}if(g=l[u],g.origin){var h=/https?\:\/\/[^\/]*/.exec(t.source.url)[0];if("*"!==g.origin&&h!==g.origin){if(console.warn("postmessage message origin mismatch",h,g.origin),s.errback){var y={message:"postmessage origin mismatch",origin:[h,g.origin]};n.send({target:p,data:y,type:s.errback,hash:!0,url:t.source.url})}continue}}try{g.callback?g.fn(s.data,e):e(g.fn(s.data))}catch(e){if(s.errback)n.send({target:p,data:e,type:s.errback,hash:!0,url:t.source.url});else throw e}}}}},_url:function(e){return(""+e).replace(/#.*$/,"")}},t.extend(n,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"==typeof jQuery?NO_JQUERY:jQuery),"JSON"in window&&window.JSON||(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?"\""+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+"\"":"\""+e+"\""}function str(e,t){var s=gap,o=t[e],n,d,l,c,p;switch(o&&"object"==typeof o&&"function"==typeof o.toJSON&&(o=o.toJSON(e)),"function"==typeof rep&&(o=rep.call(t,e,o)),typeof o){case"string":return quote(o);case"number":return isFinite(o)?o+"":"null";case"boolean":case"null":return o+"";case"object":if(!o)return"null";if(gap+=indent,p=[],"[object Array]"===Object.prototype.toString.apply(o)){for(c=o.length,n=0;n<c;n+=1)p[n]=str(n,o)||"null";return l=0===p.length?"[]":gap?"[\n"+gap+p.join(",\n"+gap)+"\n"+s+"]":"["+p.join(",")+"]",gap=s,l}if(rep&&"object"==typeof rep)for(c=rep.length,n=0;n<c;n+=1)d=rep[n],"string"==typeof d&&(l=str(d,o),l&&p.push(quote(d)+(gap?": ":":")+l));else for(d in o)Object.hasOwnProperty.call(o,d)&&(l=str(d,o),l&&p.push(quote(d)+(gap?": ":":")+l));return l=0===p.length?"{}":gap?"{\n"+gap+p.join(",\n"+gap)+"\n"+s+"}":"{"+p.join(",")+"}",gap=s,l;}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"":"\\b","	":"\\t","\n":"\\n","":"\\f","\r":"\\r",'"':"\\\"","\\":"\\\\"},gap,indent,rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,s){var o;if(gap="",indent="","number"==typeof s)for(o=0;o<s;o+=1)indent+=" ";else"string"==typeof s&&(indent=s);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var s=e[t],o,i;if(s&&"object"==typeof s)for(o in s)Object.hasOwnProperty.call(s,o)&&(i=walk(s,o),void 0===i?delete s[o]:s[o]=i);return reviver.call(e,t,s)}var j;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){angular.module("schemaForm").config(function(e,t,s){var o,i;return i=function(t,o,i){var n;if("string"===o.type&&"time"===o.format)return n=e.stdFormObj(t,o,i),n.key=i.path,n.type="timepicker",i.lookup[s.stringify(i.path)]=n,n},e.defaults.string.unshift(i),o=function(t,o,i){var n;if("string"===o.type&&"datetime"===o.format)return n=e.stdFormObj(t,o,i),n.key=i.path,n.type="datetime",i.lookup[s.stringify(i.path)]=n,n},e.defaults.string.unshift(o),t.addMapping("bootstrapDecorator","time","bootstrap_ui_time_form.html"),t.createDirective("time","bootstrap_ui_time_form.html"),t.addMapping("bootstrapDecorator","datetime","bootstrap_ui_datetime_form.html"),t.createDirective("datetime","bootstrap_ui_datetime_form.html"),t.addMapping("bootstrapDecorator","price","price_form.html"),t.createDirective("price","price_form.html"),t.addMapping("bootstrapDecorator","date","date_form.html"),t.createDirective("date","date_form.html"),t.addMapping("bootstrapDecorator","radios","radios.html"),t.createDirective("radios","radios.html"),t.addMapping("bootstrapDecorator","radios-inline","radios-inline.html"),t.createDirective("radios-inline","radios-inline.html"),t.addMapping("bootstrapDecorator","radiobuttons","radio-buttons.html"),t.createDirective("radiobuttons","radio-buttons.html")})}.call(this),function(){window.Collection=function(){return function(){}}(),window.Collection.Base=function(){function e(e,t,s){var o,i,d,l,c;for(i in this.res=e,this.items=t,this.params=s,this.callbacks=[],o={},s)c=s[i],null!=c&&(null==c.id?o[i]=c:o[i+"_id"]=c.id);if(this.jparams=JSON.stringify(o),e)for(l in e)d=e[l],this[l]=d}return e.prototype.checkItem=function(e){var t,s,o,n,d,l,c,p,m,u,b,g,h;if(!this.matchesParams(e))return this.deleteItem(e),!0;for(u=this.items,n=o=0,c=u.length;o<c;n=++o)if(s=u[n],e.self===s.self){for(this.items[n]=e,b=this.callbacks,(d=0,p=b.length);d<p;d++)t=b[d],t[1](e,"update");return!0}for(this.items.push(e),g=this.callbacks,h=[],(l=0,m=g.length);l<m;l++)t=g[l],h.push(t[1](e,"add"));return h},e.prototype.deleteItem=function(e){var t,s,o,n,d,l;if(o=this.items.length,this.items=this.items.filter(function(t){return t.self!==e.self}),this.items.length!==o){for(d=this.callbacks,l=[],(s=0,n=d.length);s<n;s++)t=d[s],l.push(t[1](e,"delete"));return l}},e.prototype.getItems=function(){return this.items},e.prototype.addCallback=function(e,t){var s,o,n,d;for(d=this.callbacks,o=0,n=d.length;o<n;o++)if(s=d[o],s[0]===e)return;return this.callbacks.push([e,t])},e.prototype.matchesParams=function(){return!0},e}(),window.BaseCollections=function(){function e(){this.collections=[]}return e.prototype.count=function(){return this.collections.length},e.prototype.add=function(e){return this.collections.push(e)},e.prototype.checkItems=function(e){var t,s,o,n,d;for(n=this.collections,d=[],(s=0,o=n.length);s<o;s++)t=n[s],d.push(t.checkItem(e));return d},e.prototype.deleteItems=function(e){var t,s,o,n,d;for(n=this.collections,d=[],(s=0,o=n.length);s<o;s++)t=n[s],d.push(t.deleteItem(e));return d},e.prototype.find=function(e){var t,s,o,n,d,l,c,p;for(d in t={},e)p=e[d],null!=p&&(null==p.id?t[d]=p:t[d+"_id"]=p.id);for(n=JSON.stringify(t),c=this.collections,(o=0,l=c.length);o<l;o++)if(s=c[o],n===s.jparams)return s},e.prototype["delete"]=function(e){return this.collections=_.without(this.collections,e)},e}()}.call(this),function(){var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;window.Collection.Day=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.checkItem=function(){return s.__super__.checkItem.apply(this,arguments)},s}(window.Collection.Base),angular.module("BB.Services").provider("DayCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this),function(){var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;window.Collection.Space=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.checkItem=function(){return s.__super__.checkItem.apply(this,arguments)},s}(window.Collection.Base),angular.module("BB.Services").provider("SpaceCollections",function(){return{$get:function(){return new window.BaseCollections}}})}.call(this),angular.module("angular-hal",[]).provider("data_cache",function(){this.$get=function(){return data=[],{set:function(e,t){return data[e]=t,t},get:function(e){return data[e]},del:function(e){delete data[e]},has:function(e){return e in data},delMatching:function(e){for(var t in data)-1!=t.indexOf(e)&&delete data[t]}}}}).provider("shared_header",function(){this.$get=function(){return data={},{set:function(e,t,s){return s.setItem(e,t),data[e]=t,t},get:function(e){return data[e]},del:function(e){delete data[e]},has:function(e){return e in data}}}}).factory("halClient",["$http","$q","data_cache","shared_header","UriTemplate","$cookies","$sessionStorage","$localStorage",function(e,t,s,o,i,n,d,l){function c(e,o,n,d){function l(e,t,s){e[t]=s}function c(e){if(angular.isArray(e))return e.map(function(e){return c(e)});var s=e.$href("self");v.set(s,t.when(e))}function g(e,t){var s=e.templated?new i(e.href).fillFromObject(t||{}):e.href;return s}function h(e,s,i,n){if(null==i&&(i={}),angular.isArray(s))return t.all(s.map(function(t){if("GET"!==e)throw"method is not supported for arrays";return h(e,t,i,n)}));var d=g(s,i);return"GET"===e?v.has(d)&&!i.no_cache?v.get(d):v.set(d,b(e,d,o,n)):b(e,d,o,n)}function y(e,t){if(angular.isArray(e))return e.map(function(e){return y(e,t)});var s=g(e,t);v.has(s)&&v.del(s)}o||(o={}),d||(d={});var f={},v=s;n.hasOwnProperty("auth_token")&&(o.auth_token=n.auth_token),e=u(e,n).href,l(this,"$href",function(e,t){return e in f?g(f[e],t):null}),l(this,"$has",function(e){return e in f}),l(this,"$flush",function(e,t){var s=f[e];return y(s,t)}),l(this,"$get",function(e,t){var s=f[e];return h("GET",s,t)}),l(this,"$post",function(e,t,s){var o=f[e];return h("POST",o,t,s)}),l(this,"$put",function(e,t,s){var o=f[e];return h("PUT",o,t,s)}),l(this,"$patch",function(e,t,s){var o=f[e];return h("PATCH",o,t,s)}),l(this,"$del",function(e,t,s){var o=f[e];return h("DELETE",o,t,s)}),l(this,"$links",function(){return f}),l(this,"$toStore",function(){return JSON.stringify({data:this,links:f,options:o})}),l(this,"setOption",function(e,t){o[e]=t}),l(this,"getOption",function(e){return o[e]}),l(this,"$link",function(e){return f[e]}),Object.keys(n).filter(function(e){return!~["_","$"].indexOf(e[0])}).forEach(function(e){this[e]=n[e]},this),n._links&&Object.keys(n._links).forEach(function(t){var s=n._links[t];s=m(e,s),f[t]=s},this),n._embedded&&Object.keys(n._embedded).forEach(function(t){var s=n._embedded[t],i=u(e,s);f[t]=i;var d=p(e,o,s);c(d)},this),d.is_new&&(this.is_new=!0)}function p(e,t,s,o){if(angular.isArray(s))return s.map(function(s){return p(e,t,s,o)});var i=new c(e,t,s,o);return i}function m(e,t){return angular.isArray(t)?t.map(function(t){return m(e,t)}):(t?("string"==typeof t&&(t={href:t}),t.href=h(e,t.href)):t={href:e},t)}function u(e,t){return angular.isArray(t)?t.map(function(t){return u(e,t)}):m(e,t&&t._links&&t._links.self)}function b(s,i,n,c){n||(n={});var m={"Content-Type":"application/json",Accept:"application/hal+json,application/json"};n.authorization&&(m.Authorization=n.authorization),n.app_id&&o.set("app_id",n.app_id,d),n.app_key&&o.set("app_key",n.app_key,d),n.auth_token&&(d.setItem("auth_token",n.auth_token),o.set("auth_token",n.auth_token,d)),o.has("app_id")&&(m["App-Id"]=o.get("app_id")),o.has("app_key")&&(m["App-Key"]=o.get("app_key")),o.has("auth_token")&&(m["Auth-Token"]=o.get("auth_token")),n.bypass_auth&&(m["Bypass-Auth"]=n.bypass_auth);var u=e({method:s,url:n.transformUrl?n.transformUrl(i):i,headers:m,data:c}).then(function(e){switch(e.headers("auth-token")&&201==e.status&&(n.auth_token=e.headers("Auth-Token"),o.set("auth_token",e.headers("Auth-Token"),d),l.getItem("auth_token")&&l.setItem("auth_token",e.headers("Auth-Token"))),e.status){case 200:return e.data&&"\"null\""!==e.data?p(i,n,e.data):null;case 201:return extra={is_new:!0},e.data?p(i,n,e.data,extra):e.headers("Content-Location")?e.headers("Content-Location"):null;case 204:return null;default:return t.reject(e);}},function(e){return t.reject(e)});return u}function g(e){var t=p(e._links.self.href,null,e);return t}function h(e,t){for(var s="",o=/^((?:\w+\:)?)((?:\/\/)?)([^\/]*)((?:\/.*)?)$/,i=o.exec(e),n=o.exec(t),d=1;5>d;d++)s+=n[d]?n[d]:i[d];return s}return d.getItem("auth_token")?o.set("auth_token",d.getItem("auth_token"),d):n["Auth-Token"]&&!o.has("auth_token")&&o.set("auth_token",n["Auth-Token"],d),{setCache:function(e){s=e},clearCache:function(e){s.delMatching(e)},createResource:function(e){return"string"==typeof e&&(e=JSON.parse(e)),resource=e.data,resource._links=e.links,key=e.links.self.href,options=e.options,new c(key,options,resource)},$get:function(e,t){return!s.has(e)||t&&t.no_cache?s.set(e,b("GET",e,t)):s.get(e)},$post:function(e,t,s){return b("POST",e,t,s)},$put:function(e,t,s){return b("PUT",e,t,s)},$patch:function(e,t,s){return b("PATCH",e,t,s)},$del:function(e,t,s){return b("DELETE",e,t,s)},$parse:function(e){return g(e)}}}]),angular.module("ngStorage",[]).factory("$fakeStorage",["$cookies",function(e){function t(){}return t.prototype.setItem=function(t,s){e[t]=s},t.prototype.getItem=function(t){return"undefined"==typeof e[t]?null:e[t]},t.prototype.removeItem=function(t){e[t]&&delete e[t]},t.prototype.clear=function(){for(var t in e)e.hasOwnProperty(t)&&delete e[t]},t.prototype.key=function(t){return Object.keys(e)[t]},new t}]).factory("$localStorage",["$window","$fakeStorage",function(e,t){var s=function(t){var s=e[t];try{return s.setItem("test","1"),s.removeItem("test"),!0}catch(e){return!1}}("localStorage")?e.localStorage:t;return{setItem:function(e,t){s.setItem(e,t)},getItem:function(e,t){return s.getItem(e)||t},setObject:function(e,t){s.setItem(e,JSON.stringify(t))},getObject:function(e){return JSON.parse(s.getItem(e)||"{}")},removeItem:function(e){s.removeItem(e)},clear:function(){s.clear()},key:function(e){s.key(e)}}}]).factory("$sessionStorage",["$window","$fakeStorage",function(e,t){var s=function(t){var s=e[t];try{return s.setItem("test","1"),s.removeItem("test"),!0}catch(e){return!1}}("sessionStorage")?e.sessionStorage:t;return{setItem:function(e,t){s.setItem(e,t)},getItem:function(e,t){return s.getItem(e)||t},setObject:function(e,t){s.setItem(e,JSON.stringify(t))},getObject:function(e){return JSON.parse(s.getItem(e)||"{}")},removeItem:function(e){s.removeItem(e)},clear:function(){s.clear()},key:function(e){s.key(e)}}}]),angular.module("ngLocalData",["angular-hal"]).factory("$localCache",["halClient","$q","$sessionStorage",function(e,t,s){return data={},jsonData=function(e){return e&&JSON.parse(e)},storage=function(){return s},localSave=function(e,t){storage().setItem(e,t.$toStore())},localLoad=function(s){return res=jsonData(storage().getItem(s)),res?(r=e.createResource(res),def=t.defer(),def.resolve(r),def.promise):null},localDelete=function(e){storage().removeItem(e)},{set:function(e,t){return data[e]=t,t.then(function(t){localSave(e,t)}),t},get:function(e){return localLoad(e),data[e]||(data[e]=localLoad(e)),data[e]},del:function(e){localDelete(e),delete data[e]},has:function(e){return data[e]||(res=localLoad(e),res&&(data[e]=res)),e in data}}}]).factory("$localData",["$http","$rootScope","$sessionStorage",function(e,t,s){return function(e){function t(e){this.setStore(e)}return t.prototype.jsonData=function(e){return e&&JSON.parse(e)},t.prototype.storage=function(){return s},t.prototype.localSave=function(e){this.storage().setItem(this.store_name+e.id,JSON.stringify(e))},t.prototype.localSaveIndex=function(e){this.storage().setItem(this.store_name,e.join(",")),this.ids=e},t.prototype.localLoadIndex=function(){return store=this.storage().getItem(this.store_name),records=store&&store.split(",")||[],records},t.prototype.localLoad=function(e){return this.jsonData(this.storage().getItem(this.store_name+e))},t.prototype.count=function(){return this.ids.length},t.prototype.setStore=function(e){for(this.store_name=e,this.data_store=[],this.ids=this.localLoadIndex(),a=0;a<this.ids.length;a++)this.data_store.push(this.localLoad(this.ids[a]))},t.prototype.update=function(e){for(x in ids=[],e)e[x].id&&(ids.push(e[x].id),this.localSave(e[x]));this.localSaveIndex(ids)},new t(e)}}]),getControllerScope=function(e,t){$(document).ready(function(){var s=$("div[data-ng-controller=\""+e+"\"]"),o=angular.element(s).scope();t(o)})};function getURIparam(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t="[\\?&]"+e+"=([^&#]*)",s=new RegExp(t),o=s.exec(window.location.href);return null==o?"":o[1]}(function(){'use strict';angular.module("BB.Directives").directive("bbAccordionRangeGroup",function(e){return{restrict:"AE",replace:!1,scope:{day:"=",slots:"=",selectSlot:"=",disabled_slot:"=disabledSlot"},controller:"AccordionRangeGroup",link:function(e,t,s){return e.options=e.$eval(s.bbAccordionRangeGroup)||{}},templateUrl:function(){return e.directivePartial("_accordion_range_group")}}}),angular.module("BB.Controllers").controller("AccordionRangeGroup",function(e,t,s,o,i,n,d){var l,c,p;return e.controller="public.controllers.AccordionRangeGroup",e.$watch("slots",function(){return c()}),s.connection_started.then(function(){return e.init()}),e.setFormDataStoreId=function(t){return i.init("AccordionRangeGroup"+t,e,[])},e.init=function(){return e.start_time=e.options.range[0],e.end_time=e.options.range[1],e.options.collaspe_when_time_selected=!_.isBoolean(e.options.collaspe_when_time_selected)||e.options.collaspe_when_time_selected,e.options.hide_availability_summary=!!_.isBoolean(e.options.hide_availability_summary)&&e.options.hide_availability_summary,e.heading=e.options.heading,c()},c=function(){if(e.accordion_slots=[],e.is_open=e.is_open||!1,e.has_availability=e.has_availability||!1,e.is_selected=e.is_selected||!1,e.slots)return angular.forEach(e.slots,function(t){var s,o;if(n.getDisplayTimeZone()===n.getTimeZone()?o=t.time:(s=moment(t.datetime).tz(n.getDisplayTimeZone()),o=d.convertMomentToTime(s)),o>=e.start_time&&o<e.end_time&&1===t.avail)return e.accordion_slots.push(t)}),p()},p=function(t,s){var o,c,p,m,u,b,g,h,y,f;if(e.selected_slot=null,e.accordion_slots&&(e.has_availability=l()),e.disabled_slot&&e.disabled_slot.time&&e.disabled_slot.date===e.day.date.toISODate())if(Array.isArray(e.disabled_slot.time))for(b=e.disabled_slot.time,c=0,m=b.length;c<m;c++)f=b[c],f,h=_.findWhere(e.slots,{time:f}),h&&(h.disabled=!0);else h=_.findWhere(e.slots,{time:e.disabled_slot.time}),h&&(h.disabled=!0);if(t&&s)n.getDisplayTimeZone()===n.getTimeZone()?y=s.time:(o=moment(s.datetime).tz(n.getDisplayTimeZone()),y=d.convertMomentToTime(o)),t.date.isSame(e.day.date)&&y>=e.start_time&&y<e.end_time&&(e.selected_slot=s);else for(g=e.accordion_slots,p=0,u=g.length;p<u;p++)if(s=g[p],s.selected){e.selected_slot=s;break}if(e.selected_slot){if(e.hideHeading=!0,e.is_selected=!0,e.options.collaspe_when_time_selected)return e.is_open=!1;}else if(e.is_selected=!1,e.options.collaspe_when_time_selected)return e.is_open=!1},l=function(){var t,s,o,n;if(!e.accordion_slots)return!1;for(o=e.accordion_slots,t=0,s=o.length;t<s;t++)if(n=o[t],0<n.availability())return!0;return!1},e.$on("slotChanged",function(e,t,s){return t&&s?p(t,s):p()})})}).call(this),function(){angular.module("BB.Directives").directive("bbAddresses",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"AddressList"}}),angular.module("BB.Controllers").controller("AddressList",function(e,t,s,o,i,n){return e.controller="public.controllers.AddressList",e.manual_postcode_entry=!1,n.init("AddressList",e,["show_complete_address"]),t.connection_started.then(function(){return function(){if(e.client.postcode&&!e.bb.postcode&&(e.bb.postcode=e.client.postcode),e.client.postcode&&e.bb.postcode&&e.client.postcode===e.bb.postcode&&!e.bb.address1&&(e.bb.address1=e.client.address1,e.bb.address2=e.client.address2,e.bb.address3=e.client.address3,e.bb.address4=e.client.address4,e.bb.address5=e.client.address5),e.manual_postcode_entry=!e.bb.postcode,e.show_complete_address=!!e.bb.address1,!e.postcode_submitted)return e.findByPostcode(),e.postcode_submitted=!1}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.findByPostcode=function(){if(e.postcode_submitted=!0,!!e.bb.postcode)return e.notLoaded(e),i.query({company:e.bb.company,post_code:e.bb.postcode}).then(function(t){var s,i;s=angular.isArray(t)?_.map(t,function(e){return{address:e.partialAddress,moniker:e.moniker}}):[{address:t.partialAddress,moniker:t.moniker}],1===s.length&&o.msie&&(i=[],i.push(s[0]),i.push({address:""}),s=i),e.addresses=s,e.bb.address=s[0],e.client.address=s[0],e.setLoaded(e)},function(){return e.show_complete_address=!0,e.postcode_submitted=!0,e.setLoaded(e)})},e.showCompleteAddress=function(){if(e.show_complete_address=!0,e.postcode_submitted=!1,e.bb.address&&e.bb.address.moniker)return e.notLoaded(e),i.getAddress({company:e.bb.company,id:e.bb.address.moniker}).then(function(t){var s,o,i,n,d,l,c;s=t,l="","string"==typeof s.buildingNumber?l=s.buildingNumber:null==s.buildingNumber&&(l=s.buildingName),"string"==typeof s.streetName?(c=s.streetName?s.streetName:"",e.bb.address1=l+" "+c):(n=s.addressLine2?s.addressLine2:"",e.bb.address1=l+" "+n),s.buildingName&&null==s.buildingNumber&&(e.bb.address1=l,e.bb.address2=s.streetName,null!=s.county&&(e.bb.address4=s.county)),"string"==typeof s.buildingNumber&&"string"==typeof s.buildingName&&"string"==typeof s.streetName&&(c=s.streetName?s.streetName:"",e.bb.address1=s.buildingName,e.bb.address2=s.buildingNumber+" "+c),null!=s.buildingName&&s.buildingName.match(/(^[^0-9]+$)/)&&(d=s.buildingNumber?s.buildingNumber:"",e.bb.address1=s.buildingName+" "+d,e.bb.address2=s.streetName),null==s.buildingNumber&&null==s.streetName&&(e.bb.address1=s.buildingName,e.bb.address2=s.addressLine3,e.bb.address4=s.town),null!=s.companyName&&(e.bb.address1=s.companyName,null==s.buildingNumber&&null==s.streetName?e.bb.address2=s.addressLine3:null==s.buildingNumber?(o=s.buildingName?s.buildingName+", "+s.streetName:s.streetName,e.bb.address2=o):null==s.buildingName&&null==s.addressLine2?e.bb.address2=s.buildingNumber+", "+s.streetName:e.bb.address2=s.buildingName,e.bb.address3=s.buildingName,i=s.addressLine3&&null!=s.buildingNumber?s.addressLine3:null==s.addressLine2&&null!=s.buildingNumber?s.buildingNumber+" "+s.streetName:null==s.addressLine2&&null==s.buildingNumber&&null!=s.buildingName?s.addressLine3:"",e.bb.address3=i,e.bb.address4=s.town,e.bb.address5="",e.bb.postcode=s.postCode),null==s.buildingName&&null==s.companyName&&null==s.county?(o=null==s.addressLine2&&null==s.companyName?s.addressLine3:s.addressLine2,e.bb.address2=o):null==s.buildingName&&null==s.companyName&&(e.bb.address2=s.addressLine3),null!=s.buildingName&&null!=s.streetName&&null==s.companyName&&null!=s.addressLine3?null==s.addressLine3?e.bb.address3=s.buildingName:e.bb.address3=s.addressLine3:null==s.buildingName&&null==s.companyName&&null!=s.addressLine2?e.bb.address3=s.addressLine3:null==s.buildingName&&null!=s.streetName&&null==s.addressLine3&&(e.bb.address3=s.addressLine3),e.bb.address4=s.town,null!=s.county&&(e.bb.address5=s.county),e.setLoaded(e)},function(t){return e.show_complete_address=!0,e.postcode_submitted=!1,e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},e.setManualPostcodeEntry=function(t){return e.manual_postcode_entry=t},e.$on("client_details:reset_search",function(){return e.bb.address1=null,e.bb.address2=null,e.bb.address3=null,e.bb.address4=null,e.bb.address5=null,e.show_complete_address=!1,e.postcode_submitted=!1,e.bb.address=e.addresses[0]})})}.call(this),function(){angular.module("BB.Directives").directive("bbAttendees",function(){return{restrict:"AE",replace:!0,scope:!0,controller:function(e,t,s,o,n,d,l,c){var p,m;return e.validator=l,t.connection_started.then(function(){return p()}),p=function(){return e.items=e.bb.basket.timeItems()},m=function(){var i,n;return i=s.defer(),n={purchase:e.bb.moving_purchase,bookings:e.bb.basket.items,notify:!0},o.update(n).then(function(s){return e.bb.purchase=s,e.setLoaded(e),e.bb.current_item.move_done=!0,t.$broadcast("booking:updated"),i.resolve()},function(){return i.reject()}),i.promise},e.markItemAsChanged=function(e){return e.attendee_changed=!0},e.changeAttendees=function(){var t,o,l,p,u,b,g;if(!e.bb.current_item.ready||!e.bb.moving_purchase)return!1;for(l=s.defer(),e.notLoaded(e),o=[],g=e.items,(p=0,b=g.length);p<b;p++)u=g[p],u.attendee_changed?(t=new n.Client,t.first_name=u.first_name,t.last_name=u.last_name,o.push(c.create_or_update(e.bb.company,t))):o.push(s.when([]));return s.all(o).then(function(t){var s,o,i,n;for(n=e.items,s=o=0,i=n.length;o<i;s=++o)u=n[s],t[s]&&t[s].id&&(u.client_id=t[s].id);return m().then(function(){return e.$parent.$has_page_control?l.resolve():(e.decideNextPage("purchase"),d.raise("ATTENDEES_CHANGED"),l.resolve())},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}),l.promise},e.setReady=function(){return e.changeAttendees()}}}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbWidget",function(e,t,s,o,i,n,d,l,c,p){var m,u,b,g,h;return u=function(s){var i,n,d;return n=s?s:"main",i=o.get(n),i?i:(d=e.directivePartial(n).$$unwrapTrustedValue(),t.get(d,{cache:o}).then(function(e){return e.data}))},h=function(e,t,s){var o,n,d,l;for(l=t.children(),n=0,d=l.length;n<d;n++)o=l[n],c(o).hasClass("custom_partial")&&c(o).remove();return m(e,t,s).then(function(){return e.$broadcast("refreshPage")})},g=function(e,t,s){return l(function(){return e.pusher=new Pusher("c8d8cea659cc46060608"),e.pusher_channel=e.pusher.subscribe("widget_"+s.design_id),e.pusher_channel.bind("update",function(){return h(e,t,s)})})},m=function(e,s,o){var d;return d=n.defer(),t.get(o.custom_partial_url).then(function(t){return i(t.data)(e,function(e,t){var i,n,l;return e.addClass("custom_partial"),n=function(){var t,s,o;for(o=[],t=0,s=e.length;t<s;t++)l=e[t],"STYLE"===l.tagName&&o.push(l);return o}(),i=function(){var t,s,o;for(o=[],t=0,s=e.length;t<s;t++)l=e[t],"STYLE"!==l.tagName&&o.push(l);return o}(),c("#widget_"+o.design_id).html(i),s.append(n),t.bb.path_setup=!0,d.resolve(n)})}),d.promise},b=function(e,t,s,o){return n.when(u(o)).then(function(o){return t.html(o).show(),s&&t.append("<style widget_css scoped></style>"),i(t.contents())(e)})},{restrict:"A",scope:{client:"=?",apiUrl:"@?",useParent:"="},transclude:!0,controller:"BBCtrl",link:function(e,t,s,o,l){var h,y;return null!=s.member&&(e.client=s.member),h=e,e.useParent&&null!=e.$parent&&(h=e.$parent),y=h.$eval(s.bbWidget),e.initWidget(y),p.widget_started.then(function(){return function(){var s;return s=e.bb,s.custom_partial_url&&(s.design_id=s.custom_partial_url.match(/^.*\/(.*?)$/)[1],c("[ng-app='BB']").append("<div id='widget_"+s.design_id+"'></div>")),e.bb.partial_url&&(y.partial_url?d.partial_url=y.partial_url:d.partial_url=e.bb.partial_url),l(e,function(o){return(e.has_content=1<o.length||1===o.length&&(!o[0].wholeText||/\S/.test(o[0].wholeText)),!e.has_content)?(s.custom_partial_url?m(e,t,s).then(function(o){return n.when(u()).then(function(n){if(t.html(n).show(),i(t.contents())(e),t.append(o),s.update_design)return g(e,t,s)})}):s.template?b(e,t,s.design_mode,s.template):b(e,t,s.design_mode),e.$on("refreshPage",function(){return b(e,t,s.design_mode)})):s.custom_partial_url?(m(e,t,s),s.update_design&&g(e,t,s),e.$on("refreshPage",function(){return e.showPage(e.bb.current_page)})):(t.html(o).show(),s.design_mode)?t.append("<style widget_css scoped></style>"):void 0})}}(this))}}}),angular.module("BB.Controllers").controller("bbContentController",function(e){return e.controller="public.controllers.bbContentController",e.initPage=function(){return function(){return e.setPageLoaded(),e.setLoadingPage(!1)}}(this)}),angular.module("BB.Controllers").controller("BBCtrl",function(e,t,s,o,i,n,d,l,c,p,m,u,b,g,h,y,f,v,k,w,S,B,P,L,D,I,C,A,E,T,M,q,R){var O,j,N,F,U,z,G;return e.cid="BBCtrl",e.controller="public.controllers.BBCtrl",e.bb=new w,P.uid=e.bb.uid,e.qs=L,e.company_api_path="/api/v1/company/{company_id}{?embed,category_id}",e.company_admin_api_path="/api/v1/admin/{company_id}/company{?embed,category_id}",e.apiUrl&&(e.bb||(e.bb={}),e.bb.api_url=e.apiUrl),s.bb&&s.bb.api_url&&(e.bb.api_url=s.bb.api_url,e.bb.partial_url=s.bb.partial_url?s.bb.partial_url:""),80!==t.port()&&443!==t.port()?(O=e.bb).api_url||(O.api_url=t.protocol()+"://"+t.host()+":"+t.port()):(j=e.bb).api_url||(j.api_url=t.protocol()+"://"+t.host()),e.bb.stacked_items=[],F=!0,N=l.defer(),s.connection_started=N.promise,G=l.defer(),s.widget_started=G.promise,moment.locale([I,"en"]),s.Route={Company:0,Category:1,Service:2,Person:3,Resource:4,Duration:5,Date:6,Time:7,Client:8,Summary:9,Basket:10,Checkout:11,Slot:12,Event:13,Login:14,Questions:15},e.Route=s.Route,h("<span bb-display-mode></span>")(e,function(){return function(e){return E(g).append(e)}}(this)),e.set_company=function(){return function(t){return e.initWidget(t)}}(this),e.initWidget=function(o){return function(i){var n;if(null==i&&(i={}),o.$init_prms=i,N=l.defer(),s.connection_started=N.promise,(y.webkit&&537>y.webkit||y.msie&&9>=y.msie)&&F){if(e.bb.api_url&&(n=document.createElement("a"),n.href=e.bb.api_url,""===n.host||n.host===t.host()||n.host===t.host()+":"+t.port()))return void e.initWidget2();s.iframe_proxy_ready?e.initWidget2():e.$on("iframe_proxy_ready",function(t,s){if(s.iframe_proxy_ready)return e.initWidget2()})}else e.initWidget2()}}(this),e.initWidget2=function(t){return function(){var n,d,c,p,m,u,b,g,h,y,f,w,B,P,D,I,q,R,O,j;if(e.init_widget_started=!0,B=t.$init_prms,B.query)for(h in P=B.query,P)j=P[h],B[h]=L(j);return B.custom_partial_url?(e.bb.custom_partial_url=B.custom_partial_url,e.bb.partial_id=B.custom_partial_url.substring(B.custom_partial_url.lastIndexOf("/")+1),B.update_design&&(e.bb.update_design=B.update_design)):B.design_mode&&(e.bb.design_mode=B.design_mode),u=e.bb.company_id,B.company_id&&(u=B.company_id),B.affiliate_id&&(e.bb.affiliate_id=B.affiliate_id,s.affiliate_id=B.affiliate_id),B.api_url&&(e.bb.api_url=B.api_url),B.partial_url&&(e.bb.partial_url=B.partial_url),B.page_suffix&&(e.bb.page_suffix=B.page_suffix),B.admin&&(e.bb.isAdmin=B.admin),B.auth_token&&A.setItem("auth_token",B.auth_token),e.bb.app_id=1,e.bb.app_key=1,e.bb.clear_basket=!0,B.basket&&(e.bb.clear_basket=!1),!1===B.clear_basket&&(e.bb.clear_basket=!1),(i.bb_setup||B.client)&&(B.clear_member||(B.clear_member=!0)),e.bb.client_defaults=B.client||{},B.client_defaults&&B.client_defaults.membership_ref&&(e.bb.client_defaults.membership_ref=B.client_defaults.membership_ref),e.bb.client_defaults&&e.bb.client_defaults.name&&(y=e.bb.client_defaults.name.match(/^(\S+)(?:\s(\S+))?/),y&&(e.bb.client_defaults.first_name=y[1],null!=y[2]&&(e.bb.client_defaults.last_name=y[2]))),B.clear_member&&(e.bb.clear_member=B.clear_member,A.removeItem("login")),B.app_id&&(e.bb.app_id=B.app_id),B.app_key&&(e.bb.app_key=B.app_key),B.item_defaults?(e.bb.original_item_defaults=B.item_defaults,e.bb.item_defaults=angular.copy(e.bb.original_item_defaults)):e.bb.original_item_defaults&&(e.bb.item_defaults=angular.copy(e.bb.original_item_defaults)),e.bb.selected_service&&e.bb.selected_service.company_id===u&&(e.bb.item_defaults.service=e.bb.selected_service.id),B.route_format&&(e.bb.setRouteFormat(B.route_format),e.bb_route_init&&e.bb_route_init()),B.locale&&moment.locale(B.locale),B.use_local_time_zone&&T.setUseLocalTimeZone(B.use_local_time_zone),e.hide_page=!0===B.hide,B.from_datetime&&(e.bb.from_datetime=B.from_datetime),B.to_datetime&&(e.bb.to_datetime=B.to_datetime),B.min_date&&(e.bb.min_date=B.min_date),B.max_date&&(e.bb.max_date=B.max_date),B.hide_block&&(e.bb.hide_block=B.hide_block),B.custom_partial_url||(e.bb.path_setup=!0),B.extra_setup&&(e.bb.extra_setup=B.extra_setup,B.extra_setup.step&&(e.bb.starting_step_number=parseInt(B.extra_setup.step)),B.extra_setup.return_url&&(e.bb.return_url=B.extra_setup.return_url),B.extra_setup.destination&&(e.bb.destination=B.extra_setup.destination)),B.booking_settings&&(e.bb.booking_settings=B.booking_settings),B.template&&(e.bb.template=B.template),B.i18n&&T.enableInternationalizaton(),B.login_required&&(e.bb.login_required=!0),B.private_note&&(e.bb.private_note=B.private_note),B.qudini_booking_id&&(e.bb.qudini_booking_id=B.qudini_booking_id),B.scroll_offset&&T.setScrollOffset(B.scroll_offset),T.update_document_title=T.update_document_title||B.update_document_title||!1,t.waiting_for_conn_started_def=l.defer(),e.waiting_for_conn_started=t.waiting_for_conn_started_def.promise,u||e.bb.affiliate_id?e.waiting_for_conn_started=s.connection_started:t.waiting_for_conn_started_def.resolve(),G.resolve(),I=[],D=[],e.bb.affiliate_id&&(n=o.$get(e.bb.api_url+"/api/v1/affiliates/"+e.bb.affiliate_id),D.push(n),n.then(function(t){var s,o;if(e.bb.$wait_for_routing&&I.push(e.bb.$wait_for_routing.promise),e.setAffiliate(new k.Affiliate(t)),e.bb.item_defaults.affiliate=e.affiliate,B.company_ref)return s=l.defer(),o=e.affiliate.getCompanyByRef(B.company_ref),I.push(s.promise),o.then(function(t){return e.setCompany(t,B.keep_basket).then(function(e){return s.resolve(e)},function(e){return s.reject(e)})},function(e){return s.reject(e)})})),u&&(B.embed&&(b=B.embed),b||(b=null),d=null,null!=e.bb.item_defaults.category&&(null==e.bb.item_defaults.category.id?d=e.bb.item_defaults.category:d=e.bb.item_defaults.category.id),c=l.defer(),p=c.promise,f={},A.getItem("auth_token")&&(f.auth_token=A.getItem("auth_token")),e.bb.isAdmin?(m=new M(e.bb.api_url+e.company_admin_api_path).fillFromObject({company_id:u,category_id:d,embed:b}),o.$get(m,f).then(function(e){return c.resolve(e)},function(){return m=new M(e.bb.api_url+e.company_api_path).fillFromObject({company_id:u,category_id:d,embed:b}),o.$get(m,f).then(function(e){return c.resolve(e)},function(e){return c.reject(e)})})):(m=new M(e.bb.api_url+e.company_api_path).fillFromObject({company_id:u,category_id:d,embed:b}),o.$get(m,f).then(function(e){return e?c.resolve(e):c.reject("Invalid company ID "+u)},function(e){return c.reject(e)})),D.push(p),p.then(function(t){var s,i,n,d;return e.bb.$wait_for_routing&&I.push(e.bb.$wait_for_routing.promise),i=new k.Company(t),n=l.defer(),I.push(n.promise),s=null,i.companies&&e.bb.item_defaults.company&&(s=i.findChildCompany(e.bb.item_defaults.company)),s?(d=i,o.$get(e.bb.api_url+"/api/v1/company/"+s.id).then(function(t){return i=new k.Company(t),z(i.id),e.bb.parent_company=d,e.setCompany(i,B.keep_basket).then(function(){return n.resolve()},function(){return n.reject()})},function(){return n.reject()})):(z(i.id),e.setCompany(i,B.keep_basket).then(function(){return n.resolve()},function(){return n.reject()}))}),B.member_sso&&(w={company_id:u,root:e.bb.api_url,member_sso:B.member_sso},R=S.memberLogin(w).then(function(t){return e.setClient(t)}),D.push(R)),B.admin_sso&&(w={company_id:B.parent_company_id?B.parent_company_id:u,root:e.bb.api_url,admin_sso:B.admin_sso},q=S.adminLogin(w).then(function(t){return e.bb.admin=t}),D.push(q)),O=e.bb.item_defaults&&e.bb.item_defaults.long_id?e.bb.item_defaults.long_id:L("total_id"),O&&(w={purchase_id:O,url_root:e.bb.api_url},g=C.query(w).then(function(t){if(e.bb.total=t,0<t.paid)return e.bb.payment_status="complete"}),D.push(g))),e.isLoaded=!1,l.all(D).then(function(){return l.all(I).then(function(){var t,s,o;return!e.bb.basket&&((t=e.bb).basket||(t.basket=new k.Basket(null,e.bb))),e.client||e.clearClient(),o=l.defer(),s=o.promise,e.bb.current_item?o.resolve():s=e.clearBasketItem(),s.then(function(){var t;if(e.client_details||(e.client_details=new k.ClientDetails),e.bb.stacked_items||(e.bb.stacked_items=[]),(e.bb.company||e.bb.affiliate)&&(N.resolve(),e.done_starting=!0,!B.no_route))return t=null,F&&E.isEmptyObject(e.bb.routeSteps)&&(t=e.bb.firstStep),B.first_page&&(t=B.first_page),F=!1,e.decideNextPage(t)})},function(t){return N.reject("Failed to start widget"),e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},function(t){return N.reject("Failed to start widget"),e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),z=function(){return function(t){var s,i,n,d,c,p,m,u,b,g,h,y;if(n=l.defer(),F||e.bb.orginal_company_id&&e.bb.orginal_company_id!==t){if(e.bb.orginal_company_id=t,e.bb.default_setup_promises=[],e.bb.item_defaults.query)for(m in b=e.bb.item_defaults.query,b)y=b[m],e.bb.item_defaults[m]=L(y);e.bb.item_defaults.resource&&(g=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/resources/"+e.bb.item_defaults.resource):o.$get(e.bb.api_url+"/api/v1/"+t+"/resources/"+e.bb.item_defaults.resource),e.bb.default_setup_promises.push(g),g.then(function(t){return e.bb.item_defaults.resource=new k.Resource(t)})),e.bb.item_defaults.person&&(u=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/people/"+e.bb.item_defaults.person):o.$get(e.bb.api_url+"/api/v1/"+t+"/people/"+e.bb.item_defaults.person),e.bb.default_setup_promises.push(u),u.then(function(t){return e.bb.item_defaults.person=new k.Person(t)})),e.bb.item_defaults.person_ref&&(u=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/people/find_by_ref/"+e.bb.item_defaults.person_ref):o.$get(e.bb.api_url+"/api/v1/"+t+"/people/find_by_ref/"+e.bb.item_defaults.person_ref),e.bb.default_setup_promises.push(u),u.then(function(t){return e.bb.item_defaults.person=new k.Person(t)})),e.bb.item_defaults.service&&(h=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/services/"+e.bb.item_defaults.service):o.$get(e.bb.api_url+"/api/v1/"+t+"/services/"+e.bb.item_defaults.service),e.bb.default_setup_promises.push(h),h.then(function(t){return e.bb.item_defaults.service=new k.Service(t)})),e.bb.item_defaults.service_ref&&(h=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/services?api_ref="+e.bb.item_defaults.service_ref):o.$get(e.bb.api_url+"/api/v1/"+t+"/services?api_ref="+e.bb.item_defaults.service_ref),e.bb.default_setup_promises.push(h),h.then(function(t){return e.bb.item_defaults.service=new k.Service(t)})),e.bb.item_defaults.event_group&&(p=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/event_groups/"+e.bb.item_defaults.event_group):o.$get(e.bb.api_url+"/api/v1/"+t+"/event_groups/"+e.bb.item_defaults.event_group),e.bb.default_setup_promises.push(p),p.then(function(t){return e.bb.item_defaults.event_group=new k.EventGroup(t)})),e.bb.item_defaults.event&&(d=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/event_chains/"+e.bb.item_defaults.event_chain+"/events/"+e.bb.item_defaults.event):o.$get(e.bb.api_url+"/api/v1/"+t+"/events/"+e.bb.item_defaults.event),e.bb.default_setup_promises.push(d),d.then(function(t){return e.bb.item_defaults.event=new k.Event(t)})),e.bb.item_defaults.event_chain&&(c=e.bb.isAdmin?o.$get(e.bb.api_url+"/api/v1/admin/"+t+"/event_chains/"+e.bb.item_defaults.event_chain):o.$get(e.bb.api_url+"/api/v1/"+t+"/event_chains/"+e.bb.item_defaults.event_chain),e.bb.default_setup_promises.push(c),c.then(function(t){return e.bb.item_defaults.event_chain=new k.EventChain(t)})),e.bb.item_defaults.category&&(s=o.$get(e.bb.api_url+"/api/v1/"+t+"/categories/"+e.bb.item_defaults.category),e.bb.default_setup_promises.push(s),s.then(function(t){return e.bb.item_defaults.category=new k.Category(t)})),e.bb.item_defaults.clinic&&(i=o.$get(e.bb.api_url+"/api/v1/"+t+"/clinics/"+e.bb.item_defaults.clinic),e.bb.default_setup_promises.push(i),i.then(function(t){return e.bb.item_defaults.clinic=new k.Clinic(t)})),e.bb.item_defaults.duration&&(e.bb.item_defaults.duration=parseInt(e.bb.item_defaults.duration)),l.all(e.bb.default_setup_promises)["finally"](function(){return n.resolve()})}else n.resolve();return n.promise}}(this),e.setLoadingPage=function(){return function(t){return e.loading_page=t}}(this),e.isLoadingPage=function(){return function(){return e.loading_page}}(this),e.$on("$locationChangeStart",function(){var t;if(e.bb.routeFormat)return(!e.bb.routing||T.isModalOpen())&&(t=e.bb.matchURLToStep(),null!=t&&t>e.bb.current_step?e.loadStep(t):e.loadPreviousStep("locationChangeStart")),e.bb.routing=!1}),e.showPage=function(){return function(t,o){if(e.bb.updateRoute(t),e.jumped=!1,!e.isLoadingPage())return e.setLoadingPage(!0),e.bb.current_page===t?(e.bb_main="",setTimeout(function(){return e.bb_main=b.trustAsResourceUrl(e.bb.pageURL(t)),e.$apply()},0)):(u.clear(),e.bb.current_page=t,!o&&e.bb.recordCurrentPage(),e.notLoaded(e),e.bb_main=b.trustAsResourceUrl(e.bb.pageURL(t))),s.$broadcast("page:loaded")}}(this),e.jumpToPage=function(){return function(t){return e.current_page=t,e.jumped=!0,e.bb_main=b.trustAsResourceUrl(e.partial_url+t+e.page_suffix)}}(this),e.clearPage=function(){return e.bb_main=""},e.getPartial=function(t){return e.bb.pageURL(t)},e.setPageLoaded=function(){return e.setLoaded(e)},e.setPageRoute=function(){return function(t){return e.bb.current_page_route=t,!!(e.bb.routeSteps&&e.bb.routeSteps[t])&&(e.showPage(e.bb.routeSteps[t]),!0)}}(this),e.decideNextPage=function(t){if(t){if("none"===t)return;if(e.bb.total&&"complete"===e.bb.payment_status)e.showPage("confirmation");else return e.showPage(t)}return e.bb.nextSteps&&e.bb.current_page&&e.bb.nextSteps[e.bb.current_page]&&!e.bb.routeSteps?e.showPage(e.bb.nextSteps[e.bb.current_page]):(!e.client.valid()&&m.isLoggedIn()&&(e.client=new k.Client(m.member()._data)),e.bb.company&&e.bb.company.companies||!e.bb.company&&e.affiliate)?e.setPageRoute(s.Route.Company)?void 0:e.showPage("company_list"):e.bb.total&&"complete"===e.bb.payment_status?e.showPage("confirmation"):e.bb.total&&"pending"===e.bb.payment_status?e.showPage("payment"):(!e.bb.company.$has("event_groups")||e.bb.current_item.event_group||e.bb.current_item.service||e.bb.current_item.product||e.bb.current_item.deal)&&(!e.bb.company.$has("events")||!e.bb.current_item.event_group||null!=e.bb.current_item.event||e.bb.current_item.product||e.bb.current_item.deal)?!e.bb.company.$has("events")||!e.bb.current_item.event||e.bb.current_item.num_book||e.bb.current_item.tickets&&e.bb.current_item.tickets.qty||e.bb.current_item.product||e.bb.current_item.deal?!e.bb.company.$has("services")||e.bb.current_item.service||null!=e.bb.current_item.event||e.bb.current_item.product||e.bb.current_item.deal?!e.bb.company.$has("resources")||e.bb.current_item.resource||null!=e.bb.current_item.event||e.bb.current_item.product||e.bb.current_item.deal?!e.bb.company.$has("people")||e.bb.current_item.person||null!=e.bb.current_item.event||e.bb.current_item.product||e.bb.current_item.deal?e.bb.current_item.duration||null!=e.bb.current_item.event||e.bb.current_item.product||e.bb.current_item.deal?!e.bb.current_item.days_link||e.bb.current_item.date||null!=e.bb.current_item.event||e.bb.current_item.deal?!e.bb.current_item.days_link||e.bb.current_item.time||null!=e.bb.current_item.event||e.bb.current_item.service&&"day"===e.bb.current_item.service.duration_unit||e.bb.current_item.deal?!e.bb.moving_booking||e.bb.current_item.ready&&e.bb.current_item.move_done?e.client.valid()?e.bb.current_item.item_details&&e.bb.current_item.item_details.hasQuestions&&!e.bb.current_item.asked_questions?e.setPageRoute(s.Route.Questions)?void 0:e.showPage("check_items"):e.bb.moving_booking&&e.bb.basket.itemsReady()?e.showPage("purchase"):e.bb.basket.readyToCheckout()?e.bb.usingBasket&&(!e.bb.confirmCheckout||e.bb.company_settings.has_vouchers||e.bb.company.$has("coupon"))?e.setPageRoute(s.Route.Basket)?void 0:e.showPage("basket"):e.bb.basket.readyToCheckout()&&null===e.bb.payment_status&&!e.bb.basket.waiting_for_checkout?e.setPageRoute(s.Route.Checkout)?void 0:e.showPage("checkout"):"complete"===e.bb.payment_status?e.showPage("confirmation"):void 0:e.setPageRoute(s.Route.Summary)?void 0:e.showPage("basket_summary"):e.setPageRoute(s.Route.Client)?void 0:e.showPage("client"):e.showPage("check_move"):e.setPageRoute(s.Route.Time)?void 0:e.showPage("time"):e.bb.company.$has("availability_slots")?e.setPageRoute(s.Route.Slot)?void 0:e.showPage("slot_list"):e.setPageRoute(s.Route.Date)?void 0:e.showPage("calendar"):e.setPageRoute(s.Route.Duration)?void 0:e.showPage("duration_list"):e.setPageRoute(s.Route.Person)?void 0:e.showPage("person_list"):e.setPageRoute(s.Route.Resource)?void 0:e.showPage("resource_list"):e.setPageRoute(s.Route.Service)?void 0:e.showPage("service_list"):e.showPage("event"):e.setPageRoute(s.Route.Event)?void 0:e.showPage("event_list")},e.showCheckout=function(){return e.bb.current_item.ready},e.addItemToBasket=function(){var t;if(t=l.defer(),!e.bb.current_item.submitted&&!e.bb.moving_booking)e.moveToBasket(),e.bb.current_item.submitted=e.updateBasket(),e.bb.current_item.submitted.then(function(e){return t.resolve(e)},function(s){return 409===s.status&&(e.bb.current_item.person=null,e.bb.current_item.resource=null,e.bb.current_item.setTime(null),e.bb.current_item.service&&e.bb.current_item.setService(e.bb.current_item.service)),e.bb.current_item.submitted=null,t.reject(s)});else{if(e.bb.current_item.submitted)return e.bb.current_item.submitted;t.resolve()}return t.promise},e.updateBasket=function(){var t,i,n;return i=e.bb.current_item.ref,t=l.defer(),n={member_id:e.client.id,member:e.client,items:e.bb.basket.items,bb:e.bb},p.updateBasket(e.bb.company,n).then(function(s){var n,d,l,c,p;for(p=s.items,l=0,c=p.length;l<c;l++)d=p[l],d.storeDefaults(e.bb.item_defaults);return o.clearCache("time_data"),o.clearCache("events"),s.setSettings(e.bb.basket.settings),e.setBasket(s),n=_.find(s.items,function(e){return e.ref===i}),n||(n=_.last(s.items)),e.setBasketItem(n),e.bb.current_item?t.resolve(s):e.clearBasketItem().then(function(){return t.resolve(s)})},function(i){var n;if(t.reject(i),409===i.status)return o.clearCache("time_data"),o.clearCache("events"),e.bb.current_item.person=null,n=f.open({templateUrl:e.getPartial("_error_modal"),controller:function(e,t){return e.message=B.getError("ITEM_NO_LONGER_AVAILABLE").msg,e.ok=function(){return t.close()}}}),n.result["finally"](function(){if(!e.bb.nextSteps)return e.decideNextPage();if(e.setPageRoute(s.Route.Date));else if(e.setPageRoute(s.Route.Event));else return e.loadPreviousStep()})}),t.promise},e.emptyBasket=function(){var t;if(e.bb.basket.items&&(!e.bb.basket.items||0!==e.bb.basket.items.length))return t=l.defer(),p.empty(e.bb).then(function(s){return e.bb.current_item.id&&delete e.bb.current_item.id,e.setBasket(s),t.resolve()},function(){return t.reject()}),t.promise},e.deleteBasketItem=function(t){return p.deleteItem(t,e.bb.company,{bb:e.bb}).then(function(t){return e.setBasket(t)})},e.deleteBasketItems=function(t){var s,o,i,n;for(n=[],o=0,i=t.length;o<i;o++)s=t[o],n.push(p.deleteItem(s,e.bb.company,{bb:e.bb}).then(function(t){return e.setBasket(t)}));return n},e.clearBasketItem=function(){var t;return t=l.defer(),e.setBasketItem(new k.BasketItem(null,e.bb)),e.bb.default_setup_promises?l.all(e.bb.default_setup_promises)["finally"](function(){return e.bb.current_item.setDefaults(e.bb.item_defaults),l.all(e.bb.current_item.promises)["finally"](function(){return t.resolve()})}):(e.bb.current_item.setDefaults({}),t.resolve()),t.promise},e.setBasketItem=function(t){return e.bb.current_item=t,e.current_item=e.bb.current_item},e.setReadyToCheckout=function(t){return e.bb.confirmCheckout=t},e.moveToBasket=function(){return e.bb.basket.addItem(e.bb.current_item)},e.quickEmptybasket=function(t){var s,o;return o=!!(t&&t.preserve_stacked_items),o?(e.bb.basket=new k.Basket(null,e.bb),e.basket=e.bb.basket,e.bb.basket.company_id=e.bb.company_id,s=l.defer(),s.resolve(),s.promise):(e.bb.stacked_items=[],e.setBasket(new k.Basket(null,e.bb)),e.clearBasketItem())},e.setBasket=function(t){if(e.bb.basket=t,e.basket=t,e.bb.basket.company_id=e.bb.company_id,e.bb.stacked_items)return e.bb.setStackedItems(t.timeItems())},e.logout=function(t){return e.client&&e.client.valid()?m.logout({root:e.bb.api_url}).then(function(){return e.client=new k.Client,e.decideNextPage(t)}):e.member?m.logout({root:e.bb.api_url}).then(function(){return e.member=new k.Member.Member,e.decideNextPage(t)}):void 0},e.setAffiliate=function(t){return e.bb.affiliate_id=t.id,e.bb.affiliate=t,e.affiliate=t,e.affiliate_id=t.id},U=function(){var t;return t=l.defer(),e.quickEmptybasket().then(function(){var s,i,n,d,c;return s=R.getItem("auth_token")||A.getItem("auth_token"),i=e.bb.api_url+"/api/v1/status{?company_id,affiliate_id,clear_baskets,clear_member}",n={company_id:e.bb.company_id,affiliate_id:e.bb.affiliate_id,clear_baskets:e.bb.clear_basket?"1":null,clear_member:e.bb.clear_member?"1":null},c=new M(i).fillFromObject(n),d=o.$get(c,{auth_token:s,no_cache:!0}),d.then(function(){return function(s){return s.$has("client")&&s.$get("client").then(function(t){if(!e.client||e.client&&!e.client.valid())return e.client=new k.Client(t)}),s.$has("member")&&s.$get("member").then(function(t){if("Contact"!==t.client_type)return t=m.setLogin(t),e.setClient(t)}),e.bb.clear_basket?t.resolve():s.$has("baskets")?s.$get("baskets").then(function(s){var o;return o=_.find(s,function(t){return parseInt(t.company_id)===e.bb.company_id}),o?(o=new k.Basket(o,e.bb),o.$get("items").then(function(s){var n,d,c,p;for(s=function(){var e,t,o;for(o=[],e=0,t=s.length;e<t;e++)n=s[e],o.push(new k.BasketItem(n));return o}(),d=0,c=s.length;d<c;d++)n=s[d],o.addItem(n);return e.setBasket(o),p=[].concat.apply([],function(){var e,t,o;for(o=[],e=0,t=s.length;e<t;e++)n=s[e],o.push(n.promises);return o}()),l.all(p).then(function(){return 0<o.items.length&&e.setBasketItem(o.items[0]),t.resolve()})})):t.resolve()}):t.resolve()}}(this),function(){return t.resolve()})}),t.promise},e.setCompany=function(t,o){var i;return i=l.defer(),e.bb.company_id=t.id,e.bb.company=t,e.company=t,e.bb.item_defaults.company=e.bb.company,T.setCountryCode(t.country_code),T.setCurrency(t.currency_code),T.setTimeZone(t.timezone),t.$has("settings")?t.getSettings().then(function(){return function(t){return e.bb.company_settings=t,e.bb.company_settings.merge_resources&&(e.bb.item_defaults.merge_resources=!0),e.bb.company_settings.merge_people&&(e.bb.item_defaults.merge_people=!0),s.bb_currency=e.bb.company_settings.currency,e.bb.currency=e.bb.company_settings.currency,e.bb.has_prices=e.bb.company_settings.has_prices,e.bb.basket&&(e.bb.basket.company_id===e.bb.company_id||o)?(i.resolve(),e.$emit("company:setup")):U().then(function(){return i.resolve(),e.$emit("company:setup")})}}(this)):e.bb.basket&&(e.bb.basket.company_id===e.bb.company_id||o)?(i.resolve(),e.$emit("company:setup")):U().then(function(){return i.resolve(),e.$emit("company:setup")}),i.promise},e.recordStep=function(t,s){return e.bb.recordStep(t,s)},e.setStepTitle=function(t){return e.bb.steps[e.bb.current_step-1].title=t},e.getCurrentStepTitle=function(){var t;if(t=e.bb.steps,_.compact(t).length&&(1!==t.length||t[0].number===e.bb.current_step)||(t=e.bb.allSteps),e.bb.current_step)return t[e.bb.current_step-1].title},e.checkStepTitle=function(t){if(e.bb.steps[e.bb.current_step-1]&&!e.bb.steps[e.bb.current_step-1].title)return e.setStepTitle(t)},e.loadStep=function(t){var s,o,i,n,d;if(t!==e.bb.current_step&&(e.bb.calculatePercentageComplete(t),d=e.bb.steps[t],i=e.bb.steps[t-1],d&&!i&&(i=d),d||(d=i),d&&!e.bb.last_step_reached&&((!d.stacked_length||0===d.stacked_length)&&(e.bb.stacked_items=[]),e.bb.current_item.loadStep(d.current_item),1<e.bb.steps.length&&e.bb.steps.splice(t,e.bb.steps.length-t),e.bb.current_step=t,e.showPage(i.page,!0)),e.bb.allSteps)){for(n=e.bb.allSteps,s=0,o=n.length;s<o;s++)t=n[s],t.active=!1,t.passed=t.number<e.bb.current_step;if(e.bb.allSteps[e.bb.current_step-1])return e.bb.allSteps[e.bb.current_step-1].active=!0}},e.loadPreviousStep=function(t){var s,o,i,n;for(i=_.reject(e.bb.steps,function(t){return t.number>=e.bb.current_step}),n=0;i[0]&&(s=i.pop(),!!s);)if(!s.skipped){n=s.number;break}if(e.bb.routeFormat&&(o=0===n?e.bb.current_step+1:e.bb.current_step-n,"locationChangeStart"===t&&o--,0<o&&window.history.go(-1*o)),0<n)return e.loadStep(n)},e.loadStepByPageName=function(t){var s,o,i,n;for(i=e.bb.allSteps,s=0,o=i.length;s<o;s++)if(n=i[s],n.page===t)return e.loadStep(n.number);return e.loadStep(1)},e.reset=function(){return s.$broadcast("clear:formData"),s.$broadcast("widget:restart"),e.setLastSelectedDate(null),m.isLoggedIn()||(e.client=new k.Client),e.bb.last_step_reached=!1,e.bb.steps.splice(1)},e.restart=function(){return e.reset(),e.loadStep(1)},e.setRoute=function(t){return e.bb.setRoute(t)},e.setBasicRoute=function(t){return e.bb.setBasicRoute(t)},e.skipThisStep=function(){if(e.bb.steps[e.bb.steps.length-1])return e.bb.steps[e.bb.steps.length-1].skipped=!0},e.setUsingBasket=function(){return function(t){return e.bb.usingBasket=t}}(this),e.setClient=function(){return function(t){if(e.client=t,t.postcode&&!e.bb.postcode)return e.bb.postcode=t.postcode}}(this),e.clearClient=function(){return function(){if(e.client=new k.Client,i.bb_setup&&e.client.setDefaults(i.bb_setup),e.bb.client_defaults)return e.client.setDefaults(e.bb.client_defaults)}}(this),e.parseDate=function(){return function(e){return moment(e)}}(this),e.getUrlParam=function(){return function(e){return i.getURIparam(e)}}(this),e.base64encode=function(){return function(e){return i.btoa(e)}}(this),e.setLastSelectedDate=function(){return function(t){return e.last_selected_date=t}}(this),e.setLoaded=function(t){var o;for(t.$emit("hide:loader",t),t.isLoaded=!0,o=!0;t;)t.hasOwnProperty("scopeLoaded")&&(e.areScopesLoaded(t)?t.scopeLoaded=!0:o=!1),t=t.$parent;o&&s.$broadcast("loading:finished")},e.setLoadedAndShowError=function(e,t,s){return v.warn(t,s),e.setLoaded(e),t&&409===t.status?"Rule checking failed"===t.data.error?u.danger(B.createCustomError(t.data.message)):u.danger(B.getError("ITEM_NO_LONGER_AVAILABLE")):t&&t.data&&"Number of Bookings exceeds the maximum"===t.data.error?u.danger(B.getError("MAXIMUM_TICKETS")):u.danger(B.getError("GENERIC"))},e.areScopesLoaded=function(t){var s;if(t.hasOwnProperty("isLoaded")&&!t.isLoaded)return!1;for(s=t.$$childHead;s;){if(!e.areScopesLoaded(s))return!1;s=s.$$nextSibling}return!0},e.notLoaded=function(t){for(e.$emit("show:loader",e),t.isLoaded=!1;t;)t.hasOwnProperty("scopeLoaded")&&(t.scopeLoaded=!1),t=t.$parent},e.broadcastItemUpdate=function(){return function(){return e.$broadcast("currentItemUpdate",e.bb.current_item)}}(this),e.hidePage=function(){return e.hide_page=!0},e.bb.company_set=function(){return null!=e.bb.company_id},e.isAdmin=function(){return e.bb.isAdmin},e.isAdminIFrame=function(){var t,s;if(!e.bb.isAdmin)return!1;try{return s=i.parent.location.href,!!(s&&i.parent.reload_dashboard)}catch(e){return t=e,!1}},e.reloadDashboard=function(){return i.parent.reload_dashboard()},e.$debounce=function(t){return!e._debouncing&&(t||(t=100),e._debouncing=!0,c(function(){return e._debouncing=!1},t))},e.supportsTouch=function(){return Modernizr.touch},s.$on("show:loader",function(){return e.loading=!0}),s.$on("hide:loader",function(){return e.loading=!1}),e.isMemberLoggedIn=function(){return m.isLoggedIn()},e.scrollTo=function(e){return t.hash(e),q()},e.redirectTo=function(e){return i.location.href=e}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbMiniBasket",function(){return{restrict:"AE",replace:!0,scope:!0,controller:function(e){return e.controller="public.controllers.MiniBasket",e.setUsingBasket(!0)}}}),angular.module("BB.Directives").directive("bbBasketList",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"BasketList"}}),angular.module("BB.Controllers").controller("BasketList",function(e,t,s,o,i,n,d,l,c){var p;return e.controller="public.controllers.BasketList",e.setUsingBasket(!0),e.show_wallet=e.bb.company_settings.hasOwnProperty("has_wallets")&&e.bb.company_settings.has_wallets&&e.client.valid()&&c.isLoggedIn()&&c.member().id===e.client.id&&e.client.has_active_wallet,e.bb.basket.setSettings(e.$eval(s.bbBasketList)||{}),o.connection_started.then(function(){var t,s,o,d,l,c;if(e.client&&e.bb.basket.setClient(e.client),e.client.$has("pre_paid_bookings")&&0<e.bb.basket.timeItems().length){for(e.notLoaded(e),l=[],c=e.bb.basket.timeItems(),(s=0,o=c.length);s<o;s++)t=c[s],d={event_id:t.getEventId()},l.push(e.client.getPrePaidBookingsPromise(d));return n.all(l).then(function(s){var o,i,n,d,c,u,b,g,h,y,f,v,w;for(o={},n=0,u=s.length;n<u;n++)for(t=s[n],d=0,b=t.length;d<b;d++)f=t[d],o[f.id]=f.number_of_bookings_remaining;for(w=e.bb.basket.timeItems(),i=c=0,g=w.length;c<g;i=++c)if(t=w[i],v=s[i],e.bb.basket.settings&&e.bb.basket.settings.auto_use_prepaid_bookings&&0<v.length&&0<t.price)for(i=y=0,h=v.length;y<h;i=++y)if(f=v[i],0<o[f.id]){t.setPrepaidBooking(f),o[f.id]-=1;break}return e.bb.basket.settings.auto_use_prepaid_bookings?e.updateBasket().then(function(){return p(e.bb.basket.timeItems())},function(){return e.setLoaded(e)}):p(e.bb.basket.timeItems())})}return p(e.bb.basket.timeItems())}),e.deleteGroupItem=function(){return function(t){return e.deleteBasketItems(t),e.multi_basket_grouping=_.without(e.multi_basket_grouping,t)}}(this),e.editGroupItem=function(){return function(t,s){return e.bb.current_item=t[0],e.decideNextPage(s)}}(this),e.groupPrice=function(e){var t,s,o,n;for(t=0,s=0,n=e.length;s<n;s++)o=e[s],t+=o.total_price;return t},e.groupTicketQty=function(e){var t,s,o,n;for(t=0,s=0,n=e.length;s<n;s++)o=e[s],t+=o.tickets.qty;return t},p=function(){return e.multi_basket_grouping=_.groupBy(e.bb.basket.timeItems(),"event_id"),e.multi_basket_grouping=_.values(e.multi_basket_grouping),e.setLoaded(e)},e.addAnother=function(){return function(t){return e.clearBasketItem(),e.bb.emptyStackedItems(),e.decideNextPage(t)}}(this),e.checkout=function(){return function(t){return e.bb.basket.settings&&e.bb.basket.settings.requires_deal&&!e.bb.basket.hasDeal()?(d.raise("GIFT_CERTIFICATE_REQUIRED"),!1):0<e.bb.basket.items.length?(e.setReadyToCheckout(!0),!!e.$parent.$has_page_control||e.decideNextPage(t)):(d.raise("EMPTY_BASKET_FOR_CHECKOUT"),!1)}}(this),e.setReady=function(){return e.checkout()},e.applyCoupon=function(){return function(t){var s;return d.clear(),e.notLoaded(e),s={bb:e.bb,coupon:t},i.applyCoupon(e.bb.company,s).then(function(t){var s,o,n,d;for(d=t.items,s=0,n=d.length;s<n;s++)o=d[s],o.storeDefaults(e.bb.item_defaults);return t.setSettings(e.bb.basket.settings),e.setBasket(t),e.setLoaded(e)},function(t){return t&&t.data&&t.data.error&&(d.clear(),d.add("danger",{msg:t.data.error})),e.setLoaded(e)})}}(this),e.applyDeal=function(){return function(t){var s;return d.clear(),s=e.client?{bb:e.bb,deal_code:t,member_id:e.client.id}:{bb:e.bb,deal_code:t,member_id:null},i.applyDeal(e.bb.company,s).then(function(t){var s,o,n,d;for(d=t.items,s=0,n=d.length;s<n;s++)o=d[s],o.storeDefaults(e.bb.item_defaults);return t.setSettings(e.bb.basket.settings),e.setBasket(t),e.items=e.bb.basket.items,e.deal_code=null},function(e){if(e&&e.data&&e.data.error)return d.clear(),d.add("danger",{msg:e.data.error})})}}(this),e.removeDeal=function(){return function(t){var s;return s={bb:e.bb,deal_code_id:t.id},i.removeDeal(e.bb.company,s).then(function(t){var s,o,n,d;for(d=t.items,s=0,n=d.length;s<n;s++)o=d[s],o.storeDefaults(e.bb.item_defaults);return t.setSettings(e.bb.basket.settings),e.setBasket(t),e.items=e.bb.basket.items},function(e){if(e&&e.data&&e.data.error)return d.clear(),d.add("danger",{msg:e.data.error})})}}(this),e.topUpWallet=function(){return e.decideNextPage("basket_wallet")}})}.call(this),function(){angular.module("BB.Directives").directive("bbBasketSummary",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"BasketSummary"}}),angular.module("BB.Controllers").controller("BasketSummary",function(e){return e.controller="public.controllers.BasketSummary",e.basket_items=e.bb.basket.items,e.confirm=function(){return function(){return e.bb.basket.reviewed=!0,e.decideNextPage()}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbBulkPurchases",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"BulkPurchase"}}),angular.module("BB.Controllers").controller("BulkPurchase",function(e,t,s){return e.controller="public.controllers.BulkPurchase",t.connection_started.then(function(){if(e.bb.company)return e.init(e.bb.company)}),e.init=function(t){return e.booking_item||(e.booking_item=e.bb.current_item),s.query(t).then(function(t){return e.bulk_purchases=t})},e.selectItem=function(t,s){return e.$parent.$has_page_control?(e.bulk_purchase=t,!1):(e.booking_item.setBulkPurchase(t),e.decideNextPage(s),!0)},e.setReady=function(){return function(){return!!e.bulk_purchase&&(e.booking_item.setBulkPurchase(e.bulk_purchase),!0)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbCategories",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"CategoryList"}}),angular.module("BB.Controllers").controller("CategoryList",function(e,t,s,o,i){return e.controller="public.controllers.CategoryList",e.notLoaded(e),angular.extend(this,new i(e,o)),t.connection_started.then(function(){return function(){if(e.bb.company)return e.init(e.bb.company)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(){return function(o){return s.query(o).then(function(s){return e.items=s,1===s.length&&(e.skipThisStep(),t.categories=s,e.selectItem(s[0],e.nextRoute)),e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),e.selectItem=function(){return function(t,s){return e.bb.current_item.setCategory(t),e.decideNextPage(s)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbCheckout",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"Checkout"}}),angular.module("BB.Controllers").controller("Checkout",function(e,t,s,o,i,n,d,l,c,p){return e.controller="public.controllers.Checkout",e.notLoaded(e),e.options=e.$eval(s.bbCheckout)||{},c.destroy(e),t.connection_started.then(function(){return function(){return e.checkout()}}(this)),e.checkout=function(){return e.bb.basket.setClient(e.client),e.options.no_notifications&&(e.bb.no_notifications=e.options.no_notifications),e.loadingTotal=o.checkout(e.bb.company,e.bb.basket,{bb:e.bb}),e.loadingTotal.then(function(){return function(t){return e.total=t,t.$has("new_payment")||(e.$emit("checkout:success",t),e.bb.total=e.total,e.bb.payment_status="complete",e.options.disable_confirmation?e.reset():(e.skipThisStep(),e.decideNextPage())),e.checkoutSuccess=!0,e.setLoaded(e)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong"),e.checkoutFailed=!0,e.$emit("checkout:fail",t)})},e.print=function(){return function(){return d.open(e.bb.partial_url+"print_purchase.html?id="+e.total.long_id,"_blank","width=700,height=500,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0"),!0}}(this),e.printElement=function(e,t){var s,o;return s=l("#"+e).html(),o=d.open("","","height=600,width=800"),p(function(){return o.document.write("<html><head><title>Booking Confirmation</title>"),t&&o.document.write("<link rel=\"stylesheet\" href=\""+t+"\" type=\"text/css\" />"),o.document.write("</head><body>"),o.document.write(s),o.document.write("</body></html>"),p(function(){return o.document.close(),o.focus(),o.print(),o.close()},100)},2e3)}})}.call(this),function(){angular.module("BB.Directives").directive("bbClientDetails",function(e,t,s){return{restrict:"AE",replace:!0,scope:!0,transclude:!0,controller:"ClientDetails",link:function(o,i,n,d,l){return l(o,function(){return function(n){var d;return d=1<n.length||1===n.length&&(!n[0].wholeText||/\S/.test(n[0].wholeText)),d?i.html(n).show():e.when(t.get("client_form.html")).then(function(e){return i.html(e).show(),s(i.contents())(o)})}}(this))}}}),angular.module("BB.Controllers").controller("ClientDetails",function(e,t,s,o,i,n,d,l,c,p){var m,u;return e.controller="public.controllers.ClientDetails",e.notLoaded(e),e.validator=l,e.existing_member=!1,e.login_error=!1,u=e.$eval(t.bbClientDetails)||{},e.suppress_client_create=null!=t.bbSuppressCreate||u.suppress_client_create,s.connection_started.then(function(){return function(){return e.initClientDetails()}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),s.$watch("member",function(){return function(){if(!e.client.valid()&&n.isLoggedIn())return e.setClient(new d.Client(n.member()._data))}}(this)),e.initClientDetails=function(){return!e.client.valid()&&n.isLoggedIn()&&e.setClient(new d.Client(n.member()._data)),n.isLoggedIn()&&n.member().$has("child_clients")&&n.member()&&n.member().getChildClientsPromise().then(function(){return function(t){return e.bb.parent_client=new d.Client(n.member()._data),e.bb.child_clients=t,e.bb.basket.parent_client_id=e.bb.parent_client.id}}(this)),e.client.client_details?(e.client_details=e.client.client_details,e.client_details.questions&&c.checkConditionalQuestions(e.client_details.questions),e.setLoaded(e)):o.query(e.bb.company).then(function(){return function(t){return e.client_details=t,e.client&&e.client.pre_fill_answers(e.client_details),e.client_details.questions&&c.checkConditionalQuestions(e.client_details.questions),e.setLoaded(e)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},e.validateClient=function(){return function(t,s){return e.notLoaded(e),e.existing_member=!1,e.bb&&e.bb.parent_client&&(e.client.parent_client_id=e.bb.parent_client.id),e.client.setClientDetails(e.client_details),i.create_or_update(e.bb.company,e.client).then(function(t){return e.setLoaded(e),e.setClient(t),e.bb.isAdmin&&e.client.setValid(!0),e.existing_member=!1,e.decideNextPage(s)},function(e){return m(e)})}}(this),e.clientLogin=function(){return function(){if(e.login_error=!1,e.login)return n.companyLogin(e.bb.company,{},{email:e.login.email,password:e.login.password}).then(function(t){return e.setClient(new d.Client(t)),e.login_error=!1,e.decideNextPage()},function(){return e.login_error=!0,e.setLoaded(e),p.raise("LOGIN_FAILED")})}}(this),e.setReady=function(){return function(){var t;return e.client.setClientDetails(e.client_details),!!e.suppress_client_create||(t=i.create_or_update(e.bb.company,e.client),t.then(function(t){if(e.setLoaded(e),e.setClient(t),t.waitingQuestions)return t.gotQuestions.then(function(){return e.client_details=t.client_details})},function(e){return m(e)}),t)}}(this),e.clientSearch=function(){return null!=e.client&&null!=e.client.email&&""!==e.client.email?(e.notLoaded(e),i.query_by_email(e.bb.company,e.client.email).then(function(t){return null!=t&&(e.setClient(t),e.client=t),e.setLoaded(e)},function(){return e.setLoaded(e)})):(e.setClient({}),e.client={})},e.switchNumber=function(t){return e.no_mobile=!e.no_mobile,"mobile"===t?(e.bb.basket.setSettings({send_sms_reminder:!0}),e.client.phone=null):(e.bb.basket.setSettings({send_sms_reminder:!1}),e.client.mobile=null)},e.getQuestion=function(t){var s,o,n,d;for(d=e.client_details.questions,s=0,o=d.length;s<o;s++)if(n=d[s],n.id===t)return n;return null},e.useClient=function(t){return e.setClient(t)},e.recalc_question=function(){if(e.client_details.questions)return c.checkConditionalQuestions(e.client_details.questions)},m=function(t){return"Please Login"===t.data.error?(e.existing_member=!0,p.raise("ALREADY_REGISTERED")):"Invalid Password"===t.data.error&&p.raise("PASSWORD_INVALID"),e.setLoaded(e)}})}.call(this),function(){'use strict';var e=Math.atan2,t=Math.sqrt,s=Math.cos,o=Math.sin,n=Math.PI,d;d=function(e,t,s,o){var i;return e.controller="public.controllers.CompanyList",e.notLoaded(e),i=e.$eval(o.bbCompanies),t.connection_started.then(function(){return function(){return e.bb.company.companies?(e.init(e.bb.company),t.parent_id=e.bb.company.id):t.parent_id?void e.initWidget({company_id:t.parent_id,first_page:e.bb.current_page}):e.init(e.bb.company)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(){return function(){return e.companies=e.bb.company.companies,e.companies&&0!==e.companies.length||(e.companies=[e.bb.company]),1===e.companies.length?(e.skipThisStep(),e.selectItem(e.companies[0])):i&&i.hide_not_live_stores?e.items=e.companies.filter(function(e){return e.live}):e.items=e.companies,e.setLoaded(e)}}(this),e.selectItem=function(){return function(t){var s,o;return s=angular.isNumber(t)?t:t.id,e.notLoaded(e),o={company_id:s},e.initWidget(o)}}(this),e.splitString=function(e){var t,s;return t=e.name.split(" "),s=t[2]?t[2]:""}},angular.module("BB.Directives").directive("bbCompanies",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"CompanyList"}}),angular.module("BB.Controllers").controller("CompanyList",d),angular.module("BB.Directives").directive("bbPostcodeLookup",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"PostcodeLookup"}}),angular.module("BB.Controllers").controller("PostcodeLookup",function(l,c,p,i,m,u){return l.controller="PostcodeLookup",angular.extend(this,new d(l,c,p,u)),l.validator=i,l.searchPostcode=function(){return function(e,t){var s;return l.notLoaded(l),s=i.validatePostcode(e,t),s?s.then(function(){var e;return l.bb.postcode=i.getGeocodeResult().address_components[0].short_name,l.postcode=l.bb.postcode,e=i.getGeocodeResult().geometry.location,l.selectItem(l.getNearestCompany({center:e}))},function(){return l.setLoaded(l)}):l.setLoaded(l)}}(this),l.getNearestCompany=function(){return function(p){var m,u,b,g,h,y,f,v,k,w,S,B,P,L,D,I,C,A,E,T,M,q;for(g=p.center,E=n,m=6371,S=[],P=g.lat(),C=g.lng(),q=l.items,(B=0,I=q.length);B<I;B++)f=q[B],f.address.lat&&f.address.long&&f.live&&(D=new google.maps.LatLng(f.address.lat,f.address.long),L=D.lat(),A=D.lng(),h=L-P,y=A-C,k=h*(E/180),w=y*(E/180),T=P*(E/180),M=L*(E/180),u=o(k/2)*o(k/2)+o(w/2)*o(w/2)*s(T)*s(M),b=2*e(t(u),t(1-u)),v=m*b,f.distance=v,S.push(f)),S.sort(function(e,t){return e.distance-t.distance});return S[0]}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbCustomBookingText",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"CustomBookingText"}}),angular.module("BB.Controllers").controller("CustomBookingText",function(e,t,s){return e.controller="public.controllers.CustomBookingText",e.notLoaded(e),t.connection_started.then(function(){return function(){return s.BookingText(e.bb.company,e.bb.current_item).then(function(t){return e.messages=t,e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}),angular.module("BB.Directives").directive("bbCustomConfirmationText",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"CustomConfirmationText"}}),angular.module("BB.Controllers").controller("CustomConfirmationText",function(e,t,s){return e.controller="public.controllers.CustomConfirmationText",e.notLoaded(e),t.connection_started.then(function(){return e.loadData()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.loadData=function(){return function(){return e.total?s.confirmationText(e.bb.company,e.total).then(function(t){return e.messages=t,e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}):e.loadingTotal?e.loadingTotal.then(function(t){return s.confirmationText(e.bb.company,t).then(function(t){return e.messages=t,e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}):e.setLoaded(e)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbMonthAvailability",function(){return{restrict:"A",replace:!0,scope:!0,controller:"DayList"}}),angular.module("BB.Controllers").controller("DayList",function(e,t,s,o,i){return e.controller="public.controllers.DayList",e.notLoaded(e),e.WeekHeaders=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],e.day_data={},e.type||(e.type="month"),e.data_source||(e.data_source=e.bb.current_item),t.connection_started.then(function(){return function(){return!e.current_date&&e.last_selected_date?e.current_date=e.last_selected_date.startOf(e.type):!e.current_date&&(e.current_date=moment().startOf(e.type)),e.loadData()}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.$on("currentItemUpdate",function(){return e.loadData()}),e.setCalType=function(){return function(t){return e.type=t}}(this),e.setDataSource=function(){return function(t){return e.data_source=t}}(this),e.format_date=function(){return function(t){if(e.current_date)return e.current_date.format(t)}}(this),e.format_start_date=function(){return function(t){return e.format_date(t)}}(this),e.format_end_date=function(){return function(t){if(e.end_date)return e.end_date.format(t)}}(this),e.selectDay=function(){return function(t,s,o){if(0===t.spaces&&!o)return!1;if(e.setLastSelectedDate(t.date),e.bb.current_item.setDate(t),e.$parent.$has_page_control);else return e.decideNextPage(s)}}(this),e.setMonth=function(){return function(t,s){return e.current_date=moment().startOf("month").year(s).month(t-1),e.current_date.year(),e.type="month"}}(this),e.setWeek=function(){return function(t,s){return e.current_date=moment().year(s).isoWeek(t).startOf("week"),e.current_date.year(),e.type="week"}}(this),e.add=function(){return function(t,s){return e.current_date.add(s,t),e.loadData()}}(this),e.subtract=function(){return function(t,s){return e.add(t,-s)}}(this),e.isPast=function(){return function(){return!e.current_date||moment().isAfter(e.current_date)}}(this),e.loadData=function(){return function(){return"week"===e.type?e.loadWeek():e.loadMonth()}}(this),e.loadMonth=function(){return function(){var t,s;return t=e.current_date,e.month=t.month(),e.notLoaded(e),s=moment(t).add(1,"months"),e.end_date=moment(s).add(-1,"days"),e.data_source?o.query({company:e.bb.company,cItem:e.data_source,month:t.format("MMYY"),client:e.client}).then(function(t){var s,o,n,l,c,p,m,u,b;for(e.days=t,n=0,p=t.length;n<p;n++)o=t[n],e.day_data[o.string_date]=o;for(b=[],m=l=0;5>=l;m=++l){for(u=[],s=c=0;6>=c;s=++c)u.push(t[7*m+s]);b.push(u)}return e.weeks=b,e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}):e.setLoaded(e)}}(this),e.loadWeek=function(){return function(){var t,s;return t=e.current_date,e.notLoaded(e),s=moment(t).add(7,"days"),e.end_date=moment(s).add(-1,"days"),e.data_source?o.query({company:e.bb.company,cItem:e.data_source,date:t.toISODate(),edate:s.toISODate(),client:e.client}).then(function(t){var s,o,n;for(e.days=t,o=0,n=t.length;o<n;o++)s=t[o],e.day_data[s.string_date]=s;return e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}):e.setLoaded(e)}}(this),e.setReady=function(){return function(){return!!e.bb.current_item.date||(i.clear(),i.add("danger",{msg:"You need to select a date"}),!1)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbDeals",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"DealList"}}),angular.module("BB.Controllers").controller("DealList",function(e,t,s,o,i,n,d,l,c){var p,m;return e.controller="public.controllers.DealList",d.init("TimeRangeList",e,["deals"]),t.connection_started.then(function(){return m()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),m=function(){var t;if(e.notLoaded(e),!e.deals)return t=s.query(e.bb.company),t.then(function(t){return e.deals=t,e.setLoaded(e)})},e.selectDeal=function(t){var s,o;return s=new i.BasketItem(null,e.bb),s.setDefaults(e.bb.item_defaults),s.setDeal(t),e.bb.company_settings.no_recipient?(e.notLoaded(e),e.setBasketItem(s),e.addItemToBasket().then(function(){return e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})):(o=c.open({templateUrl:e.getPartial("_add_recipient"),scope:e,controller:p,resolve:{item:function(){return s}}}),o.result.then(function(t){return e.notLoaded(e),e.setBasketItem(t),e.addItemToBasket().then(function(){return e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}))},p=function(e,t,s,o){return e.controller="ModalInstanceCtrl",e.item=s,e.recipient=!1,e.addToBasket=function(s){return o.validateForm(s)?t.close(e.item):void 0},e.cancel=function(){return t.dismiss("cancel")}},e.purchaseDeals=function(){return e.bb.basket.items&&0<e.bb.basket.items.length?e.decideNextPage():n.add("danger",{msg:"You need to select at least one Gift Certificate to continue"})},e.setReady=function(){return!!(e.bb.basket.items&&0<e.bb.basket.items.length)||n.add("danger",{msg:"You need to select at least one Gift Certificate to continue"})}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbDurations",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"DurationList"}}),angular.module("BB.Controllers").controller("DurationList",function(e,t,s,o,i,n,l){var c;return e.controller="public.controllers.DurationList",e.notLoaded(e),angular.extend(this,new o(e,i)),c=e.$eval(t.bbDurations)||{},s.connection_started.then(function(){return e.loadData()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.loadData=function(){return function(){var s,o,n,p,m,u,b,g;if(p=e.bb.company_id,g=e.bb.current_item.service,g){for(e.durations=function(){var e,t,o,n;for(o=_.zip(g.durations,g.prices),n=[],(e=0,t=o.length);e<t;e++)s=o[e],n.push({value:s[0],price:s[1]});return n}(),m=e.$eval(t.bbInitialDuration),b=e.durations,(n=0,u=b.length);n<u;n++)o=b[n],e.bb.current_item.duration&&o.value===e.bb.current_item.duration?e.duration=o:m&&m===o.value&&(e.duration=o,e.bb.current_item.setDuration(o.value)),o.pretty=l("time_period")(o.value),c.show_prices&&(o.pretty+=" ("+l("currency")(o.price)+")");1===e.durations.length&&(e.skipThisStep(),e.selectDuration(e.durations[0],e.nextRoute))}return e.setLoaded(e)}}(this),e.selectDuration=function(){return function(t,s){return e.$parent.$has_page_control?void(e.duration=t):(e.bb.current_item.setDuration(t.value),e.decideNextPage(s),!0)}}(this),e.durationChanged=function(){return function(){return e.bb.current_item.setDuration(e.duration.value),e.broadcastItemUpdate()}}(this),e.setReady=function(){return function(){return e.duration?(e.bb.current_item.setDuration(e.duration.value),!0):(n.clear(),n.add("danger",{msg:"You need to select a duration"}),!1)}}(this),e.$on("currentItemUpdate",function(){return e.loadData()})})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbEvent",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"Event"}}),angular.module("BB.Controllers").controller("Event",function(e,t,s,o,i,n,d,l,c){var p,m,u,b;return e.controller="public.controllers.Event",e.notLoaded(e),angular.extend(this,new n(e,i)),e.validator=l,e.event_options=e.$eval(t.bbEvent)||{},b=[],c.init("Event",e,["selected_tickets","event_options"]),s.connection_started.then(function(){if(e.bb.company)return p(e.bb.company)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),p=function(){var t;return e.bb.stacked_items&&0===e.bb.stacked_items.length&&delete e.selected_tickets,e.event=e.bb.current_item.event,e.event_options.use_my_details=null==e.event_options.use_my_details||e.event_options.use_my_details,t=[e.bb.current_item.event_group.getImagesPromise(),e.event.prepEvent()],e.client&&t.push(e.getPrePaidsForEvent(e.client,e.event)),i.all(t).then(function(t){var s,o,n,d;return(t[0]&&0<t[0].length&&(o=t[0]),s=t[1],t[2]&&0<t[2].length&&(d=t[2]),e.event=s,o&&m(o),e.bb.current_item.tickets&&0<e.bb.current_item.tickets.qty)?(e.edit_mode=!0,e.setLoaded(e),e.selected_tickets=!0,e.current_ticket_items=_.filter(e.bb.basket.timeItems(),function(t){return t.event_id===e.event.id}),e.tickets=function(){var t,s,o,d;for(o=e.current_ticket_items,d=[],(t=0,s=o.length);t<s;t++)n=o[t],d.push(n.tickets);return d}(),void e.$watch("current_ticket_items",function(){return e.bb.basket.total_price=e.bb.basket.totalPrice()},!0)):(u(),e.$broadcast("bbEvent:initialised"),e.setLoaded(e))},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},e.selectTickets=function(){var t,s,o,n,l,p,m,u,g,h;for(e.notLoaded(e),e.bb.emptyStackedItems(),t=e.bb.current_item,u=e.event.tickets,(o=0,p=u.length);o<p;o++)if(h=u[o],h.qty)switch(e.event.chain.ticket_type){case"single_space":for(s=l=1,g=h.qty;1<=g?l<=g:l>=g;s=1<=g?++l:--l)n=new d.BasketItem,m=n.ref,angular.extend(n,t),n.ref=m,b.push(n.ref),delete n.id,n.tickets=angular.copy(h),n.tickets.qty=1,e.bb.stackItem(n);break;case"multi_space":n=new d.BasketItem,m=n.ref,angular.extend(n,t),n.ref=m,b.push(n.ref),n.tickets=angular.copy(h),delete n.id,n.tickets.qty=h.qty,e.bb.stackItem(n);}return 0===e.bb.stacked_items.length?void e.setLoaded(e):(e.bb.pushStackToBasket(),e.updateBasket().then(function(){return function(){return e.setLoaded(e),e.selected_tickets=!0,e.stopTicketWatch(),e.current_ticket_items=_.filter(e.bb.basket.timeItems(),function(e){return _.contains(b,e.ref)}),e.tickets=function(){var t,s,o,i;for(o=e.current_ticket_items,i=[],(t=0,s=o.length);t<s;t++)n=o[t],i.push(n.tickets);return i}(),e.$watch("current_ticket_items",function(){return e.bb.basket.total_price=e.bb.basket.totalPrice()},!0)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}))},e.selectItem=function(){return function(t,s){return e.$parent.$has_page_control?(e.event=t,!1):(e.bb.current_item.setEvent(t),e.bb.current_item.ready=!1,e.decideNextPage(s),!0)}}(this),e.setReady=function(){return function(){var t,s,o,n;for(n=e.current_ticket_items,t=0,o=n.length;t<o;t++)s=n[t],s.setEvent(e.event);return e.bb.event_details={name:e.event.chain.name,image:e.event.image,address:e.event.chain.address,datetime:e.event.date,end_datetime:e.event.end_datetime,duration:e.event.duration,tickets:e.event.tickets},!!e.event_options.suppress_basket_update||e.updateBasket()}}(this),e.getPrePaidsForEvent=function(t,s){var o,n;return o=i.defer(),n={event_id:s.id},t.getPrePaidBookingsPromise(n).then(function(t){return e.pre_paid_bookings=t,o.resolve(t)},function(e){return o.reject(e)}),o.promise},m=function(t){var s;if(s=t[0],s)return s.background_css={"background-image":"url("+s.url+")"},e.event.image=s},u=function(){var t,s,o,n;if(!e.selected_tickets){if(e.event.tickets[0].qty=e.event_options.default_num_tickets?e.event_options.default_num_tickets:0,1<e.event.tickets.length)for(o=e.event.tickets.slice(1),t=0,s=o.length;t<s;t++)n=o[t],n.qty=0;return e.event_options.default_num_tickets&&e.event_options.auto_select_tickets&&1===e.event.tickets.length&&1===e.event.tickets[0].max_num_bookings&&e.selectTickets(),e.tickets=e.event.tickets,e.bb.basket.total_price=e.bb.basket.totalPrice(),e.stopTicketWatch=e.$watch("tickets",function(){return e.bb.basket.total_price=e.bb.basket.totalPrice(),e.event.updatePrice()},!0)}}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbEventGroups",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"EventGroupList",link:function(e,t,s){s.bbItem&&(e.booking_item=e.$eval(s.bbItem)),s.bbShowAll&&(e.show_all=!0)}}}),angular.module("BB.Controllers").controller("EventGroupList",function(e,t,s,o,i,n,d,l){var c;return e.controller="public.controllers.EventGroupList",n.init("EventGroupList",e,["event_group"]),e.notLoaded(e),angular.extend(this,new l(e,s)),e.validator=d,t.connection_started.then(function(){return function(){if(e.bb.company)return e.init(e.bb.company)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(t){var s;return e.booking_item||(e.booking_item=e.bb.current_item),s=t.getEventGroupsPromise(),s.then(function(t){var s,n,d,l,p,m,u;if(n="false"!==o.filterServices,n&&(e.booking_item.service_ref&&!e.show_all?t=t.filter(function(t){return t.api_ref===e.booking_item.service_ref}):e.booking_item.category&&!e.show_all&&(t=t.filter(function(t){return t.$has("category")&&t.$href("category")===e.booking_item.category.self}))),1!==t.length||e.allowSinglePick?c(t):e.selectItem(t[0],e.nextRoute)?e.skipThisStep():c(t),s=e.booking_item.defaultService(),s)for(d=0,m=t.length;d<m;d++)l=t[d],l.self===s.self&&e.selectItem(l,e.nextRoute);if(e.booking_item.event_group)for(p=0,u=t.length;p<u;p++)l=t[p],l.selected=!1,l.self===e.booking_item.event_group.self&&(e.event_group=l,l.selected=!0,e.booking_item.setEventGroup(e.event_group));return(e.setLoaded(e),e.booking_item.event_group||!e.booking_item.person&&!e.booking_item.resource)?e.bookable_services=e.items:void 0},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},c=function(t){if(e.items=t,e.event_group)return _.each(t,function(t){if(t.id===e.event_group.id)return e.event_group=t})},e.selectItem=function(){return function(t,s){return e.$parent.$has_page_control?(e.event_group=t,!1):(e.booking_item.setEventGroup(t),e.decideNextPage(s),!0)}}(this),e.$watch("event_group",function(){return function(){if(e.event_group&&(!e.booking_item.event_group||e.booking_item.event_group.self!==e.event_group.self))return e.booking_item.setEventGroup(e.event_group),e.broadcastItemUpdate()}}(this)),e.setReady=function(){return function(){return!!e.event_group&&(e.booking_item.setEventGroup(e.event_group),!0)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbEvents",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"EventList",link:function(e,t,s){e.summary=null!=s.summary,e.events_options=e.$eval(s.bbEvents)||{},e.mode=e.events_options&&e.events_options.mode?e.events_options.mode:0,e.summary&&(e.mode=0),e.events_options&&e.events_options.per_page&&(e.per_page=e.events_options.per_page)}}}),angular.module("BB.Controllers").controller("EventList",function(e,t,s,o,n,i,d,l,c,p){var m,u;return e.controller="public.controllers.EventList",e.notLoaded(e),angular.extend(this,new i(e,n)),e.pick={},e.start_date=moment(),e.end_date=moment().add(1,"year"),e.filters={hide_fully_booked_events:!1},e.pagination=c.initialise({page_size:10,max_size:5}),e.events={},e.fully_booked=!1,e.event_data_loaded=!1,d.init("EventList",e,["selected_date","event_group_id","event_group_manually_set"]),t.connection_started.then(function(){if(e.bb.company)if(e.bb.current_item.defaults&&e.bb.current_item.defaults.event)e.skipThisStep(),e.decideNextPage();else return e.bb.company.$has("parent")&&!e.bb.company.$has("company_questions")?e.bb.company.getParentPromise().then(function(t){return e.company_parent=t,e.initialise()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}):e.initialise()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.initialise=function(){var t,s;return e.notLoaded(e),0!==e.mode&&delete e.selected_date,e.event_group_manually_set||null!=e.current_item.event_group||(e.event_group_manually_set=null==e.event_group_manually_set&&null!=e.current_item.event_group),e.bb.current_item.event&&(t=e.current_item.event_group,e.clearBasketItem(),e.emptyBasket(),e.event_group_manually_set&&e.current_item.setEventGroup(t)),s=[],e.bb.company.$has("company_questions")?s.push(e.bb.company.getCompanyQuestionsPromise()):null!=e.company_parent&&e.company_parent.$has("company_questions")?s.push(e.company_parent.getCompanyQuestionsPromise()):(s.push(n.when([])),e.has_company_questions=!1),e.bb.item_defaults&&e.bb.item_defaults.event_group?e.bb.current_item.setEventGroup(e.bb.item_defaults.event_group):!e.current_item.event_group&&e.bb.company.$has("event_groups")?s.push(e.bb.company.getEventGroupsPromise()):s.push(n.when([])),0===e.mode||2===e.mode?s.push(e.loadEventSummary()):s.push(n.when([])),1===e.mode||2===e.mode?s.push(e.loadEventData()):s.push(n.when([])),n.all(s).then(function(t){var s,o,i,n,d,l,c,p,u;if(s=t[0],i=t[1],d=t[2],o=t[3],e.has_company_questions=null!=s&&0<s.length,s&&m(s),e.event_groups=i,n=_.indexBy(i,"id"),e.items)for(u=e.items,c=0,p=u.length;c<p;c++)l=u[c],l.group=n[l.service_id];return e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},e.loadEventSummary=function(){var t,o,i,d;return i=n.defer(),o=e.current_item.event,e.bb.current_item&&(e.bb.current_item.event_chain_id||e.bb.current_item.event_chain)&&(delete e.bb.current_item.event_chain,delete e.bb.current_item.event_chain_id),t=e.bb.company,d={item:e.bb.current_item,start_date:e.start_date.toISODate(),end_date:e.end_date.toISODate()},e.bb.item_defaults.event_chain&&(d.event_chain_id=e.bb.item_defaults.event_chain.id),s.summary(t,d).then(function(t){var s,o,n,l,c;if(t&&0<t.length){for(n=[],l=0,c=t.length;l<c;l++)o=t[l],s=moment(o),n.push({date:s,idate:parseInt(s.format("YYYYDDDD")),count:1,spaces:1});e.item_dates=n.sort(function(e,t){return e.idate-t.idate}),0===e.mode&&(e.selected_date&&(e.selected_date.isAfter(e.item_dates[0].date)||e.selected_date.isSame(e.item_dates[0].date))&&(e.selected_date.isBefore(e.item_dates[e.item_dates.length-1].date)||e.selected_date.isSame(e.item_dates[e.item_dates.length-1].date))?e.showDay(e.selected_date):e.showDay(e.item_dates[0].date))}return i.resolve(e.item_dates)},function(){return i.reject()}),i.promise},e.loadEventChainData=function(t){var s,i;return s=n.defer(),e.bb.item_defaults.event_chain?s.resolve([]):(t||(t=e.bb.company),i={item:e.bb.current_item,start_date:e.start_date.toISODate(),end_date:e.end_date.toISODate()},e.events_options.embed&&(i.embed=e.events_options.embed),o.query(t,i).then(function(e){return s.resolve(e)},function(){return s.reject()})),s.promise},e.loadEventData=function(t){var o,i,d,l;return e.notLoaded(e),e.event_data_loaded=!1,0===e.mode&&delete e.items,d=n.defer(),i=e.current_item.event,t||(t=e.bb.company),e.bb.current_item&&(e.bb.current_item.event_chain_id||e.bb.current_item.event_chain)&&(delete e.bb.current_item.event_chain,delete e.bb.current_item.event_chain_id),l={item:e.bb.current_item,start_date:e.start_date.toISODate(),end_date:e.end_date.toISODate(),include_non_bookable:!0},e.bb.item_defaults.event_chain&&(l.event_chain_id=e.bb.item_defaults.event_chain.id),e.per_page&&(l.per_page=e.per_page),o=e.loadEventChainData(t),e.events={},s.query(t,l).then(function(t){var s,n,l,p;for(e.items=_.flatten(t),p=e.items,(n=0,l=p.length);n<l;n++)s=p[n],s.spaces_left=s.getSpacesLeft();return e.bb.company.$has("address")&&e.bb.company.getAddressPromise().then(function(t){var o,i,n,d;for(n=e.items,d=[],(o=0,i=n.length);o<i;o++)s=n[o],d.push(s.address=t);return d}),o.then(function(){var t,o,n,p,m,u,b,g,h;for(b=e.items,n=0,m=b.length;n<m;n++)s=b[n],s.prepEvent({embed:"events"}),0===e.mode&&i&&i.self===s.self&&(s.select(),e.event=s);if(1===e.mode)if(o={},0<items.length){for(p=0,u=items.length;p<u;p++)s=items[p],s.getDuration(),t=parseInt(s.date.format("YYYYDDDD")),s.idate=t,o[t]||(o[t]={date:s.date,idate:t,count:0,spaces:0}),o[t].count+=1,o[t].spaces+=s.num_spaces;for(g in e.item_dates=[],o)h=o[g],e.item_dates.push(h);e.item_dates=e.item_dates.sort(function(e,t){return e.idate-t.idate})}else t=parseInt(e.start_date.format("YYYYDDDD")),e.item_dates=[{date:e.start_date,idate:t,count:0,spaces:0}];return e.isFullyBooked(),e.filtered_items=e.items,e.filterChanged(),c.update(e.pagination,e.filtered_items.length),e.setLoaded(e),e.event_data_loaded=!0,d.resolve(e.items)},function(){return d.reject()})},function(){return d.reject()}),d.promise},e.isFullyBooked=function(){var t,s,o,i,n;for(t=[],n=e.items,(o=0,i=n.length);o<i;o++)s=n[o],s.num_spaces===s.spaces_booked&&t.push(s);if(t.length===e.items.length)return e.fully_booked=!0},e.showDay=function(t){var s;if(moment.isMoment(t))return 0===e.mode?(e.event&&!e.selected_date.isSame(t,"day")&&delete e.event,s=t,e.start_date=moment(t),e.end_date=moment(t),e.loadEventData()):(!e.selected_date||!t.isSame(e.selected_date,"day"))&&(s=t),s?(e.selected_date=s,e.filters.date=s.toDate()):(delete e.selected_date,delete e.filters.date),e.filterChanged()},e.$watch("pick.date",function(){return function(t){if(t)return e.start_date=moment(t),e.end_date=moment(t),e.loadEventData()}}(this)),e.selectItem=function(){return function(t,s){var o,d,l,c;if(!(0>=t.getSpacesLeft()&&e.bb.company.settings.has_waitlists||t.hasSpace()))return!1;if(e.notLoaded(e),e.$parent.$has_page_control)return e.event&&e.event.unselect(),e.event=t,e.event.select(),e.setLoaded(e),!1;if(e.bb.moving_purchase)for(c=e.bb.basket.items,d=0,l=c.length;d<l;d++)o=c[d],o.setEvent(t);return e.bb.current_item.setEvent(t),e.bb.current_item.ready=!1,n.all(e.bb.current_item.promises).then(function(){return e.decideNextPage(s)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),!0}}(this),e.setReady=function(){return!!e.event&&(e.bb.current_item.setEvent(e.event),!0)},e.filterEvents=function(t){var s;return s=t.bookable&&(moment(e.filters.date).isSame(t.date,"day")||null==e.filters.date)&&(e.filters.event_group&&t.service_id===e.filters.event_group.id||null==e.filters.event_group)&&(null!=e.filters.price&&t.price_range.from<=e.filters.price||null==e.filters.price)&&(e.filters.hide_fully_booked_events&&0<t.getSpacesLeft()||!e.filters.hide_fully_booked_events)&&e.filterEventsWithDynamicFilters(t),s},e.filterEventsWithDynamicFilters=function(t){var s,o,n,d,c,p,u,b,g,h,y,f,v,w,S,B,P,L;if(!e.has_company_questions||!e.dynamic_filters)return!0;for(P=!0,v=e.dynamic_filters.question_types,(d=0,u=v.length);d<u;d++)if(L=v[d],"check"===L)for(w=e.dynamic_filters.check,c=0,b=w.length;c<b;c++){if(s=w[c],f=s.name.parameterise("_"),o=!1,t.chain&&t.chain.extra[f])for(S=t.chain.extra[f],p=0,g=S.length;p<g&&(n=S[p],o=e.dynamic_filters.values[s.name]&&n===e.dynamic_filters.values[s.name].name||null==e.dynamic_filters.values[s.name],!o);p++);else void 0===t.chain.extra[f]&&(_.isEmpty(e.dynamic_filters.values)||null==e.dynamic_filters.values[s.name])&&(o=!0);P=P&&o}else for(B=e.dynamic_filters[L],y=0,h=B.length;y<h;y++)s=B[y],f=s.name.parameterise("_"),o=e.dynamic_filters.values[s.name]&&t.chain.extra[f]===e.dynamic_filters.values[s.name].name||null==e.dynamic_filters.values[s.name],P=P&&o;return P},e.filterDateChanged=function(t){var s;if(null==t&&(t={reset:!1}),e.filters.date&&(s=moment(e.filters.date),e.$broadcast("event_list_filter_date:changed",s),e.showDay(s),!0===t.reset||null==e.selected_date))return p(function(){return delete e.filters.date},250)},e.resetFilters=function(){return e.filters={},e.has_company_questions&&(e.dynamic_filters.values={}),e.filterChanged(),delete e.selected_date,t.$broadcast("event_list_filter_date:cleared")},m=function(t){return e.dynamic_filters=_.groupBy(t,"question_type"),e.dynamic_filters.question_types=_.uniq(_.pluck(t,"question_type")),e.dynamic_filters.values={}},u=function(){},e.filterChanged=function(){if(e.items)return e.filtered_items=l("filter")(e.items,e.filterEvents),e.pagination.num_items=e.filtered_items.length,e.filter_active=e.filtered_items.length!==e.items.length,c.update(e.pagination,e.filtered_items.length)},e.pageChanged=function(){return c.update(e.pagination,e.filtered_items.length),t.$broadcast("page:changed")}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbGetAvailability",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"GetAvailability",link:function(e,t,s){s.bbGetAvailability&&e.loadAvailability(e.$eval(s.bbGetAvailability))}}}),angular.module("BB.Controllers").controller("GetAvailability",function(e,t,s,o,i,n,d,l,c){return e.loadAvailability=function(){return function(t){var s;return s=c.$get(e.bb.api_url+"/api/v1/"+t.company_id+"/services/"+t.service),s.then(function(t){var s,o;return e.earliest_day=null,o=moment(),s=moment().add(30,"days"),t.$get("days",{date:o.toISOString(),edate:s.toISOString()}).then(function(t){var s,o,n,d,l;for(d=t.days,l=[],(o=0,n=d.length);o<n;o++)s=d[o],0<s.spaces&&!e.earliest_day?(e.earliest_day=moment(s.date),s.first?l.push(e.earliest_day.add(s.first,"minutes")):l.push(void 0)):l.push(void 0);return l})})}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbItemDetails",function(e,t,s){return{restrict:"AE",replace:!0,scope:!0,transclude:!0,controller:"ItemDetails",link:function(o,i,n,d,l){var c;return n.bbItemDetails&&(c=o.$eval(n.bbItemDetails),o.item_from_param=c,o.item_details&&delete o.item_details,c&&o.loadItem(c)),l(o,function(){return function(n){var d;return d=1<n.length||1===n.length&&(!n[0].wholeText||/\S/.test(n[0].wholeText)),d?i.html(n).show():e.when(t.get("_item_details.html")).then(function(e){return i.html(e).show(),s(i.contents())(o)})}}(this))}}}),angular.module("BB.Controllers").controller("ItemDetails",function(e,t,s,o,i,n,d,l,c,p,m,u,b,g,h){var y,f;return e.controller="public.controllers.ItemDetails",e.suppress_basket_update=null!=t.bbSuppressBasketUpdate,e.item_details_id=e.$eval(t.bbSuppressBasketUpdate),e.suppress_basket_update?l.init("ItemDetails"+e.item_details_id,e,["item_details"]):l.init("ItemDetails",e,["item_details"]),p.addAnswersByName(e.client,["first_name","last_name","email","mobile"]),e.validator=c,y=!1,s.connection_started.then(function(){if(!y)return e.loadItem(e.bb.current_item)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.loadItem=function(t){var s;return e.notLoaded(e),y=!0,e.item=t,e.bb.private_note&&(e.item.private_note=e.bb.private_note),e.product=t.product,e.item.item_details?(f(e.item.item_details),p.addDynamicAnswersByName(e.item_details.questions),e.bb.item_defaults.answers&&p.addAnswersFromDefaults(e.item_details.questions,e.bb.item_defaults.answers),e.recalc_price(),e.setLoaded(e),e.$emit("item_details:loaded",e.item_details)):(s={company:e.bb.company,cItem:e.item},o.query(s).then(function(t){return t&&(f(t),e.item.item_details=e.item_details,p.addDynamicAnswersByName(e.item_details.questions),e.bb.item_defaults.answers&&p.addAnswersFromDefaults(e.item_details.questions,e.bb.item_defaults.answers),e.recalc_price(),e.$emit("item_details:loaded",e.item_details)),e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}))},f=function(t){var s;return e.item&&e.item.defaults&&_.each(t.questions,function(t){var s;if(s="q_"+t.name,e.item.defaults[s])return t.answer=e.item.defaults[s]}),e.hasOwnProperty("item_details")&&(s=e.item_details.questions,_.each(t.questions,function(e){var t;if(t=_.findWhere(s,{name:e.name}),t)return e.answer=t.answer})),e.item_details=t},e.$on("currentItemUpdate",function(){return e.item_from_param?e.loadItem(e.item_from_param):e.loadItem(e.bb.current_item)}),e.recalc_price=function(){var t,s;return s=e.item_details.questionPrice(e.item.getQty()),t=e.item.base_price,t||(t=e.item.price),e.item.setPrice(s+t)},e.confirm=function(t,s){if(c.validateForm(t))return e.bb.moving_booking?e.confirm_move(t,s):(e.item.setAskedQuestions(),!!e.$parent.$has_page_control||(e.item.ready?(e.notLoaded(e),e.addItemToBasket().then(function(){return e.setLoaded(e),e.decideNextPage(s)},function(){return e.setLoaded(e)})):e.decideNextPage(s)))},e.setReady=function(){return function(){return e.item.setAskedQuestions(),!e.item.ready||e.suppress_basket_update||e.addItemToBasket()}}(this),e.confirm_move=function(t){var o;return y=!0,e.item||(e.item=e.bb.current_item),e.item.moved_booking=!1,e.item.setAskedQuestions(),e.item.ready?(e.notLoaded(e),e.bb.moving_purchase?(o={purchase:e.bb.moving_purchase,bookings:e.bb.basket.items},e.bb.current_item.move_reason&&(o.move_reason=e.bb.current_item.move_reason),h.update(o).then(function(o){return e.bb.purchase=o,e.bb.purchase.getBookingsPromise().then(function(i){return e.purchase=o,e.setLoaded(e),e.item.move_done=!0,e.item.moved_booking=!0,s.$broadcast("booking:moved"),e.decideNextPage(t),e.showMoveMessage(i[0].datetime)})},function(){return e.setLoaded(e),n.add("danger",{msg:"Failed to move booking. Please try again."})})):(e.bb.current_item.move_reason&&(e.item.move_reason=e.bb.current_item.move_reason),i.update(e.item).then(function(o){var n,l,c,p,m,u;if(l=new d.Purchase.Booking(o),e.bb.purchase)for(u=e.bb.purchase.bookings,n=c=0,p=u.length;c<p;n=++c)m=u[n],m.id===l.id&&(e.bb.purchase.bookings[n]=l);return e.setLoaded(e),e.bb.moved_booking=o,e.item.move_done=!0,s.$broadcast("booking:moved"),e.decideNextPage(t),e.showMoveMessage(l.datetime)},function(){return function(){return e.setLoaded(e),n.add("danger",{msg:"Failed to move booking. Please try again."})}}(this)))):e.decideNextPage(t)},e.showMoveMessage=function(e){return g.isInternationalizatonEnabled()?b("MOVE_BOOKINGS_MSG",{datetime:e.format("LLLL")}).then(function(e){return n.add("info",{msg:e})}):n.add("info",{msg:"Your booking has been moved to "+e.format("LLLL")})},e.openTermsAndConditions=function(){var t;return t=m.open({templateUrl:e.getPartial("terms_and_conditions"),scope:e})},e.getQuestion=function(t){var s,o,n,d;for(d=e.item_details.questions,s=0,o=d.length;s<o;s++)if(n=d[s],n.id===t)return n;return null},e.updateItem=function(){if(e.item.setAskedQuestions(),e.item.ready)return e.notLoaded(e),i.update(e.item).then(function(t){var s,o,n,l,c,p;if(o=new d.Purchase.Booking(t),e.bookings)for(p=e.bookings,s=n=0,l=p.length;n<l;s=++n)c=p[s],c.id===o.id&&(e.bookings[s]=o);return e.purchase.bookings=e.bookings,e.item_details_updated=!0,e.setLoaded(e)},function(){return function(){return e.setLoaded(e)}}(this))},e.editItem=function(){return e.item_details_updated=!1}})}.call(this),function(){angular.module("BB.Directives").directive("bbLogin",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"Login"}}),angular.module("BB.Controllers").controller("Login",function(e,t,s,o,i,n,d,l){return e.controller="public.controllers.Login",e.validator=i,e.login_form={},e.login_sso=function(o,i){return t.connection_started.then(function(){return function(){return s.ssoLogin({company_id:e.bb.company.id,root:e.bb.api_url},{token:o}).then(function(){if(i)return e.showPage(i)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},e.login_with_password=function(t,o){return s.companyLogin(e.bb.company,{},{email:t,password:o}).then(function(){return function(t){return e.member=new n.Member.Member(t)}}(this),function(){return function(){return l.raise("LOGIN_FAILED")}}(this))},e.showEmailPasswordReset=function(){return function(){return e.showPage("email_reset_password")}}(this),e.isLoggedIn=function(){return s.isLoggedIn()},e.sendPasswordReset=function(t){return s.sendPasswordReset(e.bb.company,{email:t,custom:!0}).then(function(){return l.raise("PASSWORD_RESET_REQ_SUCCESS")},function(){return function(){return l.raise("PASSWORD_RESET_REQ_FAILED")}}(this))},e.updatePassword=function(o,i){return l.clear(),t.member&&o&&i&&o===i?s.updatePassword(t.member,{new_password:o,confirm_new_password:i,persist_login:e.login_form.persist_login}).then(function(){return function(t){if(t)return e.setClient(t),e.password_updated=!0,l.raise("PASSWORD_RESET_SUCESS")}}(this),function(){return function(t){return e.error=t,l.raise("PASSWORD_RESET_FAILED")}}(this)):l.raise("PASSWORD_MISMATCH")}})}.call(this),function(){'use strict';var e=Math.round,t=Math.atan2,s=Math.sqrt,o=Math.cos,i=Math.sin,n=Math.PI;angular.module("BB.Directives").directive("bbMap",function(){return{restrict:"A",replace:!0,scope:!0,controller:"MapCtrl"}}),angular.module("BB.Controllers").controller("MapCtrl",function(d,l,c,p,m,u,b,g,h,y){var f,v,k,w,S,B,P,L,D,I,C,A,E,T;return d.controller="public.controllers.MapCtrl",u.init("MapCtrl",d,["address","selectedStore","search_prms"]),d.options=d.$eval(c.bbMap)||{},d.num_search_results=d.options.num_search_results||6,d.range_limit=d.options.range_limit||2e308,d.hide_not_live_stores=d.options.hide_not_live_stores||!1,d.can_filter_by_service=d.options.filter_by_service||!1,d.filter_by_service=d.options.filter_by_service||!1,d.default_zoom=d.options.default_zoom||6,f=y.getCountryCode(),k=_.contains(["gb","us","jp"],f)?"miles":"km",d.distance_unit=k,L=b.defer(),d.mapLoaded=b.defer(),d.mapReady=L.promise,d.map_init=d.mapLoaded.promise,d.showAllMarkers=!1,d.mapMarkers=[],d.shownMarkers=d.shownMarkers||[],d.numberedPin||(d.numberedPin=null),d.defaultPin||(d.defaultPin=null),!d.address&&c.bbAddress&&(d.address=d.$eval(c.bbAddress)),d.notLoaded(d),webshim.setOptions({waitReady:!1,loadStyles:!1}),webshim.polyfill("geolocation"),p.connection_started.then(function(){var e,t,s,o,n,l,c,m;if(d.selectedStore||d.setLoaded(d),d.bb.company.companies)p.parent_id=d.bb.company.id;else return p.parent_id?void d.initWidget({company_id:p.parent_id,first_page:d.bb.current_page,keep_basket:!0,item_defaults:d.bb.item_defaults?d.bb.item_defaults:{}}):void d.initWidget({company_id:d.bb.company.id,first_page:null});for(d.companies=d.bb.company.companies,d.companies&&0!==d.companies.length||(d.companies=[d.bb.company]),d.bb.current_item.service&&d.options&&d.options.filter_by_service?(d.notLoaded(d),w().then(function(){return d.map_init.then(function(){return P()})})):d.map_init.then(function(){return P()}),d.mapBounds=new google.maps.LatLngBounds,l=d.companies,(t=0,n=l.length);t<n;t++)e=l[t],e.address&&e.address.lat&&e.address.long&&(o=new google.maps.LatLng(e.address.lat,e.address.long),d.mapBounds.extend(o));if(d.mapOptions={center:d.mapBounds.getCenter(),zoom:d.default_zoom,mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!0,mapTypeControlOptions:{style:window.google.maps.MapTypeControlStyle.DROPDOWN_MENU}},d.options&&d.options.map_options)for(s in c=d.options.map_options,c)m=c[s],d.mapOptions[s]=m;return L.resolve(!0)},function(e){return d.setLoadedAndShowError(d,e,"Sorry, something went wrong")}),w=function(){var e;return e=b.defer(),d.bb.selected_service.$has("all_children")?d.bb.selected_service.$get("all_children").then(function(t){return t.$get("services").then(function(t){var s,o,n,l,c,p,m;for(o=_.map(t,function(e){return e.company_id}),c=d.companies,p=[],(n=0,l=c.length);n<l;n++)s=c[n],s.has_service=_.contains(o,s.id),m=_.find(t,function(e){return e.company_id===s.id}),s.service=m,p.push(e.resolve());return p})}):e.resolve(),e.promise},d.filterByService=function(){var e,t,s,o;for(o=d.shownMarkers,e=0,t=o.length;e<t;e++)s=o[e],s.setMap(null);return d.shownMarkers=d.options&&d.filter_by_service?d.shown_markers_with_services:d.shown_markers,h(function(){return T()})},P=function(){var e,t,s,o,n,l;for(l=d.companies,t=0,o=l.length;t<o;t++)e=l[t],e.address&&e.address.lat&&e.address.long&&(s=new google.maps.LatLng(e.address.lat,e.address.long),n=new google.maps.Marker({map:d.myMap,position:s,visible:d.showAllMarkers,icon:d.defaultPin}),n.company=e,(!d.hide_not_live_stores||e.live)&&d.mapMarkers.push(n));return h(function(){if(d.myMap.fitBounds(d.mapBounds),d.options.default_zoom&&d.myMap.setZoom(d.default_zoom),d.bb.current_item.service&&d.options&&d.filter_by_service)return d.setLoaded(d)}),v()},v=function(){if(d.selectedStore)return d.notLoaded(d),d.search_prms?d.searchAddress(d.search_prms):d.geolocate(),google.maps.event.addListenerOnce(d.myMap,"idle",function(){return _.each(d.mapMarkers,function(e){if(d.selectedStore.id===e.company.id)return google.maps.event.trigger(e,"click")})})},d.title=function(){var e,t;return e=d.bb.current_item,t=e.category&&e.category.description?e.category.description:d.bb.company.extra.department,t+" - "+d.$eval("getCurrentStepTitle()")},d.searchAddress=function(e){return!(d.reverse_geocode_address&&d.reverse_geocode_address===d.address)&&(delete d.geocoder_result,e||(e={}),d.search_prms=e,d.map_init.then(function(){var t,s,o,i;if(t=d.address,e.address&&(t=e.address),t)return o={address:t},e.region&&(o.region=e.region),e.componentRestrictions&&(o.componentRestrictions=e.componentRestrictions),e.bounds&&(i=new google.maps.LatLng(e.bounds.sw.x,e.bounds.sw.y),s=new google.maps.LatLng(e.bounds.ne.x,e.bounds.ne.y),o.bounds=new google.maps.LatLngBounds(i,s)),new google.maps.Geocoder().geocode(o,function(e,t){return(0<e.length&&"OK"===t&&(d.geocoder_result=e[0]),!d.geocoder_result||d.geocoder_result&&d.geocoder_result.partial_match)?void C(o):(d.geocoder_result?A(d.geocoder_result):I(),d.setLoaded(d))})}),d.setLoaded(d))},C=function(e){var t,s;return t={query:e.address,types:["shopping_mall","store","embassy"]},e.bounds&&(t.bounds=e.bounds),s=new google.maps.places.PlacesService(d.myMap),s.textSearch(t,function(e,t){return 0<e.length&&"OK"===t?A(e[0]):d.geocoder_result?A(d.geocoder_result):I()})},A=function(e){return m.clear(),d.search_failed=!1,d.loc=e.geometry.location,d.myMap.setCenter(d.loc),d.options.default_zoom&&d.myMap.setZoom(d.default_zoom),d.showClosestMarkers(d.loc),p.$broadcast("map:search_success")},I=function(){return d.search_failed=!0,m.raise("LOCATION_NOT_FOUND"),p.$apply()},d.validateAddress=function(e){return!!e&&(!e.$error.required||(m.clear(),m.raise("MISSING_LOCATION"),!1))},B=function(e,l){var p,m,u,b,g,h,y,f,v,k,w,S,B,P,L;return B=n,p=6371,v=e.lat(),w=e.lng(),k=l.position.lat(),S=l.position.lng(),b=k-v,g=S-w,y=b*(B/180),f=g*(B/180),P=v*(B/180),L=k*(B/180),m=i(y/2)*i(y/2)+i(f/2)*i(f/2)*o(P)*o(L),u=2*t(s(m),s(1-m)),h=p*u},d.showClosestMarkers=function(e){var t,s,o,n,l,c,p;for(t=[],s=[],p=d.mapMarkers,(o=0,l=p.length);o<l;o++)c=p[o],n=B(e,c),d.showAllMarkers||c.setVisible(!1),c.distance=n,"miles"===d.distance_unit&&(c.distance*=.621371192),c.distance<d.range_limit&&(t.push(c),c.company.has_service&&s.push(c));return t.sort(function(e,t){return e.distance-t.distance}),s.sort(function(e,t){return e.distance-t.distance}),d.shown_markers=t.slice(0,d.num_search_results),d.shown_markers_with_services=s.slice(0,d.num_search_results),d.shownMarkers=d.options&&d.filter_by_service?d.shown_markers_with_services:d.shown_markers,h(function(){return T()})},T=function(){var e,t,s,o,n,l,c,p,m,u;for(o=d.loc,l=new google.maps.LatLngBounds,l.extend(o),s=1,u=d.shownMarkers,(e=0,n=u.length);e<n;e++)c=u[e],d.numberedPin&&(t=g.sprintf(d.numberedPin,s),c.setIcon(t)),c.setVisible(!0),c.setMap(d.myMap),l.extend(c.position),s+=1;return d.$emit("map:shown_markers_updated",d.shownMarkers),google.maps.event.trigger(d.myMap,"resize"),d.myMap.fitBounds(l),m=0,p=_.find(d.shownMarkers,function(e){return m++,e.company.id===d.bb.current_item.company.id}),p?m--:m=0,d.shownMarkers[m].is_open=!0,d.openMarkerInfo(d.shownMarkers[m])},d.openMarkerInfo=function(e){return h(function(){return d.currentMarker=e,d.myMap.setCenter(e.position),d.myInfoWindow.open(d.myMap,e)},250)},d.selectItem=function(e,t){var s;if(d.$debounce(1e3))return e?(d.notLoaded(d),d.selectedStore&&d.selectedStore.id!==e.id&&d.$emit("change:storeLocation"),d.selectedStore=e,d.bb.current_item.item_details&&d.bb.current_item.item_details.questions&&E(),e.service&&(d.bb.item_defaults.service=e.service.id),s={company_id:e.id,item_defaults:d.bb.item_defaults},t&&(s.first_page=t),d.initWidget(s)):void m.warning(ErrorService.getError("STORE_NOT_SELECTED"))},E=function(){var e,t,s,o,n;for(e={},n=d.bb.current_item.item_details.questions,(t=0,s=n.length);t<s;t++)o=n[t],e["q_"+o.name]=o.answer;if(!_.isEmpty(e))return d.bb.item_defaults.answers=e},d.roundNumberUp=function(t,s){var o=Math.pow;return e(t*o(10,s))/o(10,s)},d.geolocate=function(){return navigator.geolocation&&(!d.reverse_geocode_address||d.reverse_geocode_address!==d.address)&&(d.notLoaded(d),webshim.ready("geolocation",function(){var e;return e={timeout:5e3,maximumAge:36e5},navigator.geolocation.getCurrentPosition(D,S,e)}))},S=function(e){switch(e.code){case 2:case 3:d.setLoaded(d),m.raise("GEOLOCATION_ERROR");break;default:d.setLoaded(d);}return d.$apply()},D=function(e){var t,s,o;return t=parseFloat(e.coords.latitude),o=parseFloat(e.coords.longitude),s=new google.maps.LatLng(t,o),new google.maps.Geocoder().geocode({latLng:s},function(e,t){var s,o,n,l;if(0<e.length&&"OK"===t){for(d.geocoder_result=e[0],l=d.geocoder_result.address_components,(o=0,n=l.length);o<n;o++)s=l[o],0<=s.types.indexOf("route")&&(d.reverse_geocode_address=s.long_name),0<=s.types.indexOf("locality")&&(d.reverse_geocode_address+=", "+s.long_name),d.address=d.reverse_geocode_address;A(d.geocoder_result)}return d.setLoaded(d)})},d.increaseRange=function(){return d.range_limit=2e308,d.searchAddress(d.search_prms)},d.$watch("display.xs",function(){return function(e,t){if(e!==t&&d.loc)return d.myInfoWindow.close(),d.myMap.setCenter(d.loc),d.options.default_zoom&&d.myMap.setZoom(d.default_zoom),d.showClosestMarkers(d.loc)}}(this)),p.$on("widget:restart",function(){return d.loc=null,d.reverse_geocode_address=null,d.address=null})})}.call(this),function(){angular.module("BB.Directives").directive("bbMembershipLevels",function(e,t){var s;return{restrict:"AE",replace:!0,scope:!0},s=function(s){var o;return e.connection_started.then(function(){return s.initialise()}),s.initialise=function(){if(s.bb.company&&s.bb.company.$has("member_levels"))return s.notLoaded(s),t.getMembershipLevels(s.bb.company).then(function(e){return s.setLoaded(s),s.membership_levels=e},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")})},s.selectMemberLevel=function(e){if(e&&s.client)if(s.client.member_level_id=e.id,s.$parent.$has_page_control);else return s.decideNextPage()},o=function(){var e,t,o,n,d;if(s.bb.client_defaults.membership_ref){for(n=s.membership_levels,d=[],(e=0,t=n.length);e<t;e++)o=n[e],o.name===s.bb.client_defaults.membership_ref?d.push(s.selectMemberLevel(o)):d.push(void 0);return d}},s.setReady=function(){return!!s.client.member_level_id},s.getMembershipLevel=function(e){return _.find(s.membership_levels,function(t){return t.id===e})}}})}.call(this),function(){'use strict';var e={}.hasOwnProperty;angular.module("BB.Directives").directive("bbMultiServiceSelect",function(){return{restrict:"AE",scope:!0,controller:"MultiServiceSelect"}}),angular.module("BB.Controllers").controller("MultiServiceSelect",function(t,s,o,i,n,d,l,c,p){var m,u,b;return c.init("MultiServiceSelect",t,["selected_category_name"]),t.options=t.$eval(i.bbMultiServiceSelect)||{},t.options.max_services=t.options.max_services||2e308,t.options.ordered_categories=t.options.ordered_categories||!1,t.options.services=t.options.services||"items",s.connection_started.then(function(){return t.bb.company.$has("parent")&&!t.bb.company.$has("company_questions")?t.bb.company.getParentPromise().then(function(e){return t.company=e,u()}):t.company=t.bb.company,t.$watch(t.options.services,function(e){if(e&&angular.isArray(e))return t.items=e,u()})}),u=function(){var e;if(t.items&&t.company)return t.initialised=!0,e=[],e.push(l.query(t.bb.company)),t.company.$has("company_questions")&&e.push(t.company.getCompanyQuestionsPromise()),o.all(e).then(function(e){var s,o,i,n,d,l,c,p;if(t.company_questions=e[1],b(e[0]),t.bb.stacked_items&&0<t.bb.stacked_items.length){for(l=t.bb.stacked_items,o=0,n=l.length;o<n;o++)for(p=l[o],c=t.items,(i=0,d=c.length);i<d;i++)if(s=c[i],s.self===p.service.self){p.service=s,p.service.selected=!0;break}}else m();return t.bb.moving_booking&&t.nextStep(),t.$broadcast("multi_service_select:loaded"),t.setLoaded(t)},function(e){return t.setLoadedAndShowError(t,e,"Sorry, something went wrong")})},m=function(){var e,s,o,i;if(t.bb.item_defaults.service)for(o=t.items,e=0,s=o.length;e<s;e++)if(i=o[e],i.self===t.bb.item_defaults.service.self)return void t.addItem(i)},b=function(s){var o,i,n,d,l,c,p,m,u,b,g,h,y,f,v,w;if(t.options.ordered_categories)for(p=0,b=s.length;p<b;p++)i=s[p],i.order=parseInt(i.name.slice(0,2)),i.name=i.name.slice(3);for(u in t.all_categories=_.indexBy(s,"id"),o=_.groupBy(t.items,function(e){return e.category_id}),f=_.findWhere(t.company_questions,{name:"Extra Category"}),f&&(f=_.map(f.question_items,function(e){return e.name})),s={},o)e.call(o,u)&&(w=o[u],0<w.length&&(s[u]=w));for(d in t.categories=[],h=[],s){if(y=s[d],i={},l=[],f){for(m=0,g=f.length;m<g;m++)v=f[m],c={name:v,services:_.filter(y,function(e){return e.extra.extra_category===v})},0<c.services.length&&l.push(c);i.sub_categories=l}else i.services=y;t.all_categories[d]&&(n={name:t.all_categories[d].name,description:t.all_categories[d].description}),i.name=n.name,i.description=n.description,t.options.ordered_categories&&t.all_categories[d]&&(i.order=t.all_categories[d].order),t.categories.push(i),t.selected_category_name&&t.selected_category_name===n.name?h.push(t.selected_category=t.categories[t.categories.length-1]):t.bb.item_defaults.category&&t.bb.item_defaults.category.name===n.name&&!t.selected_category?(t.selected_category=t.categories[t.categories.length-1],h.push(t.selected_category_name=t.selected_category.name)):h.push(void 0)}return h},t.changeCategory=function(e,o){if(e&&o)return t.selected_category={name:e,sub_categories:o},t.selected_category_name=t.selected_category.name,s.$broadcast("multi_service_select:category_changed")},t.changeCategoryName=function(){return t.selected_category_name=t.selected_category.name,s.$broadcast("multi_service_select:category_changed")},t.addItem=function(e,o){var l,c,p,m,u,b;if(!(t.bb.stacked_items.length<t.options.max_services)){for(u=t.items,b=[],(p=0,m=u.length);p<m;p++)l=u[p],l.popover="Sorry, you can only book a maximum of "+t.options.max_services+" treatments",b.push(l.popoverText=l.popover);return b}return(t.bb.clearStackedItemsDateTime(),e.selected=!0,c=new n.BasketItem(null,t.bb),c.setDefaults(t.bb.item_defaults),c.setService(e),o&&c.setDuration(o),c.setGroup(e.group),t.bb.stackItem(c),s.$broadcast("multi_service_select:item_added"),t.options.raise_alerts)?d.info({msg:e.name+" added to your treatment selection",persist:!1}):void 0},t.removeItem=function(e,o){var n,d,l,c,p;for(e.selected=!1,o&&"BasketItem"===o.type?t.bb.deleteStackedItem(e):t.bb.deleteStackedItemByService(e),t.bb.clearStackedItemsDateTime(),s.$broadcast("multi_service_select:item_removed"),c=t.items,p=[],(d=0,l=c.length);d<l;d++)if(n=c[d],n.self===e.self){n.selected=!1;break}else p.push(void 0);return p},t.removeStackedItem=function(e){return t.removeItem(e,{type:"BasketItem"})},t.nextStep=function(){return 1<t.bb.stacked_items.length?t.decideNextPage():1===t.bb.stacked_items.length?(t.bb.basket&&0<t.bb.basket.items.length&&t.quickEmptybasket({preserve_stacked_items:!0}),t.setBasketItem(t.bb.stacked_items[0]),t.decideNextPage()):(d.clear(),d.add("danger",{msg:"You need to select at least one treatment to continue"}))},t.addService=function(){return s.$broadcast("multi_service_select:add_item")},t.setReady=function(){return!!(1<t.bb.stacked_items.length)||(1===t.bb.stacked_items.length?(t.bb.basket&&0<t.bb.basket.items.length&&t.quickEmptybasket({preserve_stacked_items:!0}),t.setBasketItem(t.bb.stacked_items[0]),!0):(d.clear(),d.add("danger",{msg:"You need to select at least one treatment to continue"}),!1))},t.selectDuration=function(e){var s;return 1===e.durations.length?t.addItem(e):(s=p.open({templateUrl:t.getPartial("_select_duration_modal"),scope:t,controller:function(e,t,s){return e.durations=s.durations,e.duration=e.durations[0],e.service=s,e.cancel=function(){return t.dismiss("cancel")},e.setDuration=function(){return t.close({service:e.service,duration:e.duration})}},resolve:{service:function(){return e}}}),s.result.then(function(e){return t.addItem(e.service,e.duration)}))}})}.call(this),function(){'use strict';var e=Math.ceil,t={}.hasOwnProperty;angular.module("BB.Directives").directive("bbTimeRangeStacked",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"TimeRangeListStackedController"}}),angular.module("BB.Controllers").controller("TimeRangeListStackedController",function(s,o,i,n,d,l,c,p,m,u,b,g){var h,y,f,v,w;return s.controller="public.controllers.TimeRangeListStacked",m.init("TimeRangeListStacked",s,["selected_slot","original_start_date","start_at_week_start"]),s.notLoaded(s),s.available_times=0,n.connection_started.then(function(){var e,t,o;return s.options=s.$eval(i.bbTimeRangeStacked)||{},s.time_range_length||(null==i.bbTimeRangeLength?s.options&&s.options.time_range_length?s.time_range_length=s.options.time_range_length:s.time_range_length=7:s.time_range_length=s.$eval(i.bbTimeRangeLength)),(null!=i.bbDayOfWeek||s.options&&s.options.day_of_week)&&(s.day_of_week=null==i.bbDayOfWeek?s.options.day_of_week:s.$eval(i.bbDayOfWeek)),(null!=i.bbSelectedDay||s.options&&s.options.selected_day)&&(t=null==i.bbSelectedDay?moment(s.options.selected_day):moment(s.$eval(i.bbSelectedDay)),moment.isMoment(t)&&(s.selected_day=t)),!s.start_date&&s.last_selected_date?s.original_start_date?(e=s.last_selected_date.diff(s.original_start_date,"days"),e%=s.time_range_length,e=0===e?e:e+1,o=s.last_selected_date.clone().subtract(e,"days"),f(s.last_selected_date,o)):f(s.last_selected_date):s.bb.stacked_items[0].date?f(s.bb.stacked_items[0].date.date):s.selected_day?(s.original_start_date=s.original_start_date||moment(s.selected_day),f(s.selected_day)):(s.start_at_week_start=!0,f(moment())),s.loadData()},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")}),f=function(e,t){return s.start_date=t?t:s.day_of_week?e.clone().day(s.day_of_week):s.start_at_week_start?e.clone().startOf("week"):e.clone(),s.selected_day=e,s.selected_date=s.selected_day.toDate(),h()},s.add=function(e,t){return s.selected_day=moment(s.selected_date),"days"===t?f(s.selected_day.add(e,"days")):"weeks"===t?(s.start_date.add(e,"weeks"),f(s.start_date)):void 0,s.loadData()},s.subtract=function(e,t){return s.add(-e,t)},h=function(){var t;return s.is_subtract_valid=!0,t=e(s.selected_day.diff(moment(),"day",!0)),s.subtract_length=t<s.time_range_length?t:s.time_range_length,0>=t&&(s.is_subtract_valid=!1),s.subtract_string=1<s.subtract_length?"Prev "+s.subtract_length+" days":1===s.subtract_length?"Prev day":"Prev"},s.selectedDateChanged=function(){return f(moment(s.selected_date)),s.selected_slot=null,s.loadData()},w=function(){var e,t,o,i;for(t in o=s.days,i=[],o)e=o[t],i.push(s.days[t].hide=!e.date.isSame(s.selected_day,"day"));return i},s.isPast=function(){return!s.start_date||moment().isAfter(s.start_date)},s.status=function(e,t){var s;if(t)return s=t.status(),s},s.highlightSlot=function(e,t){var o,d,l,c;if(t&&e&&0<e.availability()){for(s.bb.clearStackedItemsDateTime(),s.selected_slot&&(s.selected_slot.selected=!1),s.setLastSelectedDate(t.date),s.selected_slot=angular.copy(e),s.selected_day=t.date,s.selected_date=t.date.toDate(),s.$broadcast("slotChanged",t,e);e;)for(c=s.bb.stacked_items,o=0,l=c.length;o<l;o++)if(d=c[o],d.service.self===e.service.self&&!d.date&&!d.time){d.setDate(t),d.setTime(e),e=e.next;break}return w(),n.$broadcast("time:selected")}},s.loadData=function(){var e,o,c,p,m,u;if(s.notLoaded(s),s.request&&s.request.start.twix(s.request.end).contains(s.selected_day))return w(),void s.setLoaded(s);for(s.start_date=moment(s.start_date),e=moment(s.start_date).add(s.time_range_length,"days"),s.end_date=moment(e).add(-1,"days"),s.request={start:moment(s.start_date),end:moment(s.end_date)},u=[],o=_.groupBy(s.bb.stacked_items,function(e){return e.service.id}),o=_.toArray(o),(c=0,m=o.length);c<m;c++)p=o[c],u.push(l.query({company:s.bb.company,cItem:p[0],date:s.start_date,end_date:s.end_date,client:s.client,available:1}));return d.all(u).then(function(e){var i,d,c,m,u,b,g,h,f,S,B,P;for(s.data_valid=!0,s.days={},(i=m=0,g=o.length);m<g;i=++m)for(p=o[i],S=e[i],S&&0!==S.length||(s.data_valid=!1),(b=0,h=p.length);b<h;b++)for(d in c=p[b],v(c,S),c.slots={},S)t.call(S,d)&&(B=S[d],c.slots[d]=_.indexBy(B,"time"));if(s.data_valid){for(u in f=e[0],f)P=f[u],s.days[u]={date:moment(u)};y(),w(),n.$broadcast("TimeRangeListStacked:loadFinished")}else;return s.setLoaded(s)},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")})},v=function(e,t){var o,i,n;if(e.datetime||e.date)return(o=e.datetime||g.convertTimeSlotToMoment(e.date.date,e.time),s.start_date<=o&&s.end_date>=o)?(i=g.convertMomentToTime(o),n=_.findWhere(t[o.toISODate()],{time:i}),n||(n=e.time,t[o.toISODate()].splice(0,0,n)),n.selected=e.self===s.bb.stacked_items[0].self):void 0},y=function(){var e,t,o,i,n,d,l;for(e in i=s.days,n=[],i)t=i[e],t.slots={},1<s.bb.stacked_items.length?n.push(function(){var i,n;for(l in i=s.bb.stacked_items[0].slots[e],n=[],i)d=i[l],d=angular.copy(d),o=function(t){var o,n,d,c,p,m;for(m=!1,l=t.time,o=s.bb.stacked_items[0].service.duration,c=l+o,(d=n=1,p=s.bb.stacked_items.length-1);1<=p?n<=p:n>=p;d=1<=p?++n:--n)if(!_.isEmpty(s.bb.stacked_items[d].slots[e])&&s.bb.stacked_items[d].slots[e][c])t.next=angular.copy(s.bb.stacked_items[d].slots[e][c]),t=t.next,c+=s.bb.stacked_items[d].service.duration;else return!1;return!0},o(d)?n.push(t.slots[d.time]=d):n.push(void 0);return n}()):n.push(function(){var o,i;for(l in o=s.bb.stacked_items[0].slots[e],i=[],o)d=o[l],i.push(t.slots[d.time]=d);return i}());return n},s.pretty_month_title=function(e,t,o){var i,n;if(null==o&&(o="-"),!!s.start_date)return i=e+" "+t,s.start_date&&s.end_date&&s.end_date.isAfter(s.start_date,"month")?(n=s.start_date.format(e),11===s.start_date.month()&&(n=s.start_date.format(i)),n+" "+o+" "+s.end_date.format(i)):s.start_date.format(i)},s.confirm=function(e,t){var o,n,d,p,m,u,g,h,y,f,v,k,w,S;for(null==t&&(t={}),k=s.bb.stacked_items,(p=0,h=k.length);p<h;p++)if(m=k[p],!m.time)return c.add("danger",{msg:"Select a time to continue your booking"}),!1;if(null!=s.bb.moving_booking&&null!=s.bb.moving_booking.bookings){for(n=!1,w=s.bb.moving_booking.bookings,(u=0,y=w.length);u<y;u++){for(o=w[u],d=!1,S=s.bb.stacked_items,(g=0,f=S.length);g<f;g++)m=S[g],o.getDateString()===m.date.string_date&&o.getTimeInMins()===m.time.time&&o.category_name===m.category_name&&(d=!0);if(!d){n=!0;break}}if(!n)return c.add("danger",{msg:"Your treatments are already booked for this time."}),!1}return(s.bb.basket.clear(),s.bb.pushStackToBasket(),s.bb.moving_booking)?(s.notLoaded(s),v=b.update({purchase:s.bb.moving_booking,bookings:s.bb.basket.items}),void v.then(function(e){return e.getBookingsPromise().then(function(e){var t,i,n,d,l;for(l=[],n=0,i=e.length;n<i;n++)o=e[n],s.bookings?l.push(function(){var e,i,l,c;for(l=s.bookings,c=[],(t=i=0,e=l.length);i<e;t=++i)d=l[t],d.id===o.id?c.push(s.bookings[t]=o):c.push(void 0);return c}()):l.push(void 0);return l}),s.setLoaded(s),s.bb.current_item.move_done=!0,s.decideNextPage()},function(){return s.setLoaded(s),c.add("danger",{msg:"Failed to move booking"})})):(s.notLoaded(s),t.do_not_route?s.updateBasket():s.updateBasket().then(function(){return s.setLoaded(s),s.decideNextPage(e)},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")}))},s.setReady=function(){return s.confirm("",{do_not_route:!0})}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbPackageItems",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"PackageItem"}}),angular.module("BB.Controllers").controller("PackageItem",function(e,t,s){return e.controller="public.controllers.PackageItem",t.connection_started.then(function(){if(e.bb.company)return e.init(e.bb.company)}),e.init=function(t){return e.booking_item||(e.booking_item=e.bb.current_item),s.query(t).then(function(t){return e.packages=t})},e.selectItem=function(t,s){return e.$parent.$has_page_control?(e["package"]=t,!1):(e.booking_item.setPackageItem(t),e.decideNextPage(s),!0)},e.setReady=function(){return!!e["package"]&&(e.booking_item.setPackageItem(e["package"]),!0)},e.getPackageServices=function(e){var t;return e&&!e.service_list&&(e.service_list=[],t=s.getPackageServices(e),t.then(function(t){return e.service_list=t}),!0)}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbPackagePicker",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"PackagePicker"}}),angular.module("BB.Controllers").controller("PackagePicker",function(e,t,s,o,n){return e.controller="public.controllers.PackagePicker",e.sel_date=moment().add(1,"days"),e.selected_date=e.sel_date.toDate(),e.picked_time=!1,e.$watch("selected_date",function(){return function(t){return e.sel_date=moment(t),e.loadDay()}}(this)),e.loadDay=function(){return function(){var t,d,l,c,p;for(e.timeSlots=[],e.notLoaded(e),c=[],p=e.stackedItems,(t=0,l=p.length);t<l;t++)d=p[t],c.push(o.query({company:e.bb.company,cItem:d,date:e.sel_date,client:e.client}));return s.all(c).then(function(t){var s,o,i,c,p,u,b,g,h,y,f,v,w,S,B,P,L,D,I,C,A,E;for(e.setLoaded(e),e.data_valid=!0,e.timeSlots=[],P=e.stackedItems,(s=i=0,b=P.length);i<b;s=++i)d=P[s],d.slots=t[s],d.slots&&0!==d.slots.length||(e.data_valid=!1),d.order=s;if(e.data_valid){for(e.timeSlots=t,o=null,L=e.stackedItems,(c=0,g=L.length);c<g;c++){for(d=L[c],S=null,D=d.slots,(p=0,h=D.length);p<h;p++)E=D[p],o&&E.time<o?E.disable():!S&&(S=E.time+d.service.duration);o=S}for(u=null,I=e.bb.stacked_items.slice(0).reverse(),A=[],(v=0,y=I.length);v<y;v++){for(d=I[v],B=null,C=d.slots,(w=0,f=C.length);w<f;w++)E=C[w],u&&E.time>u?E.disable():B=E.time-d.service.duration;A.push(u=B)}return A}},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),e.selectSlot=function(){return function(t,s){var o,d,l,c,p,m,u,b,g,h,y,f,v,w,S;for(f=e.stackedItems,o=l=0,b=f.length;l<b;o=++l)if(c=f[o],o===t.order){if(c.setDate(new n.Day({date:e.sel_date.format(),spaces:1})),c.setTime(s),y=s.time+c.service.duration,S=s.time,s=null,0<o)for(d=o-1;0<=d;){if(c=e.bb.stacked_items[d],u=S-c.service.duration,!c.time||c.time.time>u)for(c.setDate(new n.Day({date:e.sel_date.format(),spaces:1})),c.setTime(null),v=c.slots,(p=0,g=v.length);p<g;p++)s=v[p],s.time<u&&c.setTime(s);S=c.time.time,d-=1}}else if(o>t.order&&(w=c.slots,c.setDate(new n.Day({date:e.sel_date.format(),spaces:1})),w))for(c.setTime(null),m=0,h=w.length;m<h;m++)s=w[m],s.time>=y&&!c.time&&(c.setTime(s),y=s.time+c.service.duration);return e.picked_time=!0}}(this),e.hasAvailability=function(){return function(e,t,s){var o,n,d,c,p,m,u,b,g;if(!e)return!1;if(t&&s){for(o=0,p=e.length;o<p;o++)if(g=e[o],g.time>=t&&g.time<s&&0<g.availability())return!0;}else if(s){for(n=0,m=e.length;n<m;n++)if(g=e[n],g.time<s&&0<g.availability())return!0;}else if(t){for(d=0,u=e.length;d<u;d++)if(g=e[d],g.time>=t&&0<g.availability())return!0;}else for(c=0,b=e.length;c<b;c++)if(g=e[c],0<g.availability())return!0}}(this),e.confirm=function(){return function(){}}(this)})}.call(this),function(){'use strict';var e;e=function(e,t,s){var o;return e.controllerClass="public.controllers.PageController",e.$has_page_control=!0,e.validator=s,o=function(){return function(e){var t,s,n,d,l,c;for(c=[],s=[],t=e.$$childHead;t;)s.push(t),t=t.$$nextSibling;for(s.sort(function(e,t){return(e.ready_order||0)>=(t.ready_order||0)?1:-1}),n=0,d=s.length;n<d;n++)t=s[n],l=o(t),angular.isArray(l)?Array.prototype.push.apply(c,l):c.push(l);return e.hasOwnProperty("setReady")&&c.push(e.setReady()),c}}(this),e.checkReady=function(){var s,n,d,l,c;if(l=o(e),s=t.defer(),e.$checkingReady=s.promise,l=l.filter(function(e){return!("boolean"==typeof e&&e)}),!l||0===l.length)return s.resolve(),!0;for(n=0,d=l.length;n<d;n++)if(c=l[n],"boolean"==typeof value||!c)return s.reject(),!1;return e.notLoaded(e),t.all(l).then(function(){return e.setLoaded(e),s.resolve()},function(){return e.setLoaded(e)}),!0},e.routeReady=function(t){return e.$checkingReady?e.$checkingReady.then(function(){return function(){return e.decideNextPage(t)}}(this)):e.decideNextPage(t)}},angular.module("BB.Directives").directive("bbPage",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"PageController"}}),angular.module("BB.Controllers").controller("PageController",e),angular.module("BB.Services").value("PageControllerService",e)}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbPayForm",function(e,t,s,o,n,d,l,c){var p,m,u;return p=function(e,t,s){if(null!=e)return d.domain="bookingbug.com",o.get(e).then(function(e){return n(e.data)(t,function(t,o){var d,l,c,p;for(c=0,p=t.length;c<p;c++)l=t[c],"STYLE"===l.tagName&&s.after(l.outerHTML);if(d=function(){var e,s,o;for(o=[],e=0,s=t.length;e<s;e++)l=t[e],"payment_form"===l.id&&o.push(l);return o}(),d&&d[0])return n(d[0].innerHTML)(o,function(e){var t,o;return o=s.find("form")[0],t=o.action,e.attr("action",t),$(o).replaceWith(e)})})})},m=function(t){var s,o,i;if(s="custom_css",!document.getElementById(s))return o=document.getElementsByTagName("head")[0],i=document.createElement("link"),i.id=s,i.rel="stylesheet",i.type="text/css",i.href=t,i.media="all",o.appendChild(i),i.onload=function(){if("parentIFrame"in e)return parentIFrame.size()}},u=function(t,s){return e.addEventListener("message",function(){return function(e){var o;if(angular.isObject(e.data)?o=e.data:angular.isString(e.data)&&!e.data.match(/iFrameSizer/)&&(o=JSON.parse(e.data)),o)switch(o.type){case"load":return t.$apply(function(){if(t.referrer=o.message,o.custom_partial_url&&p(e.data.custom_partial_url,t,s),o.custom_stylesheet&&m(o.custom_stylesheet),o.scroll_offset)return c.setScrollOffset(o.scroll_offset)});}}}(this),!1)},{restrict:"AE",replace:!0,scope:!0,controller:"PayForm",link:u}}),angular.module("BB.Controllers").controller("PayForm",function(e,t){var s,o;return e.controller="public.controllers.PayForm",e.setTotal=function(t){return e.total=t},e.setCard=function(t){return e.card=t},s=function(){return function(){var s,o,i;return o=t.protocol()+"://"+t.host(),t.port()&&(o+=":"+t.port()),i=e.referrer,s=JSON.stringify({type:"submitting",message:o}),parent.postMessage(s,i)}}(this),o=function(){return function(){var e;return e=angular.element.find("form"),e[0].submit()}}(this),e.submitAndSendMessage=function(){return function(t){var i;return t.preventDefault(),t.stopPropagation(),i=e.$eval("payment_form"),i.$invalid?(i.submitted=!0,!1):(s(),o())}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbPayment",function(e,t,s,o,i){return{restrict:"AE",replace:!0,scope:!0,controller:"Payment",link:function(s,n,d){var l,c,p;return l=function(e,t){return e.error(t)},c=function(e){var t;return t=document.createElement("a"),t.href=e,t.protocol+"//"+t.host},p=function(e,s,i){var n,d,l;return l=t.protocol()+"://"+t.host(),t.port()&&(l+=":"+t.port()),i.payment_options.custom_stylesheet&&(n=i.payment_options.custom_stylesheet),d=JSON.stringify({type:"load",message:l,custom_partial_url:i.bb.custom_partial_url,custom_stylesheet:n,scroll_offset:o.getScrollOffset()}),e.find("iframe")[0].contentWindow.postMessage(d,s)},s.payment_options=s.$eval(d.bbPayment)||{},s.route_to_next_page=null==s.payment_options.route_to_next_page||s.payment_options.route_to_next_page,n.find("iframe").bind("load",function(){return function(){var e,t;return s.bb&&s.bb.total&&s.bb.total.$href("new_payment")&&(t=s.bb.total.$href("new_payment")),e=c(t),p(n,e,s),s.$apply(function(){return s.callSetLoaded()})}}(this)),e.addEventListener("message",function(){return function(e){var t;return angular.isObject(e.data)?t=e.data:!e.data.match(/iFrameSizer/)&&(t=JSON.parse(e.data)),s.$apply(function(){if(t)switch(t.type){case"submitting":return s.callNotLoaded();case"error":return s.$emit("payment:failed"),s.callNotLoaded(),i.raise("PAYMENT_FAILED"),document.getElementsByTagName("iframe")[0].src+="";case"payment_complete":return s.callSetLoaded(),s.paymentDone();}})}}(this),!1)}}}),angular.module("BB.Controllers").controller("Payment",function(e,t,s,o,i,n,d){return e.controller="public.controllers.Payment",e.notLoaded(e),e.purchase&&(e.bb.total=e.purchase),t.connection_started.then(function(){if(e.total&&(e.bb.total=e.total),e.bb&&e.bb.total&&e.bb.total.$href("new_payment"))return e.url=n.trustAsResourceUrl(e.bb.total.$href("new_payment"))}),e.callNotLoaded=function(){return function(){return e.notLoaded(e)}}(this),e.callSetLoaded=function(){return function(){return e.setLoaded(e)}}(this),e.paymentDone=function(){if(e.bb.payment_status="complete",e.$emit("payment:complete"),e.route_to_next_page)return e.decideNextPage()},e.error=function(e){return d.warn("Payment Failure: "+e)}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbPeople",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"PersonList",link:function(e,t,s){return s.bbItems?(e.booking_items=e.$eval(s.bbItems)||[],e.booking_item=e.booking_items[0]):(e.booking_item=e.$eval(s.bbItem)||e.bb.current_item,e.booking_items=[e.booking_item])}}}),angular.module("BB.Controllers").controller("PersonList",function(e,t,s,o,i,n,d,l){var c,p,m;return e.controller="public.controllers.PersonList",e.notLoaded(e),angular.extend(this,new s(e,n)),t.connection_started.then(function(){return p()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),p=function(){var t,s;return(t=e.booking_item,!t.service||t.service===e.change_watch_item)?void(t.service||e.setLoaded(e)):(e.change_watch_item=t.service,e.notLoaded(e),s=o.query(e.bb.company),s.then(function(s){return t.group&&(s=s.filter(function(e){return!e.group_id||e.group_id===t.group})),e.all_people=s}),i.query({company:e.bb.company,cItem:t,wait:s,item:"person"}).then(function(s){var o,d,l,c;for(t.group&&(s=s.filter(function(e){return!e.group_id||e.group_id===t.group})),c=[],(d=0,l=s.length);d<l;d++)o=s[d],c.push(o.promise);return n.all(c).then(function(){return function(){var i,n,d,l;for(d=[],i=0,n=s.length;i<n;i++)o=s[i],d.push(o.item),t&&t.person&&t.person.id===o.item.id&&(-1!==e.bb.current_item.settings.person&&(e.person=o.item),e.selected_bookable_items=[o]);return 1===s.length&&e.bb.company.settings&&e.bb.company.settings.merge_people&&(l=s[0]),e.bb.current_item.defaults.person&&(l=e.bb.current_item.defaults.person),l&&!e.selectItem(l,e.nextRoute,{skip_step:!0})?(m(d),e.bookable_items=s,e.selected_bookable_items=s):(m(d),e.bookable_items=s,!e.selected_bookable_items&&(e.selected_bookable_items=s)),e.setLoaded(e)}}(this))},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}))},m=function(t){if(e.bookable_people=t,e.person)return _.each(t,function(t){if(t.id===e.person.id)return e.person=t})},c=function(){return function(t){var s,o,i,n;if(t instanceof l&&e.bookable_items)for(n=e.bookable_items,o=0,i=n.length;o<i;o++)if(s=n[o],s.item.self===t.self)return s;return t}}(this),e.selectItem=function(){return function(t,s,o){var i;return null==o&&(o={}),e.$parent.$has_page_control?(e.person=t,!1):(i=c(t),_.each(e.booking_items,function(e){return e.setPerson(i)}),o.skip_step&&e.skipThisStep(),e.decideNextPage(s),!0)}}(this),e.selectAndRoute=function(){return function(t,s){var o;return o=c(t),_.each(e.booking_items,function(e){return e.setPerson(o)}),e.decideNextPage(s),!0}}(this),e.$watch("person",function(){return function(t,s){var o;if(e.person&&e.booking_item){if(!e.booking_item.person||e.booking_item.person.self!==e.person.self)return o=c(e.person),_.each(e.booking_items,function(e){return e.setPerson(o)}),e.broadcastItemUpdate();}else if(t!==s)return _.each(e.booking_items,function(e){return e.setPerson(null)}),e.broadcastItemUpdate()}}(this)),e.$on("currentItemUpdate",function(){return p()}),e.setReady=function(){return function(){var t;return e.person?(t=c(e.person),_.each(e.booking_items,function(e){return e.setPerson(t)}),!0):(_.each(e.booking_items,function(e){return e.setPerson(null)}),!0)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbProductList",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"ProductList",link:function(e,t,s){s.bbItem&&(e.booking_item=e.$eval(s.bbItem)),s.bbShowAll&&(e.show_all=!0)}}}),angular.module("BB.Controllers").controller("ProductList",function(e,t,s,o,i,n,d){return e.controller="public.controllers.ProductList",e.notLoaded(e),e.validator=d,t.connection_started.then(function(){if(e.bb.company)return e.init(e.bb.company)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(t){return e.booking_item||(e.booking_item=e.bb.current_item),t.$get("products").then(function(t){return t.$get("products").then(function(t){return e.products=t,e.setLoaded(e)})})},e.selectItem=function(t,s){return e.$parent.$has_page_control?(e.product=t,!1):(e.booking_item.setProduct(t),e.decideNextPage(s),!0)}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbPurchaseTotal",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"PurchaseTotal"}}),angular.module("BB.Controllers").controller("PurchaseTotal",function(e,t,s,o,i){return e.controller="public.controllers.PurchaseTotal",angular.extend(this,new s.PageController(e,i)),e.load=function(){return function(s){return t.connection_started.then(function(){return e.loadingTotal=o.query({company:e.bb.company,total_id:s}),e.loadingTotal.then(function(t){return e.total=t})})}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbResources",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"ResourceList",link:function(e,t,s){return e.options=e.$eval(s.bbResources)||{},s.bbItems?(e.booking_items=e.$eval(s.bbItems)||[],e.booking_item=e.booking_items[0]):(e.booking_item=e.$eval(s.bbItem)||e.bb.current_item,e.booking_items=[e.booking_item])}}}),angular.module("BB.Controllers").controller("ResourceList",function(e,t,s,o,i,n,d,l,c){var p,m;return e.controller="public.controllers.ResourceList",e.notLoaded(e),angular.extend(this,new o(e,d)),t.connection_started.then(function(){return function(){return m()}}(this)),m=function(){return function(){var t,s;return e.bb.steps&&"resource_list"===e.bb.steps[0].page||e.options.resource_first||e.booking_item.service&&e.booking_item.service!==e.change_watch_item?(e.change_watch_item=e.booking_item.service,e.notLoaded(e),s=i.query(e.bb.company),s.then(function(t){return e.booking_item.group&&(t=t.filter(function(t){return!t.group_id||t.group_id===e.booking_item.group})),e.all_resources=t}),t={company:e.bb.company,cItem:e.booking_item,wait:s,item:"resource"},n.query(t).then(function(t){var s,o,n,l;for(l=[],e.booking_item.group&&(t=t.filter(function(t){return!t.group_id||t.group_id===e.booking_item.group})),(o=0,n=t.length);o<n;o++)s=t[o],l.push(s.promise);return d.all(l).then(function(){var o,i,n,d;for(d=[],o=0,i=t.length;o<i;o++)s=t[o],d.push(s.item),e.booking_item&&e.booking_item.resource&&e.booking_item.resource.id===s.item.id&&-1!==e.bb.current_item.settings.resource&&(e.resource=s.item);return 1===d.length&&(n=t[0]),e.bb.item_defaults.resource&&(n=e.bb.item_defaults.resource),n&&!e.selectItem(n.item,e.nextRoute,{skip_step:!0})?(e.bookable_resources=d,e.bookable_items=t):(e.bookable_resources=d,e.bookable_items=t),e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},function(t){return"No service link found"===t&&(e.bb.steps&&"resource_list"===e.bb.steps[0].page||e.options.resource_first)?e.setLoaded(e):e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})):void(e.booking_item.service||e.setLoaded(e))}}(this),p=function(){return function(t){var s,o,i,n;if(t instanceof c&&e.bookable_items)for(n=e.bookable_items,o=0,i=n.length;o<i;o++)if(s=n[o],s.item.self===t.self)return s;return t}}(this),e.selectItem=function(){return function(t,s,o){var i;return null==o&&(o={}),e.$parent.$has_page_control?(e.resource=t,!1):(i=p(t),_.each(e.booking_items,function(e){return e.setResource(i)}),o.skip_step&&e.skipThisStep(),e.decideNextPage(s),!0)}}(this),e.$watch("resource",function(){return function(t,s){var o;if(e.resource&&e.booking_item){if(!e.booking_item.resource||e.booking_item.resource.self!==e.resource.self)return o=p(e.resource),_.each(e.booking_items,function(e){return e.setResource(o)}),e.broadcastItemUpdate();}else if(t!==s)return _.each(e.booking_items,function(e){return e.setResource(null)}),e.broadcastItemUpdate()}}(this)),e.$on("currentItemUpdate",function(){return m()}),e.setReady=function(){return function(){var t;return e.resource?(t=p(e.resource),_.each(e.booking_items,function(e){return e.setResource(t)}),!0):(_.each(e.booking_items,function(e){return e.setResource(null)}),!0)}}(this)})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbServices",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"ServiceList"}}),angular.module("BB.Controllers").controller("ServiceList",function(e,t,s,o,i,n,d,l,c,p,m,u,b,g,h){var y,f;return e.controller="public.controllers.ServiceList",l.init("ServiceList",e,["service"]),e.notLoaded(e),angular.extend(this,new p(e,s)),e.validator=c,e.filters={category_name:null,service_name:null,price:{min:0,max:100},custom_array_value:null},e.show_custom_array=!1,e.options=e.$eval(o.bbServices)||{},o.bbItem&&(e.booking_item=e.$eval(o.bbItem)),(o.bbShowAll||e.options.show_all)&&(e.show_all=!0),e.options.allow_single_pick&&(e.allowSinglePick=!0),e.options.hide_disabled&&(e.hide_disabled=!0),e.price_options={min:0,max:100},t.connection_started.then(function(){return function(){if(e.bb.company)return e.init(e.bb.company)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(t){var i,n,l;return e.booking_item||(e.booking_item=e.bb.current_item),e.bb.company.$has("named_categories")?h.query(e.bb.company).then(function(){return function(t){return e.all_categories=t}}(this),function(){return e.all_categories=[]}):e.all_categories=[],e.service&&e.service.company_id!==e.bb.company.id&&(e.service=null),l=t.getServicesPromise(),i=[l],l.then(function(){return function(t){var s,i,n,d,l,c;if(e.hide_disabled&&(t=t.filter(function(e){return!e.disabled&&!e.deleted})),s="false"!==o.filterServices,s&&(e.booking_item.service_ref&&!e.show_all?t=t.filter(function(t){return t.api_ref===e.booking_item.service_ref}):e.booking_item.category&&!e.show_all&&(t=t.filter(function(t){return t.$has("category")&&t.$href("category")===e.booking_item.category.self}))),e.options.show_event_groups||(t=t.filter(function(e){return!e.is_event_group})),1!==t.length||e.allowSinglePick?y(t):!e.selectItem(t[0],e.nextRoute,{skip_step:!0})&&y(t),e.booking_item.defaultService())for(n=0,l=t.length;n<l;n++)i=t[n],i.self!==e.booking_item.defaultService().self&&(i.name!==e.booking_item.defaultService().name||i.deleted)||e.selectItem(i,e.nextRoute,{skip_step:!0});if(e.booking_item.service)for(d=0,c=t.length;d<c;d++)i=t[d],i.selected=!1,i.self===e.booking_item.service.self&&(e.service=i,i.selected=!0,e.booking_item.setService(e.service));return e.booking_item.service||(!e.booking_item.person||e.booking_item.anyPerson())&&(!e.booking_item.resource||e.booking_item.anyResource())?(t=f(t),e.bookable_services=t):void 0}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),(e.booking_item.person&&!e.booking_item.anyPerson()||e.booking_item.resource&&!e.booking_item.anyResource())&&(n=d.query({company:e.bb.company,cItem:e.booking_item,wait:l,item:"service"}),i.push(n),n.then(function(){return function(t){var s,o;return(e.booking_item.service_ref&&(t=t.filter(function(t){return t.api_ref===e.booking_item.service_ref})),e.booking_item.group&&(t=t.filter(function(t){return!t.group_id||t.group_id===e.booking_item.group})),e.hide_disabled&&(t=t.filter(function(e){return null==e.item||!e.item.disabled&&!e.item.deleted})),o=function(){var e,o,i;for(i=[],e=0,o=t.length;e<o;e++)s=t[e],null!=s.item&&i.push(s.item);return i}(),o=f(o),e.bookable_services=o,e.bookable_items=t,1!==o.length||e.allowSinglePick)?y(o):e.selectItem(o[0],e.nextRoute,{skip_step:!0})?void 0:y(o)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})),s.all(i).then(function(){return e.setLoaded(e)})},f=function(e){var t,s,o;for(s=0,o=e.length;s<o;s++)t=e[s],t.display_name=t.listed_durations&&1===t.listed_durations.length?t.name+" - "+g("time_period")(t.duration):t.name;return e},y=function(t){if(e.items=t,e.filtered_items=e.items,e.service)return _.each(t,function(t){if(t.id===e.service.id)return e.service=t})},e.selectItem=function(){return function(t,s,o){return null==o&&(o={}),!!e.routed||(e.$parent.$has_page_control?(e.service=t,!1):t.is_event_group?(e.booking_item.setEventGroup(t),o.skip_step&&e.skipThisStep(),e.decideNextPage(s),e.routed=!0):(e.booking_item.setService(t),e.bb.selected_service=e.booking_item.service,o.skip_step&&e.skipThisStep(),e.decideNextPage(s),e.routed=!0,!0))}}(this),e.$watch("service",function(){return function(){if(e.service&&e.booking_item&&(!e.booking_item.service||e.booking_item.service.self!==e.service.self))return e.booking_item.setService(e.service),e.broadcastItemUpdate(),e.bb.selected_service=e.service}}(this)),e.setReady=function(){return function(){return e.service?(e.booking_item.setService(e.service),!0):!!(e.bb.stacked_items&&0<e.bb.stacked_items.length)}}(this),e.errorModal=function(){var t;return t=i.open({templateUrl:e.getPartial("_error_modal"),controller:function(e,t){return e.message=b.getError("GENERIC").msg,e.ok=function(){return t.close()}}})},e.filterFunction=function(t){return!!t&&(e.service_array=[],e.custom_array=function(s){var o,i,n,d;if(!s)return!1;if(e.options.custom_filter){for(s=s.toLowerCase(),d=t.extra[e.options.custom_filter],(i=0,n=d.length);i<n;i++)if(o=d[i],o=o.toLowerCase(),o===s)return e.show_custom_array=!0,!0;return!1}},e.service_name_include=function(e){var s;return!!e&&(e?(e=e.toLowerCase(),s=t.name.toLowerCase(),!!s.includes(e)):void 0)},(!e.filters.category_name||t.category_id===e.filters.category_name.id)&&(!e.filters.service_name||e.service_name_include(e.filters.service_name))&&(!e.filters.custom_array_value||e.custom_array(e.filters.custom_array_value))&&(!t.price||t.price>=100*e.filters.price.min&&t.price<=100*e.filters.price.max))},e.resetFilters=function(){return e.options.clear_results&&(e.show_custom_array=!1),e.filters.category_name=null,e.filters.service_name=null,e.filters.price.min=0,e.filters.price.max=100,e.filters.custom_array_value=null,e.filterChanged()},e.filterChanged=function(){return e.filtered_items=g("filter")(e.items,e.filterFunction)}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbTimeSlots",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"TimeSlots",link:function(e,t,s){s.bbItem&&(e.booking_item=e.$eval(s.bbItem)),s.bbShowAll&&(e.show_all=!0)}}}),angular.module("BB.Controllers").controller("TimeSlots",function(e,t,s,o,i){var n;return e.controller="public.controllers.SlotList",e.notLoaded(e),t.connection_started.then(function(){if(e.bb.company)return e.init(e.bb.company)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(){return e.booking_item||(e.booking_item=e.bb.current_item),e.start_date=moment(),e.end_date=moment().add(1,"month"),i.query(e.bb.company,{item:e.booking_item,start_date:e.start_date.toISODate(),end_date:e.end_date.toISODate()}).then(function(t){return e.slots=t,e.setLoaded(e)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})},n=function(t){return e.booking_item.setSlot(t)},e.selectItem=function(t,s){return e.$parent.$has_page_control?(n(t),!1):(n(t),e.decideNextPage(s),!0)}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbSpaces",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"SpaceList"}}),angular.module("BB.Controllers").controller("SpaceList",function(e,t,s,o){return e.controller="public.controllers.SpaceList",t.connection_started.then(function(){return function(){if(e.bb.company)return e.init(e.bb.company)}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.init=function(){return function(s){return o.query(s).then(function(s){return e.currentItem.category&&(s=s.filter(function(t){return t.$has("category")&&t.$href("category")===e.currentItem.category.self})),e.items=s,1!==s.length||e.allowSinglePick?e.listLoaded=!0:(e.skipThisStep(),t.services=s,e.selectItem(s[0],e.nextRoute))},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),e.selectItem=function(){return function(t,s){return e.currentItem.setService(t),e.decide_next_page(s)}}(this)})}.call(this),function(){angular.module("BB.Directives").directive("bbSummary",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"Summary"}}),angular.module("BB.Controllers").controller("Summary",function(e,t,s,o){return e.controller="public.controllers.Summary",t.connection_started.then(function(){return function(){return e.item=e.bb.current_item,e.items=e.bb.basket.timeItems()}}(this)),e.confirm=function(){return function(){var t;return e.notLoaded(e),t=[s.create_or_update(e.bb.company,e.client)],e.bb.current_item.service&&t.push(e.addItemToBasket()),o.all(t).then(function(t){var s;return s=t[0],e.setClient(s),s.waitingQuestions&&s.gotQuestions.then(function(){return e.client_details=s.client_details}),e.setLoaded(e),e.decideNextPage()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this)})}.call(this),function(){angular.module("BB.Directives").directive("bbSurveyQuestions",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"SurveyQuestions"}}),angular.module("BB.Controllers").controller("SurveyQuestions",function(e,t,s,o,i,n,d,l,c,p,m,u,b,g,h,y,f,v,k,w){var S,B,P,L,D,I,C;return e.controller="SurveyQuestions",e.completed=!1,e.login={email:"",password:""},e.login_error=!1,e.booking_ref="",e.notLoaded(e),t.connection_started.then(function(){return D()},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),D=function(){return function(){if(e.company){if(!e.company.settings.requires_login)return S();if(e.checkIfLoggedIn(),t.member)return S()}}}(this),e.checkIfLoggedIn=function(){return function(){return h.checkLogin()}}(this),e.loadSurvey=function(){return function(){return e.company||e.purchase.$get("company").then(function(e){return I(e)}),e.purchase.$has("client")&&e.purchase.$get("client").then(function(t){return e.setClient(new p.Client(t))}),e.purchase.getBookingsPromise().then(function(s){var o,n,d,l,c,m,u,b;for(c={},e.bookings=s,u=e.bookings,b=[],(d=0,l=u.length);d<l;d++)n=u[d],n.datetime&&(n.pretty_date=moment(n.datetime).format("dddd, MMMM Do YYYY")),n.address&&(o=new p.Address(n.address),m=o.addressSingleLine(),n.pretty_address=m),t.user&&(c.admin_only=!0),b.push(n.$get("survey_questions",c).then(function(t){var s;return s=new p.ItemDetails(t),n.survey_questions=s.survey_questions,n.getSurveyAnswersPromise().then(function(t){var s,o,i,d,l,c,p,m;for(n.survey_answers=t,p=n.survey_questions,(o=0,d=p.length);o<d;o++)if(c=p[o],n.survey_answers)for(m=n.survey_answers,i=0,l=m.length;i<l;i++)s=m[i],s.question_text===c.name&&s.value&&(c.answer=s.value);return e.setLoaded(e)})}));return b},function(){return e.setLoaded(e),failMsg()})}}(this),e.submitSurveyLogin=function(){return function(t){return v.validateForm(t)?h.companyLogin(e.company,{},{email:e.login.email,password:e.login.password,id:e.company.id}).then(function(e){return h.setLogin(e),S()},function(t){return C(),e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}):void 0}}(this),e.loadSurveyFromPurchaseID=function(){return function(t){var s,i;return i={purchase_id:t,url_root:e.bb.api_url},s=w.getItem("auth_token"),s&&(i.auth_token=s),o.query(i).then(function(t){return e.purchase=t,e.total=e.purchase,e.loadSurvey(e.purchase)},function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),e.loadSurveyFromBookingRef=function(){return function(t){var s,i;return i={booking_ref:t,url_root:e.bb.api_url,raw:!0},s=w.getItem("auth_token"),s&&(i.auth_token=s),o.bookingRefQuery(i).then(function(t){return e.purchase=t,e.total=e.purchase,e.loadSurvey(e.purchase)},function(t){return C(),e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),e.submitSurvey=function(){return function(t){var s,o,n,d,l,c;if(v.validateForm(t)){for(l=e.bookings,c=[],(o=0,n=l.length);o<n;o++)s=l[o],s.checkReady(),s.ready?(e.notLoaded(e),s.client_id=e.client.id,d=s,c.push(k.addSurveyAnswersToBooking(d).then(function(){return e.setLoaded(e),e.completed=!0},function(){return e.setLoaded(e)}))):c.push(e.decideNextPage(route));return c}}}(this),e.submitBookingRef=function(){return function(t){var s,i;if(v.validateForm(t))return e.notLoaded(e),i={booking_ref:e.booking_ref,url_root:e.bb.api_url,raw:!0},s=w.getItem("auth_token"),s&&(i.auth_token=s),o.bookingRefQuery(i).then(function(t){return e.purchase=t,e.total=e.purchase,e.loadSurvey(e.purchase)},function(t){return C(),e.setLoadedAndShowError(e,t,"Sorry, something went wrong")})}}(this),e.storeBookingCookie=function(){return document.cookie="bookingrefsc="+e.booking_ref},C=function(){return function(){return e.login_error=!0}}(this),P=function(){return function(){var t;return t={member_id:e.member_id,company_id:e.company_id},h.memberQuery(t).then(function(t){return e.member=t})}}(this),I=function(t){if(e.bb.company_id=t.id,e.bb.company=new p.Company(t),e.company=e.bb.company,e.bb.item_defaults.company=e.bb.company,t.settings&&(t.settings.merge_resources&&(e.bb.item_defaults.merge_resources=!0),t.settings.merge_people))return e.bb.item_defaults.merge_people=!0},B=function(){var e,t;return t=/^.*(?:\?|&)booking_ref=(.*?)(?:&|$)/.exec(d.absUrl()),t&&(e=t[1]),e},L=function(){var e,t;return e=/^.*(?:\?|&)id=(.*?)(?:&|$)/.exec(d.absUrl()),e&&(t=e[1]),t},S=function(){var t;return(t=B(),t)?e.loadSurveyFromBookingRef(t):(t=L(),t)?e.loadSurveyFromPurchaseID(t):e.bb.total?e.loadSurveyFromPurchaseID(e.bb.total.long_id):void 0}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbTimes",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"TimeList"}}),angular.module("BB.Controllers").controller("TimeList",function(e,t,o,i,n,s,d,l,c,p,m){var u;return o.controller="public.controllers.TimeList",o.notLoaded(o),angular.extend(this,new p(o,n)),o.data_source||(o.data_source=o.bb.current_item),o.options=o.$eval(e.bbTimes)||{},i.connection_started.then(function(){return o.bb.current_item.defaults.date&&!o.bb.current_item.date?o.setDate(o.bb.current_item.defaults.date):o.bb.current_item.date?o.setDate(o.bb.current_item.date.date):o.setDate(moment()),o.loadDay()},function(e){return o.setLoadedAndShowError(o,e,"Sorry, something went wrong")}),o.setDate=function(){return function(e){var t;return t=new l.Day({date:e,spaces:1}),o.selected_day=t,o.selected_date=t.date}}(this),o.setDataSource=function(){return function(e){return o.data_source=e}}(this),o.setItemLinkSource=function(){return function(e){return o.item_link_source=e}}(this),o.$on("dateChanged",function(){return function(e,t){return o.setDate(t),o.loadDay()}}(this)),o.$on("currentItemUpdate",function(){return o.loadDay({check_requested_slot:!1})}),o.selectSlot=function(){return function(e,t,s){if(e&&0<e.availability())return o.item_link_source&&o.data_source.setItem(o.item_link_source),e.datetime?(o.setLastSelectedDate(e.datetime),o.data_source.setDate({date:e.datetime})):t&&(o.setLastSelectedDate(t.date),o.data_source.setDate(t)),o.data_source.setTime(e),o.data_source.reserve_ready?o.addItemToBasket().then(function(){return o.decideNextPage(s)}):o.decideNextPage(s)}}(this),o.highlightSlot=function(){return function(e,t){if(t&&e&&0<e.availability())return e.datetime?(o.setLastSelectedDate(e.datetime),o.data_source.setDate({date:e.datetime})):t&&(o.setLastSelectedDate(t.date),o.data_source.setDate(t)),o.data_source.setTime(e),o.$broadcast("slotChanged")}}(this),o.status=function(e){var t;if(e)return t=e.status(),t},o.add=function(){return function(e,t){var s;return delete o.bb.current_item.time,s=moment(o.selected_day.date).add(t,e),o.setDate(s),o.loadDay()}}(this),o.subtract=function(){return function(e,t){return o.add(e,-t)}}(this),o.loadDay=function(){return function(e){var t;return e||(e={check_requested_slot:!0}),o.data_source&&(o.data_source.days_link||o.item_link_source)&&o.selected_day?(o.notLoaded(o),t=s.query({company:o.bb.company,cItem:o.data_source,item_link:o.item_link_source,date:o.selected_day.date,client:o.client,available:1}),t["finally"](function(){return o.setLoaded(o)}),t.then(function(t){var n,d,c,p,m,b,g,h,y;if(o.slots=t,o.$broadcast("slotsUpdated",o.data_source,t),o.add_padding&&0<t.length){for(n={},d=0,p=t.length;d<p;d++)h=t[d],n[h.time]=1;for(g=o.add_padding,y=c=0,m=g.length;c<m;y=++c)b=g[y],n[b]||t.splice(y,0,new l.TimeSlot({time:b,avail:0},t[0].service))}return!0===e.check_requested_slot?u(t):void 0},function(e){return 404===e.status&&e.data&&e.data.error&&"No bookable events found"===e.data.error?o.data_source&&o.data_source.person?(d.warning(m.getError("NOT_BOOKABLE_PERSON")),o.setLoaded(o)):o.data_source&&o.data_source.resource?(d.warning(m.getError("NOT_BOOKABLE_RESOURCE")),o.setLoaded(o)):o.setLoadedAndShowError(o,e,"Sorry, something went wrong"):o.setLoadedAndShowError(o,e,"Sorry, something went wrong")})):o.setLoaded(o)}}(this),u=function(e){var t;if(o.bb.item_defaults&&o.bb.item_defaults.time)return(t=c.checkDefaultTime(o.selected_date,e,o.data_source,o.bb.item_defaults),console.log(o.bb.item_defaults),console.log(t),null===t.slot||null===t.match)?o.availability_conflict=!0:t.slot&&"full"===t.match?(o.skipThisStep(),o.selectSlot(t.slot,o.selected_day)):t.slot&&"partial"===t.match?o.highlightSlot(t.slot,o.selected_day):void 0},o.padTimes=function(){return function(e){return o.add_padding=e}}(this),o.setReady=function(){return o.data_source.time?!o.data_source.reserve_ready||o.addItemToBasket():(d.clear(),d.add("danger",{msg:"You need to select a time slot"}),!1)}})}.call(this),function(){'use strict';var e=Math.ceil;angular.module("BB.Directives").directive("bbTimeRanges",function(e,t,s){return{restrict:"AE",replace:!0,scope:!0,priority:1,transclude:!0,controller:"TimeRangeList",link:function(o,i,n,d,l){return o.today=moment().toDate(),o.tomorrow=moment().add(1,"days").toDate(),o.options=o.$eval(n.bbTimeRanges)||{},l(o,function(){return function(n){var d;return d=1<n.length||1===n.length&&(!n[0].wholeText||/\S/.test(n[0].wholeText)),d?i.html(n).show():e.when(t.get("_week_calendar.html")).then(function(e){return i.html(e).show(),s(i.contents())(o)})}}(this))}}}),angular.module("BB.Controllers").controller("TimeRangeList",function(t,s,o,i,n,d,l,c,p,m,u,b){var g,h,y;return t.controller="public.controllers.TimeRangeList",g=t.bb.postcode,p.init("TimeRangeList",t,["selected_slot","postcode","original_start_date","start_at_week_start"]),g!==t.postcode&&(t.selected_slot=null,t.selected_date=null),t.postcode=t.bb.postcode,t.notLoaded(t),t.data_source||(t.data_source=t.bb.current_item),i.connection_started.then(function(){return t.initialise()}),t.initialise=function(){var e,s,i,n,d;return null==o.bbTimeRangeLength?t.options&&t.options.time_range_length?t.time_range_length=t.options.time_range_length:(e=function(){var e,t,s,o;for(s in e={lg:7,md:5,sm:3,xs:1},o=7,e)t=e[s],s===b.getViewportSize()&&(o=t);return o},t.time_range_length=e(),t.$on("ViewportSize:changed",function(){return t.time_range_length=null,t.initialise()})):t.time_range_length=t.$eval(o.bbTimeRangeLength),(null!=o.bbDayOfWeek||t.options&&t.options.day_of_week)&&(t.day_of_week=null==o.bbDayOfWeek?t.options.day_of_week:t.$eval(o.bbDayOfWeek)),(null!=o.bbSelectedDay||t.options&&t.options.selected_day)&&(n=null==o.bbSelectedDay?moment(t.options.selected_day):moment(t.$eval(o.bbSelectedDay)),moment.isMoment(n)&&(t.selected_day=n)),t.options.ignore_min_advance_datetime=!!t.options.ignore_min_advance_datetime,!t.start_date&&t.last_selected_date?t.original_start_date?(i=t.last_selected_date.diff(t.original_start_date,"days"),i%=t.time_range_length,i=0===i?i:i+1,d=t.last_selected_date.clone().subtract(i,"days"),y(t.last_selected_date,d)):y(t.last_selected_date):t.bb.current_item.date||t.bb.current_item.defaults.date?(s=t.bb.current_item.date?t.bb.current_item.date.date:t.bb.current_item.defaults.date,y(s)):t.selected_day?(t.original_start_date=t.original_start_date||moment(t.selected_day),y(t.selected_day)):(t.start_at_week_start=!0,y(moment())),t.loadData()},y=function(e,s){t.start_date=s?s:t.day_of_week?e.clone().day(t.day_of_week):t.start_at_week_start?e.clone().startOf("week"):e.clone(),t.selected_day=e,t.selected_date=t.selected_day.toDate(),h()},t.moment=function(e){return moment(e)},t.setDataSource=function(e){return t.data_source=e},t.$on("currentItemUpdate",function(){return t.loadData()}),t.add=function(e,o){return 0<o&&(s.removeClass("subtract"),s.addClass("add")),"days"===e?y(t.start_date.add(o,"days")):"weeks"===e?(t.start_date.add(o,e),y(t.start_date)):"months"===e?(t.start_date.add(o,e).startOf("month"),y(t.start_date)):void 0,t.loadData()},t.subtract=function(e,o){return s.removeClass("add"),s.addClass("subtract"),t.add(e,-o)},h=function(){var s;return t.is_subtract_valid=!0,s=e(t.selected_day.diff(moment(),"day",!0)),t.subtract_length=s<t.time_range_length?s:t.time_range_length,0>=s&&(t.is_subtract_valid=!1),t.subtract_string=1<t.subtract_length?"Prev "+t.subtract_length+" days":1===t.subtract_length?"Prev day":"Prev"},t.selectedDateChanged=function(){return y(moment(t.selected_date)),t.selected_slot=null,t.loadData()},t.isPast=function(){return!t.start_date||moment().isAfter(t.start_date)},t.status=function(e,t){var s;if(t)return s=t.status(),s},t.selectSlot=function(e,s,o){if(e&&0<e.availability())return t.bb.current_item.setTime(e),e.datetime?(t.setLastSelectedDate(e.datetime),t.bb.current_item.setDate({date:e.datetime})):s&&(t.setLastSelectedDate(s.date),t.bb.current_item.setDate(s)),t.bb.current_item.reserve_ready?(t.notLoaded(t),t.addItemToBasket().then(function(){return t.setLoaded(t),t.decideNextPage(o)},function(e){return t.setLoadedAndShowError(t,e,"Sorry, something went wrong")})):t.decideNextPage(o)},t.highlightSlot=function(e,s){var o;if(o=t.bb.current_item,e&&0<e.availability()&&!e.disabled)return e.datetime?(t.setLastSelectedDate(e.datetime),o.setDate({date:e.datetime.clone().tz(t.bb.company.timezone)})):s&&(t.setLastSelectedDate(s.date),o.setDate(s)),o.setTime(e),t.selected_slot=e,t.selected_day=s.date,t.selected_date=s.date.toDate(),t.bb.current_item.earliest_time_slot&&t.bb.current_item.earliest_time_slot.selected&&(!t.bb.current_item.earliest_time_slot.date.isSame(s.date,"day")||t.bb.current_item.earliest_time_slot.time!==e.time)&&(t.bb.current_item.earliest_time_slot.selected=!1),i.$broadcast("time:selected"),t.$broadcast("slotChanged",s,e)},t.loadData=function(){var e,s,o,i,n,p;return e=t.bb.current_item,e.service&&!t.options.ignore_min_advance_datetime&&(t.min_date=e.service.min_advance_datetime,t.max_date=e.service.max_advance_datetime,t.selected_day&&t.selected_day.isBefore(e.service.min_advance_datetime,"day")&&!t.isAdmin()&&y(e.service.min_advance_datetime)),s=t.start_date,i=moment(s).add(t.time_range_length,"days"),t.end_date=moment(i).add(-1,"days"),l.clear(),o=t.bb.current_item.duration,t.bb.current_item.min_duration&&(o=t.bb.current_item.min_duration),t.data_source&&t.data_source.days_link?(t.notLoaded(t),n=null,t.bb.postcode&&(n=",,,,"+t.bb.postcode+","),p=d.query({company:t.bb.company,resource_ids:t.bb.item_defaults.resources,cItem:t.data_source,date:s,client:t.client,end_date:t.end_date,duration:o,location:n,num_resources:t.bb.current_item.num_resources,available:1}),p["finally"](function(){return t.setLoaded(t)}),p.then(function(s){var o,n,l,p,u,b,g,h,y,f,w,S,B,P,L,D,I;for(t.days=[],t.no_slots_in_week=!!_.every(_.values(s),_.isEmpty),S=_.sortBy(_.pairs(s),function(e){return e[0]}),(p=0,g=S.length);p<g;p++){if(w=S[p],o=w[0],D=w[1],n={date:moment(o),slots:D},t.days.push(n),0<D.length&&((!e.earliest_time||e.earliest_time.isAfter(o))&&(e.earliest_time=moment(o).add(D[0].time,"minutes")),(!e.earliest_time_slot||e.earliest_time_slot.date.isAfter(o))&&(e.earliest_time_slot={date:moment(o).add(D[0].time,"minutes"),time:D[0].time})),t.add_padding&&0<D.length){for(l={},u=0,h=D.length;u<h;u++)L=D[u],l[L.time]=1,L.date=n.date.format("DD-MM-YY");for(B=t.add_padding,I=b=0,y=B.length;b<y;I=++b)f=B[I],l[f]||D.splice(I,0,new c.TimeSlot({time:f,avail:0},D[0].service))}P=m.checkDefaultTime(n.date,n.slots,e,t.bb.item_defaults),P.slot&&"full"===P.match?(t.skipThisStep(),t.selectSlot(P.slot,n)):P.slot&&t.highlightSlot(P.slot,n)}return t.$broadcast("time_slots:loaded",D)},function(e){return 404===e.status&&e.data&&e.data.error&&"No bookable events found"===e.data.error?(t.data_source&&t.data_source.person?(l.warning(ErrorService.getError("NOT_BOOKABLE_PERSON")),t.setLoaded(t)):t.data_source&&t.data_source.resource&&(l.warning(ErrorService.getError("NOT_BOOKABLE_RESOURCE")),t.setLoaded(t)),t.setLoadedAndShowError(t,e,"Sorry, something went wrong")):t.setLoadedAndShowError(t,e,"Sorry, something went wrong")})):t.setLoaded(t)},t.showFirstAvailableDay=function(){return u.getFirstDayWithSlots(t.data_source,t.selected_day).then(function(e){return t.no_slots_in_week=!1,y(e),t.loadData()},function(e){return t.setLoadedAndShowError(t,e,"Sorry, something went wrong")})},t.padTimes=function(e){return t.add_padding=e},t.setReady=function(){return t.bb.current_item.time?t.bb.moving_booking&&t.bb.current_item.start_datetime().isSame(t.bb.current_item.original_datetime)&&t.current_item.person_name===t.current_item.person.name?(l.raise("APPT_AT_SAME_TIME"),!1):t.bb.moving_booking?(t.bb.company.$has("resources")&&!t.bb.current_item.resource&&(t.bb.current_item.resource=!0),t.bb.company.$has("people")&&!t.bb.current_item.person&&(t.bb.current_item.person=!0),!0):!t.bb.current_item.reserve_ready||t.addItemToBasket():(l.raise("TIME_SLOT_NOT_SELECTED"),!1)},t.pretty_month_title=function(e,s,o){var i,n;if(null==o&&(o="-"),t.start_date&&t.end_date)return i=e+" "+s,t.start_date&&t.end_date&&t.end_date.isAfter(t.start_date,"month")?(n=t.start_date.format(e),11===t.start_date.month()&&(n=t.start_date.format(i)),n+" "+o+" "+t.end_date.format(i)):t.start_date.format(i)},t.selectEarliestTimeSlot=function(){var e,s;if(e=_.find(t.days,function(e){return e.date.isSame(t.bb.current_item.earliest_time_slot.date,"day")}),s=_.find(e.slots,function(e){return e.time===t.bb.current_item.earliest_time_slot.time}),e&&s)return t.bb.current_item.earliest_time_slot.selected=!0,t.highlightSlot(e,s)}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbTotal",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"Total"}}),angular.module("BB.Controllers").controller("Total",function(e,t,s,o,i,n,d){return e.controller="public.controllers.Total",e.notLoaded(e),t.connection_started.then(function(){return function(){var t;return e.bb.payment_status=null,t=d("purchase_id"),t&&!e.bb.total?n.query({url_root:e.bb.api_url,purchase_id:t}).then(function(t){if(e.total=t,e.setLoaded(e),t.paid===t.total_price)return e.$emit("checkout:success",t)}):(e.total=e.bb.total,e.setLoaded(e),e.total.paid===e.total.total_price&&e.$emit("checkout:success",e.total)),e.reset()}}(this),function(t){return e.setLoadedAndShowError(e,t,"Sorry, something went wrong")}),e.print=function(){return function(){return i.open(e.bb.partial_url+"print_purchase.html?id="+e.total.long_id,"_blank","width=700,height=500,toolbar=0,menubar=0,location=0,status=1,scrollbars=1,resizable=1,left=0,top=0"),!0}}(this)})}.call(this),"use strict",angular.module("BB.Directives").directive("bbAccordionGroup",function(){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!1,templateUrl:"accordion-group.html",scope:{heading:"@",isOpen:"=?",isDisabled:"=?"},controller:function(){this.setHeading=function(e){this.heading=e}},link:function(e,t,s,o){o.addGroup(e),e.$watch("isOpen",function(t){t&&o.closeOthers(e)}),e.toggleOpen=function(){e.isDisabled||(e.isOpen=!e.isOpen)}}}}).directive("bbAccordionHeading",function(){return{restrict:"EA",transclude:!0,template:"",replace:!0,require:"^bbAccordionGroup",link:function(e,t,s,o,i){o.setHeading(i(e,function(){}))}}}).directive("bbAccordionTransclude",function(){return{require:"^bbAccordionGroup",link:function(e,t,s,o){e.$watch(function(){return o[s.bbAccordionTransclude]},function(e){e&&(t.html(""),t.append(e))})}}}),function(){'use strict';angular.module("BB.Directives").directive("bbBasket",function(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:function(t,s){return _.has(s,"mini")?e.directivePartial("_basket_mini"):e.directivePartial("basket")},controllerAs:"BasketCtrl",controller:function(e,t){var s;e.setUsingBasket(!0),this.empty=function(){return e.$eval("emptyBasket()")},this.view=function(){return e.$eval("viewBasket()")},e.showBasketDetails=function(){var o;return"basket"!==e.bb.current_page&&"checkout"!==e.bb.current_page&&(o=t.open({templateUrl:e.getPartial("_basket_details"),scope:e,controller:s,resolve:{basket:function(){return e.bb.basket}}}))},s=function(e,t,s,o){return e.basket=o,e.cancel=function(){return s.dismiss("cancel")}},e.$watch(function(){var t;e.basketItemCount=t=e.bb.basket?e.bb.basket.length():0,e.basketStatus=t?1===t?"1 item in your basket":t+" items in your basket":"empty"})},link:function(e,t){return t.bind("click",function(t){return t.preventDefault()})}}}),angular.module("BB.Directives").directive("bbMinSpend",function(){return{restrict:"A",scope:!0,controller:function(e,t,s,o,n){var d,l;return l=e.$eval(s.bbMinSpend||{}),e.min_spend=l.min_spend||0,e.setReady=function(){return d()},d=function(){var t,s,d,l,c;for(l=0,c=e.bb.stacked_items,(t=0,d=c.length);t<d;t++)s=c[t],l+=s.service.price;return l>=e.min_spend?(o.clear(),!0):(o.clear(),l=n("ipretty_price")(e.min_spend),o.add("warning",{msg:"You need to spend at least "+l+" to make a booking."}),!1)}}}})}.call(this),function(){angular.module("BB.Directives").directive("bbDateTimePicker",function(){return{scope:{date:"=",showMeridian:"=?",minuteStep:"=?",minDate:"=?",maxDate:"=?",format:"=?",bbDisabled:"=?"},restrict:"A",templateUrl:"bb_date_time_picker.html",controller:function(e,t,s,o){var i;return null==e.format&&(e.format="dd/MM/yyyy"),null==e.bbDisabled&&(e.bbDisabled=!1),e.minuteStep&&"undefined"!=typeof e.minuteStep||(e.minuteStep=o.calendar_minute_step),e.showMeridian&&"undefined"!=typeof e.showMeridian||(e.showMeridian=o.twelve_hour_format),e.$watch("datetimeWithNoTz",function(s){var o,i,n;s=new Date(s),null!=s&&moment(s).isValid()&&(o=moment(),o.set({year:parseInt(s.getFullYear()),month:parseInt(s.getMonth()),date:parseInt(s.getDate()),hour:parseInt(s.getHours()),minute:parseInt(s.getMinutes()),second:0}),null!=e.minDateClean&&(n=new Date(e.minDateClean),s.getTime()/1e3<n.getTime()/1e3&&(s.getFullYear()<n.getFullYear()&&o.year(parseInt(n.getFullYear())),s.getMonth()<n.getMonth()&&o.month(parseInt(n.getMonth())),s.getDate()<n.getDate()&&o.date(parseInt(n.getDate())),s.getHours()<n.getHours()&&o.hours(parseInt(n.getHours())),s.getMinutes()<n.getMinutes()&&o.minutes(parseInt(n.getMinutes())),e.datetimeWithNoTz=t("clearTimezone")(o.format()))),null!=e.maxDateClean&&(i=new Date(e.maxDateClean),s.getTime()/1e3>i.getTime()/1e3&&(s.getFullYear()>n.getFullYear()&&o.year(parseInt(n.getFullYear())),s.getMonth()>n.getMonth()&&o.month(parseInt(n.getMonth())),s.getDate()>n.getDate()&&o.date(parseInt(n.getDate())),s.getHours()>i.getHours()&&o.hours(parseInt(i.getHours())),s.getMinutes()>i.getMinutes()&&o.minutes(parseInt(i.getMinutes())),e.datetimeWithNoTz=t("clearTimezone")(o.format()))),e.date=o.format())}),e.datetimeWithNoTz=t("clearTimezone")(moment(e.date).format()),e.$watch("date",function(s,o){if(s!==o)return e.datetimeWithNoTz=t("clearTimezone")(moment(e.date).format())}),e.$watch("minDate",function(t,s){if(t!==s)return e.minDateClean=i(t)}),e.$watch("maxDate",function(t,s){if(t!==s)return e.maxDateClean=i(t)}),i=function(e){return null!=e&&moment(e).isValid()?t("clearTimezone")(moment(e).format()):null},e.minDateClean=i(e.minDate),e.maxDateClean=i(e.maxDate)}}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbBreadcrumb",function(e){return{restrict:"A",replace:!0,scope:!0,controller:"Breadcrumbs",templateUrl:function(t,s){return _.has(s,"complex")?e.directivePartial("_breadcrumb_complex"):e.directivePartial("_breadcrumb")},link:function(){}}}),angular.module("BB.Controllers").controller("Breadcrumbs",function(e){var t,s,o,i;return i=e.loadStep,e.steps=e.bb.steps,e.allSteps=e.bb.allSteps,e.loadStep=function(e){if(!o()&&!s(e)&&!t())return i(e)},o=function(){return e.bb.current_step===e.bb.allSteps.length},s=function(t){return t===e.bb.current_step},t=function(){return!!angular.isDefined(e.bb.disableGoingBackAtStep)&&e.bb.current_step>=e.bb.disableGoingBackAtStep},e.isDisabledStep=function(e){return!!(o()||s(e.number)||!e.passed||t())}})}.call(this),function(){'use strict';var e;e=angular.module("BB.Directives"),e.directive("bbContentNew",function(e){return{restrict:"A",replace:!0,scope:!0,templateUrl:e.directivePartial("content_main"),controller:function(e){e.initPage=function(){return e.$eval("setPageLoaded()")}}}})}.call(this),function(){angular.module("BB.Directives").directive("bbDatepickerPopup",function(t,s,o,i){var n,d;d=!1;try{d=window.parseInt(/MSIE\s*(\d)/.exec(window.navigator.userAgent)[1])}catch(e){n=e,d=!1}return{restrict:"A",priority:-1,require:"ngModel",link:function(e,n,l,c){var p,m,u,b,g,h,y,v,k,w,S;return v=null,m=n.controller("ngModel"),null!=l.datepickerPopup&&(g={date_us:"MM/dd/yyyy",date_uk:"dd/MM/yyyy"},l.datepickerPopup="us"===e.bb.company.country_code?g.date_us:g.date_uk),u=l.bbDatepickerPopup?l.bbDatepickerPopup:"DD/MM/YYYY",S=moment(new Date).year(),y=t(l.ngModel),w=e,h=function(e){if(e)return e.controller&&0<e.controller.indexOf("TimeRangeList")?w=e:h(e.$parent)},h(e),d&&i(n).on("keydown keyup keypress",function(e){return e.preventDefault(),e.stopPropagation()}),(d||e.display.xs)&&i(n).attr("readonly","true"),i(n).on("keydown",function(t){if(13===t.keyCode)return k(i(t.target).val(),!0),s.trigger("click"),i(n).blur()}),i(n).on("click",function(t){return t.preventDefault(),t.stopPropagation(),o(function(){return e.opened=!0})}),i(n).on("focus",function(){if($(this).attr("readonly"))return this.blur()}),p=function(t){var s,i;return i=e.$watch(y,function(e){if(!e)return y.assign(w,t)}),o(i,0),s=_.isDate(t),s&&(y.assign(w,t),c.$setValidity("date",!0),e.$eval(l.onDateChange)),s},k=function(e,t){var s;return p(e)?e:d?e:(s=moment(e,u),s.isValid()||(s=moment(new Date)),/\/YY$/.test(u)&&(u+="YY"),0===s.year()&&s.year(S),e=s.format("MM/DD/YYYY"),e=e.replace(/\/00/,"/20"),/\/02\d{2}$/.test(e)?void 0:t?(2===s.year().toString().length&&s.year(s.year()+2e3),p(s._d)):v.call(this,e))},b=function(){return _.isFunction(m.$parsers[0])?void(v=m.$parsers[0],m.$parsers[0]=k):setTimeout(b,10)},b()}}})}.call(this),function(){angular.module("BB.Directives").directive("bbFbLogin",function(e,t,s){return{restrict:"A",scope:!0,link:function(o,i,n){var d,l,c,p;return c=o.$eval(n.bbFbLogin)||{},t.connection_started.then(function(){return d()}),p=function(e){var t;"connected"===e.status?(t={},t.access_token=e.authResponse.accessToken,c.login_only&&(t.login_only=c.login_only),l(t)):"not_authorized"===e.status?o.loginFB():o.loginFB()},d=function(){FB.getLoginStatus(function(e){p(e)})},l=function(i){return e.FBLogin(o.bb.company,i).then(function(e){return t.member=e,o.setClient(t.member),o.bb.destination?o.redirectTo(o.bb.destination):(o.setLoaded(o),o.decideNextPage())},function(e){return"FACEBOOK-LOGIN-MEMBER-NOT-FOUND"===e.data.error?s.raise("FB_LOGIN_NOT_A_MEMBER"):s.raise("LOGIN_FAILED")})},o.loginFB=function(){return FB.login(function(e){var t;"connected"===e.status?(t={},t.access_token=e.authResponse.accessToken,c.login_only&&(t.login_only=c.login_only),l(t)):"not_authorized"===e.status?s.raise("LOGIN_FAILED"):s.raise("LOGIN_FAILED")},{scope:"public_profile,email"})}}}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbFileUpload",function(){return{restrict:"A",replace:!1,scope:{accept:"@",prettyAccept:"@",maxSize:"@",item:"="},controller:"FileUpload",templateUrl:"file_upload.html"}}),angular.module("BB.Controllers").controller("FileUpload",function(e,t){return e.controller="public.controllers.FileUpload",e.uploadFile=function(s,o,i,n){var d,l,c,p,m,u,b,g;return(e.err_file=i&&i[0],e.show_error=!1,e.file_type_error=!1,e.my_file=o,d=e.accept.replace(/\'/g,"").split(","),c=o&&(0<=d.indexOf(o.type)||0<=o.type.indexOf("image")),c)?(l=n?n:null,p="POST",l&&(p="PUT"),g=s.$href("add_attachment"),b=function(e){return o.result=e.data,s.attachment=e.data,s.attachment_id=e.data.id,o.progress=100},m=function(){return e.show_error=!0,o.progress=100},u=function(e){var t=Math.min;return o.progress=t(100,parseInt(99*e.loaded/e.total))},t.rename(o,o.name.replace(/[^\x00-\x7F]/g,"")),o.upload=t.upload({url:g,method:p,data:{attachment_id:l},file:o}),o.upload.then(b,m,u)):!1===c?e.file_type_error=!0:void 0}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbFormDataStore",function(e){return{require:"?bbWidget",link:function(t){return e.register(t)}}})}.call(this),function(){var e=Math.ceil,t;t=angular.module("BB.Directives"),t.directive("ngConfirmClick",function(){return{link:function(e,t,s){var o,i;return i=s.ngConfirmClick||"Are you sure?",o=s.ngConfirmedClick,t.bind("click",function(){return function(){if(window.confirm(i))return e.$eval(o)}}(this))}}}),t.directive("ngValidInclude",function(e){return{link:function(t,s,o){return t[o.watchValue].then(function(){return function(){return s.attr("ng-include",o.ngValidInclude),s.attr("ng-valid-include",null),e(s)(t)}}(this))}}}),t.directive("ngDelayed",function(e){return{link:function(t,s,o){return t[o.ngDelayedWatch].then(function(){return function(){if(s.attr(o.ngDelayed,o.ngDelayedValue),s.attr("ng-delayed-value",null),s.attr("ng-delayed-watch",null),s.attr("ng-delayed",null),e(s)(t),o.ngDelayedReady)return t[o.ngDelayedReady].resolve(!0)}}(this))}}}),t.directive("ngInitial",function(){return{restrict:"A",controller:["$scope","$element","$attrs","$parse",function(e,t,s,o){var i,n,d;return d=s.ngInitial||s.value,i=o(s.ngModel),n=i.assign,"true"===d?d=!0:"false"===d&&(d=!1),n(e,d)}]}}),t.directive("bbPrintPage",function(e,t){return{restrict:"A",link:function(s,o,i){if(i.bbPrintPage)return s.$watch(i.bbPrintPage,function(){return function(){return t(function(){return e.print()},3e3)}}(this))}}}),t.directive("bbInclude",function(e,t){return{link:function(s,o,i){var n;return n=null!=i.bbTrackPage,s.$watch("bb.path_setup",function(){return function(d){if(d&&(o.attr("ng-include","'"+s.getPartial(i.bbInclude)+"'"),o.attr("bb-include",null),e(o)(s),n))return t.$broadcast("page:loaded",i.bbInclude)}}(this))}}}),t.directive("bbRaiseAlertWhenInvalid",function(){return{require:"^form",link:function(e,t,s,o){var i;if(o.raise_alerts=!0,i=e.$eval(s.bbRaiseAlertWhenInvalid),i&&i.alert)return o.alert=i.alert}}}),t.directive("bbHeader",function(e){return{link:function(t,s,o){return t.bb.waitForRoutes(),t.$watch("bb.path_setup",function(){return function(i){if(i)return s.attr("ng-include","'"+t.getPartial(o.bbHeader)+"'"),s.attr("bb-header",null),e(s)(t)}}(this))}}}),t.directive("bbDate",function(){return{restrict:"AE",scope:!0,link:function(e,t,s){var o,i;return i=null!=s.bbTrackService,o=s.bbDate?moment(e.$eval(s.bbDate)):e.bb&&e.bb.current_item&&e.bb.current_item.date?e.bb.current_item.date.date:moment(),i&&e.bb.current_item&&e.bb.current_item.service&&(e.min_date=e.bb.current_item.service.min_advance_datetime,e.max_date=e.bb.current_item.service.max_advance_datetime),e.$broadcast("dateChanged",moment(o)),e.bb_date={date:o,js_date:o.toDate(),addDays:function(t,s){return this.date=moment(this.date).add(s,t),this.js_date=this.date.toDate(),e.$broadcast("dateChanged",moment(this.date))},subtractDays:function(e,t){return this.addDays(e,-t)},setDate:function(t){return this.date=t,this.js_date=t.toDate(),e.$broadcast("dateChanged",moment(this.date))}},e.$on("currentItemUpdate",function(){if(e.bb.current_item.service&&i&&(e.min_date=e.bb.current_item.service.min_advance_datetime,e.max_date=e.bb.current_item.service.max_advance_datetime,e.bb_date.date.isBefore(e.min_date,"day")&&e.bb_date.setDate(e.min_date.clone()),e.bb_date.date.isAfter(e.max_date,"day")))return e.bb_date.setDate(e.max_date.clone())}),e.$watch("bb_date.js_date",function(t){var s;if(s=moment(t),!e.bb_date.date.isSame(s)&&(e.bb_date.date=s,moment(s).isValid()))return e.$broadcast("dateChanged",moment(s))})}}}),t.directive("bbDebounce",function(e){return{restrict:"A",link:function(t,s,o){var i;return i=400,o.bbDebounce&&(i=o.bbDebounce),s.bind("click",function(){return function(){return e(function(){return s.attr("disabled",!0)},0),e(function(){return s.attr("disabled",!1)},i)}}(this))}}}),t.directive("bbLocalNumber",function(e){return{restrict:"A",scope:{},require:"ngModel",link:function(t,s,o,i){var n,d;return t.userinput_mobile=null,d=function(e){return e&&(t.userinput_mobile=e),e},n=function(s){return t.userinput_mobile?s=t.userinput_mobile:e("local_phone_number")(s)},i.$parsers.push(d),i.$formatters.push(n)}}}),t.directive("bbPadWithZeros",function(){return{restrict:"A",require:"ngModel",link:function(e,t,s,o){var n,d,l;return d=e.$eval(s.bbPadWithZeros)||{},n=d.how_many||2,l=function(e){var t,s,o,d;if(e+="",e&&e.length<n){for(o="",s=t=1,d=n-e.length;1<=d?t<=d:t>=d;s=1<=d?++t:--t)o+="0";e=o.concat(e)}return e},o.$formatters.push(l)}}}),t.directive("bbFormResettable",function(e){return{restrict:"A",controller:function(t,s,o){return t.inputs=[],t.resetForm=function(e){var s,n,d,l,c;for(e&&e.clear_submitted&&(t[o.name].submitted=!1),l=t.inputs,c=[],(s=0,d=l.length);s<d;s++)n=l[s],n.getter.assign(t,null),c.push(n.controller.$setPristine());return c},{registerInput:function(s,o){var i;return i=e(s),t.inputs.push({getter:i,controller:o})}}}}}),t.directive("bbResettable",function(){return{restrict:"A",require:["ngModel","^bbFormResettable"],link:function(e,t,s,o){var i,n;return n=o[0],i=o[1],i.registerInput(s.ngModel,n)}}}),t.directive("bbDateSplit",function(){return{restrict:"A",require:["ngModel"],link:function(e,t,s,o){var i,n;if(i=o[0],n=e.$eval(s.bbDateSplit),n.date={day:null,month:null,year:null,date:null,joinDate:function(){var e;if(this.day&&this.month&&this.year)return e=this.day+"/"+this.month+"/"+this.year,this.date=moment(e,"DD/MM/YYYY"),e=this.date.toISODate(),i.$setViewValue(e),i.$render()},splitDate:function(e){if(e&&e.isValid())return this.day=e.date(),this.month=e.month()+1,this.year=e.year(),this.date=e}},n.answer&&n.date.splitDate(moment(n.answer)),i.$viewValue)return n.date.splitDate(moment(i.$viewValue))}}}),t.directive("bbCommPref",function(){return{restrict:"A",require:["ngModel"],link:function(e,t,s,o){var i,n,d;return n=o[0],i=e.$eval(s.bbCommPref)||!1,null!=e.bb.current_item.settings.send_email_followup&&null!=e.bb.current_item.settings.send_sms_followup?i=e.bb.current_item.settings.send_email_followup:(e.bb.current_item.settings.send_email_followup=i,e.bb.current_item.settings.send_sms_followup=i),n.$setViewValue(i),d=function(t){return e.bb.current_item.settings.send_email_followup=t,e.bb.current_item.settings.send_sms_followup=t,t},n.$parsers.push(d)}}}),t.directive("bbCountTicketTypes",function(e){return{restrict:"A",scope:!1,link:function(t){var s;return e.connection_started.then(function(){return s()}),t.$on("basket:updated",function(){return s()}),s=function(e){var s,o,n,d;for(e=t.bb.basket.timeItems(),s=[],(o=0,d=e.length);o<d;o++)n=e[o],n.tickets&&(s[n.tickets.name]?s[n.tickets.name]+=n.tickets.qty:s[n.tickets.name]=n.tickets.qty,n.number=s[n.tickets.name]);return t.counts=s}}}}),t.directive("bbCapitaliseFirstLetter",function(){return{restrict:"A",require:["ngModel"],link:function(e,t,s,o){var i;return i=o[0],e.$watch(s.ngModel,function(t){var o;t&&(o=e.$eval(s.ngModel),o=o.charAt(0).toUpperCase()+o.slice(1),i.$setViewValue(o),i.$render())})}}}),t.directive("bbApiUrl",function(e,t,s,o,i,n){return{restrict:"A",scope:{apiUrl:"@bbApiUrl"},compile:function(){return{pre:function(o,i){var d,l;if(e.bb||(e.bb={}),e.bb.api_url=o.apiUrl,l=document.createElement("a"),l.href=o.apiUrl,(s.msie&&9>=s.msie||s.webkit&&537>s.webkit)&&""!==l.host&&l.host!==n.host()&&l.host!==n.host()+":"+n.port())return d=":"===l.protocol[l.protocol.length-1]?l.protocol+"//"+l.host+"/ClientProxy.html":l.protocol+"://"+l.host+"/ClientProxy.html",e.iframe_proxy_ready=!1,t("<iframe id='ieapiframefix' name='"+l.hostname+("' src='"+d+"' style='visibility:false;display:none;'></iframe>"))(o,function(){return function(t){return t.bind("load",function(){return e.iframe_proxy_ready=!0,e.$broadcast("iframe_proxy_ready",{iframe_proxy_ready:!0})}),i.append(t)}}(this))}}}}}),t.directive("bbPriceFilter",function(t){return{restrict:"AE",replace:!0,scope:!1,require:"^?bbServices",templateUrl:function(){return t.directivePartial("_price_filter")},controller:function(t){var s,o;return t.$watch("items",function(e){if(e)return s(e)}),s=function(e){return t.price_array=_.uniq(_.map(e,function(e){return e.price/100||0})),t.price_array.sort(function(e,t){return e-t}),o()},o=function(){var s,o,i;return i=_.last(t.price_array),s=function(){switch(!1){case!(1>i):return 0;case!(11>i):return 10;case!(51>i):return 50;case!(101>i):return 100;case!(1e3>i):return 100*e(i/100);}}(),o=0,t.price_options={min:o,max:s},t.filters.price={min:o,max:s}},t.$watch("filters.price.min",function(e,s){if(e!==s)return t.filterChanged()}),t.$watch("filters.price.max",function(e,s){if(e!==s)return t.filterChanged()})}}}),angular.module("BB.Directives").directive("bbBookingExport",function(){return{restrict:"AE",scope:!0,template:"<div bb-include=\"_popout_export_booking\" style=\"display: inline-block\"></div>",link:function(e){var t;return e.$watch("total",function(e){if(e)return t(e)}),e.$watch("purchase",function(e){if(e)return t(e)}),t=function(t){return e.html="<div class='text-center'><a href='"+t.webcalLink()+"'><img src='images/outlook.png' alt='outlook calendar icon' height='30' width='30' /><div class='clearfix'></div><span>Outlook</span></a></div><p></p>"+("<div class='text-center'><a href='"+t.gcalLink()+"'><img src='images/google.png' alt='google calendar icon' height='30' width='30' /><div class='clearfix'></div><span>Google</span></a></div><p></p>")+("<div class='text-center'><a href='"+t.icalLink()+"'><img src='images/ical.png' alt='ical calendar icon' height='30' width='30' /><div class='clearfix'></div><span>iCal</span></a></div>")}}}}),angular.module("BB.Directives").directive("bbDynamicFooter",function(e,t){return function(e){return e.$on("page:loaded",function(){return t(".content").css("height","auto")}),e.$watch(function(){return t(".content")[0].scrollHeight},function(t,s){if(t!==s)return e.setContentHeight()}),e.setContentHeight=function(){var e,s;if(t(".content").css("height","auto"),e=t(".content")[0].scrollHeight,s=t(window).innerHeight()-t(".content").offset().top-t(".footer").height(),e<s)return t(".content").css("height",s+"px")},t(window).on("resize",function(){return e.setContentHeight()})}}),angular.module("BB.Directives").directive("bbBlurOnReturn",function(t){return{restrict:"A",require:"ngModel",link:function(e,s){return s.keydown(function(s){var e;if(e=s.which||s.keyCode,13===e||"13"===e)return t(function(){if(s.target)return s.target.blur()},10)})}}})}.call(this),function(){'use strict';var e,t;e=angular.module("BB.Directives"),e.directive("bbQuestionLine",function(t){return{transclude:!1,restrict:"A",link:function(s,o){var i,n,d,l;if("heading"===s.question.detail_type&&(n="",0<s.question.name.length&&(n+="<div class='bb-question-heading'>"+s.question.name+"</div>"),s.question.help_text&&0<s.question.help_text.length&&(n+="<div class='bb-question-help-text'>"+s.question.help_text+"</div>"),o.html(n)),s.idmaps&&(s.idmaps[s.question.detail_type]&&s.idmaps[s.question.detail_type].block||s.idmaps[s.question.id]&&s.idmaps[s.question.id].block))return l=s.idmaps[s.question.id]?s.question.id:s.question.detail_type,d=s.$parent.idmaps[l].html,i=t(d)(s,function(){return function(e){return o.replaceWith(e)}}(this))}}}),e.directive("bbQuestion",function(e){return{priority:0,replace:!0,transclude:!1,restrict:"A",compile:function(){return{pre:function(t,s,o){var n,d,l;return n=null!=o.bbAdminRequired,d="DD/MM/YYYY",l="dd/MM/yyyy",null!=o.bbDateFormat&&"US"===o.bbDateFormat&&(d="MM/DD/YYYY",l="MM/dd/yyyy"),t.$watch(o.bbQuestion,function(c){var p,m,u,b,g,h,y,f,v,w,S,B,P,L,D,I;if(c){if(m="",f="",P="",null!=o.defaultPlaceholder&&"text_area"===c.detail_type|"text_field"===c.detail_type&&(c["default"]&&(P=c["default"]),c.answer===c["default"]&&(c.answer="")),t.recalc=function(){return function(){if(angular.isDefined(t.recalc_price)&&!c.outcome&&t.recalc_price(),angular.isDefined(t.recalc_question))return t.recalc_question()}}(this),t.idmaps&&(t.idmaps[c.detail_type]||t.idmaps[c.id]))b=t.idmaps[t.question.id]?t.question.id:t.question.detail_type,m=t.idmaps[b].html;else if("select"===c.detail_type||"select-price"===c.detail_type){for(m="<select ng-model='question.answer' name='q"+c.id+"' id='"+c.id+"' ng-change='recalc()' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' class='form-question form-control'>",L=c.options,(u=0,v=L.length);u<v;u++)g=L[u],m+="<option data_id='"+g.id+"' value='"+g.name.replace(/'/g,"&apos;")+"'>"+g.display_name+"</option>";m+="</select>"}else if("text_area"===c.detail_type)m="<textarea placeholder='"+P+"' ng-model='question.answer' name='q"+c.id+"' id='"+c.id+"' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' rows=3 class='form-question form-control'>"+c.answer+"</textarea>";else if("radio"===c.detail_type){for(m="<div class=\"radio-group\">",D=c.options,(h=0,w=D.length);h<w;h++)g=D[h],m+="<div class='radio'><label class='radio-label'><input ng-model='question.answer' name='q"+c.id+"' id='"+c.id+"' ng-change='recalc()' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' type='radio' value=\""+g.name+"\"/>"+g.name+"</label></div>";m+="</div>"}else if("check"===c.detail_type)B=c.name,B===f&&(B=""),f=c.name,m="<div class='checkbox' ng-class='{\"selected\": question.answer}'><label><input name='q"+c.id+"' id='"+c.id+"' ng-model='question.answer' ng-checked='question.answer == \"1\"' ng-change='recalc()' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' type='checkbox' value=1>"+B+"</label></div>";else if("check-price"===c.detail_type)m="<div class='checkbox'><label><input name='q"+c.id+"' id='"+c.id+"' ng-model='question.answer' ng-checked='question.answer == \"1\"' ng-change='recalc()' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' type='checkbox' value=1> ({{question.price | currency:'GBP'}})</label></div>";else if("radio-price"===c.detail_type){for(m="<div class=\"radio-group\">",I=c.options,(y=0,S=I.length);y<S;y++)g=I[y],m+="<div class='radio'><label class='radio-label'><input ng-model='question.answer' name='q"+c.id+"' id='"+c.id+"' ng-change='recalc()' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' type='radio' value=\""+g.name+"\"/>"+g.display_name+"</label></div>";m+="</div>"}else m="date"===c.detail_type?"<div class='input-group date-picker'> <input type='text' class='form-question form-control' name='q"+c.id+"' id='"+c.id+"' bb-datepicker-popup='"+d+"' datepicker-popup='"+l+"' ng-model='question.answer' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' ng-change='recalc()' datepicker-options='{\"starting-day\": 1}' show-weeks='false' show-button-bar='false' is-open='opened' /> <span class='input-group-btn' ng-click='$event.preventDefault();$event.stopPropagation();opened=true'> <button class='btn btn-default' type='submit'><span class='glyphicon glyphicon-calendar'></span></button> </span> </div>":"<input type='text' placeholder='"+P+"'  ng-model='question.answer' name='q"+c.id+"' id='"+c.id+"' ng-required='question.currentlyShown && (("+n+" && question.required) || (question.required && !bb.isAdmin))' class='form-question form-control'/>";if(m)return p=e(m)(t,function(){return function(e){return s.replaceWith(e)}}(this))}})},post:function(){}}}}}),e.directive("bbQuestionSetup",function(){return{restrict:"A",terminal:!0,priority:1e3,link:function(e,t){var s,o,n,d,l,c,p,m,u;for(c={},n=null,u=t.children(),(p=d=0,m=u.length);d<m;p=++d)o=u[p],l=$(o).attr("bb-question-id"),s=!1,$(o).attr("bb-replace-block")&&(s=!0),o.innerHTML=o.innerHTML.replace(/question_form/g,"question_form_"+p),c[l]={id:l,html:o.innerHTML,block:s};return e.idmaps=c,t.replaceWith("")}}}),e.directive("bbFocus",[function(){var e;return e="bb-focused",{restrict:"A",require:"ngModel",link:function(t,s,o,i){return i.$focused=!1,s.bind("focus",function(){return s.addClass(e),t.$apply(function(){return i.$focused=!0})}).bind("blur",function(){return s.removeClass(e),t.$apply(function(){return i.$focused=!1})})}}}]),e.directive("bbCurrencyField",function(){return{restrict:"A",require:"ngModel",link:function(e,t,s,o){var i,n;return i=function(e){return e/100},n=function(e){return 100*e},o.$formatters.push(i),o.$parsers.push(n)}}}),t=function(e){return angular.isUndefined(e)||""===e||null===e||e!==e},e.directive("ngMin",function(){return{restrict:"A",require:"ngModel",link:function(e,s,o,i){var n;n=function(s){var n;return n=e.$eval(o.ngMin)||0,i.$setValidity("ngMin",t(s)||s>=n),s},i.$parsers.push(n),i.$formatters.push(n)}}}),e.directive("ngMax",function(){return{restrict:"A",require:"ngModel",link:function(e,s,o,i){var n;n=function(s){var n;return n=e.$eval(o.ngMax),i.$setValidity("ngMax",t(s)||s<=n),s},i.$parsers.push(n),i.$formatters.push(n)}}}),e.directive("creditCardNumber",function(){var e,t,s;return e=function(e){return e?(e=e.toString().replace(/\s+/g,""),/^(34)|^(37)/.test(e)?"american_express":/^(62)|^(88)/.test(e)?"china_unionpay":/^30[0-5]/.test(e)?"diners_club_carte_blanche":/^(2014)|^(2149)/.test(e)?"diners_club_enroute":/^36/.test(e)?"diners_club_international":/^(6011)|^(622(1(2[6-9]|[3-9][0-9])|[2-8][0-9]{2}|9([01][0-9]|2[0-5])))|^(64[4-9])|^65/.test(e)?"discover":/^35(2[89]|[3-8][0-9])/.test(e)?"jcb":/^(6304)|^(6706)|^(6771)|^(6709)/.test(e)?"laser":/^(5018)|^(5020)|^(5038)|^(5893)|^(6304)|^(6759)|^(6761)|^(6762)|^(6763)|^(0604)/.test(e)?"maestro":/^5[1-5]/.test(e)?"master":/^4/.test(e)?"visa":/^(4026)|^(417500)|^(4405)|^(4508)|^(4844)|^(4913)|^(4917)/.test(e)?"visa_electron":void 0):""},t=function(e){var t,s,o,i;if(!e)return!1;for(e=e.toString().replace(/\s+/g,""),t=e.length,s=0,o=[[0,1,2,3,4,5,6,7,8,9],[0,2,4,6,8,1,3,5,7,9]],i=0;t--;)i+=o[s][parseInt(e.charAt(t),10)],s^=1;return 0==i%10&&0<i},s=function(s,o,i,n){return s.$watch(function(){return n.$modelValue},function(i){return n.$setValidity("card_number",t(i)),s.cardType=e(i),null!=i&&16===i.length?n.$invalid?(o.parent().addClass("has-error"),o.parent().removeClass("has-success")):(o.parent().removeClass("has-error"),o.parent().addClass("has-success")):o.parent().removeClass("has-success")})},{restrict:"C",require:"ngModel",link:s,scope:{cardType:"="}}}),e.directive("cardSecurityCode",function(){var e;return e=function(e,t){return e.$watch("cardType",function(e){return"american_express"===e?(t.attr("maxlength",4),t.attr("placeholder","\u2022\u2022\u2022\u2022")):(t.attr("maxlength",3),t.attr("placeholder","\u2022\u2022\u2022"))})},{restrict:"AC",link:e,scope:{cardType:"="}}}),e.directive("bbInputGroupManager",function(){return{restrict:"A",controller:function(e,t){return e.input_manger={input_groups:{},inputs:[],registerInput:function(e,t){if(!(0<=this.inputs.indexOf(e.$name)))return this.inputs.push(e.$name),this.input_groups[t]||(this.input_groups[t]={inputs:[],valid:!1}),this.input_groups[t].inputs.push(e)},validateInputGroup:function(e){var t,s,o,n,d,l,c,p;for(o=!1,c=this.input_groups[e].inputs,(t=0,d=c.length);t<d&&(s=c[t],o=s.$modelValue,!o);t++);if(o===!this.input_groups[e].valid){for(p=this.input_groups[e].inputs,n=0,l=p.length;n<l;n++)s=p[n],s.$setValidity(s.$name,o);return this.input_groups[e].valid=o}}},t.on("submit",function(){var t,s;for(t in s=[],e.input_manger.input_groups)s.push(e.input_manger.validateInputGroup(t));return s})}}}),e.directive("bbInputGroup",function(){return{restrict:"A",require:"ngModel",link:function(e,t,s,o){if(!(0<=e.input_manger.inputs.indexOf(o.$name)))return e.input_manger.registerInput(o,s.bbInputGroup),e.$watch(s.ngModel,function(t,o){if(t===!o)return e.input_manger.validateInputGroup(s.bbInputGroup)})}}}),e.directive("bbQuestionLabel",function(){return{transclude:!1,restrict:"A",scope:!1,link:function(e,t,s){return e.$watch(s.bbQuestionLabel,function(e){if(e&&("check"===e.detail_type||"check-price"===e.detail_type))return t.html("")})}}}),e.directive("bbQuestionLink",function(e){return{transclude:!1,restrict:"A",scope:!0,link:function(t,s,o){var n;return n=parseInt(o.bbQuestionLink),t.$watch("question_set",function(o){var d,l,c,p,m;if(o){for(p=t.question_set,m=[],(d=0,l=p.length);d<l;d++)c=p[d],c.id===n?(t.question=c,s.attr("ng-model","question.answer"),s.attr("bb-question-link",null),m.push(e(s)(t))):m.push(void 0);return m}})}}}),e.directive("bbQuestionSet",function(){return{transclude:!1,restrict:"A",scope:!0,link:function(e,t,s){var o;return o=s.bbQuestionSet,t.addClass("ng-hide"),e.$watch(o,function(s){if(s)return e.question_set=s,t.removeClass("ng-hide")})}}}),e.directive("bbMatchInput",function(){return{restrict:"A",require:"ngModel",link:function(e,t,s,o){var i;return e.$watch(s.bbMatchInput,function(){return e.val_1=e.$eval(s.bbMatchInput),i(o.$viewValue)}),i=function(t){return o.$setValidity("match",e.val_1===t),t},o.$parsers.push(i)}}})}.call(this),function(){var e;e=angular.module("BB.Directives"),e.directive("bbIntTelNumber",function(e){return{restrict:"A",require:"ngModel",link:function(t,s,o,i){var n,d,l,c;return l=t.$eval(o.bbIntTelNumber),s.intlTelInput(l),d=function(e){return!e||s.intlTelInput("isValidNumber")},n=function(e){var n;return n="",null!=t.$eval(o.ngModel+"_prefix")&&(n+="+"+t.$eval(o.ngModel+"_prefix")+" "),null!=t.$eval(o.ngModel)&&(n+=t.$eval(o.ngModel)),"+"===n[0]&&(s.intlTelInput("setNumber","+"+t.$eval(o.ngModel+"_prefix")+" "+t.$eval(o.ngModel)),i.$setValidity("phone",d(e))),n},c=function(n){var l,c;return c=s.intlTelInput("getSelectedCountryData").dialCode,l=e(o.ngModel+"_prefix"),l.assign(t,c),i.$setValidity("phone",d(n)),n},i.$formatters.push(n),i.$parsers.push(c)}}})}.call(this),function(){'use strict';var e;e=angular.module("BB.Directives"),e.directive("bbLoader",function(e,t,s,o){return{restrict:"A",replace:!1,scope:{},controllerAs:"LoaderCtrl",controller:function(t){var s,o,i,n,d,l;i=t.$parent.$id,d=[],s=function(e){d.push(e),d=_.uniq(d)},n=function(e){return d=_.without(d,e),d.length},l=function(o,e){var n;for(n=e.$id;e;){if(e.$id===i){s(n),t.scopeLoaded=!1;break}e=e.$parent}},o=function(s,e){n(e.$id)||(t.scopeLoaded=!0)},e.$on("show:loader",l),e.$on("hide:loader",o),t.scopeLoaded=!1},link:function(e,i,n){o.get(s.directivePartial("loader")).then(function(s){var o;_.isString(n.bbLoader)&&(o=n.bbLoader.slice(1),/^#/.test(n.bbLoader)?s.attr("id",o):/^\./.test(n.bbLoader)&&s.addClass(o)),i.prepend(s),t(s)(e)})}}}),e.directive("bbLoadingSpinner",function(){return{transclude:!0,link:function(e){var t;return t={},e.isLoading=!1,e.$on("isLoading",function(s,o){return s.stopPropagation(),t[s.targetScope.$id]=o,e.isLoading=_.every(_.values(t))})},template:"<div ng-show=\"isLoading\" class=\"loader-wrapper\">\n  <div class=\"loader\"></div>\n</div>\n<div ng-transclude></div>"}})}.call(this),function(){'use strict';angular.module("BB.Directives").directive("bbContent",function(e){return{transclude:!1,restrict:"A",link:function(t,s){return s.attr("ng-include","bb_main"),s.attr("onLoad","initPage()"),s.attr("bb-content",null),s.attr("ng-hide","hide_page"),t.initPage=function(){return function(){return t.setPageLoaded(),t.setLoadingPage(!1)}}(this),e(s)(t)}}}),angular.module("BB.Directives").directive("bbLoading",function(e,t,s){return{link:function(o,i){var n;o.scopeLoaded=o.areScopesLoaded(o),i.attr("ng-hide","scopeLoaded"),i.attr("bb-loading",null),n=function(){var e,o,i,n;return o=s(".bb-loader").find("#loading_icon"),n=s(".bb-loader").find("#wait_graphic"),i=s("[ng-app]").find("body").hasClass("modal-open"),i?t(function(){var e;return e=s("[ng-app]").find(".modal-dialog").height()||s("[ng-app]").find(".modal-content").height()||s("[ng-app]").find(".modal").height(),e=e/2-n.height()/2,o.css("padding-top",e+"px")},50):(e=$(window).innerHeight()/2-n.height()/2,o.css("padding-top",e+"px"))},n(),s(window).on("resize",function(){return n()}),o.$on("page:loaded",function(){return n()}),e(i)(o)}}}),angular.module("BB.Directives").directive("bbWaitFor",function(){return{transclude:!1,restrict:"A",priority:800,link:function(e,t,s){var o,i;o=s.bbWaitVar,o||(o="allDone"),e[o]=!1,i=e.$eval(s.bbWaitFor),i.then(function(){return e[o]=!0})}}}),angular.module("BB.Directives").directive("bbScrollTo",function(e,t,s,o,i,n){return{transclude:!1,restrict:"A",link:function(e,d,l){var c,p,m,u,b;return m=l.bbScrollTo.split(","),c=null!=l.bbAlwaysScroll||!1,p=null==l.bbTransitionTime?500:parseInt(l.bbTransitionTime,10),angular.isArray(m)?angular.forEach(m,function(t){return e.$on(t,function(){return b(t)})}):e.$on(m,function(){return b(m)}),u=function(e){return e.offset().top>o("body").scrollTop()&&e.offset().top<o("body").scrollTop()+o(window).height()},b=function(l){var m,b;if(b="page:loaded"===l&&e.display&&e.display.xs&&o("[data-scroll-id=\""+t.uid+"\"]").length?o("[data-scroll-id=\""+t.uid+"\"]"):o(d),m=s.getCurrentStep(),b&&("page:loaded"===l&&1<m||c||"widget:restart"===l||!u(b)&&0!==b.offset().top))return"parentIFrame"in i?parentIFrame.scrollToOffset(0,b.offset().top-n.getScrollOffset()):o("html, body").animate({scrollTop:b.offset().top-n.getScrollOffset()},p)}}}}),angular.module("BB.Directives").directive("bbSlotGrouper",function(){return{restrict:"A",scope:!0,link:function(e,t,s){var o,n,d,l;if(l=e.$eval(s.slots),!!l){for(e.grouped_slots=[],o=0,n=l.length;o<n;o++)d=l[o],d.time>=e.$eval(s.startTime)&&d.time<e.$eval(s.endTime)&&e.grouped_slots.push(d);return e.has_slots=0<e.grouped_slots.length}}}}),angular.module("BB.Directives").directive("bbForm",function(e,t,s,o,i){return{restrict:"A",require:"^form",scope:!0,link:function(n,d,l,c){return n.form=c,d.on("submit",function(){return n.submitForm(),n.$apply()}),n.submitForm=function(){for(var l in n.form.submitted=!0,n.form)angular.isObject(n.form[l])&&n.form[l].hasOwnProperty("$valid")&&(n.form[l].submitted=!0);return i(function(){var o,i;if(o=d.find(".has-error:first"),o&&0<o.length&&!n.form.raise_alerts)return"parentIFrame"in t?parentIFrame.scrollToOffset(0,o.offset().top-s.getScrollOffset()):e("html, body").animate({scrollTop:o.offset().top-s.getScrollOffset()},1e3),i=o.find(".ng-invalid"),i.focus()},100),o.validateForm(n.form)}}}}),angular.module("BB.Directives").directive("bbAddressMap",function(e){return{restrict:"A",scope:!0,replace:!0,controller:function(t,s,o){return t.isDraggable=480<e.width(),t.$watch(o.bbAddressMap,function(e){var s;if(e)return s=e,t.map={center:{latitude:s.lat,longitude:s.long},zoom:15},t.options={scrollwheel:!1,draggable:t.isDraggable},t.marker={id:0,coords:{latitude:s.lat,longitude:s.long}}})}}}),angular.module("BB.Directives").directive("bbMergeDuplicateQuestions",function(){return{restrict:"A",scope:!0,controller:function(e,t){return e.questions={},t.$on("item_details:loaded",function(){var t,s,o,n,d,l,c,p;for(c=e.bb.stacked_items,t=0,n=c.length;t<n;t++)if(s=c[t],s.item_details&&s.item_details.questions)for(s.item_details.hide_questions=!1,p=s.item_details.questions,(o=0,d=p.length);o<d;o++)if(l=p[o],e.questions[l.id]){s.setCloneAnswers(e.questions[l.id].item),s.item_details.hide_questions=!0;break}else e.questions[l.id]={question:l,item:s};return e.has_questions=0<_.pluck(e.questions,"question").length})}}}),angular.module("BB.Directives").directive("bbModal",function(e,t,s){return{restrict:"A",scope:!0,link:function(e,o){var i;return s(function(){return o.parent().parent().parent().css("z-index",999999)},i=e.$watch(function(){var e,s,n;if(e=o.height(),s=769<=t(window).width()?200:20,e>t(window).height())return n=t(window).height()-s,o.css({height:n+"px","overflow-y":"scroll"}),i()}))}}}),angular.module("BB.Directives").directive("bbBackgroundImage",function(){return{restrict:"A",scope:!0,link:function(e,t,s){var o;return s.bbBackgroundImage&&""!==s.bbBackgroundImage?o=e.$watch(s.bbBackgroundImage,function(e){if(e)return o(),t.css("background-image","url(\""+e+"\")")}):void 0}}}),angular.module("BB.Directives").directive("bbCapacityView",function(){return{restrict:"A",template:"{{capacity_view_description}}",link:function(e,t,s){var o,i;return i=s.ticketTypeSingular||"ticket",o=e.$watch(s.bbCapacityView,function(t){var s,n;if(t)switch(o(),s=1<t.num_spaces?"s":"",n=1<t.spaces_left?"s":"",t.chain.capacity_view){case"NUM_SPACES":return e.capacity_view_description=e.ticket_spaces=t.num_spaces+" "+i+s;case"NUM_SPACES_LEFT":return e.capacity_view_description=e.ticket_spaces=t.spaces_left+" "+i+n+" available";case"NUM_SPACES_AND_SPACES_LEFT":return e.capacity_view_description=e.ticket_spaces=t.spaces_left+" of "+t.num_spaces+" "+i+s+" available";}})}}}),angular.module("BB.Directives").directive("bbTimeZone",function(e){return{restrict:"A",link:function(t){var s;if(s=e.getTimeZone(),t.time_zone_name=moment().tz(s).format("zz"),!e.getUseLocalTimeZone()&&moment.tz.guess()!==s)return t.is_time_zone_diff=!0}}})}.call(this),function(){angular.module("BB").directive("bbMemberLogin",function(e){return{restrict:"A",controller:"MemberLogin",templateUrl:function(t,s){return null==s.bbCustomLoginForm?e.directivePartial("_member_login_schema_form"):e.directivePartial("_member_login_form")}}}),angular.module("BB.Controllers").controller("MemberLogin",function(e,t,s,o,i,n,d,l,c,p,m,u){return e.login={},e.validator=u,s.connection_started.then(function(){return m.checkLogin()?(e.setClient(s.member),e.bb.destination?e.redirectTo(e.bb.destination):(e.setLoaded(e),e.skipThisStep(),e.decideNextPage())):n.$get(e.bb.api_url+"/api/v1").then(function(t){return t.$get("new_login").then(function(t){return e.form=t.form,e.schema=t.schema},function(e){return console.log("err ",e)})},function(e){return console.log("err ",e)})}),e.submit=function(){return e.login.role="member",e.company.$post("login",{},e.login).then(function(t){return t.$has("members")?t.$get("members").then(function(t){return e.handleLogin(t[0])}):t.$has("member")?t.$get("member").then(function(t){return e.handleLogin(t)}):void 0},function(e){return"Account has been disabled"===e.data.error?p.raise("ACCOUNT_DISABLED"):p.raise("LOGIN_FAILED")})},e.handleLogin=function(t){return t=m.setLogin(t,e.login.persist_login),e.setClient(t),e.bb.destination?e.redirectTo(e.bb.destination):(e.skipThisStep(),e.decideNextPage())}})}.call(this),function(){angular.module("BB.Directives").directive("bbMonthPicker",function(e,t){return{restrict:"AE",replace:!0,scope:!0,require:["^?bbEvents","^?bbMultiCompanyEvents"],templateUrl:function(){return e.directivePartial("_month_picker")},link:function(e,t,s){var o;return e.picker_settings=e.$eval(s.bbMonthPicker)||{},e.picker_settings.months_to_show=e.picker_settings.months_to_show||3,o=e.$watch(s.dayData,function(t){if(t)return e.processDates(t),o()})},controller:function(e){return e.processDates=function(s){var o,n,c,p,u,b,g,h,y,f,v,S,B,P,L,D,I,C,A;for(p={},h=0,B=s.length;h<B;h++)c=s[h],p[c.date.format("DDMMYY")]=c,!e.first_available_day&&0<c.spaces&&(e.first_available_day=c.date);for(o=e.picker_settings.start_at_first_available_day?e.first_available_day.clone().startOf("month"):moment().startOf("month"),S=_.last(s),g=S.date.diff(o,"months"),g=0<g?g+1:1,e.num_months=e.picker_settings&&e.picker_settings.months?e.picker_settings.months:g,D=[],(P=y=1,I=e.num_months);1<=I?y<=I:y>=I;P=1<=I?++y:--y){for(c=o.clone().startOf("week"),L={weeks:[]},L.index=P-1,C=f=1;6>=f;C=++f){for(A={days:[]},n=v=1;7>=v;n=++v)c.isSame(c.clone().startOf("month"),"day")&&!L.start_date&&(L.start_date=c.clone()),b=p[c.format("DDMMYY")],u={date:c.clone(),data:b,available:b&&b.spaces&&0<b.spaces,today:moment().isSame(c,"day"),past:c.isBefore(moment(),"day"),disabled:!L.start_date||!c.isSame(L.start_date,"month")},A.days.push(u),e.selected_date&&u.date.isSame(e.selected_date,"day")&&(u.selected=!0,e.selected_day=u),c.add(1,"day");L.weeks.push(A)}D.push(L),o.add(1,"month")}return e.months=D,e.slick_config={nextArrow:".month-next",prevArrow:".month-prev",slidesToShow:e.months.length>=e.picker_settings.months_to_show?e.picker_settings.months_to_show:e.months.length,infinite:!1,responsive:[{breakpoint:1200,settings:{slidesToShow:2<=e.months.length?2:e.months.length}},{breakpoint:992,settings:{slidesToShow:1}}],method:{},event:{init:function(s,o){return t(function(){var t,s,i,d;if(null!=e.selected_day){for(i=e.months,d=[],(s=0,t=i.length);s<t;s++)P=i[s],P.start_date.month()===e.selected_day.date.month()?d.push(o.slickGoTo(P.index)):d.push(void 0);return d}})}}}},e.$on("event_list_filter_date:changed",function(t,s){var o;if(o=e.getDay(s),e.selected_day){if(e.selected_day.date.isSame(s))return e.selected_day.selected=!e.selected_day.selected;if(e.selected_day.selected=!1,o)return e.selected_day=o,e.selected_day.selected=!0}else if(o)return e.selected_day=o,e.selected_day.selected=!0}),e.$on("event_list_filter_date:cleared",function(){if(e.selected_day)return e.selected_day.selected=!1}),e.toggleDay=function(t){if(t&&(!t.data||0!==t.data.spaces&&!t.disabled&&t.available)&&(t.data||t._d))return e.selected_day&&e.selected_day.date.isSame(t.date)&&(e.selected_day.selected=!e.selected_day.selected),e.selected_day&&!e.selected_day.date.isSame(t.date)&&(e.selected_day.selected=!1,e.selected_day=t,e.selected_day.selected=!0),e.selected_day||(e.selected_day=t,e.selected_day.selected=!0),e.showDay(t.date)},e.getDay=function(t){var s,o,n,d,l,c,p,m,u,b,g,h;for(u=e.months,o=0,l=u.length;o<l;o++)for(m=u[o],b=m.weeks,(n=0,c=b.length);n<c;n++)for(h=b[n],g=h.days,(d=0,p=g.length);d<p;d++)if(s=g[d],s.date.isSame(t)&&!s.disabled)return s}}}})}.call(this),function(){angular.module("BB.Directives").directive("ngOptions",function(e,t){return{restrict:"A",link:function(s,o,i){var n;if(n=parseInt(i.size,10),!isNaN(n)&&1<n&&e.msie)return t.$on("loading:finished",function(){return o.focus(),$("body").focus()})}}})}.call(this),function(){'use strict';var e;e=angular.module("BB.Directives"),e.directive("script",function(e,t){return{transclude:!1,restrict:"E",link:function(e,s,o){var i,n,d;if("text/hal-object"===o.type)return i=s[0].innerText,n=$bbug.parseJSON(i),d=t.$parse(n)}}})}.call(this),function(){angular.module("BB.Directives").directive("bbPaymentButton",function(e,t,s,o,i,n,d){return{restrict:"EA",replace:!0,scope:{total:"=",bb:"=",decideNextPage:"=",notLoaded:"=",setLoaded:"="},link:function(o,l,c){var p,m,u,b;return m=function(e,t){return"button_form"===e?p(t):"page"===e?d.get("payment.html"):"location"===e?"<a href='{{payment_link}}'>{{label}}</a>":""},p=function(e){var o;return o=t.parseAsResourceUrl("'"+e.payment_link+"'")(),s.get(o,{}).then(function(e){return e.data})},b=function(e,t,s){var o,n,d,l,p,m,u,b;switch(e.link_type){case"button_form":d=t.find("input"),m=function(){var e,t,s;for(s=[],e=0,t=d.length;e<t;e++)n=d[e],"submit"===$(n).attr("type")&&s.push(n);return s}()[0],s.value&&$(m).attr("value",s.value);break;case"page":case"location":m=t.find("a")[0];}if(s["class"]){for(u=s["class"].split(" "),b=[],(l=0,p=u.length);l<p;l++)o=u[l],$(m).addClass(o),b.push($(t).removeClass(o));return b}},u=o.$watch("total",function(t){var s;if(t&&t.$has("new_payment"))return u(),o.bb.payment_status="pending",o.bb.total=o.total,o.link_type=o.total.$link("new_payment").type,o.label=c.value||"Make Payment",o.payment_link=o.total.$href("new_payment"),s=o.total.$href("new_payment"),i.when(m(o.link_type,o)).then(function(t){return l.html(t).show(),e(l.contents())(o),b(o,l,c)},function(e){return n.warn(e.data),l.remove()})})}}}),angular.module("BB.Directives").directive("bbPaypalExpressButton",function(e,t,s,o,i,n,d,l){return{restrict:"EA",replace:!0,template:"<a ng-href=\"{{href}}\" ng-click=\"showLoader()\">Pay</a>",scope:{total:"=",bb:"=",decideNextPage:"=",paypalOptions:"=bbPaypalExpressButton",notLoaded:"="},link:function(e){var t,s;return s=e.total,t=e.paypalOptions,e.href=new l(s.$link("paypal_express").href).fillFromObject(t),e.showLoader=function(){if(e.notLoaded)return e.notLoaded(e)}}}})}.call(this),function(){'use strict';var e;e=angular.module("BB.Directives"),e.directive("bbPaypal",function(e){return{restrict:"A",replace:!0,scope:{ppDetails:"=bbPaypal"},templateUrl:e.directivePartial("paypal_button"),link:function(e){var t;if(e.inputs=[],!!e.ppDetails)return t=_.keys(e.ppDetails),_.each(t,function(t){var s;return s={name:t,value:e.ppDetails[t]},e.inputs.push(s)})}}})}.call(this),function(){angular.module("BB.Directives").directive("pricepicker",function(){var e,t;return e=function(e){return e.$watch("price",function(t){if(null!=t)return e.updateModel(t)})},t=function(e,t,s,o){return o.$render=function(){if(o.$viewValue)return e.price=o.$viewValue},e.updateModel=function(e){return o.$setViewValue(e)}},{require:"ngModel",link:t,controller:e,scope:{currency:"@"},template:"<span>{{0 | currency: currency | limitTo: 1}}</span>\n<input type=\"number\" ng-model=\"price\" class=\"form-control\" step=\"0.01\">"}})}.call(this),function(){angular.module("BB.Directives").directive("scoped",function(e,t){var s;return this.compat=function(){var e,t,s,o,i,n,d;o=document.createElement("style"),t="undefined"==typeof o.sheet?"undefined"==typeof o.getSheet?"styleSheet":"getSheet":"sheet",i=void 0!==o.scoped,document.body.appendChild(o),n=o[t],n.addRule?n.addRule("c","blink"):n.insertRule("c{}",0),e=n.rules?"rules":"cssRules",d=n[e][0];try{d.selectorText="d"}catch(e){}return s="d"===d.selectorText.toLowerCase(),o.parentNode.removeChild(o),{scopeSupported:i,rules:e,sheet:t,changeSelectorTextAllowed:s}}(),s=function(e){return function(t){var s,o,i,n,d,l,c,p,m,u,b,g;if(b=t[0],n=0,u=b[e.compat.sheet],!!u){for(s=u[e.compat.rules],l=b.parentNode,i=l.id||(l.id="scopedByScopedPolyfill_"+ ++n),o="",d=s.length||0;l;)l.id&&(o="#"+l.id+" "+o),l=l.parentNode;for(c=[];d--;)p=s[d],p.selectorText?p.selectorText.match(new RegExp(o))?c.push(void 0):(m=o+" "+p.selectorText.split(",").join(", "+o),m=m.replace(/[\ ]+:root/gi,""),e.compat.changeSelectorTextAllowed?c.push(p.selectorText=m):p.type&&1!==p.type?c.push(void 0):(g=p.style.cssText,g?(u.removeRule?u.removeRule(d):u.deleteRule(d),u.addRule?c.push(u.addRule(m,g)):c.push(u.insertRule(m+"{"+g+"}",d))):c.push(void 0))):c.push(void 0);return c}}}(this),{restrict:"A",link:function(e,o){if(e.scopeSupported=this.compat.scopeSupported,!this.compat.scopeSupported)return t(function(){return s(o)})},controller:function(e,t,o){e.scopeSupported||(this.updateCss=function(){return o(function(){return s(t)})})}}})}.call(this),function(){var e;e=angular.module("BB.Directives"),e.directive("bbDisplayMode",function(e,s,o,i){return{transclude:!1,restrict:"A",template:"<span class=\"visible-xs\">&nbsp;</span><span class=\"visible-sm\">&nbsp;</span><span class=\"visible-md\">&nbsp;</span><span class=\"visible-lg\">&nbsp;</span>",link:function(e,n){var d,l,c,p,m;return c=n.find("span"),o(n).addClass("bb-display-mode"),e.display={},l=function(e){return e&&"none"!==e.style.display&&e.offsetWidth&&e.offsetHeight},d=function(){var e,t,s,o;for(e=!1,s=0,o=c.length;s<o;s++)if(t=c[s],l(t)){e=t.className.slice(8,11),i.setViewportSize(t.className.slice(8,11));break}return e},m=function(t){return function(){var s;return s=d(),s!==t.currentSize&&(t.currentSize=s,e.display.xs=!1,e.display.sm=!1,e.display.md=!1,e.display.lg=!1,e.display.not_xs=!0,e.display.not_sm=!0,e.display.not_md=!0,e.display.not_lg=!0,e.display[s]=!0,e.display["not_"+s]=!1,!0)}}(this),p=null,angular.element(s).bind("resize",function(){return function(){return window.clearTimeout(p),p=setTimeout(function(){if(m())return e.$apply()},50)}}(this)),angular.element(s).bind("load",function(){return function(){if(m())return e.$apply()}}(this))}}})}.call(this),function(){angular.module("BB.Directives").directive("bbToggleEdit",function(e,t,s){return{restrict:"AE",link:function(e,t){return e.editing=!1,t.on("dblclick",function(){return function(){return e.$apply(function(){return e.editing=!0})}}(this)),s.on("click",function(){return function(){if(!t.is(":hover"))return e.$apply(function(){return e.editing=!1})}}(this)),!0}}})}.call(this),function(){angular.module("BB.Directives").directive("popover",function(){var t,s;return t=null,s=null,$("div[ng-controller=\"BBCtrl\"]").off(".bbtooltip").on("click.bbtooltip",function(o){var e;return e=$(o.target).closest("[popover]")[0],!e&&t&&s&&($(t).next(".popover").remove(),s.tt_isOpen=!1),!0}),{restrict:"EA",priority:-1e3,link:function(o,i){return i.on("click.bbtooltip",function(n){return t===$(n.target).closest("[popover]")[0]?void n.preventDefault():(t&&s&&($(t).next(".popover").remove(),s.tt_isOpen=!1),t=i[0],s=o)}),o.$on("$destroy",function(){return $(i).off(".bbtooltip")})}}})}.call(this),function(e){'use strict';var t=e.module("BB.Directives");t.directive("appVersion",function(e){return function(t,s){s.text(e)}})}(window.angular),function(){var e=Math.floor,t;t=angular.module("BB.Filters"),angular.module("BB.Filters").filter("stripPostcode",function(){return function(e){var t;return t=e.toLowerCase().match(/[a-z]+\d/),t&&(e=e.substr(0,t.index)),e=$.trim(e),/,$/.test(e)&&(e=e.slice(0,-1)),e}}),angular.module("BB.Filters").filter("labelNumber",function(){return function(e,t){var s;return s=e,t[e]&&(s=t[e]),s}}),angular.module("BB.Filters").filter("interpolate",["version",function(e){return function(t){return(t+"").replace(/\%VERSION\%/mg,e)}}]),angular.module("BB.Filters").filter("rag",function(){return function(e,t,s){return e<=t?"red":e<=s?"amber":"green"}}),angular.module("BB.Filters").filter("time",function(t){return function(s){return t.sprintf("%02d:%02d",e(s/60),s%60)}}),angular.module("BB.Filters").filter("address_single_line",function(){return function(){return function(e){var t;if(e)return e.address1?(t="",t+=e.address1,e.address2&&0<e.address2.length&&(t+=", ",t+=e.address2),e.address3&&0<e.address3.length&&(t+=", ",t+=e.address3),e.address4&&0<e.address4.length&&(t+=", ",t+=e.address4),e.address5&&0<e.address5.length&&(t+=", ",t+=e.address5),e.postcode&&0<e.postcode.length&&(t+=", ",t+=e.postcode),t):void 0}}(this)}),angular.module("BB.Filters").filter("address_multi_line",function(){return function(){return function(e){var t;if(e)return e.address1?(t="",e.address1&&(t+=e.address1),e.address2&&0<t.length&&(t+="<br/>"),e.address2&&(t+=e.address2),e.address3&&0<t.length&&(t+="<br/>"),e.address3&&(t+=e.address3),e.address4&&0<t.length&&(t+="<br/>"),e.address4&&(t+=e.address4),e.address5&&0<t.length&&(t+="<br/>"),e.address5&&(t+=e.address5),e.postcode&&0<t.length&&(t+="<br/>"),e.postcode&&(t+=e.postcode),t):void 0}}(this)}),angular.module("BB.Filters").filter("map_lat_long",function(){return function(){return function(e){var t;if(e)return e.map_url?(t=/([-+]*\d{1,3}[\.]\d*)[, ]([-+]*\d{1,3}[\.]\d*)/.exec(e.map_url),t[0]):void 0}}(this)}),angular.module("BB.Filters").filter("currency",function(e){return function(){return function(t,s){return e("icurrency")(t,s)}}(this)}),angular.module("BB.Filters").filter("icurrency",function(e,t){return function(){return function(s,o){var i,n,d,l;return o||(o=t.getCurrency()),i={USD:"$",GBP:"\xA3",AUD:"$",EUR:"\u20AC",CAD:"$",MIXED:"~"},0<=$.inArray(o,["USD","AUD","CAD","MIXED","GBP"])?(l=",",n=".",d="%s%v"):(l=".",n=",",d="%s%v"),s/=100,e.accounting.formatMoney(s,i[o],2,l,n,d)}}(this)}),angular.module("BB.Filters").filter("raw_currency",function(){return function(){return function(e){return e/100}}(this)}),angular.module("BB.Filters").filter("pretty_price",function(e){return function(t,s){return e("ipretty_price")(t,s)}}),angular.module("BB.Filters").filter("ipretty_price",function(e,t){return function(s,o){var i;return o||(i={USD:"$",GBP:"\xA3",AUD:"$",EUR:"\u20AC",CAD:"$",MIXED:"~"},o=i[t.getCurrency()]),s/=100,0===parseFloat(s)?"Free":0==parseFloat(s)%1?o+parseFloat(s):o+e.sprintf("%.2f",parseFloat(s))}}),angular.module("BB.Filters").filter("time_period",function(){return function(e,t){var s,o,i,n,d,l,c;if(angular.isNumber(e))return(s=t&&t.abbr_units?"hr":"hour",i=t&&t.abbr_units?"min":"minute",d=t&&angular.isString(t.separator)?t.separator:"and",c=parseInt(e),60>c)?(l=c+" "+i,1<c&&(l+="s"),l):(o=parseInt(c/60),n=c%60,0===n)?1===o?"1 "+s:o+" "+s+"s":(l=o+" "+s,1<o&&(l+="s"),0===n)?l:(0<d.length&&(l+=" "+d),l+=" "+n+" "+i,1<n&&(l+="s"),l)}}),angular.module("BB.Filters").filter("twelve_hour_time",function(s){return function(o,i){var n,d,l,c,p,u;if(angular.isNumber(o))return l=i&&i.omit_mins_on_hour||!1,c=i&&i.separator?i.separator:":",u=o,n=e(u/60),d=u%60,p="am",12<=n&&(p="pm"),12<n&&(n-=12),o=0===d&&l?""+n:""+n+c+s.sprintf("%02d",d),o+=p,o}}),angular.module("BB.Filters").filter("time_period_from_seconds",function(){return function(t){var s,o,i,n,d;if(d=parseInt(t),60>d)return""+d+" seconds";if(s=e(d/3600),o=e(d%3600/60),i=e(d%60),n="",0<s){if(n+=s+" hour",1<s&&(n+="s"),0===o&&0===i)return n;n+=" and "}if(0<o){if(n+=o+" minute",1<o&&(n+="s"),0===i)return n;n+=" and "}return n+=i+" second",0<i&&(n+="s"),n}}),angular.module("BB.Filters").filter("round_up",function(){return function(e,t){var s;return s=e/t,s=parseInt(s),s*=t,0<e%t&&(s+=t),s}}),angular.module("BB.Filters").filter("exclude_days",function(){return function(e,t){return _.filter(e,function(e){return-1===t.indexOf(e.date.format("dddd"))})}}),angular.module("BB.Filters").filter("local_phone_number",function(e,t){return function(s){var o;if(s)return o=e.getCountryCode(),"gb"===o?s.replace(/^(\+44 \(0\)|\S{0})/,"0"):"us"===o?s.replace(t.us_phone_number,"($1) $2 $3"):s}}),angular.module("BB.Filters").filter("datetime",function(e){var t;return t={datetime:{us:"MM/DD/YYYY, h:mm a",uk:"DD/MM/YYYY, HH:mm"},date:{us:"MM/DD/YYYY",uk:"DD/MM/YYYY"},time:{us:"h:mm a",uk:"HH:mm"}},function(s,o,i){var n,d;if(null==o&&(o="LLL"),null==i&&(i=!1),t[o]&&(n="us"===e.getCountryCode()?"us":"uk",o=t[o][n]),s&&moment.isMoment(s))return d=s.clone(),d.tz(e.getDisplayTimeZone()),i&&(o+=" zz"),d.format(o)}}),angular.module("BB.Filters").filter("range",function(){return function(e,t,s){var o,n,d,l;for(o=n=d=parseInt(t),l=parseInt(s);d<=l?n<=l:n>=l;o=d<=l?++n:--n)e.push(o);return e}}),angular.module("BB.Filters").filter("international_number",function(){return function(){return function(e,t){return e&&t?t+" "+e:e?""+e:""}}(this)}),angular.module("BB.Filters").filter("startFrom",function(){return function(e,t){return void 0===e?e:e.slice(+t)}}),angular.module("BB.Filters").filter("add",function(){return function(){return function(e,t){if(e&&t)return e=parseInt(e),e+t}}(this)}),angular.module("BB.Filters").filter("spaces_remaining",function(){return function(e){return 1>e?0:e}}),angular.module("BB.Filters").filter("key_translate",function(){return function(e){var t,s,o;return o=angular.uppercase(e),s=o.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g,""),t=s.replace(/\ /g,"_"),t}}),angular.module("BB.Filters").filter("nl2br",function(){return function(e){if(e)return e.replace(/\n/g,"<br/>")}}),t.filter("clearTimezone",function(){return function(e){return null!==e&&19<e.length?e.substring(0,19):e}}),t.filter("format_answer",function(){return function(e){return"boolean"==typeof e?e=!0===e?"Yes":"No":moment(e,"YYYY-MM-DD",!0).isValid()&&(e=moment(e).format("D MMMM YYYY")),e}})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("AddressModel",function(t,s,o){var i;return i=function(t){function s(e){s.__super__.constructor.call(this,e),(!this.map_url||""===this.map_url)&&this.lat&&this.long&&(this.map_url="https://www.google.com/maps/@"+this.lat+","+this.long+",17z")}return e(s,t),s.prototype.addressSingleLine=function(){var e;return e="",this.address1&&(e+=this.address1),this.address2&&0<e.length&&(e+=", "),this.address2&&(e+=this.address2),this.address3&&0<e.length&&(e+=", "),this.address3&&(e+=this.address3),this.address4&&0<e.length&&(e+=", "),this.address4&&(e+=this.address4),this.address5&&0<e.length&&(e+=", "),this.address5&&(e+=this.address5),this.postcode&&0<e.length&&(e+=", "),this.postcode&&(e+=this.postcode),e},s.prototype.hasAddress=function(){return this.address1||this.address2||this.postcode},s.prototype.addressCsvLine=function(){var e;return e="",this.address1&&(e+=this.address1),e+=", ",this.address2&&(e+=this.address2),e+=", ",this.address3&&(e+=this.address3),e+=", ",this.address4&&(e+=this.address4),e+=", ",this.address5&&(e+=this.address5),e+=", ",this.postcode&&(e+=this.postcode),e+=", ",this.country&&(e+=this.country),e},s.prototype.addressMultiLine=function(){var e;return e="",this.address1&&(e+=this.address1),this.address2&&0<e.length&&(e+="<br/>"),this.address2&&(e+=this.address2),this.address3&&0<e.length&&(e+="<br/>"),this.address3&&(e+=this.address3),this.address4&&0<e.length&&(e+="<br/>"),this.address4&&(e+=this.address4),this.address5&&0<e.length&&(e+="<br/>"),this.address5&&(e+=this.address5),this.postcode&&0<e.length&&(e+="<br/>"),this.postcode&&(e+=this.postcode),e},s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("AffiliateModel",function(t,s,o,i,n){var d;return d=function(o){function d(e){d.__super__.constructor.call(this,e),this.test=1}return e(d,o),d.prototype.getCompanyByRef=function(e){var o,d,l,c;return l={id:this.cookie,reference:e},d=n.bb.api_url+"/api/v1/affiliates/{id}/companies/{reference}",c=new UriTemplate(d).fillFromObject(l||{}),o=t.defer(),i.$get(c,{}).then(function(t){return t?o.resolve(new s.Company(t)):o.reject("No company for ref "+e)},function(e){return console.log("err ",e),o.reject(e)}),o.promise},d}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("AnswerModel",function(t,s,o){var i;return i=function(s){function o(e){o.__super__.constructor.call(this,e)}return e(o,s),o.prototype.getQuestion=function(){var e;return e=t.defer(),this.question&&e.resolve(this.question),this._data.$has("question")?this._data.$get("question").then(function(t){return function(s){return t.question=s,e.resolve(t.question)}}(this)):e.resolve([]),e.promise},o}(o)})}.call(this),function(){angular.module("BB.Models").service("BBModel",function(e,t){var s,o,n,d,c,p,m,u,b,g,h,y,f,v,w,S,B,P,L,D,I;for(L=["Address","Answer","Affiliate","Basket","BasketItem","BookingText","BookableItem","Category","Client","ClientDetails","Company","CompanySettings","Day","Event","EventChain","EventGroup","EventTicket","EventSequence","ItemDetails","Person","PurchaseItem","PurchaseTotal","Question","Resource","Service","Slot","Space","Clinic","SurveyQuestion","TimeSlot","BusinessQuestion","Image","Deal","PrePaidBooking","MembershipLevel","Product","BBCollection","ExternalPurchase","PackageItem","BulkPurchase","Pagination","Reason"],m={},n=function(){return function(e){return m[e]=function(s,o){return new(t.get(e+"Model"))(s,o)}}}(this),(u=0,y=L.length);u<y;u++)P=L[u],n(P);for(I=["Booking","Total","CourseBooking"],D={},d=function(){return function(e){return D[e]=function(s){return new(t.get("Purchase."+e+"Model"))(s)}}}(this),(b=0,f=I.length);b<f;b++)P=I[b],d(P);for(m.Purchase=D,S=["Member","Booking","PrePaidBooking","Wallet","WalletLog","Purchase","PurchaseItem","WalletPurchaseBand"],B={},c=function(){return function(e){return B[e]=function(s){return new(t.get("Member."+e+"Model"))(s)}}}(this),(g=0,v=S.length);g<v;g++)P=S[g],c(P);for(m.Member=B,s=["Booking","Slot","User","Administrator","Schedule","Address","Resource","Person","Service","Login","EventChain","EventGroup","Event","Queuer","ClientQueue","Clinic"],o={},p=function(){return function(e){return o[e]=function(s){return new(t.get("Admin."+e+"Model"))(s)}}}(this),(h=0,w=s.length);h<w;h++)P=s[h],p(P);return m.Admin=o,m}),angular.module("BB.Models").service("BaseModel",function(e,t,s,o){var i;return i=function(){function s(e){this.deleted=!1,this.updateModel(e)}return s.prototype.updateModel=function(e){var t,s,o,i,d,l,c;if(e&&(this._data=e),e)for(i in e)o=e[i],this[i]=o;if(this._data&&this._data.$href){for(t in this.self=this._data.$href("self"),s=this.$links(),this.__linkedData={},this.__linkedPromises={},c=[],s)l=s[t],d=this._snakeToCamel("get_"+t),c.push(function(e){return function(t,s,o){if(e[o]||(e[o]=function(){return this.$buildOject(t)}),!e[o+"Promise"])return e[o+"Promise"]=function(){return this.$buildOjectPromise(t)}}}(this)(t,l,d));return c}},s.prototype._snakeToCamel=function(e){return e.replace(/(\_\w)/g,function(e){return e[1].toUpperCase()})},s.prototype.$buildOject=function(e){return this.__linkedData[e]?this.__linkedData[e]:(this.$buildOjectPromise(e).then(function(t){return function(s){return t.__linkedData[e]=s,o(function(){return t.__linkedData[e]=s})}}(this)),null)},s.prototype.$buildOjectPromise=function(s){var o;return this.__linkedPromises[s]?this.__linkedPromises[s]:(o=e.defer(),this.__linkedPromises[s]=o.promise,this.$get(s).then(function(){return function(e){var i;try{return i=t.get("BB.Service."+s),i.promise?i.unwrap(e).then(function(e){return o.resolve(e)},function(e){return o.reject(e)}):o.resolve(i.unwrap(e))}catch(t){return o.resolve(e)}}}(this),function(e){return o.reject(e)}),this.__linkedPromises[s])},s.prototype.get=function(e){return this._data?this._data[e]:null},s.prototype.set=function(e,t){return this._data?this._data[e]=t:null},s.prototype.$href=function(e,t){if(this._data)return this._data.$href(e,t)},s.prototype.$has=function(e){if(this._data)return this._data.$has(e)},s.prototype.$flush=function(e,t){if(this._data)return this._data.$href(e,t)},s.prototype.$get=function(e,t){if(this._data)return this._data.$get(e,t)},s.prototype.$post=function(e,t,s){if(this._data)return this._data.$post(e,t,s)},s.prototype.$put=function(e,t,s){if(this._data)return this._data.$put(e,t,s)},s.prototype.$patch=function(e,t,s){if(this._data)return this._data.$patch(e,t,s)},s.prototype.$del=function(e,t,s){if(this._data)return this._data.$del(e,t,s)},s.prototype.$links=function(){if(this._data)return this._data.$links()},s.prototype.$toStore=function(){if(this._data)return this._data.$toStore()},s}()})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("BasketModel",function(t,s,o){var i;return i=function(t){function o(e,t){this.is_admin=!!(t&&t.isAdmin)&&t.isAdmin,null!=t&&t.parent_client&&(this.parent_client_id=t.parent_client.id),this.items=[],o.__super__.constructor.call(this,e),this.reviewed=!1}return e(o,t),o.prototype.addItem=function(e){var t,s,o,n;for(n=this.items,s=0,o=n.length;s<o;s++){if(t=n[s],t===e)return;if(t.id&&e.id&&t.id===e.id)return}return this.items.push(e)},o.prototype.clear=function(){return this.items=[]},o.prototype.clearItem=function(e){return this.items=this.items.filter(function(t){return t!==e})},o.prototype.itemsReady=function(){var e,t,s,o,n;if(0<this.items.length){for(o=!0,n=this.items,(t=0,s=n.length);t<s;t++)e=n[t],e.checkReady()||(o=!1);return o}return!1},o.prototype.readyToCheckout=function(){var e,t,s,o,n;if(0<this.items.length&&this.reviewed){for(o=!0,n=this.items,(t=0,s=n.length);t<s;t++)e=n[t],e.checkReady()||(o=!1);return o}return!1},o.prototype.timeItems=function(){var e,t,s,o,n;for(n=[],o=this.items,(t=0,s=o.length);t<s;t++)e=o[t],e.isTimeItem()&&n.push(e);return n},o.prototype.hasTimeItems=function(){var e,t,s,o;for(o=this.items,t=0,s=o.length;t<s;t++)if(e=o[t],e.isTimeItem())return!0;return!1},o.prototype.basketItems=function(){var e,t,s,o,n;for(e=[],n=this.items,(s=0,o=n.length);s<o;s++)t=n[s],t.is_coupon||e.push(t);return e},o.prototype.externalPurchaseItems=function(){var e,t,s,o,n;for(e=[],n=this.items,(s=0,o=n.length);s<o;s++)t=n[s],t.isExternalPurchase()&&e.push(t);return e},o.prototype.couponItems=function(){var e,t,s,o,n;for(e=[],n=this.items,(s=0,o=n.length);s<o;s++)t=n[s],t.is_coupon&&e.push(t);return e},o.prototype.removeCoupons=function(){return this.items=_.reject(this.items,function(e){return e.is_coupon})},o.prototype.setSettings=function(e){if(e)return this.settings||(this.settings={}),$.extend(this.settings,e)},o.prototype.setClient=function(e){return this.client=e},o.prototype.setClientDetails=function(e){return this.client_details=new s.PurchaseItem(e)},o.prototype.getPostData=function(){var e,t,s,o,i;for(o={client:this.client.getPostData(),settings:this.settings,reference:this.reference},o.is_admin=this.is_admin,o.parent_client_id=this.parent_client_id,o.take_from_wallet=this.take_from_wallet,o.items=[],i=this.items,(t=0,s=i.length);t<s;t++)e=i[t],o.items.push(e.getPostData());return o},o.prototype.dueTotal=function(){var e,t,s,o,i;for(i=this.totalPrice(),o=this.items,(t=0,s=o.length);t<s;t++)e=o[t],e.isWaitlist()&&(i-=e.price);return 0>i&&(i=0),i},o.prototype.length=function(){return this.items.length},o.prototype.questionPrice=function(e){var t,s,o,i,n,d;for(d=e&&e.unready,i=0,n=this.items,(s=0,o=n.length);s<o;s++)t=n[s],(t.ready||!d)&&d||(i+=t.questionPrice());return i},o.prototype.totalPrice=function(e){var t,s,o,i,n,d;for(d=e&&e.unready,i=0,n=this.items,(s=0,o=n.length);s<o;s++)t=n[s],(t.ready||!d)&&d||(i+=t.totalPrice());return i},o.prototype.updateTotalPrice=function(e){return this.total_price=this.totalPrice(e)},o.prototype.fullPrice=function(){var e,t,s,o,i;for(o=0,i=this.items,(t=0,s=i.length);t<s;t++)e=i[t],o+=e.fullPrice();return o},o.prototype.hasCoupon=function(){var e,t,s,o;for(o=this.items,t=0,s=o.length;t<s;t++)if(e=o[t],e.is_coupon)return!0;return!1},o.prototype.totalCoupons=function(){return this.fullPrice()-this.totalPrice()-this.totalDealPaid()},o.prototype.totalDuration=function(){var e,t,s,o,i;for(e=0,i=this.items,(s=0,o=i.length);s<o;s++)t=i[s],t.service&&t.service.listed_duration&&(e+=t.service.listed_duration);return e},o.prototype.containsDeal=function(){var e,t,s,o;for(o=this.items,t=0,s=o.length;t<s;t++)if(e=o[t],e.deal_id)return!0;return!1},o.prototype.hasDeal=function(){var e,t,s,o;for(o=this.items,t=0,s=o.length;t<s;t++)if(e=o[t],e.deal_codes&&0<e.deal_codes.length)return!0;return!1},o.prototype.getDealCodes=function(){return this.deals=this.items[0]&&this.items[0].deal_codes?this.items[0].deal_codes:[],this.deals},o.prototype.totalDeals=function(){var e,t,s,o,i;for(i=0,o=this.getDealCodes(),(t=0,s=o.length);t<s;t++)e=o[t],i+=e.value;return i},o.prototype.totalDealPaid=function(){var e,t,s,o,i;for(i=0,o=this.items,(t=0,s=o.length);t<s;t++)e=o[t],e.certificate_paid&&(i+=e.certificate_paid);return i},o.prototype.remainingDealBalance=function(){return this.totalDeals()-this.totalDealPaid()},o.prototype.hasWaitlistItem=function(){var e,t,s,o;for(o=this.items,t=0,s=o.length;t<s;t++)if(e=o[t],e.isWaitlist())return!0;return!1},o.prototype.hasExternalPurchase=function(){var e,t,s,o;for(o=this.items,t=0,s=o.length;t<s;t++)if(e=o[t],e.isExternalPurchase())return!0;return!1},o.prototype.useWallet=function(e,t){return t&&t.$has("wallet")&&e?(this.take_from_wallet=!0,!0):(this.take_from_wallet=!1,!1)},o.prototype.voucherRemainder=function(){var e,t,s,o,i;for(e=0,i=this.items,(s=0,o=i.length);s<o;s++)t=i[s],t.voucher_remainder&&(e+=t.voucher_remainder);return e},o}(o)})}.call(this),function(){'use strict';var e=Math.ceil,s=function(e,t){return function(){return e.apply(t,arguments)}},o=function(e,t){function s(){this.constructor=e}for(var o in t)i.call(t,o)&&(e[o]=t[o]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},i={}.hasOwnProperty;angular.module("BB.Models").factory("BasketItemModel",function(t,i,n,d,l,c,p){var m;return m=function(t){function l(o){this.fullPrice=s(this.fullPrice,this),this.totalPrice=s(this.totalPrice,this),this.getQty=s(this.getQty,this),this.questionPrice=s(this.questionPrice,this);var i,d,p,m,u,b;l.__super__.constructor.call(this,o),this.ready=!1,this.days_link=null,this.book_link=null,this.parts_links={},this.settings||(this.settings={}),this.has_questions=!1,this.ref||(this.ref=e(moment().unix()*Math.random())),_.isNumber(this.time)&&(this.time=new n.TimeSlot({time:this.time,event_id:this.event_id,selected:!0,avail:1,price:this.price})),this.date&&(this.date=new n.Day({date:this.date,spaces:1})),this.datetime&&(this.date=new n.Day({date:this.datetime.toISODate(),spaces:1}),b=60*this.datetime.hour()+this.datetime.minute(),this.time=new n.TimeSlot({time:b,event_id:this.event_id,selected:!0,avail:1,price:this.price})),this.id&&(this.reserve_ready=!0,this.held={time:this.time,date:this.date,event_id:this.event_id,id:this.id}),this.promises=[],o&&(o.$has("answers")&&o.$get("answers").then(function(){return function(e){var t,s,n,d;for(o.questions=[],d=[],(s=0,n=e.length);s<n;s++)t=e[s],d.push(o.questions.push({id:t.question_id,answer:t.value}));return d}}(this)),o.$has("company")&&(d=o.$get("company"),this.promises.push(d),d.then(function(e){return function(t){var s;return s=new n.Company(t),e.promises.push(s.getSettings()),e.setCompany(s)}}(this))),o.$has("service")&&(u=o.$get("service"),this.promises.push(u),u.then(function(e){return function(t){var s;if(t.$has("category")&&(s=t.$get("category"),e.promises.push(s),s.then(function(t){return e.setCategory(new n.Category(t))})),e.setService(new n.Service(t),o.questions),e.duration&&e.setDuration(e.duration),e.checkReady(),e.time)return e.time.service=e.service}}(this))),o.$has("event_group")&&(u=o.$get("event_group"),this.promises.push(u),u.then(function(e){return function(t){var s;if(t.$has("category")&&(s=t.$get("category"),e.promises.push(s),s.then(function(t){return e.setCategory(new n.Category(t))})),e.setEventGroup(new n.EventGroup(t)),e.time)return e.time.service=e.event_group}}(this))),o.$has("event_chain")&&(i=o.$get("event_chain"),this.promises.push(i),!o.$has("event")&&i.then(function(e){return function(t){return e.setEventChain(new n.EventChain(t),o.questions)}}(this))),o.$has("resource")&&(m=o.$get("resource"),this.promises.push(m),m.then(function(e){return function(t){return e.setResource(new n.Resource(t),!1)}}(this))),o.$has("person")&&(p=o.$get("person"),this.promises.push(p),p.then(function(e){return function(t){return e.setPerson(new n.Person(t),!1)}}(this))),o.$has("event")&&o.$get("event").then(function(e){return function(t){return e.setEvent(new n.Event(t))}}(this)),o.settings&&(this.settings=c.extend(!0,{},o.settings)),o.attachment_id&&(this.attachment_id=o.attachment_id),o.$has("product")&&o.$get("product").then(function(e){return function(t){return e.setProduct(new n.Product(t))}}(this)),o.$has("package_item")&&o.$get("package_item").then(function(e){return function(t){return e.setPackageItem(new n.PackageItem(t))}}(this)),o.$has("bulk_purchase")&&o.$get("bulk_purchase").then(function(e){return function(t){return e.setBulkPurchase(new n.BulkPurchase(t))}}(this)),o.$has("deal")&&o.$get("deal").then(function(e){return function(t){return e.setDeal(new n.Deal(t))}}(this)),o.$has("pre_paid_booking")&&o.$get("pre_paid_booking").then(function(e){return function(t){return e.setPrepaidBooking(new n.PrePaidBooking(t))}}(this)),o.clinic_id&&(this.clinic_id=o.clinic_id))}return o(l,t),l.prototype.setDefaults=function(e){var t,s;return e.settings&&(this.settings=e.settings),e.company&&this.setCompany(e.company),e.merge_resources&&this.setResource(null),e.merge_people&&this.setPerson(null),e.resource&&this.setResource(e.resource),e.person&&this.setPerson(e.person),e.service&&this.setService(e.service),e.category&&this.setCategory(e.category),e.date&&(e.date=moment(e.date)),e.time&&(t=e.date?e.date:moment(),s=e.time?parseInt(e.time):0,e.datetime=p.convertTimeSlotToMoment(e.date,{time:s})),e.service_ref&&(this.service_ref=e.service_ref),e.group&&(this.group=e.group),e.clinic&&(this.clinic=e.clinic,this.clinic_id=e.clinic.id),e.private_note&&(this.private_note=e.private_note),e.event_group&&this.setEventGroup(e.event_group),e.event&&this.setEvent(e.event),this.defaults=e},l.prototype.storeDefaults=function(e){return this.defaults=e},l.prototype.defaultService=function(){return this.defaults&&this.defaults.service?this.defaults.service:this.defaults&&this.defaults.event_group?this.defaults.event_group:null},l.prototype.setSlot=function(e){var s;return this.date=new n.Day({date:e.datetime.toISODate(),spaces:1}),s=60*e.datetime.hour()+e.datetime.minute(),this.time=new n.TimeSlot({time:s,avail:1,price:this.price}),this.available_slot=e.id},l.prototype.setCompany=function(e){if(this.company=e,this.parts_links.company=this.company.$href("self"),this.item_details)return this.item_details.currency_code=this.company.currency_code},l.prototype.clearExistingItem=function(){var e;return this.$has("self")&&this.event_id&&(e=this.$del("self"),this.promises.push(e),e.then(function(){})),delete this.earliest_time,delete this.event_id},l.prototype.setItem=function(e){if(e)return"person"===e.type?this.setPerson(e):"service"===e.type?this.setService(e):"resource"===e.type?this.setResource(e):void 0},l.prototype.setService=function(e,t){var s;if(null==t&&(t=null),this.service){if(this.service.self&&e.self&&this.service.self===e.self)return this.service.$has("book")&&(this.book_link=this.service),e.$has("days")&&(this.days_link=e),void(e.$has("book")&&(this.book_link=e));this.item_details=null,this.clearExistingItem()}return(this.service&&e&&this.service.self&&e.self&&this.service.self!==e.self&&e.durations&&1<e.durations.length&&(this.duration=null,this.listed_duration=null),this.service=e,e&&e instanceof d&&(this.service=e.item),this.parts_links.service=this.service.$href("self"),this.service.$has("book")&&(this.book_link=this.service),e.$has("days")&&(this.days_link=e),e.$has("book")&&(this.book_link=e),this.service.$has("questions")?(this.has_questions=!0,s=this.service.$get("questions"),this.promises.push(s),s.then(function(e){return function(s){if(e.company&&(s.currency_code=e.company.currency_code),e.item_details=new n.ItemDetails(s),e.has_questions=e.item_details.hasQuestions,t)return e.item_details.setAnswers(t),e.setAskedQuestions()}}(this),function(e){return function(){return e.has_questions=!1}}(this))):this.has_questions=!1,this.service&&this.service.durations&&1===this.service.durations.length&&(this.setDuration(this.service.durations[0]),this.listed_duration=this.service.durations[0]),this.service&&this.service.listed_durations&&1===this.service.listed_durations.length&&(this.listed_duration=this.service.listed_durations[0]),this.service.$has("category")&&(s=this.service.getCategoryPromise(),s))?this.promises.push(s):void 0},l.prototype.setEventGroup=function(e){var t;if(!(this.event_group&&this.event_group.self&&e.self&&this.event_group.self===e.self))return(this.event_group=e,this.parts_links.event_group=this.event_group.$href("self").replace("event_group","service"),this.event_group.$has("category")&&(t=this.event_group.getCategoryPromise(),t))?this.promises.push(t):void 0},l.prototype.setEventChain=function(e,t){var s;if(null==t&&(t=null),!(this.event_chain&&this.event_chain.self&&e.self&&this.event_chain.self===e.self))return this.event_chain=e,this.base_price=parseFloat(e.price),null!=this.price&&this.price!==this.base_price?this.setPrice(this.price):this.setPrice(this.base_price),this.event_chain.isSingleBooking()&&(this.tickets={name:"Admittance",max:1,type:"normal",price:this.base_price},this.tickets.pre_paid_booking_id=this.pre_paid_booking_id,this.num_book&&(this.tickets.qty=this.num_book)),this.event_chain.$has("questions")?(this.has_questions=!0,s=this.event_chain.$get("questions"),this.promises.push(s),s.then(function(e){return function(s){var o,d,l,p,c;if(e.item_details=new n.ItemDetails(s),e.has_questions=e.item_details.hasQuestions,e.questions){for(c=e.item_details.questions,d=0,l=c.length;d<l;d++)p=c[d],o=_.find(e.questions,function(e){return e.id===p.id}),(o&&void 0===p.answer||o!==p.answer)&&(p.answer=o.answer);e.setAskedQuestions()}return t?(e.item_details.setAnswers(t),e.setAskedQuestions()):void 0}}(this),function(e){return function(){return e.has_questions=!1}}(this))):this.has_questions=!1},l.prototype.setEvent=function(e,t){var s;if(null==t&&(t=null),this.event&&this.event.unselect(),this.event=e,this.event.select(),this.event_chain_id=e.event_chain_id,this.setDate({date:e.date}),this.setTime(e.time),this.setDuration(e.duration),e.$has("book")&&(this.book_link=e),e.qty&&(this.num_book=e.qty),s=this.event.getChain(),this.promises.push(s),s.then(function(e){return function(s){return e.setEventChain(s,t)}}(this)),s=this.event.getGroup(),this.promises.push(s),s.then(function(e){return function(t){return e.setEventGroup(t)}}(this)),0>=this.event.getSpacesLeft()&&!this.company.settings){if(this.company.getSettings().has_waitlists)return this.status=8;}else if(0>=this.event.getSpacesLeft()&&this.company.settings&&this.company.settings.has_waitlists)return this.status=8},l.prototype.setCategory=function(e){return this.category=e},l.prototype.setPerson=function(e,t){if(null==t&&(t=!0),t&&this.earliest_time&&delete this.earliest_time,!e){if(this.person=!0,t&&(this.settings.person=-1),this.parts_links.person=null,this.service&&this.setService(this.service),this.resource&&!this.anyResource()&&this.setResource(this.resource,!1),this.event_id&&(delete this.event_id,this.resource&&this.defaults&&this.defaults.merge_resources))return this.setResource(null);}else if(this.person=e,t&&(this.settings.person=this.person.id),this.parts_links.person=this.person.$href("self"),e.$has("days")&&(this.days_link=e),e.$has("book")&&(this.book_link=e),this.event_id&&this.$has("person")&&this.$href("person")!==this.person.self&&(delete this.event_id,this.resource&&this.defaults&&this.defaults.merge_resources))return this.setResource(null)},l.prototype.setResource=function(e,t){if(null==t&&(t=!0),t&&this.earliest_time&&delete this.earliest_time,!e){if(this.resource=!0,t&&(this.settings.resource=-1),this.parts_links.resource=null,this.service&&this.setService(this.service),this.person&&!this.anyPerson()&&this.setPerson(this.person,!1),this.event_id&&(delete this.event_id,this.person&&this.defaults&&this.defaults.merge_people))return this.setPerson(null);}else if(this.resource=e,t&&(this.settings.resource=this.resource.id),this.parts_links.resource=this.resource.$href("self"),e.$has("days")&&(this.days_link=e),e.$has("book")&&(this.book_link=e),this.event_id&&this.$has("resource")&&this.$href("resource")!==this.resource.self&&(delete this.event_id,this.person&&this.defaults&&this.defaults.merge_people))return this.setPerson(null)},l.prototype.setDuration=function(e){return this.duration=e,this.service?this.base_price=this.service.getPriceByDuration(e):this.time&&this.time.price?this.base_price=this.time.price:this.price&&(this.base_price=this.price),this.setPrice(this.base_price)},l.prototype.print_time=function(){if(this.time)return this.time.print_time()},l.prototype.print_end_time=function(){if(this.time)return this.time.print_end_time(this.duration)},l.prototype.print_time12=function(e){if(null==e&&(e=!0),this.time)return this.time.print_time12(e)},l.prototype.print_end_time12=function(e){if(null==e&&(e=!0),this.time)return this.time.print_end_time12(e,this.duration)},l.prototype.setTime=function(e){return this.time&&this.time.unselect(),this.time=e,this.time&&(this.time.select(),this.datetime&&(this.datetime=p.convertTimeSlotToMoment(this.date.date,this.time)),this.price&&this.time.price&&this.price!==this.time.price?this.setPrice(this.time.price):this.price&&!this.time.price?this.setPrice(this.price):this.time.price&&!this.price?this.setPrice(this.time.price):this.price&&this.time.price?this.setPrice(this.price):this.setPrice(null)),this.checkReady()},l.prototype.setDate=function(e){return this.date=e,this.date&&(this.date.date=moment(this.date.date),this.datetime&&(this.datetime.date(this.date.date.date()),this.datetime.month(this.date.date.month()),this.datetime.year(this.date.date.year()))),this.checkReady()},l.prototype.clearDateTime=function(){return delete this.date,delete this.time,delete this.datetime,this.ready=!1,this.reserve_ready=!1},l.prototype.clearTime=function(){return delete this.time,this.ready=!1,this.reserve_ready=!1},l.prototype.setGroup=function(e){return this.group=e},l.prototype.setAskedQuestions=function(){return this.asked_questions=!0,this.checkReady()},l.prototype.checkReady=function(){return this.ready=!1,this.checkReserveReady()&&(this.asked_questions||!this.has_questions)&&(this.ready=!0),this.ready},l.prototype.checkReserveReady=function(){return this.reserve_ready=!1,(this.date&&this.time&&this.service||this.event||this.product||this.package_item||this.bulk_purchase||this.external_purchase||this.deal||this.is_coupon||this.date&&this.service&&"day"===this.service.duration_unit)&&(this.reserve_ready=!0),this.reserve_ready},l.prototype.getPostData=function(){var e,t,s,o,n,d,l,c,p;if(this.cloneAnswersItem)for(c=this.cloneAnswersItem.item_details.questions,t=0,o=c.length;t<o;t++)for(l=c[t],p=this.item_details.questions,(s=0,n=p.length);s<n;s++)d=p[s],d.id===l.id&&(d.answer=l.answer,this.setAskedQuestions());return e={},this.date&&(e.date=this.date.date.toISODate()),this.time?(e.time=this.time.time,this.time.event_id?e.event_id=this.time.event_id:this.time.event_ids&&(e.event_ids=this.time.event_ids)):this.date&&this.date.event_id&&(e.event_id=this.date.event_id),e.price=this.price,e.paid=this.paid,this.book_link&&(e.book=this.book_link.$href("book")),e.id=this.id,e.duration=this.duration,e.settings=this.settings,e.settings||(e.settings={}),this.earliest_time&&(e.settings.earliest_time=this.earliest_time),this.item_details&&this.asked_questions&&(e.questions=this.item_details.getPostData()),this.move_item_id&&(e.move_item_id=this.move_item_id),this.srcBooking&&(e.move_item_id=this.srcBooking.id),this.service&&(e.service_id=this.service.id),this.resource&&(e.resource_id=this.resource.id),this.person&&(e.person_id=this.person.id),e.length=this.length,this.event&&(e.event_id=this.event.id,null==this.event.pre_paid_booking_id?this.tickets&&null!=this.tickets.pre_paid_booking_id&&(e.pre_paid_booking_id=this.tickets.pre_paid_booking_id):e.pre_paid_booking_id=this.event.pre_paid_booking_id,e.tickets=this.tickets),null!=this.pre_paid_booking_id&&(e.pre_paid_booking_id=this.pre_paid_booking_id),e.event_chain_id=this.event_chain_id,e.event_group_id=this.event_group_id,e.qty=this.qty,this.status&&(e.status=this.status),null!=this.num_resources&&(e.num_resources=parseInt(this.num_resources)),this.package_item&&(e.package_id=this.package_item.id),this.bulk_purchase&&(e.bulk_purchase_id=this.bulk_purchase.id),e.external_purchase=this.external_purchase,this.deal&&(e.deal=this.deal),this.deal&&this.recipient&&(e.recipient=this.recipient),this.deal&&this.recipient&&this.recipient_mail&&(e.recipient_mail=this.recipient_mail),e.coupon_id=this.coupon_id,e.is_coupon=this.is_coupon,this.attachment_id&&(e.attachment_id=this.attachment_id),this.deal_codes&&(e.vouchers=this.deal_codes),this.product&&(e.product_id=this.product.id),e.ref=this.ref,this.move_reason&&(e.move_reason=this.move_reason),this.email&&(e.email=this.email),this.first_name&&(e.first_name=this.first_name),this.last_name&&(e.last_name=this.last_name),null!=this.email&&(e.email=this.email),null!=this.email_admin&&(e.email_admin=this.email_admin),this.private_note&&(e.private_note=this.private_note),this.available_slot&&(e.available_slot=this.available_slot),this.clinic_id&&(e.clinic_id=this.clinic_id),e},l.prototype.setPrice=function(e){var t;return null==e?(this.price=null,this.printed_price=null,this.printed_vat_cal=null,this.printed_vat=null,this.printed_vat_inc=null):(this.price=parseFloat(e),t=this.price/100,this.printed_price=0==t%1?"\xA3"+parseInt(t):i.sprintf("\xA3%.2f",t),this.company&&this.company.settings&&(this.printed_vat_cal=this.company.settings.payment_tax),this.printed_vat_cal&&(this.printed_vat=this.printed_vat_cal/100*t),this.printed_vat_cal)?this.printed_vat_inc=this.printed_vat_cal/100*t+t:void 0},l.prototype.getStep=function(){var e;return e={},e.service=this.service,e.category=this.category,e.person=this.person,e.resource=this.resource,e.duration=this.duration,e.event=this.event,e.event_group=this.event_group,e.event_chain=this.event_chain,e.time=this.time,e.date=this.date,e.days_link=this.days_link,e.book_link=this.book_link,e.ready=this.ready,e},l.prototype.loadStep=function(e){return this.service=e.service,this.category=e.category,this.person=e.person,this.resource=e.resource,this.duration=e.duration,this.event=e.event,this.event_chain=e.event_chain,this.event_group=e.event_group,this.time=e.time,this.date=e.date,this.days_link=e.days_link,this.book_link=e.book_link,this.ready=e.ready},l.prototype.describe=function(){var e;return e="-",this.service&&(e=this.service.name),this.event_group&&this.event&&"-"===e&&(e=this.event_group.name+" - "+this.event.description),this.product&&(e=this.product.name),this.external_purchase&&(e=this.external_purchase.name),this.deal&&(e=this.deal.name),this.package_item&&(e=this.package_item.name),this.bulk_purchase&&(e=this.bulk_purchase.name),e},l.prototype.booking_date=function(e){return this.date&&this.date.date?this.date.date.format(e):null},l.prototype.booking_time=function(e){var t;return(null==e&&(e="-"),!this.time)?null:(t=this.listed_duration?this.listed_duration:this.duration,this.time.print_time()+" "+e+" "+this.time.print_end_time(t))},l.prototype.duePrice=function(){return this.isWaitlist()?0:this.price},l.prototype.isWaitlist=function(){return this.status&&8===this.status},l.prototype.start_datetime=function(){return this.date&&this.time?p.convertTimeSlotToMoment(this.date.date,this.time):null},l.prototype.startDatetime=function(){return this.start_datetime()},l.prototype.end_datetime=function(){var e,t;return this.date&&this.time&&(this.listed_duration||this.duration)?(e=this.listed_duration?this.listed_duration:this.duration,t=this.time.time+e,p.convertTimeSlotToMoment(this.date.date,t)):null},l.prototype.endDatetime=function(){return this.end_datetime()},l.prototype.setSrcBooking=function(e){return this.srcBooking=e,this.duration=e.duration},l.prototype.anyPerson=function(){return this.person&&"boolean"==typeof this.person},l.prototype.anyResource=function(){return this.resource&&"boolean"==typeof this.resource},l.prototype.isMovingBooking=function(){return this.srcBooking||this.move_item_id},l.prototype.setCloneAnswers=function(e){return this.cloneAnswersItem=e},l.prototype.questionPrice=function(){return this.item_details?this.item_details.questionPrice(this.getQty()):0},l.prototype.getQty=function(){return this.qty?this.qty:this.tickets?this.tickets.qty:1},l.prototype.totalPrice=function(){var e;return this.tickets&&this.tickets.pre_paid_booking_id?0:this.pre_paid_booking_id?0:null==this.discount_price?(e=this.total_price,angular.isNumber(e)||(e=this.price),angular.isNumber(e)||(e=0),e+this.questionPrice()):this.discount_price+this.questionPrice()},l.prototype.fullPrice=function(){var e;return e=this.base_price,e||(e=this.total_price),e||(e=this.price),e||(e=0),e+this.questionPrice()},l.prototype.setProduct=function(e){if(this.product=e,this.product.$has("book")&&(this.book_link=this.product),e.price)return this.setPrice(e.price)},l.prototype.setPackageItem=function(e){if(this.package_item=e,this.package_item.$has("book")&&(this.book_link=this.package_item),e.price)return this.setPrice(e.price)},l.prototype.setBulkPurchase=function(e){if(this.bulk_purchase=e,this.bulk_purchase.$has("book")&&(this.book_link=this.bulk_purchase),e.price)return this.setPrice(e.price)},l.prototype.setExternalPurchase=function(e){if(this.external_purchase=e,this.book_link=this.company,e.price)return this.setPrice(e.price)},l.prototype.setDeal=function(e){if(this.deal=e,this.deal.$has("book")&&(this.book_link=this.deal),e.price)return this.setPrice(e.price)},l.prototype.hasPrice=function(){return null!=this.price},l.prototype.getAttachment=function(){return this.attachment?this.attachment:this.$has("attachment")&&this.attachment_id?this._data.$get("attachment").then(function(e){return function(t){return e.attachment=t,e.attachment}}(this)):void 0},l.prototype.deleteAttachment=function(){if(this.attachment_id)return this._data.$del("del_attachment",{}),this.attachment_id=null},l.prototype.setPrepaidBooking=function(e){return this.pre_paid_booking=e,this.pre_paid_booking_id=e.id},l.prototype.hasPrepaidBooking=function(){return null!=this.pre_paid_booking_id},l.prototype.getEventId=function(){return this.time&&this.time.event_id?this.time.event_id:this.date&&this.date.event_id?this.date.event_id:this.event?this.event.id:void 0},l.prototype.isExternalPurchase=function(){return null!=this.external_purchase},l.prototype.getName=function(){return this.session_name?this.session_name:this.service_name},l.prototype.getAttendeeName=function(e){return this.first_name?this.first_name+" "+this.last_name:e?e.getName():void 0},l.prototype.isTimeItem=function(){return this.service||this.event},l}(l)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("BookableItemModel",function(t,s,o){var i;return i=function(o){function i(){i.__super__.constructor.apply(this,arguments),this.name="-Waiting-",this.ready=t.defer(),this.promise=this._data.$get("item"),this.promise.then(function(e){return function(t){var o,i,d,l,c;if("person"===t.type){if(e.item=new s.Person(t),e.item){for(i in d=e.item._data,d)o=d[i],e.item._data.hasOwnProperty(i)&&"function"!=typeof o&&(e[i]=o);return e.ready.resolve()}return e.ready.resolve()}if("resource"===t.type){if(e.item=new s.Resource(t),e.item){for(i in l=e.item._data,l)o=l[i],e.item._data.hasOwnProperty(i)&&"function"!=typeof o&&(e[i]=o);return e.ready.resolve()}return e.ready.resolve()}if("service"===t.type){if(e.item=new s.Service(t),e.item){for(i in c=e.item._data,c)o=c[i],e.item._data.hasOwnProperty(i)&&"function"!=typeof o&&(e[i]=o);return e.ready.resolve()}return e.ready.resolve()}}}(this))}return e(i,o),i.prototype.item=null,i.prototype.promise=null,i}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("BookingTextModel",function(t,s,o){var i;return console.log("BookingText model loaded"),i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("BulkPurchaseModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("BusinessQuestionModel",function(t,s,o,i){var n;return n=function(t){function s(e){s.__super__.constructor.call(this,e)}return e(s,t),s}(i)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("CategoryModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ClientModel",function(t,s,o){var i;return i=function(o){function i(e){i.__super__.constructor.apply(this,arguments),this.name=this.getName(),e&&e.answers&&e.$has("questions")&&(this.waitingQuestions=t.defer(),this.gotQuestions=this.waitingQuestions.promise,e.$get("questions").then(function(t){return function(o){return t.client_details=new s.ClientDetails(o),t.client_details.setAnswers(e.answers),t.questions=t.client_details.questions,t.setAskedQuestions(),t.waitingQuestions.resolve()}}(this)))}return e(i,o),i.prototype.setClientDetails=function(e){return this.client_details=e,this.questions=this.client_details.questions},i.prototype.setDefaults=function(e){if(e.name&&(this.name=e.name),e.first_name&&(this.first_name=e.first_name),e.last_name&&(this.last_name=e.last_name),e.phone&&(this.phone=e.phone),e.mobile&&(this.mobile=e.mobile),e.email&&(this.email=e.email),e.id&&(this.id=e.id),e.ref&&(this.comp_ref=e.ref),e.comp_ref&&(this.comp_ref=e.comp_ref),e.address1&&(this.address1=e.address1),e.address2&&(this.address2=e.address2),e.address3&&(this.address3=e.address3),e.address4&&(this.address4=e.address4),e.address5&&(this.address5=e.address5),e.postcode&&(this.postcode=e.postcode),e.country&&(this.country=e.country),e.answers&&(this.default_answers=e.answers),e.time_zone)return this.time_zone=e.time_zone},i.prototype.pre_fill_answers=function(e){var t,s,o,n,d;if(this.default_answers){for(n=e.questions,d=[],(t=0,s=n.length);t<s;t++)o=n[t],this.default_answers[o.name]?d.push(o.answer=this.default_answers[o.name]):d.push(void 0);return d}},i.prototype.getName=function(){var e;return e="",this.first_name&&(e+=this.first_name),0<e.length&&this.last_name&&(e+=" "),this.last_name&&(e+=this.last_name),e},i.prototype.addressSingleLine=function(){var e;return e="",this.address1&&(e+=this.address1),this.address2&&0<e.length&&(e+=", "),this.address2&&(e+=this.address2),this.address3&&0<e.length&&(e+=", "),this.address3&&(e+=this.address3),this.address4&&0<e.length&&(e+=", "),this.address4&&(e+=this.address4),this.address5&&0<e.length&&(e+=", "),this.address5&&(e+=this.address5),this.postcode&&0<e.length&&(e+=", "),this.postcode&&(e+=this.postcode),e},i.prototype.hasAddress=function(){return this.address1||this.address2||this.postcode},i.prototype.addressCsvLine=function(){var e;return e="",this.address1&&(e+=this.address1),e+=", ",this.address2&&(e+=this.address2),e+=", ",this.address3&&(e+=this.address3),e+=", ",this.address4&&(e+=this.address4),e+=", ",this.address5&&(e+=this.address5),e+=", ",this.postcode&&(e+=this.postcode),e+=", ",this.country&&(e+=this.country),e},i.prototype.addressMultiLine=function(){var e;return e="",this.address1&&(e+=this.address1),this.address2&&0<e.length&&(e+="<br/>"),this.address2&&(e+=this.address2),this.address3&&0<e.length&&(e+="<br/>"),this.address3&&(e+=this.address3),this.address4&&0<e.length&&(e+="<br/>"),this.address4&&(e+=this.address4),this.address5&&0<e.length&&(e+="<br/>"),this.address5&&(e+=this.address5),this.postcode&&0<e.length&&(e+="<br/>"),this.postcode&&(e+=this.postcode),e},i.prototype.getPostData=function(){var e,t,s,o,n;if(n={},n.first_name=this.first_name,n.last_name=this.last_name,n.address1=this.house_number?this.house_number+" "+this.address1:this.address1,n.address2=this.address2,n.address3=this.address3,n.address4=this.address4,n.address5=this.address5,n.postcode=this.postcode,n.country=this.country,n.email=this.email,n.id=this.id,n.comp_ref=this.comp_ref,n.parent_client_id=this.parent_client_id,n.password=this.password,n.notifications=this.notifications,this.member_level_id&&(n.member_level_id=this.member_level_id),this.send_welcome_email&&(n.send_welcome_email=this.send_welcome_email),this.default_company_id&&(n.default_company_id=this.default_company_id),this.time_zone&&(n.time_zone=this.time_zone),this.phone&&(n.phone=this.phone,this.phone_prefix&&(n.phone_prefix=this.phone_prefix)),this.mobile&&(this.remove_prefix(),n.mobile=this.mobile,n.mobile_prefix=this.mobile_prefix),this.questions)for(n.questions=[],o=this.questions,(e=0,t=o.length);e<t;e++)s=o[e],n.questions.push(s.getPostData());return n},i.prototype.valid=function(){return this.isValid?this.isValid:!!(this.email||this.hasServerId())},i.prototype.setValid=function(e){return this.isValid=e},i.prototype.hasServerId=function(){return this.id},i.prototype.setAskedQuestions=function(){return this.asked_questions=!0},i.prototype.fullMobile=function(){return this.mobile?this.mobile_prefix?"+"+this.mobile_prefix+this.mobile:this.mobile:void 0},i.prototype.remove_prefix=function(){var e;if(e=this.mobile.match(/^(\+|00)(999|998|997|996|995|994|993|992|991|990|979|978|977|976|975|974|973|972|971|970|969|968|967|966|965|964|963|962|961|960|899|898|897|896|895|894|893|892|891|890|889|888|887|886|885|884|883|882|881|880|879|878|877|876|875|874|873|872|871|870|859|858|857|856|855|854|853|852|851|850|839|838|837|836|835|834|833|832|831|830|809|808|807|806|805|804|803|802|801|800|699|698|697|696|695|694|693|692|691|690|689|688|687|686|685|684|683|682|681|680|679|678|677|676|675|674|673|672|671|670|599|598|597|596|595|594|593|592|591|590|509|508|507|506|505|504|503|502|501|500|429|428|427|426|425|424|423|422|421|420|389|388|387|386|385|384|383|382|381|380|379|378|377|376|375|374|373|372|371|370|359|358|357|356|355|354|353|352|351|350|299|298|297|296|295|294|293|292|291|290|289|288|287|286|285|284|283|282|281|280|269|268|267|266|265|264|263|262|261|260|259|258|257|256|255|254|253|252|251|250|249|248|247|246|245|244|243|242|241|240|239|238|237|236|235|234|233|232|231|230|229|228|227|226|225|224|223|222|221|220|219|218|217|216|215|214|213|212|211|210|98|95|94|93|92|91|90|86|84|82|81|66|65|64|63|62|61|60|58|57|56|55|54|53|52|51|49|48|47|46|45|44|43|41|40|39|36|34|33|32|31|30|27|20|7|1)/),e)return this.mobile.replace(e[0],""),this.mobile_prefix=e[0]},i.prototype.getPrePaidBookingsPromise=function(e){var o;return o=t.defer(),this.$has("pre_paid_bookings")?this.$get("pre_paid_bookings",e).then(function(e){return e.$get("pre_paid_bookings").then(function(e){var t;return o.resolve(function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)t=e[o],d.push(new s.PrePaidBooking(t));return d}())},function(e){return o.reject(e)})},function(){return o.resolve([])}):o.resolve([]),o.promise},i}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ClientDetailsModel",function(t,s,o){var i;return i=function(t){function o(e){var t,n,d,l;if(o.__super__.constructor.apply(this,arguments),this.questions=[],this._data)for(l=e.questions,t=0,n=l.length;t<n;t++)d=l[t],this.questions.push(new s.Question(d));this.hasQuestions=0<this.questions.length}return e(o,t),o.prototype.getPostData=function(e){var t,s,o,n;for(t=[],s=0,o=e.length;s<o;s++)n=e[s],t.push({answer:n.answer,id:n.id,price:n.price});return t},o.prototype.setAnswers=function(e){var t,s,o,n,d,l,c,p,m;for(s={},o=0,d=e.length;o<d;o++)t=e[o],s[t.question_id]=t;for(p=this.questions,m=[],(n=0,l=p.length);n<l;n++)c=p[n],s[c.id]?m.push(c.answer=s[c.id].answer):m.push(void 0);return m},o}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ClinicModel",function(t,s,o){var i;return i=function(t){function s(e){s.__super__.constructor.call(this,e),this.setTimes(),this.setResourcesAndPeople(),this.settings||(this.settings={})}return e(s,t),s.prototype.setResourcesAndPeople=function(){return this.resources=_.reduce(this.resource_ids,function(e,t){return e[t]=!0,e},{}),this.people=_.reduce(this.person_ids,function(e,t){return e[t]=!0,e},{}),this.services=_.reduce(this.service_ids,function(e,t){return e[t]=!0,e},{}),this.uncovered=!this.person_ids||0===this.person_ids.length,this.className=this.uncovered?"clinic_uncovered":"clinic_covered"},s.prototype.setTimes=function(){return this.start_time&&(this.start_time=moment(this.start_time),this.start=this.start_time),this.end_time&&(this.end_time=moment(this.end_time),this.end=this.end_time),this.title=this.name},s}(o)})}.call(this),function(){'use strict';var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("BBCollectionModel",function(s,o,i){var n;return n=function(i){function n(){return this.getNextPage=e(this.getNextPage,this),n.__super__.constructor.apply(this,arguments)}return t(n,i),n.prototype.getNextPage=function(e){var t;return t=s.defer(),this.$get("next",e).then(function(e){return t.resolve(new o.BBCollection(e))},function(){return t.reject()}),t.promise},n}(i)})}.call(this),function(){'use strict';var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("CompanyModel",function(s,o,i,n,d,l){var c;return c=function(i){function p(t){this.getPusherChannel=e(this.getPusherChannel,this),this.pusherSubscribe=e(this.pusherSubscribe,this);var s,d,l,m,u,b,g,h,y,f;if(p.__super__.constructor.call(this,t),this.companies){for(s=[],this.child_companies=[],y=this.companies,(u=0,g=y.length);u<g;u++)if(m=y[u],d=new o.Company(n.$parse(m)),this.child_companies.push(d),d.companies)for(f=d.companies,b=0,h=f.length;b<h;b++)l=f[b],s.push(l);else s.push(d);this.companies=s}}return t(p,i),p.prototype.getCompanyByRef=function(e){var t;return t=s.defer(),this.$get("companies").then(function(s){var o;return o=_.find(s,function(t){return t.reference===e}),o?t.resolve(o):t.reject("No company for ref "+e)},function(e){return console.log("err ",e),t.reject(e)}),t.promise},p.prototype.findChildCompany=function(e){var t,s,o,n,d,l,p,m,u;if(!this.companies)return null;for(m=this.companies,o=0,d=m.length;o<d;o++){if(t=m[o],t.id===parseInt(e))return t;if(t.ref&&t.ref===e+"")return t}if("string"==typeof e)for(p=e.replace(/[\s\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|'’!<>;:,.~`=+-@£&%"]/g,"").toLowerCase(),u=this.companies,(n=0,l=u.length);n<l;n++)if(t=u[n],s=t.name.replace(/[\s\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|'’!<>;:,.~`=+-@£&%"]/g,"").toLowerCase(),p===s)return t;return null},p.prototype.getSettings=function(){var e;return e=s.defer(),this.settings?e.resolve(this.settings):this.$has("settings")?this.$get("settings").then(function(t){return function(s){return t.settings=new o.CompanySettings(s),e.resolve(t.settings)}}(this)):e.reject("Company has no settings"),e.promise},p.prototype.pusherSubscribe=function(e,t){var s;return null==t&&(t={}),"undefined"!=typeof Pusher&&null!==Pusher&&null==this.pusher&&(this.pusher=new Pusher("c8d8cea659cc46060608",{encrypted:!t.hasOwnProperty("encrypted")||t.encrypted,authEndpoint:this.$link("pusher").href,auth:{headers:{"App-Id":d.appId,"App-Key":d.appKey,"Auth-Token":l.getItem("auth_token")}}})),s="private-c"+this.id+"-w"+this.numeric_widget_id,null!=this.pusher.channel(s)&&this.pusher.unsubscribe(s),this.pusher_channel=this.pusher.subscribe(s),this.pusher_channel.bind("booking",e),this.pusher_channel.bind("cancellation",e),this.pusher_channel.bind("updating",e)},p.prototype.getPusherChannel=function(e,t){var s;if(null==t&&(t={}),this.pusher||(this.pusher=new Pusher("c8d8cea659cc46060608",{encrypted:!t.hasOwnProperty("encrypted")||t.encrypted,authEndpoint:this.$link("pusher").href,auth:{headers:{"App-Id":d.appId,"App-Key":d.appKey,"Auth-Token":l.getItem("auth_token")}}})),this.$has(e))return s=this.$href(e),s=s.replace(/https?:\/\//,"").replace(/\//g,"-").replace(/:/g,"_"),this.pusher.channel(s)?this.pusher.channel(s):(this.pusher.subscribe(s),this.pusher.channel(s))},p}(i)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("CompanySettingsModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("DayModel",function(t,s,o){var i;return i=function(t){function s(){s.__super__.constructor.apply(this,arguments),this.string_date=this.date,this.date=moment(this.date)}return e(s,t),s.prototype.day=function(){return this.date.date()},s.prototype.off=function(e){return this.date.month()!==e},s.prototype["class"]=function(e){var t;return t="",this.date.month()<e&&(t+="off off-prev"),this.date.month()>e&&(t+="off off-next"),0===this.spaces&&(t+=" not-avail"),t},s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("DealModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("EventModel",function(t,s,o,i){var n;return n=function(o){function n(e){n.__super__.constructor.call(this,e),this.date=moment.parseZone(this.datetime),this.time=new s.TimeSlot({time:i.convertMomentToTime(this.date)}),this.duration&&(this.end_datetime=this.date.clone().add(this.duration,"minutes")),this.date_unix=this.date.unix()}return e(n,o),n.prototype.getGroup=function(){var e,o;return e=t.defer(),this.group?e.resolve(this.group):this.$has("event_groups")||this.$has("event_group")?(o="event_group",this.$has("event_groups")&&(o="event_groups"),this.$get(o).then(function(t){return function(o){return t.group=new s.EventGroup(o),e.resolve(t.group)}}(this),function(t){return e.reject(t)})):e.reject("No event group"),e.promise},n.prototype.getChain=function(e){var o,i;return o=t.defer(),this.chain?o.resolve(this.chain):this.$has("event_chains")||this.$has("event_chain")?(i="event_chain",this.$has("event_chains")&&(i="event_chains"),this.$get(i,e).then(function(e){return function(t){return e.chain=new s.EventChain(t),o.resolve(e.chain)}}(this))):o.reject("No event chain"),o.promise},n.prototype.getDuration=function(){var e;return e=new t.defer,this.duration?e.resolve(this.duration):this.getChain().then(function(t){return function(s){return t.duration=s.duration,e.resolve(t.duration)}}(this)),e.promise},n.prototype.getNumBooked=function(){return this.spaces_blocked+this.spaces_booked+this.spaces_reserved+this.spaces_held},n.prototype.getSpacesLeft=function(e){var t;return null==e&&(e=null),e&&this.ticket_spaces&&this.ticket_spaces[e]?this.ticket_spaces[e].left:(t=this.num_spaces-this.getNumBooked(),0>t?0:t)},n.prototype.getWaitSpacesLeft=function(){var e;return e=this.chain.waitlength,e||(e=0),e-=this.spaces_wait,0>=e?0:e},n.prototype.hasSpace=function(){return 0<this.getSpacesLeft()},n.prototype.hasWaitlistSpace=function(){return 0>=this.getSpacesLeft()&&this.getChain().waitlength>this.spaces_wait},n.prototype.getRemainingDescription=function(){var e;return e=this.getSpacesLeft(),0<e&&3>e?"Only "+e+" "+(1<e?"spaces":"space")+" left":this.hasWaitlistSpace()?"Join Waitlist":""},n.prototype.select=function(){return this.selected=!0},n.prototype.unselect=function(){if(this.selected)return delete this.selected},n.prototype.prepEvent=function(e){var s;return s=t.defer(),this.getChain(e).then(function(e){return function(){return e.chain.$has("address")&&e.chain.getAddressPromise().then(function(t){return e.chain.address=t}),e.chain.getTickets().then(function(t){var o,n,d,l;if(e.tickets=t,e.price_range={},t&&0<t.length)for(d=e.tickets,o=0,n=d.length;o<n;o++)l=d[o],(!e.price_range.from||e.price_range.from&&l.price<e.price_range.from)&&(e.price_range.from=l.price),(!e.price_range.to||e.price_range.to&&l.price>e.price_range.to)&&(e.price_range.to=l.price),l.old_price=l.price;else e.price_range.from=e.price,e.price_range.to=e.price;return e.ticket_prices=_.indexBy(t,"name"),s.resolve(e)})}}(this)),s.promise},n.prototype.updatePrice=function(){var e,t,s,o,n;for(s=this.tickets,o=[],(e=0,t=s.length);e<t;e++)n=s[e],n.pre_paid_booking_id?o.push(n.price=0):o.push(n.price=n.old_price);return o},n.prototype.numTicketsSelected=function(){var e,t,s,o,n;for(s=0,o=this.tickets,(e=0,t=o.length);e<t;e++)n=o[e],s+=n.qty;return s},n}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("EventChainModel",function(t,s,o){var i;return i=function(o){function i(){i.__super__.constructor.apply(this,arguments),this.capacity_view=n(this.capacity_view),this.start_date&&(this.start_date=moment(this.start_date)),this.end_date&&(this.end_date=moment(this.end_date))}var n;return e(i,o),i.prototype.name=function(){return this._data.name},i.prototype.isSingleBooking=function(){return 1===this.max_num_bookings&&!this.$has("ticket_sets")},i.prototype.hasTickets=function(){return this.$has("ticket_sets")},i.prototype.getTickets=function(){var e;return e=t.defer(),this.tickets?e.resolve(this.tickets):this.$has("ticket_sets")?this.$get("ticket_sets").then(function(t){return function(o){var n,d,l;for(t.tickets=[],n=0,d=o.length;n<d;n++)l=o[n],l.ticket_set=!0,t.tickets.push(new s.EventTicket(l));return t.adjustTicketsForRemaining(),e.resolve(t.tickets)}}(this)):(this.tickets=[new s.EventTicket({name:"Admittance",min_num_bookings:1,max_num_bookings:this.max_num_bookings,type:"normal",price:this.price})],this.adjustTicketsForRemaining(),e.resolve(this.tickets)),e.promise},i.prototype.adjustTicketsForRemaining=function(){var e,t,s,o;if(this.tickets){for(s=this.tickets,o=[],(e=0,t=s.length);e<t;e++)this.ticket=s[e],o.push(this.ticket.max_spaces=this.spaces);return o}},n=function(e){var t;return t=0===e?"DO_NOT_DISPLAY":1===e?"NUM_SPACES":2===e?"NUM_SPACES_LEFT":3===e?"NUM_SPACES_AND_SPACES_LEFT":"NUM_SPACES_AND_SPACES_LEFT",t},i}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("EventGroupModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.name=function(){return this._data.name},s.prototype.colour=function(){return this._data.colour},s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("EventSequenceModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s.prototype.name=function(){return this._data.name},s}(o)})}.call(this),function(){'use strict';var e=Math.ceil,t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("EventTicketModel",function(s,o,i){var n;return n=function(s){function o(e){var t;o.__super__.constructor.call(this,e),this.max=this.max_num_bookings,this.max_spaces&&(t=this.max_spaces,this.counts_as&&(t=this.max_spaces/this.counts_as),t<max&&(this.max=t))}return t(o,s),o.prototype.fullName=function(){return this.pool_name?this.pool_name+" - "+this.name:this.name},o.prototype.getRange=function(e,t){var s,o,i,n;if(e)return i=null,this.ticket_set&&(i=this.pool_id),s=this.getMax(e,i,t),o=s<=this.min_num_bookings?s:this.min_num_bookings,[].concat(function(){n=[];for(var e=o;o<=s?e<=s:e>=s;o<=s?e++:e--)n.push(e);return n}.apply(this))},o.prototype.getMax=function(t,s,o){var n,d,l,p,m,u,b,g,h,y,f;if(null==s&&(s=null),null==o&&(o=null),l=function(e){return _.each(e.ticket_spaces,function(e){if(0>=e.left)return!1}),!0},!t)return 0;for(!l(t)||0>=t.getSpacesLeft()?(g=t.getWaitSpacesLeft(),f=!0):g=t.getSpacesLeft(s),u=g<=this.max?g:this.max,y=0,b=t.tickets,(d=0,m=b.length);d<m;d++)h=b[d],(h.pool_id===this.pool_id||f)&&(y+=h.totalQty());return this.qty&&(y-=this.totalQty()),this.counts_as&&(y=e(y/this.counts_as)),u-=y,0>u&&(u=0),p-=y,0>p&&(p=0),this.cap&&(o=this.cap),(!o||o>p)&&(o=p),o&&(n=o,this.counts_as&&(n=o/this.counts_as),n<u)?n:u},o.prototype.totalQty=function(){return this.qty?this.counts_as?this.qty*this.counts_as:this.qty:0},o.prototype.add=function(e){return this.qty||(this.qty=0),this.qty=parseInt(this.qty),angular.isNumber(this.qty)&&this.qty>=this.max&&0<e||0===this.qty&&0>e?void 0:this.qty+=e},o.prototype.subtract=function(e){return this.add(-e)},o}(i)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ExternalPurchaseModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ImageModel",function(t,s,o,i){var n;return n=function(t){function s(e){s.__super__.constructor.call(this,e)}return e(s,t),s}(i)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ItemDetailsModel",function(t,s,o,i,n){var d;return d=function(t){function o(e){var t,o,n,d;if(this._data=e,this._data&&(this.self=this._data.$href("self")),this.questions=[],this.survey_questions=[],e)for(d=e.questions,t=0,o=d.length;t<o;t++)n=d[t],!1===n.outcome?(e.currency_code&&(n.currency_code=e.currency_code),this.questions.push(new s.Question(n))):this.survey_questions.push(new s.SurveyQuestion(n));this.hasQuestions=0<this.questions.length,this.hasSurveyQuestions=0<this.survey_questions.length}return e(o,t),o.prototype.questionPrice=function(e){var t,s,o,n,d;for(e||(e=1),this.checkConditionalQuestions(),o=0,d=this.questions,(t=0,s=d.length);t<s;t++)n=d[t],o+=n.selectedPriceQty(e);return o},o.prototype.checkConditionalQuestions=function(){return n.checkConditionalQuestions(this.questions)},o.prototype.getPostData=function(){var e,t,s,o,n;for(e=[],n=this.questions,(t=0,s=n.length);t<s;t++)o=n[t],o.currentlyShown&&e.push(o.getPostData());return e},o.prototype.setAnswers=function(e){var t,s,o,n,d,l,c,p;for(s={},o=0,d=e.length;o<d;o++)t=e[o],s[t.id]=t;for(p=this.questions,n=0,l=p.length;n<l;n++)c=p[n],s[c.id]&&(c.answer=s[c.id].answer);return this.checkConditionalQuestions()},o.prototype.getQuestion=function(e){return _.findWhere(this.questions,{id:e})},o}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("MembershipLevelModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("PackageItemModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){var e=Math.ceil;angular.module("BB.Models").factory("PaginationModel",function(){var t;return t=function(){function t(e){this.current_page=1,this.page_size=e.page_size||10,this.request_page_size=e.request_page_size||this.page_size,this.max_size=e.max_size||5,this.num_pages=null,this.num_items=null,this.items=[]}return t.prototype.initialise=function(e,t){return this.current_page=1,this.items=e||[],this.num_items=t||0,this.update()},t.prototype.update=function(){var t,s,o,i;return o=(this.current_page-1)*this.page_size+1,t=this.current_page*this.page_size,t=this.num_items<t?this.num_items:t,i=100<=t?"100+":t,this.summary=o+" - "+t+" of "+i,s=e(this.current_page*this.page_size/this.request_page_size),[null!=this.items[o-1],s]},t.prototype.add=function(e,t){var s,o,n,d,l,c;for(c=(e-1)*this.request_page_size,l=[],(o=s=0,d=t.length);s<d;o=++s)n=t[o],l.push(this.items[c+o]=n);return l},t}()})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("PersonModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("PrePaidBookingModel",function(t,s,o){var i;return i=function(t){function s(e){s.__super__.constructor.call(this,e),this.book_by&&(this.book_by=moment(this.book_by)),this.use_by&&(this.use_by=moment(this.use_by)),this.use_from&&(this.use_from=moment(this.use_from)),this.expired=this.book_by&&moment().isAfter(this.book_by,"day")||this.use_by&&moment().isAfter(this.use_by,"day")||!1}return e(s,t),s.prototype.checkValidity=function(e){return!(this.service_id&&e.service_id&&this.service_id!==e.service_id)&&!(this.resource_id&&e.resource_id&&this.resource_id!==e.resource_id)&&!(this.person_id&&e.person_id&&this.person_id!==e.person_id)},s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ProductModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("PurchaseItemModel",function(t,s,o){var i;return i=function(t){function s(e){s.__super__.constructor.call(this,e),this.parts_links={},e&&(e.$has("service")&&(this.parts_links.service=e.$href("service")),e.$has("resource")&&(this.parts_links.resource=e.$href("resource")),e.$has("person")&&(this.parts_links.person=e.$href("person")),e.$has("company")&&(this.parts_links.company=e.$href("company")))}return e(s,t),s.prototype.describe=function(){return this.get("describe")},s.prototype.full_describe=function(){return this.get("full_describe")},s.prototype.hasPrice=function(){return this.price&&0<this.price},s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("PurchaseTotalModel",function(t,s,o){var i;return i=function(t){function o(e){var t;o.__super__.constructor.call(this,e),this.promise=this._data.$get("purchase_items"),this.purchase_items=[],this.promise.then(function(e){return function(t){var o,n,d,l;for(l=[],o=0,d=t.length;o<d;o++)n=t[o],l.push(e.purchase_items.push(new s.PurchaseItem(n)));return l}}(this)),this._data.$has("client")&&(t=e.$get("client"),t.then(function(e){return function(t){return e.client=new s.Client(t)}}(this))),this.created_at=moment.parseZone(this.created_at),this.time_zone&&this.created_at.tz(this.time_zone)}return e(o,t),o.prototype.icalLink=function(){return this._data.$href("ical")},o.prototype.webcalLink=function(){return this._data.$href("ical")},o.prototype.gcalLink=function(){return this._data.$href("gcal")},o.prototype.id=function(){return this.get("id")},o}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("QuestionModel",function(t,s,o,i){var n;return n=function(t){function o(e){var t,n,d,l,c;if(o.__super__.constructor.call(this,e),this.price&&(this.price=parseFloat(this.price)),this._data["default"]&&(this.answer=this._data["default"]),this._data.options)for(c=this._data.options,n=0,d=c.length;n<d;n++)l=c[n],l.is_default&&(this.answer=l.name),this.hasPrice()?(l.price=parseFloat(l.price),t=e.currency_code?e.currency_code:"GBP",l.display_name=l.name+" ("+s("currency")(l.price,t)+")"):l.display_name=l.name;("check"===this._data.detail_type||"check-price"===this._data.detail_type)&&(this.answer=this._data["default"]&&"1"===this._data["default"]),this.currentlyShown=!0}return e(o,t),o.prototype.hasPrice=function(){return"check-price"===this.detail_type||"select-price"===this.detail_type||"radio-price"===this.detail_type},o.prototype.selectedPrice=function(){var e,t,s,o;if(!this.hasPrice())return 0;if("check-price"===this.detail_type)return this.answer?this.price:0;for(o=this._data.options,e=0,t=o.length;e<t;e++)if(s=o[e],this.answer===s.name)return s.price;return 0},o.prototype.selectedPriceQty=function(e){var t;return e||(e=1),t=this.selectedPrice(),this.price_per_booking&&(t*=e),t},o.prototype.getAnswerId=function(){var e,t,s,n;if(!this.answer||!this.options||0===this.options.length)return null;for(n=this.options,e=0,t=n.length;e<t;e++)if(s=n[e],this.answer===s.name)return s.id;return null},o.prototype.showElement=function(){return this.currentlyShown=!0},o.prototype.hideElement=function(){return this.currentlyShown=!1},o.prototype.getPostData=function(){var e,t;return t={},t.id=this.id,t.answer=this.answer,"date"===this.detail_type&&this.answer&&(t.answer=moment(this.answer).toISODate()),e=this.selectedPrice(),e&&(t.price=e),t},o}(i)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ReasonModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("ResourceModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("ServiceModel",function(s,o,i){var n;return n=function(s){function i(){this.days_array=e(this.days_array,this),this.getCategoryPromise=e(this.getCategoryPromise,this),i.__super__.constructor.apply(this,arguments),this.prices&&0<this.prices.length&&(this.price=this.prices[0]),this.durations&&0<this.durations.length&&(this.duration=this.durations[0]),this.listed_durations||(this.listed_durations=this.durations),this.listed_durations&&0<this.listed_durations.length&&(this.listed_duration=this.listed_durations[0]),this.min_advance_datetime=moment().add(this.min_advance_period,"seconds"),this.max_advance_datetime=moment().add(this.max_advance_period,"seconds")}return t(i,s),i.prototype.getPriceByDuration=function(e){var t,s,o,n,l;for(l=this.durations,s=o=0,n=l.length;o<n;s=++o)if(t=l[s],t===e)return this.prices[s]},i.prototype.getCategoryPromise=function(){var e;return this.$has("category")?(e=this.$get("category"),e.then(function(e){return function(t){return e.category=new o.Category(t)}}(this)),e):null},i.prototype.days_array=function(){var e,t,s,o,i,n;for(e=[],n=t=s=this.min_bookings,o=this.max_bookings;s<=o?t<=o:t>=o;n=s<=o?++t:--t)i=""+n+" day",1<n&&(i+="s"),e.push({name:i,val:n});return e},i}(i)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("SlotModel",function(t,s,o){var i;return i=function(t){function s(e){s.__super__.constructor.call(this,e),this.datetime=moment(e.datetime)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("SpaceModel",function(t,s,o){var i;return i=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(o)})}.call(this),function(){'use strict';var e=function(e,s){function o(){this.constructor=e}for(var i in s)t.call(s,i)&&(e[i]=s[i]);return o.prototype=s.prototype,e.prototype=new o,e.__super__=s.prototype,e},t={}.hasOwnProperty;angular.module("BB.Models").factory("SurveyQuestionModel",function(t,s,o,i,n){var d;return d=function(t){function s(){return s.__super__.constructor.apply(this,arguments)}return e(s,t),s}(n)})}.call(this),function(){'use strict';var e=Math.floor,t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("TimeSlotModel",function(s,o,i,n){var d;return d=function(s){function i(e,t){i.__super__.constructor.call(this,e),this.service=t,this.time_12=this.print_time12(),this.time_24=this.print_time(),this.datetime=moment.parseZone(this.datetime),this.time_moment=this.datetime}return t(i,s),i.prototype.print_time=function(){var s,o;return this.start?this.start.format("h:mm"):(o=this.get("time"),s=10>o%60?"0"+o%60:o%60,""+e(o/60)+":"+s)},i.prototype.print_end_time=function(s){var o,i;return this.end?this.end.format("h:mm"):(s||(s=this.service.listed_durations[0]),i=this.get("time")+s,o=10>i%60?"0"+i%60:i%60,""+e(i/60)+":"+o)},i.prototype.print_time12=function(s){var i,n,d,l,c;return null==s&&(s=!0),l=this.get("time"),i=e(l/60),n=l%60,d="am",12<=i&&(d="pm"),12<i&&(i-=12),c=o.sprintf("%d.%02d",i,n),s&&(c+=d),c},i.prototype.print_end_time12=function(s,i){var n,d,l,c,p;return null==s&&(s=!0),i=null,i||(null==this.service.listed_duration?i=this.service.listed_durations[0]:i=this.service.listed_duration),p=this.get("time")+i,d=e(p/60),l=p%60,c="am",12<=d&&(c="pm"),12<d&&(d-=12),n=o.sprintf("%d.%02d",d,l),s&&(n+=c),n},i.prototype.availability=function(){return this.avail},i.prototype.select=function(){return this.selected=!0},i.prototype.unselect=function(){if(this.selected)return delete this.selected},i.prototype.disable=function(e){return this.disabled=!0,this.disabled_reason=e},i.prototype.enable=function(){if(this.disabled&&delete this.disabled,this.disabled_reason)return delete this.disabled_reason},i.prototype.status=function(){return this.selected?"selected":this.disabled?"disabled":0<this.availability()?"enabled":"disabled"},i}(n)})}.call(this),function(){angular.module("BB.Services").factory("AddressListService",function(e,t,s,o){return{query:function(t){var i,n,d;return i=e.defer(),n="/api/v1/company/{company_id}/addresses/{post_code}",d=new o(n).fillFromObject({company_id:t.company.id,post_code:t.post_code}),s.$get(d,{}).then(function(e){return i.resolve(e)},function(){return function(e){return i.reject(e)}}(this)),i.promise},getAddress:function(t){var i,n,d;return i=e.defer(),n="/api/v1/company/{company_id}/addresses/address/{id}",d=new o(n).fillFromObject({company_id:t.company.id,id:t.id}),s.$get(d,{}).then(function(e){return i.resolve(e)},function(){return function(e){return i.reject(e)}}(this)),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("$exceptionHandler",function(e){return function(t){e.error(t)}})}.call(this),function(){angular.module("BB.Services").factory("AlertService",function(e,t,s){var o,i;return e.alerts=[],i=function(e,t){return t?t:(t="error"===e||"danger"===e?"Error":null,t)},o={add:function(t,n){var d,l,c,p;return p=n.title,l=n.msg,c=n.persist,null==c&&(c=!0),e.alerts=[],d={type:t,title:i(t,p),msg:l,close:function(){return o.closeAlert(this)}},e.alerts.push(d),c||s(function(){return e.alerts.splice(e.alerts.indexOf(d),1)},3e3),e.$broadcast("alert:raised")},closeAlert:function(t){return this.closeAlertIdx(e.alerts.indexOf(t))},closeAlertIdx:function(t){return e.alerts.splice(t,1)},clear:function(){return e.alerts=[]},error:function(e){return e?this.add("error",{title:e.title,msg:e.msg,persist:e.persist}):void 0},danger:function(e){return e?this.add("danger",{title:e.title,msg:e.msg,persist:e.persist}):void 0},info:function(e){return e?this.add("info",{title:e.title,msg:e.msg,persist:e.persist}):void 0},warning:function(e){return e?this.add("warning",{title:e.title,msg:e.msg,persist:e.persist}):void 0},success:function(e){return e?this.add("success",{title:e.title,msg:e.msg,persist:e.persist}):void 0},raise:function(e){var s;if(e&&(s=t.getAlert(e),s))return this.add(s.type,{title:s.title,msg:s.msg,persist:s.persist})}}})}.call(this),function(){angular.module("BB.Services").factory("BasketService",function(e,t,s,o){return{addItem:function(t,n){var d,l,c;return l=e.defer(),c=n.item.book_link,d=n.item.getPostData(),c?o.getLock().then(function(i){return c.$post("book",n,d).then(function(d){var c;return o.unlock(i),t.$flush("basket"),c=new s.Basket(d,n.bb),d.$get("items").then(function(t){var o,d,p,m,u;for(u=[],p=0,m=t.length;p<m;p++)o=t[p],d=new s.BasketItem(o,n.bb),c.addItem(d),u=u.concat(d.promises);return 0<u.length?e.all(u).then(function(){return l.resolve(c)}):l.resolve(c)},function(e){return l.reject(e)})},function(e){return o.unlock(i),l.reject(e)})}):l.reject("rel book not found for event"),l.promise},applyCoupon:function(t,n){var d;return d=e.defer(),o.getLock().then(function(i){return t.$post("coupon",{},{coupon:n.coupon}).then(function(l){var c;return o.unlock(i),t.$flush("basket"),c=new s.Basket(l,n.bb),l.$get("items").then(function(t){var o,l,p,m,u;for(u=[],p=0,m=t.length;p<m;p++)o=t[p],l=new s.BasketItem(o,n.bb),c.addItem(l),u=u.concat(l.promises);return 0<u.length?e.all(u).then(function(){return d.resolve(c)}):d.resolve(c)},function(e){return d.reject(e)})},function(e){return o.unlock(i),d.reject(e)})}),d.promise},updateBasket:function(i,n){var d,l,c,p,m,u,b,g;for(l=e.defer(),d={entire_basket:!0,items:[]},b=n.items,(p=0,m=b.length);p<m;p++)c=b[p],c.book_link&&(u=c.book_link),g=c.getPostData(),d.items.push(g);return u?(o.getLock().then(function(p){return u.$post("book",n,d).then(function(d){var m;return o.unlock(p),i.$flush("basket"),m=new s.Basket(d,n.bb),d.$get("items").then(function(o){var d,p,u,b;for(b=[],p=0,u=o.length;p<u;p++)d=o[p],c=new s.BasketItem(d,n.bb),m.addItem(c),b=b.concat(c.promises);return 0<b.length?e.all(b).then(function(){return t.$broadcast("basket:updated",m),l.resolve(m)}):(t.$broadcast("basket:updated",m),l.resolve(m))},function(e){return l.reject(e)})},function(e){return o.unlock(p),l.reject(e)})}),l.promise):(l.reject("rel book not found for event"),l.promise)},checkPrePaid:function(e,t){var s,o,i,n;for(n=null,o=0,i=t.length;o<i;o++)if(s=t[o],s.checkValidity(e)){n=s;break}return n},query:function(t,o){var i;return i=e.defer(),t.$has("basket")?t.$get("basket").then(function(e){return e=new s.Basket(e,o.bb),e.$has("items")&&e.$get("items").then(function(t){var i,n,d,l;for(l=[],n=0,d=t.length;n<d;n++)i=t[n],l.push(e.addItem(new s.BasketItem(i,o.bb)));return l}),i.resolve(e)},function(e){return i.reject(e)}):i.reject("rel basket not found for company"),i.promise},deleteItem:function(t,i,n){var d;return n||(n={}),n.basket&&n.basket.clearItem(t),d=e.defer(),t.$has("self")?o.getLock().then(function(e){return t.$del("self",n).then(function(l){return o.unlock(e),i.$flush("basket"),l=new s.Basket(l,n.bb),l.$has("items")&&l.$get("items").then(function(e){var o,i,d;for(d=[],o=0,i=e.length;o<i;o++)t=e[o],d.push(l.addItem(new s.BasketItem(t,n.bb)));return d}),d.resolve(l)},function(e){return d.reject(e)})},function(e){return o.unlock(mutex),d.reject(e)}):d.reject("rel self not found for item"),d.promise},checkout:function(i,n,d){var l,c;return c=e.defer(),n.$has("checkout")?(l=n.getPostData(),d.bb.qudini_booking_id&&(l.qudini_booking_id=d.bb.qudini_booking_id),d.bb.booking_settings&&(l.booking_settings=d.bb.booking_settings),d.bb.no_notifications&&(l.no_notifications=d.bb.no_notifications),l.affiliate_id=t.affiliate_id||d.affiliate_id,n.waiting_for_checkout=!0,o.getLock().then(function(e){return n.$post("checkout",d,l).then(function(i){var d;return o.unlock(e),t.$broadcast("updateBookings"),d=new s.Purchase.Total(i),t.$broadcast("newCheckout",d),n.clear(),n.waiting_for_checkout=!1,c.resolve(d)},function(e){return n.waiting_for_checkout=!1,c.reject(e)})},function(e){return n.waiting_for_checkout=!1,o.unlock(mutex),c.reject(e)})):c.reject("rel checkout not found for basket"),c.promise},empty:function(t){var i;return i=e.defer(),o.getLock().then(function(e){return t.company.$del("basket").then(function(n){return o.unlock(e),t.company.$flush("basket"),i.resolve(new s.Basket(n,t))},function(e){return i.reject(e)})},function(e){return o.unlock(mutex),i.reject(e)}),i.promise},memberCheckout:function(o,i){var n,d,l;return d=e.defer(),o.$has("checkout")?null===t.member?d.reject("member not set"):(o._data.setOption("auth_token",t.member._data.getOption("auth_token")),n={items:function(){var e,t,s,i;for(s=o.items,i=[],(e=0,t=s.length);e<t;e++)l=s[e],i.push(l._data);return i}()},o.$post("checkout",i,n).then(function(e){return e.$has("member")&&e.$get("member").then(function(e){return t.member.flushBookings(),t.member=new s.Member.Member(e)}),d.resolve(e)},function(e){return d.reject(e)})):d.reject("rel checkout not found for basket"),d.promise},applyDeal:function(t,n){var d;return d=e.defer(),o.getLock().then(function(i){return n.bb.basket.$post("deal",{},{deal_code:n.deal_code}).then(function(l){var c;return o.unlock(i),t.$flush("basket"),c=new s.Basket(l,n.bb),l.$get("items").then(function(t){var o,l,p,m,u;for(u=[],p=0,m=t.length;p<m;p++)o=t[p],l=new s.BasketItem(o,n.bb),c.addItem(l),u=u.concat(l.promises);return 0<u.length?e.all(u).then(function(){return d.resolve(c)}):d.resolve(c)},function(e){return d.reject(e)})},function(e){return o.unlock(i),d.reject(e)})}),d.promise},removeDeal:function(t,i){var n;return i||(i={}),n=e.defer(),i.bb.basket.$has("deal")?(o.getLock().then(function(e){return i.bb.basket.$put("deal",{},{deal_code_id:i.deal_code_id.toString()}).then(function(d){if(o.unlock(e),t.$flush("basket"),d=new s.Basket(d,i.bb),d.$has("items"))return d.$get("items").then(function(e){var t,o,l;for(o=0,l=e.length;o<l;o++)t=e[o],d.addItem(new s.BasketItem(t,i.bb));return n.resolve(d)},function(e){return n.reject(e)})},function(t){return o.unlock(e),n.reject(t)})}),n.promise):n.reject("No Remove Deal link found")}}})}.call(this),function(){angular.module("BB.Services").factory("BreadcrumbService",function(){var e;return e=1,{setCurrentStep:function(t){return e=t},getCurrentStep:function(){return e}}})}.call(this),function(){angular.module("BB.Services").factory("BulkPurchaseService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("bulk_purchases")?s.$get("bulk_purchases").then(function(e){return e.$get("bulk_purchases").then(function(e){var s;return o.resolve(function(){var o,i,n;for(n=[],o=0,i=e.length;o<i;o++)s=e[o],n.push(new t.BulkPurchase(s));return n}())})},function(){return function(e){return o.reject(e)}}(this)):o.reject("No bulk purchases found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("CategoryService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("categories")?s.$get("named_categories").then(function(){return function(e){return e.$get("categories").then(function(e){var s,n,d,l,c,p;for(d=[],s=c=0,p=e.length;c<p;s=++c)l=e[s],n=new t.Category(l),n.order||(n.order=s),d.push(n);return o.resolve(d)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No categories found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ClientService",function(e,t,s){return{create:function(o,i){var n;return n=e.defer(),o.$has("client")?s.getLock().then(function(e){return o.$post("client",{},i.getPostData()).then(function(){return function(o){return n.resolve(new t.Client(o)),s.unlock(e)}}(this),function(){return function(t){return n.reject(t),s.unlock(e)}}(this))}):n.reject("Cannot create new people for this company"),n.promise},update:function(o,i){var n;return n=e.defer(),s.getLock().then(function(e){return i.$put("self",{},i.getPostData()).then(function(){return function(o){return n.resolve(new t.Client(o)),s.unlock(e)}}(this),function(){return function(t){return n.reject(t),s.unlock(e)}}(this))}),n.promise},create_or_update:function(e,t){return t.$has("self")?this.update(e,t):this.create(e,t)},query_by_email:function(s,o){var i;return i=e.defer(),null!=s&&null!=o?s.$get("client_by_email",{email:o}).then(function(){return function(e){return null==e?i.resolve({}):i.resolve(new t.Client(e))}}(this),function(e){return i.reject(e)}):i.reject("No company or email defined"),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ClientDetailsService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("client_details")?s.$get("client_details").then(function(){return function(e){return o.resolve(new t.ClientDetails(e))}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No client_details found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ClinicService",function(e,t){return{query:function(s){var o,i;return o=s.company,i=e.defer(),s.id?o.$get("clinics",s).then(function(e){return e=new t.Clinic(e),i.resolve(e)},function(e){return i.reject(e)}):o.$get("clinics",s).then(function(e){return e.$get("clinics").then(function(e){var o;return e=function(){var s,n,d;for(d=[],s=0,n=e.length;s<n;s++)o=e[s],d.push(new t.Clinic(o));return d}(),i.resolve(e)},function(e){return i.reject(e)})},function(e){return i.reject(e)}),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("CompanyService",function(e,t,s){return{query:function(s,o){var i,n;return o.root||(o.root=""),n=o.root+"/api/v1/company/"+s,i=e.defer(),t.$get(n,o).then(function(){return function(e){return i.resolve(e)}}(this),function(){return function(e){return i.reject(e)}}(this)),i.promise},queryChildren:function(t){var o;return o=e.defer(),t.$has("companies")?t.$get("companies").then(function(){return function(e){return e.$get("companies").then(function(e){var t,n,d,l;for(t=[],d=0,l=e.length;d<l;d++)n=e[d],t.push(new s.Company(n));return o.resolve(t)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No child companies found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("CustomTextService",function(e){return{BookingText:function(t,s){var o;return o=e.defer(),t.$get("booking_text").then(function(){return function(e){return e.$get("booking_text").then(function(e){var t,n,d,l,c,p,m;for(c=[],n=0,d=e.length;n<d;n++)if(t=e[n],"Booking"===t.message_type)for(p in m=s.parts_links,m)l=m[p],t.$href("item")===l&&-1===c.indexOf(t.message)&&c.push(t.message);return o.resolve(c)})}}(this),function(){return function(e){return o.reject(e)}}(this)),o.promise},confirmationText:function(t,s){var o;return o=e.defer(),t.$get("booking_text").then(function(e){return e.$get("booking_text").then(function(e){return s.getMessages(e,"Confirm").then(function(e){return o.resolve(e)})})},function(e){return o.reject(e)}),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("DateTimeUtilitiesService",function(e){var t,s;return t=function(e,t){return e.defaults.person&&e.defaults.person.self===e.person.self||_.isBoolean(e.person)||t.merge_people},s=function(e,t){return e.defaults.resource&&e.defaults.resource.self===e.resource.self||_.isBoolean(e.resource)||t.merge_resources},{convertTimeSlotToMoment:function(t,s){var o,i,n,d;if(t&&moment.isMoment(t)&&s)return o=moment(),e.getDisplayTimeZone()!==e.getTimeZone()&&(o=o.tz(e.getTimeZone())),d=parseInt(s.time),i=parseInt(d/60),n=d%60,o.hour(i),o.minutes(n),o.seconds(0),o.date(t.date()),o.month(t.month()),o.year(t.year()),o},convertMomentToTime:function(e){return e.minutes()+60*e.hours()},checkDefaultTime:function(e,o,n,d){var l,c,p,m,u,b;if(m=n.defaults.time?t(n,d)&&s(n,d)?"full":"partial":null,l=null,n.defaults.time&&(n.defaults.date&&e.isSame(n.defaults.date,"day")||!n.defaults.date))for(b=n.time?n.time.time:n.defaults.time,c=0,p=o.length;c<p;c++)if(u=o[c],b&&b===u.time&&1===u.avail){l=u;break}return{match:m,slot:l}}}})}.call(this),function(){angular.module("BB.Services").factory("DayService",function(e,t){return{query:function(s){var o,i;return o=e.defer(),s.cItem.days_link?(i={},i.month=s.month,i.date=s.date,i.edate=s.edate,s.client&&(i.location=s.client.addressCsvLine()),s.cItem.person&&!s.cItem.anyPerson()&&(i.person_id=s.cItem.person.id),s.cItem.resource&&!s.cItem.anyResource()&&(i.resource_id=s.cItem.resource.id),s.cItem.days_link.$get("days",i).then(function(){return function(e){var n,d,l,c,p;for(n=e.days,d=[],(c=0,p=n.length);c<p;c++)l=n[c],l.type===s.item&&d.push(new t.Day(l));return o.resolve(d)}}(this),function(){return function(e){return o.reject(e)}}(this))):o.reject("No Days Link found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("DealService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("deals")?s.$get("deals").then(function(){return function(e){return e.$get("deals").then(function(e){var s;return e=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.Deal(s));return d}(),o.resolve(e)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No Deals found"),o.promise}}})}.call(this),function(){angular.module("BB").config(function(e){return e.debugEnabled(!0)}),angular.module("BB.Services").factory("DebugUtilsService",function(e,t,s,o,i,n){var d,l;return d=function(e,t){var s,o;for(s in e)o=e[s],!e.hasOwnProperty(s)||_.isFunction(o)||/^\$\$/.test(s)||(console.log(s),t&&console.log("\t",o,"\n"))},l=function(){var e,t,s;e=$("[ng-app]"),t=e.data(),t&&t.$scope&&(s=function(e){return(console.log(e.$id),console.log(e),e.$$nextSibling)?s(e.$$nextSibling):e.$$childHead?s(e.$$childHead):void 0},s(t.$scope))},function(){if(("localhost"===t.host()||"127.0.0.1"===t.host())&&3e3===t.port())return window.setTimeout(function(){var t;for(t=e;t&&"public.controllers.BBCtrl"!==t.controller;)t=t.$$childHead;return n(s).on("dblclick",function(i){var e,n,d;for(t=angular.element(i.target).scope(),e=t.hasOwnProperty("controller"),d=t,e&&(n=t.controller);!e;)d=d.$parent,n=d.controller,e=d.hasOwnProperty("controller");return s.bbScope=t,o.log(i.target),o.log(s.bbScope),o.log("Controller ->",n)}),s.bbBBCtrlScopeKeyNames=function(e){return d(t,e)},s.bbBBCtrlScope=function(){return t},s.bbCurrentItem=function(){return t.current_item},s.bbShowScopeChain=l},10)}(),{logObjectKeys:d}})}.call(this),function(){angular.module("BB.Services").factory("Dialog",function(e){var t;return t=function(e,t,s,o,i,n,d){return e.body=d,e.ok=function(){return t.close(s)},e.cancel=function(){return event.preventDefault(),event.stopPropagation(),t.dismiss("cancel")},t.result.then(function(){if(i)return i(s)},function(){if(n)return n()})},{confirm:function(s){var o;return s.templateUrl&&(o=s.templateUrl),o||(o="dialog.html"),e.open({templateUrl:o,controller:t,size:s.size||"sm",resolve:{model:function(){return s.model},title:function(){return s.title},success:function(){return s.success},fail:function(){return s.fail},body:function(){return s.body}}})}}})}.call(this),function(){angular.module("BB.Services").factory("ErrorService",function(e,t){var s,o,i,n;return s=[{key:"GENERIC",type:"error",title:"",persist:!0,msg:"Sorry, it appears that something went wrong. Please try again or call the business you're booking with if the problem persists."},{key:"LOCATION_NOT_FOUND",type:"warning",title:"",persist:!0,msg:"Sorry, we don't recognise that location"},{key:"MISSING_LOCATION",type:"warning",title:"",persist:!0,msg:"Please enter your location"},{key:"MISSING_POSTCODE",type:"warning",title:"",persist:!0,msg:"Please enter a postcode"},{key:"INVALID_POSTCODE",type:"warning",title:"",persist:!0,msg:"Please enter a valid postcode"},{key:"ITEM_NO_LONGER_AVAILABLE",type:"error",title:"",persist:!0,msg:"Sorry. The item you were trying to book is no longer available. Please try again."},{key:"NO_WAITLIST_SPACES_LEFT",type:"error",title:"",persist:!0,msg:"Sorry, the space has now been taken, you are still in the waitlist and we will notify you if more spaces become available"},{key:"FORM_INVALID",type:"warning",title:"",persist:!0,msg:"Please complete all required fields"},{key:"GEOLOCATION_ERROR",type:"error",title:"",persist:!0,msg:"Sorry, we could not determine your location. Please try searching instead."},{key:"EMPTY_BASKET_FOR_CHECKOUT",type:"warning",title:"",persist:!0,msg:"You need to add some items to the basket before you can checkout."},{key:"MAXIMUM_TICKETS",type:"warning",title:"",persist:!0,msg:"Sorry, the maximum number of tickets per person has been reached."},{key:"GIFT_CERTIFICATE_REQUIRED",type:"warning",title:"",persist:!0,msg:"A valid Gift Certificate is required to proceed with this booking"},{key:"TIME_SLOT_NOT_SELECTED",type:"warning",title:"",persist:!0,msg:"You need to select a time slot"},{key:"STORE_NOT_SELECTED",type:"warning",title:"",persist:!0,msg:"You need to select a store"},{key:"APPT_AT_SAME_TIME",type:"warning",title:"",persist:!0,msg:"Your appointment is already booked for this time"},{key:"REQ_TIME_NOT_AVAIL",type:"warning",title:"",persist:!0,msg:"The requested time slot is not available. Please choose a different time."},{key:"TOPUP_SUCCESS",type:"success",title:"",persist:!0,msg:"Your wallet has been topped up"},{key:"TOPUP_FAILED",type:"warning",title:"",persist:!0,msg:"Sorry, your topup failed. Please try again."},{key:"UPDATE_SUCCESS",type:"success",title:"",persist:!0,msg:"Updated"},{key:"UPDATE_FAILED",type:"warning",title:"",persist:!0,msg:"Update failed. Please try again"},{key:"ALREADY_REGISTERED",type:"warning",title:"",persist:!0,msg:"You have already registered with this email address. Please login or reset your password."},{key:"LOGIN_FAILED",type:"warning",title:"",persist:!0,msg:"Sorry, your email or password was not recognised. Please try again or reset your password."},{key:"SSO_LOGIN_FAILED",type:"warning",title:"",persist:!0,msg:"Sorry, the login process failed. Please try again."},{key:"PASSWORD_INVALID",type:"warning",title:"",persist:!0,msg:"Sorry, your chosen password is invalid"},{key:"PASSWORD_RESET_REQ_SUCCESS",type:"success",title:"",persist:!0,msg:"We have sent you an email with instructions on how to reset your password."},{key:"PASSWORD_RESET_REQ_FAILED",type:"warning",title:"",persist:!0,msg:"Sorry, we didn't find an account registered with that email."},{key:"PASSWORD_RESET_SUCESS",type:"success",title:"",persist:!0,msg:"Your password has been updated."},{key:"PASSWORD_RESET_FAILED",type:"warning",title:"",persist:!0,msg:"Sorry, we couldn't update your password. Please try again."},{key:"PASSWORD_MISMATCH",type:"warning",title:"",persist:!0,msg:"Your passwords don't match"},{key:"ATTENDEES_CHANGED",type:"info",title:"",persist:!0,msg:"Your booking has been successfully updated"},{key:"PAYMENT_FAILED",type:"danger",title:"",persist:!0,msg:"We were unable to take payment. Please contact your card issuer or try again using a different card"},{key:"ACCOUNT_DISABLED",type:"warning",title:"",persist:!0,msg:"Your account appears to be disabled. Please contact the business you're booking with if the problem persists."},{key:"FB_LOGIN_NOT_A_MEMBER",type:"warning",title:"",persist:!0,msg:"Sorry, we couldn't find a login linked with your Facebook account. You will need to sign up using Facebook first."},{key:"PHONE_NUMBER_ALREADY_REGISTERED_ADMIN",type:"warning",title:"",persist:!0,msg:"There's already an account registered with this phone number. Use the search field to find the customers account."},{key:"EMAIL_ALREADY_REGISTERED_ADMIN",type:"warning",title:"",persist:!0,msg:"There's already an account registered with this email. Use the search field to find the customers account."},{key:"WAITLIST_ACCEPTED",type:"success",title:"",persist:!1,msg:"Your booking is now confirmed!"},{key:"BOOKING_CANCELLED",type:"success",title:"",persist:!1,msg:"Your booking has been cancelled."},{key:"NOT_BOOKABLE_PERSON",type:"warning",title:"",persist:!1,msg:"Sorry, this person does not offer this service, please select another"},{key:"NOT_BOOKABLE_RESOURCE",type:"warning",title:"",persist:!1,msg:"Sorry, resource does not offer this service, pelase select another"}],o=function(e){return{msg:e}},n=function(o){var i,n;return i=_.findWhere(s,{key:o}),i.persist=!0,n=e.isInternationalizatonEnabled(),i&&n?{msg:t.instant("ERROR."+o)}:i&&!n?i:n?{msg:"GENERIC"}:s[0]},i=function(o){var i,n;return i=_.findWhere(s,{key:o}),n=e.isInternationalizatonEnabled(),i&&n?{msg:t.instant("ALERT."+o)}:i&&!n?i:null},{createCustomError:o,getAlert:i,getError:n}})}.call(this),function(){angular.module("BB.Services").factory("EventService",function(e,t){return{query:function(s,o){var i;return i=e.defer(),s.$has("events")?(o.item&&(o.item.event_group&&(o.event_group_id=o.item.event_group.id),o.item.event_chain&&(o.event_chain_id=o.item.event_chain.id),o.item.resource&&(o.resource_id=o.item.resource.id),o.item.person&&(o.person_id=o.item.person.id)),o.no_cache=!0,s.$get("events",o).then(function(){return function(e){return o.no_cache=!1,e.$get("events",o).then(function(e){var s;return e=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.Event(s));return d}(),i.resolve(e)})}}(this),function(){return function(e){return i.reject(e)}}(this))):i.resolve([]),i.promise},summary:function(t,s){var o;return o=e.defer(),t.$has("events")?(s.item&&(s.item.event_group&&(s.event_group_id=s.item.event_group.id),s.item.event_chain&&(s.event_chain_id=s.item.event_chain.id),s.item.resource&&(s.resource_id=s.item.resource.id),s.item.person&&(s.person_id=s.item.person.id)),s.summary=!0,t.$get("events",s).then(function(){return function(e){return o.resolve(e.events)}}(this),function(){return function(e){return o.reject(e)}}(this))):o.resolve([]),o.promise},queryEventCollection:function(s,o){var i;return i=e.defer(),s.$has("events")?(o.item&&(o.item.event_group&&(o.event_group_id=o.item.event_group.id),o.item.event_chain&&(o.event_chain_id=o.item.event_chain.id),o.item.resource&&(o.resource_id=o.item.resource.id),o.item.person&&(o.person_id=o.item.person.id)),s.$get("events",o).then(function(){return function(e){var s;return s=new t.BBCollection(e),i.resolve(s)}}(this),function(){return function(e){return i.reject(e)}}(this))):i.resolve([]),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("EventChainService",function(e,t){return{query:function(s,o){var i;return i=e.defer(),s.$has("event_chains")?s.$get("event_chains",o).then(function(){return function(e){return e.$get("event_chains",o).then(function(e){var s;return e=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.EventChain(s));return d}(),i.resolve(e)})}}(this),function(){return function(e){return i.reject(e)}}(this)):i.reject("company does not have event_chains"),i.promise},queryEventChainCollection:function(s,o){var i;return i=e.defer(),s.$has("event_chains")?s.$get("event_chains",o).then(function(){return function(e){var s;return s=new t.BBCollection(e),i.resolve(s)}}(this),function(){return function(e){return i.reject(e)}}(this)):i.resolve([]),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("EventGroupService",function(e,t){return{query:function(s,o){var i;return i=e.defer(),s.$has("event_groups")?s.$get("event_groups",o).then(function(){return function(e){return e.$get("event_groups",o).then(function(e){var s;return e=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.EventGroup(s));return d}(),i.resolve(e)})}}(this),function(){return function(e){return i.reject(e)}}(this)):i.reject("company does not have event_groups"),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("EventSequenceService",function(e,t){return{query:function(s,o){var i;return i=e.defer(),s.$has("event_sequences")?s.$get("event_sequences",o).then(function(){return function(e){return e.$get("event_sequences",o).then(function(e){var s;return e=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.EventSequence(s));return d}(),i.resolve(e)})}}(this),function(){return function(e){return i.reject(e)}}(this)):i.reject("company does not have event_sequences"),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("PathSvc",function(e,t){return{directivePartial:function(s){var o;return t.partial_url?(o=t.partial_url,e.trustAsResourceUrl(o+"/"+s+".html")):e.trustAsResourceUrl(s+".html")}}})}.call(this),function(){"use strict";angular.module("BB.Services").factory("FormDataStoreService",function(e,t,s,o){var i,n,d,l,c,p,m,u,b,g,h,y,f,v,k,w,S,B;return g=[],l={},B=0,c="___",u=function(){},w=function(){return u(l)},f=function(e,t){var s,i;if(i=this,s=o(e),"undefined"==typeof s(i))return s.assign(i,t)},y=function(e,t){var s,n,d,l;for(s=0,n=t.length;s<n;s++)d=t[s],d=o(d),l=d.assign,l(e,null)},d=function(e,t){var s,o,i;if(!e)throw new Error("Missing scope object. Cannot clear form data without scope");if(_.isString(e))return s=l[e],t||y(s[0],s[1]),void delete l[e];if(e=p(e),e&&e.bb)for(o in i=e.bb.uid,h(e),l)s=l[o],-1!==o.indexOf(i)&&(s[3]&&_.each(s[3],function(e){if(_.isFunction(e))return e()}),!t&&y(s[0],s[1]),delete l[o])},S=function(){var e,t,s,o,n,d,c,p,m;for(t in u("formDataStore ->",l),l){for(p=l[t],u("\t",t),c=p[0],d=p[1],o=p[2],o||(o=p[2]={}),(e=0,s=d.length);e<s;e++)n=d[e],m=o[n],"data:destroyed"===m?o[n]=null:(m=angular.copy(c.$eval(n)),o[n]=m),u("\t\t",n,m);u("\n")}},k=function(e,t){var s,i;s=l[e],i=s[2],u("Decorating scope ->",e,i),_.isObject(i)&&_.each(_.keys(i),function(e){var s;if("undefined"!=typeof i[e]&&"data:destroyed"!==i[e])return s=o(e),s.assign(t,i[e])}),s[0]=t,u(t),u("\n")},p=function(e){for(;e;){if(e.hasOwnProperty("cid")&&"BBCtrl"===e.cid)return e;e=e.$parent}},n=function(e){var t,s,o,n;for(s=!1,e=p(e),(t=0,o=g.length);t<o;t++)n=g[t],n===e&&(s=!0);return s},i=function(e){var t;return t=[],_.each(e,function(s,o){var i;if(i=s.split("->"),2===i.length)return t.push(i),e[o]=i[0]}),t},v=function(t,s,o){var i,n;if(s.length)return i=l[o],n=i[3]||[],_.each(s,function(t){var s;return s=e.$on(t[1],function(){var s;try{return i[2][t[0]]="data:destroyed"}catch(e){return s=e,u(s)}}),n.push(s)}),i[3]=n},m=function(e,t,s){var o,p;if(n(t)){if(o=t.bb.uid+c+t.bb.current_page+c+e,o=o.toLowerCase(),p=i(s),t.clearStoredData=function(e){return function(){d(e)}}(o),!o)throw new Error("Missing current step");if(l[o])return void k(o,t);u("Controller registered ->",o,t,"\n\n"),l[o]=[t,s],v(t,p,o)}},h=function(e){g=_.without(g,e)},b=function(e){var t;for(t=!1,e&&e.$$childHead&&(e=e.$$childHead);!_.has(e,"cid");)e=e.$parent;if(e){if("BBCtrl"!==e.cid)throw new Error("This directive can only be used with the BBCtrl");return(_.each(g,function(s){if(e===s)return t=!0}),!t)?(u("Scope registered ->",e),e.$on("destroy",h),g.push(e)):void 0}},e.$watch(function(){t.clearTimeout(B),B=setTimeout(S,300)}),e.$on("save:formData",S),e.$on("clear:formData",d),{init:m,destroy:function(e){return d(e,!0)},showInfo:w,register:b,setIfUndefined:f}})}.call(this),function(){angular.module("BB.Services").provider("GeneralOptions",[function(){var e;e={twelve_hour_format:!1,calendar_minute_step:10,calendar_min_time:"09:00",calendar_max_time:"18:00",calendar_slot_duration:5},this.setOption=function(t,s){e.hasOwnProperty(t)&&(e[t]=s)},this.$get=function(){return e}}])}.call(this),function(){var e=Math.round,t=Math.atan2,s=Math.sqrt,o=Math.cos,i=Math.sin,n=Math.PI;angular.module("BB.Services").factory("GeolocationService",function(d){return{haversine:function(l,p){var m,u,b,g,h,y,f,v,k,w,S,B,P,L,D,I,C;return D=n,m=6371,w=[],S=l.lat,P=l.long,B=p.lat,L=p.long,g=B-S,h=L-P,f=g*(D/180),v=h*(D/180),I=S*(D/180),C=B*(D/180),u=i(f/2)*i(f/2)+i(v/2)*i(v/2)*o(I)*o(C),b=2*t(s(u),s(1-u)),y=m*b,y*=.621371192,k=e(y),k},geocode:function(e,t){var s,o,i,n;return null==t&&(t={}),s=d.defer(),i={address:e},t.region&&(i.region=t.region),t.componentRestrictions&&(i.componentRestrictions=t.componentRestrictions),t.bounds&&(n=new google.maps.LatLng(t.bounds.sw.x,t.bounds.sw.y),o=new google.maps.LatLng(t.bounds.ne.x,t.bounds.ne.y),i.bounds=new google.maps.LatLngBounds(n,o)),new google.maps.Geocoder().geocode(i,function(e,t){return e&&"OK"===t?s.resolve({results:e,status:t}):s.reject(t)}),s.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ItemService",function(e,t){return{query:function(t){var s;return s=e.defer(),t.cItem.service&&"service"!==t.item?t.cItem.service.$has("items")?this.build_items(t.cItem.service.$get("items"),t,s):t.cItem.service.$get("item").then(function(e){return function(o){return e.build_items(o.$get("items"),t,s)}}(this)):t.cItem.resource&&!t.cItem.anyResource()&&"resource"!==t.item?t.cItem.resource.$has("items")?this.build_items(t.cItem.resource.$get("items"),t,s):t.cItem.resource.$get("item").then(function(e){return function(o){return e.build_items(o.$get("items"),t,s)}}(this)):t.cItem.person&&!t.cItem.anyPerson()&&"person"!==t.item?t.cItem.person.$has("items")?this.build_items(t.cItem.person.$get("items"),t,s):t.cItem.person.$get("item").then(function(e){return function(o){return e.build_items(o.$get("items"),t,s)}}(this)):s.reject("No service link found"),s.promise},build_items:function(s,o,i){var n;return n=[s],o.wait&&n.push(o.wait),e.all(n).then(function(){return function(s){var n;return n=s[0],n.$get("items").then(function(s){var n,d,l,c,p,u;for(c=[],u=[],(n=0,d=s.length);n<d;n++)p=s[n],p.type===o.item&&c.push(new t.BookableItem(p));return e.all(function(){var e,t,s;for(s=[],e=0,t=c.length;e<t;e++)l=c[e],s.push(l.ready.promise);return s}()).then(function(){return i.resolve(c)})})}}(this))}}})}.call(this),function(){angular.module("BB.Services").factory("ItemDetailsService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.cItem.service?s.cItem.service.$has("questions")?s.cItem.service.$get("questions").then(function(){return function(e){return o.resolve(new t.ItemDetails(e))}}(this),function(){return function(e){return o.reject(e)}}(this)):o.resolve(new t.ItemDetails):s.cItem.event_chain?s.cItem.event_chain.$has("questions")?s.cItem.event_chain.$get("questions").then(function(){return function(e){return o.resolve(new t.ItemDetails(e))}}(this),function(){return function(e){return o.reject(e)}}(this)):o.resolve(new t.ItemDetails):s.cItem.deal?s.cItem.deal.$has("questions")?s.cItem.deal.$get("questions").then(function(){return function(e){return o.resolve(new t.ItemDetails(e))}}(this),function(){return function(e){return o.reject(e)}}(this)):o.resolve(new t.ItemDetails):o.resolve(),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("LoadingService",function(e,t,s,o,i){return{$loader:function(e){var t,s;return s=this,t={scope:e,setLoaded:function(){return s.setLoaded(e)},setLoadedAndShowError:function(t,o){return s.setLoadedAndShowError(e,t,o)},notLoaded:function(){return s.notLoaded(e),this}},t},setLoaded:function(e){var t;for(e.$emit("hide:loader",e),e.isLoaded=!0,t=!0;e;)e.hasOwnProperty("scopeLoaded")&&(this.areScopesLoaded(e)?e.scopeLoaded=!0:t=!1),e=e.$parent;t&&o.$broadcast("loading:finished")},setLoadedAndShowError:function(e,t,o){return s.warn(t,o),e.setLoaded(e),t&&409===t.status?i.danger(ErrorService.getError("ITEM_NO_LONGER_AVAILABLE")):t.data&&"Number of Bookings exceeds the maximum"===t.data.error?i.danger(ErrorService.getError("MAXIMUM_TICKETS")):i.danger(ErrorService.getError("GENERIC"))},areScopesLoaded:function(e){var t;if(e.hasOwnProperty("isLoaded")&&!e.isLoaded)return!1;for(t=e.$$childHead;t;){if(!this.areScopesLoaded(t))return!1;t=t.$$nextSibling}return!0},notLoaded:function(e){for(e.$emit("show:loader",e),e.isLoaded=!1;e;)e.hasOwnProperty("scopeLoaded")&&(e.scopeLoaded=!1),e=e.$parent}}})}.call(this),function(){angular.module("BB.Services").factory("LocaleService",function(e){var t;return t=e.getURIparam("locale"),t?t:e.navigator.language?e.navigator.language:"en"})}.call(this),function(){angular.module("BB.Services").factory("LoginService",function(e,t,s,o,i,n){return{companyLogin:function(t,s,o){var i;return i=e.defer(),t.$post("login",s,o).then(function(e){return function(t){return t.$get("member").then(function(t){return e.setLogin(t),i.resolve(t)},function(e){return i.reject(e)})}}(this),function(){return function(e){return i.reject(e)}}(this)),i.promise},login:function(s,o){var i,n;return i=e.defer(),o.root||(o.root=""),n=o.root+"/api/v1/login",t.$post(n,o,s).then(function(e){return function(t){var s;return s={auth_token:t.auth_token},t.$get("member").then(function(t){return e.setLogin(t),i.resolve(t)})}}(this),function(){return function(e){return i.reject(e)}}(this)),i.promise},FBLogin:function(t,s){var n;return n=e.defer(),t.$post("facebook_login",{},s).then(function(e){return function(t){return t.$get("member").then(function(t){return t=new o.Member.Member(t),i.setItem("fb_user",!0),e.setLogin(t),n.resolve(t)},function(e){return n.reject(e)})}}(this),function(){return function(e){return n.reject(e)}}(this)),n.promise},companyQuery:function(){return function(e){var s;if(e)return s=t.$get(location.protocol+"//"+location.host+"/api/v1/company/"+e),s.then(function(e){return e=new o.Company(e)})}}(this),memberQuery:function(){return function(e){var s;if(e.member_id&&e.company_id)return s=t.$get(location.protocol+"//"+location.host+("/api/v1/"+e.company_id+"/members/")+e.member_id),s.then(function(e){return e=new o.Member.Member(e)})}}(this),ssoLogin:function(s,i){var n,d;return n=e.defer(),s.root||(s.root=""),d=s.root+"/api/v1/login/sso/"+s.company_id,t.$post(d,{},i).then(function(e){return function(t){var s;return s={auth_token:t.auth_token},t.$get("member").then(function(t){return t=new o.Member.Member(t),e.setLogin(t,!0),n.resolve(t)})}}(this),function(){return function(e){return n.reject(e)}}(this)),n.promise},isLoggedIn:function(){return this.checkLogin(),s.member&&(!s.user||void 0===s.user)},setLogin:function(e,t){var d;return d=e.getOption("auth_token"),e=new o.Member.Member(e),i.setItem("login",e.$toStore()),i.setItem("auth_token",d),s.member=e,t&&n.setItem("auth_token",d),e},member:function(){return this.checkLogin(),s.member},checkLogin:function(){var e;return!!s.member||(e=i.getItem("login"),!!e&&(e=t.createResource(e),s.member=new o.Member.Member(e),!0))},logout:function(o){var d,l;return s.member=null,d=e.defer(),o||(o={}),o.root||(o.root=""),l=o.root+"/api/v1/logout",i.clear(),n.clear(),t.$del(l,o,{}).then(function(){return function(){return i.clear(),n.clear(),d.resolve(!0)}}(this),function(){return function(e){return d.reject(e)}}(this)),d.promise},FBLogout:function(e){return i.removeItem("fb_user"),this.logout(e)},sendPasswordReset:function(t,s){var o;return o=e.defer(),t.$post("email_password_reset",{},s).then(function(){return function(){return o.resolve(!0)}}(this),function(){return function(e){return o.reject(e)}}(this)),o.promise},updatePassword:function(t,s){var o;if(s.auth_token=t.getOption("auth_token"),t&&s.new_password&&s.confirm_new_password)return o=e.defer(),t.$post("update_password",{},s).then(function(e){return function(t){return t.$get("member").then(function(t){return e.setLogin(t,s.persist_login),o.resolve(t)},function(e){return o.reject(e)})}}(this),function(){return function(e){return o.reject(e)}}(this)),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("MembershipLevelsService",function(e,t){return{getMembershipLevels:function(s){var o;return o=e.defer(),s.$get("member_levels").then(function(e){return e.$get("membership_levels").then(function(){return function(e){var s,i;return i=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.MembershipLevel(s));return d}(),o.resolve(i)}}(this))},function(){return function(e){return o.reject(e)}}(this)),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ModalForm",function(e,t,s){var o,i,n;return n=function(e,s,o,i,n,d,l,c){return e.loading=!0,e.title=i,e.company=o,e.company.$has(n)?e.company.$get(n).then(function(t){return e.form=_.reject(t.form,function(e){return"submit"===e.type}),e.schema=t.schema,e.form_model={},e.loading=!1}):t.warn("company does not have '"+n+"' rel"),e.submit=function(){return e.$broadcast("schemaFormValidate"),e.loading=!0,e.company.$post(d,{},e.form_model).then(function(t){if(e.loading=!1,s.close(t),l)return l(t)},function(o){if(e.loading=!1,s.close(o),t.error("Failed to create"),c)return c(o)})},e.cancel=function(e){return e.preventDefault(),e.stopPropagation(),s.dismiss("cancel")}},i=function(e,o,i,n,d,l){return e.loading=!0,e.title=n,e.model=i,e.model.$has("edit")?e.model.$get("edit").then(function(t){return e.form=_.reject(t.form,function(e){return"submit"===e.type}),e.schema=t.schema,e.form_model=e.model,e.loading=!1}):t.warn("model does not have 'edit' rel"),e.submit=function(){return e.$broadcast("schemaFormValidate"),e.loading=!0,e.model.$update?e.model.$update(e.form_model).then(function(){if(e.loading=!1,o.close(e.model),d)return d(e.model)},function(s){if(e.loading=!1,o.close(s),t.error("Failed to create"),l)return l()}):e.model.$put("self",{},e.form_model).then(function(t){if(e.loading=!1,o.close(t),d)return d(t)},function(s){if(e.loading=!1,o.close(s),t.error("Failed to create"),l)return l()})},e.cancel=function(e){return e.preventDefault(),e.stopPropagation(),o.dismiss("cancel")},e.success=function(e){if(event.preventDefault(),event.stopPropagation(),o.close(),d)return d(e)},e.cancelEvent=function(e,t){return null==t&&(t="booking"),e.preventDefault(),e.stopPropagation(),o.close(),s.confirm({model:i,body:"Are you sure you want to cancel this "+t+"?",success:function(e){return e.$del("self").then(function(e){if(d)return d(e)})}})}},o=function(e,s,o,i,n,d,l){return e.loading=!0,e.title=n,e.model=o,e.company=i,e.model.$has("new_booking")?e.model.$get("new_booking").then(function(t){return e.form=_.reject(t.form,function(e){return"submit"===e.type}),e.schema=t.schema,e.form_model={},e.loading=!1}):t.warn("model does not have 'new_booking' rel"),e.submit=function(o){return e.$broadcast("schemaFormValidate"),o.$valid?(e.loading=!0,e.company.$post("bookings",{},e.form_model).then(function(t){if(e.loading=!1,s.close(t),d)return d(t)},function(o){if(e.loading=!1,s.close(o),t.error("Failed to create"),l)return l()})):t.warn("Invalid form")},e.cancel=function(e){return e.preventDefault(),e.stopPropagation(),s.dismiss("cancel")}},{new:function(t){var s;return t.templateUrl&&(s=t.templateUrl),s||(s="modal_form.html"),e.open({templateUrl:s,controller:n,size:t.size,resolve:{company:function(){return t.company},title:function(){return t.title},new_rel:function(){return t.new_rel},post_rel:function(){return t.post_rel},success:function(){return t.success},fail:function(){return t.fail}}})},edit:function(t){var s;return t.templateUrl&&(s=t.templateUrl),s||(s="modal_form.html"),e.open({templateUrl:s,controller:i,size:t.size,resolve:{model:function(){return t.model},title:function(){return t.title},success:function(){return t.success},fail:function(){return t.fail}}})},book:function(t){var s;return t.templateUrl&&(s=t.templateUrl),s||(s="modal_form.html"),e.open({templateUrl:s,controller:o,size:t.size,resolve:{model:function(){return t.model},company:function(){return t.company},title:function(){return t.title},success:function(){return t.success},fail:function(){return t.fail}}})}}})}.call(this),function(){angular.module("BB.Services").factory("MutexService",function(e,t,s){return{getLock:function(){var t,o;return o=e.defer(),t=e.defer(),o.promise.then(function(){var e;if(s.mutexes.shift(),0<s.mutexes.length)return e=s.mutexes[0],e.iprom.resolve(e.mprom)}),s.mutexes&&0!==s.mutexes.length?(s.mutexes.push({mprom:o,iprom:t}),t.promise):(s.mutexes=[{mprom:o,iprom:t}],t.resolve(o),t.promise)},unlock:function(e){return e.resolve()}}})}.call(this),function(){angular.module("BB.Services").factory("PackageItemService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("packages")?s.$get("packages").then(function(e){return e.$get("packages").then(function(e){var s;return o.resolve(function(){var o,i,n;for(n=[],o=0,i=e.length;o<i;o++)s=e[o],n.push(new t.PackageItem(s));return n}())})},function(e){return o.reject(e)}):o.reject("No packages found"),o.promise},getPackageServices:function(s){var o;return o=e.defer(),s.$has("services")?s.$get("services").then(function(e){var i;return o.resolve(function(){var s,o,n;for(n=[],s=0,o=e.length;s<o;s++)i=e[s],n.push(new t.Service(i));return n}())},function(){return function(e){return o.reject(e)}}(this)):o.reject("No services found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("PaginationService",function(){return{initialise:function(e){var t;if(e)return t={current_page:1,page_size:e.page_size,num_pages:null,max_size:e.max_size,num_items:null},t},update:function(e,t){var s,o,i;if(e&&null!=t)return e.num_items=t,o=(e.page_size-1)*e.current_page-(e.page_size-1-e.current_page),s=e.current_page*e.page_size,i=s<e.page_size?s:t,s=s>i?i:s,i=100<=i?"100+":i,e.summary=o+" - "+s+" of "+i},checkItems:function(e,t){var s,o;return s=e.page_size*(e.current_page-1),o=e.num_items-t,t<s+e.page_size&&0<o}}})}.call(this),function(){angular.module("BB.Services").factory("PathHelper",function(e,t){return{matchRouteToPath:function(s,o){var i,n,d,l;if(!t.path()||!s)return!1;for(d=s.split("/"),i=null;0<d.length&&!i;)n=d.join("/"),l=e.compile(n),i=l.exec(t.path()),d.pop();return i[o]?i[o]:i}}})}.call(this),function(){angular.module("BB.Services").factory("PersonService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("people")?s.$get("people").then(function(){return function(e){return e.$get("people").then(function(e){var s,n,d,l;for(l=[],n=0,d=e.length;n<d;n++)s=e[n],l.push(new t.Person(s));return o.resolve(l)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No people found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ProductService",function(e,t,s,o,n,d,l){return{getProduct:function(t){var i,c,p;return i=e.defer(),t.id?(c=l.bb.api_url+"/api/v1/{company_id}/products/{id}",p=new o(c).fillFromObject({company_id:t.company_id,id:t.product_id})):t.sku?(c=l.bb.api_url+"/api/v1/{company_id}/products/find_by_sku/{sku}",p=new o(c).fillFromObject({company_id:t.company_id,sku:t.sku})):(d.warn("id or sku is required"),i.reject()),s.$get(p,{}).then(function(e){return i.resolve(new n.Product(e))},function(){return function(e){return i.reject(e)}}(this)),i.promise},query:function(t){var s;return s=e.defer(),t.$has("products")?t.$get("products").then(function(){return function(e){return e.$get("products").then(function(e){var t,o,d,l;for(l=[],o=0,d=e.length;o<d;o++)t=e[o],l.push(new n.Product(t));return s.resolve(l)})}}(this),function(){return function(e){return s.reject(e)}}(this)):s.reject("No products found"),s.promise}}})}.call(this),function(){angular.module("BB.Services").factory("PurchaseTotalService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.company.$has("total")?s.company.$get("total",{total_id:s.total_id}).then(function(){return function(e){return o.resolve(new t.PurchaseTotal(e))}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No Total link found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("QueryStringService",function(e){return function(t){var s,o,n,d,l,c,p,m;if(m={},n=e.location.href,!(0>n.indexOf("?"))){for(o=n.slice(n.indexOf("?")+1).split(/[#&]/),l=function(e){return null==e||"0"===e.substr(0,1)||/[a-zA-Z\-\_\+\.\#\%\*\,]/.test(e)?void 0:!window.isNaN(window.parseInt(e,10))||void 0},(d=0,c=o.length);d<c;d++)s=o[d],s=s.split("="),p=s[1],p=l(p)?window.parseInt(p,10):"true"===p||"false"!==p&&window.decodeURIComponent(p),m[s[0]]=p;return t?m[t]:m}}})}.call(this),function(){'use strict';angular.module("BB.Services").factory("QuestionService",function(e,t,s){var o,i,n,d,l,c,p,m,u,b;return m=t()||{},c=function(t){return _.each(t,function(s,o){var i;if(i=e.moment(t[o]),_.isString(t[o])&&i.isValid())return t[o]=i})},e.bb_setup&&(c(e.bb_setup),angular.extend(m,e.bb_setup)),o=function(e){if(e)return angular.isArray(e)?_.each(e,function(e){var t;if(t=e.id+"",!e.answer&&m[t])return e.answer=m[t]}):m[e.id+""]?e.answer=m[e.id+""]:void 0},p=function(e){return e=e.toLowerCase(),e=$.trim(e),e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|'’!<>;:,.~`=+-@£&%"]/g,""),e=e.replace(/\s{2,}/g," "),e=e.replace(/\s/g,"_"),e},d=function(e){var t;if(angular.isArray(e))return t=_.keys(m),_.each(e,function(e){var s;return s=p(e.name),_.each(t,function(t){(0<=s.indexOf("_"+t)||0<=s.indexOf("_"+t+"_")||0<=s.indexOf(t+"_"))&&m[t]&&!e.answer&&(e.answer=m[t],delete m[t])})})},i=function(e,t){var s,o,n,d;if(d=Object.prototype.toString.call(e).slice(8,-1),"Object"===d&&angular.isArray(t))for(s=0,n=t.length;s<n;s++)o=t[s],m[o]&&!e[o]&&(e[o]=m[o],delete m[o])},n=function(e,t){var s,o,n,d,l;for(l=[],s=0,o=e.length;s<o;s++)d=e[s],n=d.help_text,t[n]&&(d.answer=t[n]),t[d.id+""]?l.push(d.answer=t[d.id+""]):l.push(void 0);return l},b=function(e){return angular.extend(m,e.bb_setup||{})},l=function(e){var t,o,n,d,l,c,p,m,b,g;for(b=[],l=0,c=e.length;l<c;l++)if(p=e[l],!(p.settings&&p.settings.conditional_question))b.push(void 0);else if(n=u(e,parseInt(p.settings.conditional_question)),n){for(t in o=n.getAnswerId(),d=!1,s.isEmptyObject(p.settings.conditional_answers)&&"check"===n.detail_type&&!n.answer&&(d=!0),m=p.settings.conditional_answers,m)g=m[t],"c"===t[0]&&1===parseInt(g)&&n.answer?d=!0:parseInt(t)===o&&1===parseInt(g)&&(d=!0);d?b.push(p.showElement()):b.push(p.hideElement())}else b.push(void 0);return b},u=function(e,t){var s,o,n;for(s=0,o=e.length;s<o;s++)if(n=e[s],n.id===t)return n;return null},{getStoredData:function(){return m},storeDefaults:b,addAnswersById:o,addAnswersByName:i,addDynamicAnswersByName:d,addAnswersFromDefaults:n,convertToSnakeCase:p,checkConditionalQuestions:l}})}.call(this),function(){angular.module("BB.Services").factory("ReasonService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("reasons")?s.$get("reasons").then(function(){return function(e){return e.$get("reasons").then(function(e){var s,n,d,l,c;for(c=[],n=0,d=e.length;n<d;n++)s=e[n],l=new t.Reason(s),c.push(l);return o.resolve(c)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("Reasons not turned on for this Company."),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("RecaptchaService",function(e,t,s){return{validateResponse:function(o){var i,n,d,l;return i=e.defer(),n=o.api_url+"/api/v1/recaptcha",l=new s(n),d={},d.response=o.response,t.$post(l,{},d).then(function(e){return i.resolve(e)},function(e){return i.reject(e)}),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ResourceService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("resources")?s.$get("resources").then(function(){return function(e){return e.$get("resources").then(function(e){var s,n,d,l;for(l=[],n=0,d=e.length;n<d;n++)s=e[n],l.push(new t.Resource(s));return o.resolve(l)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No resource found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("ServiceService",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("services")?s.$get("services").then(function(){return function(e){return e.$get("services").then(function(e){var s,n,d,l;for(l=[],n=0,d=e.length;n<d;n++)s=e[n],l.push(new t.Service(s));return o.resolve(l)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No services found"),o.promise}}})}.call(this),function(){angular.module("BB.Services").factory("SettingsService",function(e){var t,s,o,i,n,d,l;return n=!1,d=0,s=null,l=!1,o=null,t=null,i=null,{update_document_title:!1,enableInternationalizaton:function(){return n=!0},isInternationalizatonEnabled:function(){return n},setScrollOffset:function(e){return d=parseInt(e)},getScrollOffset:function(){return d},setCountryCode:function(e){if(s=e,s&&s.match(/^(gb|au)$/))return moment.locale("en-"+s)},getCountryCode:function(){return s},setUseLocalTimeZone:function(e){return l=e,i=moment.tz.guess()},getUseLocalTimeZone:function(){return l},setCurrency:function(e){return o=e},getCurrency:function(){return o},setTimeZone:function(e){return t=e},getTimeZone:function(){return t},setDisplayTimeZone:function(e){return i=e},getDisplayTimeZone:function(){return i?i:t},isModalOpen:function(){return!!e.getTop()}}})}.call(this),function(){angular.module("BB.Services").factory("SlotService",function(e,t){return{query:function(s,o){var i;return i=e.defer(),s.$has("slots")?(o.item&&(o.item.resource&&(o.resource_id=o.item.resource.id),o.item.person&&(o.person_id=o.item.person.id)),s.$get("slots",o).then(function(){return function(e){return e.$get("slots",o).then(function(e){var s;return e=function(){var o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.Slot(s));return d}(),i.resolve(e)})}}(this),function(){return function(e){return i.reject(e)}}(this))):i.resolve([]),i.promise}}})}.call(this),function(){'use strict';angular.module("BB.Services").factory("SlotDates",["$q","DayService",function(e,t){var s,o;return s={firstSlotDate:null,timesQueried:0},o=function(i,n){var d,l;return(d=e.defer(),null!=s.firstSlotDate)?(d.resolve(s.firstSlotDate),d.promise):(l=n.clone().add(3,"month"),t.query({cItem:i,date:n.format("YYYY-MM-DD"),edate:l.format("YYYY-MM-DD")}).then(function(e){var t;return s.timesQueried++,t=_.find(e,function(e){return 0<e.spaces}),t?(s.firstSlotDate=t.date,d.resolve(s.firstSlotDate)):4>=s.timesQueried?o(i,l).then(function(){return d.resolve(s.firstSlotDate)},function(e){return d.reject(e)}):d.reject(new Error("ERROR.NO_SLOT_AVAILABLE"))},function(){return d.reject(new Error("ERROR.COULDNT_GET_AVAILABLE_DATES"))}),d.promise)},{getFirstDayWithSlots:o}}])}.call(this),function(){angular.module("BB.Services").config(function(e){return e.decorator("$sniffer",function(e){var t,s,o;return t=/Safari\/([\d.]+)/,s=t.exec(navigator.userAgent),o=s?parseFloat(s[1]):null,_.extend(e,{webkit:o}),e})})}.call(this),function(){angular.module("BB.Services").factory("SpaceService",["$q",function(e,t){return{query:function(s){var o;return o=e.defer(),s.$has("spaces")?s.$get("spaces").then(function(){return function(e){return e.$get("spaces").then(function(e){var s,n,d,l;for(l=[],n=0,d=e.length;n<d;n++)s=e[n],l.push(new t.Space(s));return o.resolve(l)})}}(this),function(){return function(e){return o.reject(e)}}(this)):o.reject("No spaces found"),o.promise}}}])}.call(this),function(){angular.module("BB.Services").factory("SSOService",function(e,t,s,o){return{memberLogin:function(t){var i,n,d;return n=e.defer(),t.root||(t.root=""),d=t.root+"/api/v1/login/sso/"+t.company_id,i={token:t.member_sso},s.$post(d,{},i).then(function(){return function(e){var t;return t={auth_token:e.auth_token},e.$get("member").then(function(e){return e=o.setLogin(e),n.resolve(e)})}}(this),function(){return function(e){return n.reject(e)}}(this)),n.promise},adminLogin:function(t){var o,i,n;return i=e.defer(),t.root||(t.root=""),n=t.root+"/api/v1/login/admin_sso/"+t.company_id,o={token:t.admin_sso},s.$post(n,{},o).then(function(){return function(e){var t;return t={auth_token:e.auth_token},e.$get("administrator").then(function(e){return i.resolve(e)})}}(this),function(){return function(e){return i.reject(e)}}(this)),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("TemplateSvc",function(e,t,s){return{get:function(o){var i,n;return n=e.defer(),i=s.get(o),i?n.resolve(angular.element(i)):t({method:"GET",url:o}).success(function(e){return s.put(o,e),n.resolve(angular.element(e))}).error(function(e){return n.reject(e)}),n.promise}}})}.call(this),function(){var e=Math.floor;angular.module("BB.Services").factory("TimeService",function(t,s,o,i,n){return{query:function(e){var s,o,n,d,l,c,p;if(o=t.defer(),p=null,d=null,e.date)e.start_date=e.date;else if(e.cItem.date)e.start_date=e.cItem.date.date;else return o.reject("No date set"),o.promise;return p=e.start_date,e.end_date&&(d=e.end_date),i.getDisplayTimeZone()!==i.getTimeZone()&&(n=moment().tz(i.getDisplayTimeZone()).utcOffset(),s=moment().tz(i.getTimeZone()).utcOffset(),s<n?p=e.start_date.clone().subtract(1,"day"):s>n&&e.end_date&&(d=e.end_date.clone().add(1,"day")),e.time_zone=i.getDisplayTimeZone()),null==e.duration&&e.cItem&&e.cItem.duration&&(e.duration=e.cItem.duration),c=e.item_link,e.cItem&&e.cItem.days_link&&!c&&(c=e.cItem.days_link),c?(l={date:p.toISODate()},e.location&&(l.location=e.location),e.cItem.event_id&&(l.event_id=e.cItem.event_id),e.cItem.person&&!e.cItem.anyPerson()&&!c.event_id&&!l.event_id&&(l.person_id=e.cItem.person.id),e.cItem.resource&&!e.cItem.anyResource()&&!c.event_id&&!l.event_id&&(l.resource_id=e.cItem.resource.id),d&&(l.end_date=d.toISODate()),l.duration=e.duration,l.resource_ids=e.resource_ids,l.num_resources=e.num_resources,e.time_zone&&(l.time_zone=e.time_zone),e.cItem.id&&(l.ignore_booking=e.cItem.id),l.event_id&&(c=e.company),c.$get("times",l).then(function(s){return function(i){var n;return i.$has("date_links")?i.$get("date_links").then(function(i){var n,l,c,p,d,m;for(l={},n=[],p=function(o){var i;return(o.elink=t.defer(),n.push(o.elink.promise),o.$has("event_links"))?o.$get("event_links").then(function(t){var i;return i=s.merge_times(t,e.cItem.service,e.cItem,o.date),e.available&&(i=_.filter(i,function(s){return s.avail>=e.available})),o.elink.resolve(i)}):o.times?(i=s.merge_times([o],e.cItem.service,e.cItem,o.date),e.available&&(i=_.filter(i,function(s){return s.avail>=e.available})),o.elink.resolve(i)):void 0},(d=0,m=i.length);d<m;d++)c=i[d],p(c);return t.all(n).then(function(t){var s,i,n;for(l=_.chain(t).flatten().sortBy(function(e){return e.datetime.unix()}).groupBy(function(e){return e.datetime.toISODate()}).value(),n={},s=e.start_date.clone();s<=e.end_date;)i=s.toISODate(),n[i]=l[i]?l[i]:[],s=s.clone().add(1,"day");return o.resolve(n)})}):i.$has("event_links")?i.$get("event_links").then(function(t){var i;return i=s.merge_times(t,e.cItem.service,e.cItem,e.start_date),e.available&&(i=_.filter(i,function(s){return s.avail>=e.available})),o.resolve(i)}):i.times?(n=s.merge_times([i],e.cItem.service,e.cItem,e.start_date),e.available&&(n=_.filter(n,function(s){return s.avail>=e.available})),o.resolve(n)):void 0}}(this),function(e){return o.reject(e)})):o.reject("No day data"),o.promise},queryItems:function(e){var s,o,i,n,d,l;for(s=t.defer(),d=[],l=e.items,(i=0,n=l.length);i<n;i++)o=l[i],d.push(this.query({company:e.company,cItem:o,date:e.start_date,end_date:e.end_date,client:e.client,available:1}));return t.all(d).then(function(e){return s.resolve(e)},function(){return s.reject()}),s.promise},merge_times:function(t,o,d,c){var p,m,u,b,g,h,y,f,v,w,S,B;if(!t||0===t.length)return[];for(t=_.shuffle(t),S=[],(b=0,y=t.length);b<y;b++)if(m=t[b],m.times){for(w=m.times,g=0,f=w.length;g<f;g++)u=w[g],(!S[u.time]||0===S[u.time].avail||0===e(Math.random()*t.length)&&0<u.avail)&&(u.event_id=m.event_id,S[u.time]=u);d.held&&this.checkCurrentItem(d.held,S,m),this.checkCurrentItem(d,S,m)}for(B=[],p={},(h=0,v=S.length);h<v;h++)u=S[h],u&&(!u.datetime&&(u.datetime=n.convertTimeSlotToMoment(moment(c),u)),B.push(new s.TimeSlot(u,o)));return B},checkCurrentItem:function(e,t,s){return e&&e.id&&e.event_id===s.event_id&&e.time&&!t[e.time.time]&&e.date&&e.date.date.toISODate()===s.date?(e.time.datetime=n.convertTimeSlotToMoment(e.date.date,e.time),t[e.time.time]=e.time,o.clearCache(s.$href("self"))):e&&e.id&&e.event_id===s.event_id&&e.time&&t[e.time.time]&&e.date&&e.date.date.toISODate()===s.date?t[e.time.time].avail=1:void 0}}})}.call(this),function(){angular.module("BB.Services").factory("TimeSlotService",function(e,t){return{query:function(s){var o,i;return i=e.defer(),o=s.company,o.$get("slots",s).then(function(e){return e.$get("slots").then(function(e){var o;return e=function(){var s,n,d;for(d=[],s=0,n=e.length;s<n;s++)o=e[s],d.push(new t.TimeSlot(o));return d}(),i.resolve(e)},function(e){return i.reject(e)})},function(e){return i.reject(e)}),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("UnwrapService",function(e){return{unwrapCollection:function(t,s,o){var n,d,l;return n=e.defer(),angular.isArray(o)?(d=function(){var e,s,i;for(i=[],e=0,s=o.length;e<s;e++)l=o[e],i.push(new t(l));return i}(),n.resolve(d)):o.$has(s)?o.$get(s).then(function(){return function(e){var s,o,l;for(d=[],o=0,l=e.length;o<l;o++)s=e[o],d.push(new t(s));return n.resolve(d)}}(this),function(){return function(e){return n.reject(e)}}(this)):n.reject(),n.promise},unwrapResource:function(e,t){return new e(t)}}}),angular.module("BB.Services").factory("BB.Service.address",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Address,e)}}}),angular.module("BB.Services").factory("BB.Service.person",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Person,e)}}}),angular.module("BB.Services").factory("BB.Service.people",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Person,"people",e)}}}),angular.module("BB.Services").factory("BB.Service.resource",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Resource,e)}}}),angular.module("BB.Services").factory("BB.Service.resources",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Resource,"resources",e)}}}),angular.module("BB.Services").factory("BB.Service.service",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Service,e)}}}),angular.module("BB.Services").factory("BB.Service.services",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Service,"services",e)}}}),angular.module("BB.Services").factory("BB.Service.package_item",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.PackageItem,e)}}}),angular.module("BB.Services").factory("BB.Service.package_items",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.PackageItem,"package_items",e)}}}),angular.module("BB.Services").factory("BB.Service.bulk_purchase",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.BulkPurchase,e)}}}),angular.module("BB.Services").factory("BB.Service.bulk_purchases",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.BulkPurchase,"bulk_purchases",e)}}}),angular.module("BB.Services").factory("BB.Service.event_group",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.EventGroup,e)}}}),angular.module("BB.Services").factory("BB.Service.event_groups",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.EventGroup,"event_groups",e)}}}),angular.module("BB.Services").factory("BB.Service.event_chain",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.EventChain,e)}}}),angular.module("BB.Services").factory("BB.Service.event_chains",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.EventChain,e)}}}),angular.module("BB.Services").factory("BB.Service.category",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Category,e)}}}),angular.module("BB.Services").factory("BB.Service.categories",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Category,"categories",e)}}}),angular.module("BB.Services").factory("BB.Service.client",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Client,e)}}}),angular.module("BB.Services").factory("BB.Service.child_clients",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Client,"clients",e)}}}),angular.module("BB.Services").factory("BB.Service.clients",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Client,"clients",e)}}}),angular.module("BB.Services").factory("BB.Service.questions",function(e,t,s){return{unwrap:function(e){return s.unwrapCollection(t.Question,"questions",e)}}}),angular.module("BB.Services").factory("BB.Service.question",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Question,e)}}}),angular.module("BB.Services").factory("BB.Service.answers",function(e,t){return{promise:!1,unwrap:function(e){var s,o,n,d,l;for(l=[],n=0,d=e.length;n<d;n++)o=e[n],l.push(new t.Answer(o));return s={answers:l,getAnswer:function(e){var t,s,o,i;for(i=this.answers,s=0,o=i.length;s<o;s++)if(t=i[s],t.question_text===e||t.question_id===e)return t.value}},s}}}),angular.module("BB.Services").factory("BB.Service.administrators",function(e,t){return{unwrap:function(e){var s,o,n,d;for(d=[],o=0,n=e.length;o<n;o++)s=e[o],d.push(new t.Admin.User(s));return d}}}),angular.module("BB.Services").factory("BB.Service.company",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Company,e)}}}),angular.module("BB.Services").factory("BB.Service.parent",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Company,e)}}}),angular.module("BB.Services").factory("BB.Service.company_questions",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.BusinessQuestion,"company_questions",e)}}}),angular.module("BB.Services").factory("BB.Service.company_question",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.BusinessQuestion,e)}}}),angular.module("BB.Services").factory("BB.Service.images",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Image,"images",e)}}}),angular.module("BB.Services").factory("BB.Service.bookings",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Member.Booking,"bookings",e)}}}),angular.module("BB.Services").factory("BB.Service.wallet",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Member.Wallet,e)}}}),angular.module("BB.Services").factory("BB.Service.product",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.Product,e)}}}),angular.module("BB.Services").factory("BB.Service.products",function(e,t){return{promise:!0,unwrap:function(s){var o;return o=e.defer(),s.$get("products").then(function(){return function(e){var s,n,d,l,c,p;for(p=[],d=l=0,c=e.length;l<c;d=++l)n=e[d],s=new t.Product(n),s.order||(s.order=d),p.push(s);return o.resolve(p)}}(this),function(){return function(e){return o.reject(e)}}(this)),o.promise}}}),angular.module("BB.Services").factory("BB.Service.pre_paid_booking",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.PrePaidBooking,e)}}}),angular.module("BB.Services").factory("BB.Service.pre_paid_bookings",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.PrePaidBooking,"pre_paid_bookings",e)}}}),angular.module("BB.Services").factory("BB.Service.external_purchase",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.ExternalPurchase,e)}}}),angular.module("BB.Services").factory("BB.Service.external_purchases",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.ExternalPurchase,"external_purchases",e)}}}),angular.module("BB.Services").factory("BB.Service.purchase_item",function(e,t,s){return{unwrap:function(e){return s.unwrapResource(t.PurchaseItem,e)}}}),angular.module("BB.Services").factory("BB.Service.purchase_items",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.PurchaseItem,"purchase_items",e)}}}),angular.module("BB.Services").factory("BB.Service.events",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Event,"events",e)}}}),angular.module("BB.Services").factory("BB.Service.all_children",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Service,"services",e)}}}),angular.module("BB.Services").factory("BB.Service.child_services",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.Service,"child_services",e)}}}),angular.module("BB.Services").factory("BB.Service.booking_text",function(e,t,s){return{promise:!0,unwrap:function(e){return s.unwrapCollection(t.BookingText,"booking_text",e)}}})}.call(this),function(){angular.module("BB.Services").factory("ValidatorService",function(e,t,s,o,i){var n,d,l,c,p,m,u,b,g,h,y,f,v;return y=/^(((([A-PR-UWYZ][0-9][0-9A-HJKS-UW]?)|([A-PR-UWYZ][A-HK-Y][0-9][0-9ABEHMNPRV-Y]?))\s{0,1}[0-9]([ABD-HJLNP-UW-Z]{2}))|(GIR\s{0,2}0AA))$/i,v=/^\d{5}(?:[-\s]\d{4})?$/,f=/^[A-Z]{1,2}[0-9][0-9A-Z]?\s*[0-9][A-Z]{2}$/i,m=/^\d+$/,h=/^((\+44|0)\s*7\s*([45789]\s*\d\s*\d|6\s*2\s*4)\s*\d\s*\d\s*\d\s*\d\s*\d\s*\d)$/,p=/^(0|\+)([\d \(\)]{9,19})$/,g=/^(\+44|0)\s*[1-9]\s*\d{1,4}\s*\d{3,4}\s*\d{2,4}$/,b=/^(0|\+)([\d \(\)]{9,19})$/,c=/^(\+)([\d \(\)]{9,19})$/,d=/^$|^([^@\s]+)@((?:[-a-z0-9]+\.)+[a-z]{2,})$/i,u=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,n=/^[a-zA-Z0-9]*$/,l=null,{alpha:/^[a-zA-Z\s-]*$/,us_phone_number:/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/,getEmailPattern:function(){return d},getStandardPassword:function(){return u},getUKPostcodePattern:function(){return f},getMailingPattern:function(){var e;return e=s.getCountryCode(),(e="us")?v:f},getNumberOnlyPattern:function(){return m},getAlphaNumbericPattern:function(){return n},getUKMobilePattern:function(e){return null==e&&(e=!1),e?h:p},getMobilePattern:function(){return p},getUKLandlinePattern:function(e){return null==e&&(e=!1),e?g:b},getIntPhonePattern:function(){return c},getGeocodeResult:function(){if(l)return l},validatePostcode:function(s,o){var n,d,c,p,m,u;return t.clear(),!!(s&&s.postcode)&&(s.$error.required?(t.raise("MISSING_POSTCODE"),!1):s.$error.pattern?(t.raise("INVALID_POSTCODE"),!1):(n=i.defer(),p=s.postcode.$viewValue,m={address:p},o.region&&(m.region=o.region),m.componentRestrictions={postalCode:m.address},o.bounds&&(u=new google.maps.LatLng(o.bounds.sw.x,o.bounds.sw.y),c=new google.maps.LatLng(o.bounds.ne.x,o.bounds.ne.y),m.bounds=new google.maps.LatLngBounds(u,c)),d=new google.maps.Geocoder,d.geocode(m,function(s,o){return 1===s.length&&"OK"===o?(l=s[0],n.resolve(!0)):(t.raise("INVALID_POSTCODE"),e.$apply(),n.reject(!1))}),n.promise))},validateForm:function(s){return!!s&&(s.submitted=!0,e.$broadcast("form:validated",s),s.$invalid&&s.raise_alerts&&s.alert?(t.danger(s.alert),!1):s.$invalid&&s.raise_alerts?(t.danger(ErrorService.getError("FORM_INVALID")),!1):!s.$invalid)}}}),{resetForm:function(e){if(e)return e.submitted=!1,e.$setPristine()},resetForms:function(e){var t,s,o,n;if(e&&$bbug.isArray(e)){for(n=[],s=0,o=e.length;s<o;s++)t=e[s],t.submitted=!1,n.push(t.$setPristine());return n}}}}.call(this),function(){'use strict';angular.module("BB.Services").factory("ViewportSize",["$rootScope",function(e){var t;return t=null,{setViewportSize:function(s){if(s!==t)return t=s,e.$broadcast("ViewportSize:changed")},getViewportSize:function(){return t}}}])}.call(this),function(){'use strict';var e=function(e,t){return function(){return e.apply(t,arguments)}};angular.module("BB.Models").factory("BBWidget",function(t,s,o,i,n,d,l,c,p,m){var u;return u=function(){function l(){this.clearAddress=e(this.clearAddress,this),this.emptyStackedItems=e(this.emptyStackedItems,this),this.deleteStackedItemByService=e(this.deleteStackedItemByService,this),this.removeItemFromStack=e(this.removeItemFromStack,this),this.deleteStackedItem=e(this.deleteStackedItem,this),this.sortStackedItems=e(this.sortStackedItems,this),this.setStackedItems=e(this.setStackedItems,this),this.stackItem=e(this.stackItem,this),this.waitForRoutes=e(this.waitForRoutes,this),this.setBasicRoute=e(this.setBasicRoute,this),this.setRoute=e(this.setRoute,this),this.calculatePercentageComplete=e(this.calculatePercentageComplete,this),this.recordStep=e(this.recordStep,this),this.recordCurrentPage=e(this.recordCurrentPage,this),this.uid=_.uniqueId("bbwidget_"),this.page_suffix="",this.steps=[],this.allSteps=[],this.item_defaults={},this.usingBasket=!1,this.confirmCheckout=!1,this.isAdmin=!1,this.payment_status=null}return l.prototype.pageURL=function(e){return e+".html"},l.prototype.updateRoute=function(e){var t,s,o,d,l,c,p,m,u;if(this.routeFormat)return e||(e=this.current_page),l=i.compile(this.routeFormat),p="-",d="-",o="-",this.current_item&&(this.current_item.service&&(p=this.convertToDashSnakeCase(this.current_item.service.name)),this.current_item.event_group&&(d=this.convertToDashSnakeCase(this.current_item.event_group.name)),this.current_item.event&&(o=this.current_item.event.id),this.current_item.date&&(s=this.current_item.date.date.toISODate()),this.current_item.time&&(m=this.current_item.time.time),this.current_item.company&&(t=this.convertToDashSnakeCase(this.current_item.company.name))),this.route_values&&(c=angular.copy(this.route_values)),c||(c={}),angular.extend(c,{page:e,company:t,service:p,event_group:d,date:s,time:m,event:o}),u=l.format(c),u=u.replace(/\/+$/,""),n.path(u),this.routing=!0,u},l.prototype.setRouteFormat=function(e){var t;if(this.routeFormat=e,!!this.routeFormat)return(this.routing=!0,t=p.matchRouteToPath(this.routeFormat),t)?(t.company&&(this.item_defaults.company=decodeURIComponent(t.company)),t.service&&"-"!==t.service&&(this.item_defaults.service=decodeURIComponent(t.service)),t.event_group&&"-"!==t.event_group&&(this.item_defaults.event_group=t.event_group),t.event&&"-"!==t.event&&(this.item_defaults.event=decodeURIComponent(t.event)),t.person&&(this.item_defaults.person=decodeURIComponent(t.person)),t.resource&&(this.item_defaults.resource=decodeURIComponent(t.resource)),t.resources&&(this.item_defaults.resources=decodeURIComponent(t.resoures)),t.date&&(this.item_defaults.date=t.date),t.time&&(this.item_defaults.time=t.time),this.route_matches=t):void 0},l.prototype.matchURLToStep=function(){var e,t;return e=p.matchRouteToPath(this.routeFormat,"page"),t=_.findWhere(this.allSteps,{page:e}),t?t.number:null},l.prototype.convertToDashSnakeCase=function(e){return e=e.toLowerCase(),e=$.trim(e),e=e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|'’!<>;:,.~`=+-@£&%"]/g,""),e=e.replace(/\s{2,}/g," "),e=e.replace(/\s/g,"-"),e},l.prototype.recordCurrentPage=function(){var e,t,s,o,i,n,d,c,p,u,b,g,h;if(b=function(e){if(m.update_document_title&&e)return document.title=e},this.current_step||(this.current_step=0),d=!1,this.allSteps)for(c=this.allSteps,e=0,o=c.length;e<o;e++)g=c[e],g.page===this.current_page&&(this.current_step=g.number,b(g.title),d=!0);if(!d)for(p=this.steps,t=0,i=p.length;t<i;t++)g=p[t],g&&g.page===this.current_page&&(this.current_step=g.number,b(g.title),d=!0);if(d||(this.current_step+=1),h="",this.allSteps){for(u=this.allSteps,s=0,n=u.length;s<n;s++)g=u[s],g.active=!1,g.passed=g.number<this.current_step;this.allSteps[this.current_step-1]&&(this.allSteps[this.current_step-1].active=!0,h=this.allSteps[this.current_step-1].title)}return this.recordStep(this.current_step,h)},l.prototype.recordStep=function(e,t){var s,o,i,n;for(this.steps[e-1]={url:this.updateRoute(this.current_page),current_item:this.current_item.getStep(),page:this.current_page,number:e,title:t,stacked_length:this.stacked_items.length},d.setCurrentStep(e),i=this.steps,(s=0,o=i.length);s<o;s++)n=i[s],n&&(n.passed=n.number<this.current_step,n.active=n.number===this.current_step),n&&n.number===e&&this.calculatePercentageComplete(n.number);return this.allSteps&&this.allSteps.length===e||"checkout"===this.current_page?this.last_step_reached=!0:this.last_step_reached=!1},l.prototype.calculatePercentageComplete=function(e){return this.percentage_complete=e&&this.allSteps?100*(e/this.allSteps.length):0},l.prototype.setRoute=function(e){var t,s,o,n,d,l,c,p;for(this.allSteps.length=0,this.nextSteps={},void 0===e||null===e||void 0===e[0]||(this.firstStep=e[0].page),(t=s=0,n=e.length);s<n;t=++s)if(p=e[t],p.disable_breadcrumbs&&(this.disableGoingBackAtStep=t+1),e[t+1]&&(this.nextSteps[p.page]=e[t+1].page),this.allSteps.push({number:t+1,title:p.title,page:p.page}),p.when)for(this.routeSteps||(this.routeSteps={}),l=p.when,(o=0,d=l.length);o<d;o++)c=l[o],this.routeSteps[c]=p.page;if(this.$wait_for_routing)return this.$wait_for_routing.resolve()},l.prototype.setBasicRoute=function(e){var t,s,o,n;for(this.nextSteps={},this.firstStep=e[0],(t=s=0,o=e.length);s<o;t=++s)n=e[t],this.nextSteps[n]=e[t+1];if(this.$wait_for_routing)return this.$wait_for_routing.resolve()},l.prototype.waitForRoutes=function(){if(!this.$wait_for_routing)return this.$wait_for_routing=t.defer()},l.prototype.stackItem=function(e){if(this.stacked_items.push(e),this.sortStackedItems(),1===this.stacked_items.length)return this.current_item=e},l.prototype.setStackedItems=function(e){return this.stacked_items=e,this.sortStackedItems()},l.prototype.sortStackedItems=function(){var e,s,o,i,n;for(e=[],n=this.stacked_items,(o=0,i=n.length);o<i;o++)s=n[o],e=e.concat(s.promises);return t.all(e)["finally"](function(e){return function(){return e.stacked_items=e.stacked_items.sort(function(e,t){var s,o;return e.time&&t.time?null==(s=e.time.time>t.time.time)?{1:-1}:s:e.service.category&&!t.service.category?1:t.service.category&&!e.service.category?-1:t.service.category||e.service.category?null==(o=e.service.category.order>t.service.category.order)?{1:-1}:o:1})}}(this))},l.prototype.deleteStackedItem=function(e){return e&&e.id&&o.deleteItem(e,this.company,{bb:this}),this.stacked_items=this.stacked_items.filter(function(t){return t!==e})},l.prototype.removeItemFromStack=function(e){return this.stacked_items=this.stacked_items.filter(function(t){return t!==e})},l.prototype.deleteStackedItemByService=function(e){var t,s,n,d;for(d=this.stacked_items,s=0,n=d.length;s<n;s++)t=d[s],t&&t.service&&t.service.self===e.self&&t.id&&o.deleteItem(t,this.company,{bb:this});return this.stacked_items=this.stacked_items.filter(function(t){return t&&t.service&&t.service.self!==e.self})},l.prototype.emptyStackedItems=function(){return this.stacked_items=[]},l.prototype.pushStackToBasket=function(){var e,t,o,n;for(this.basket||(this.basket=new new s.Basket(null,this)),n=this.stacked_items,(t=0,o=n.length);t<o;t++)e=n[t],this.basket.addItem(e);return this.emptyStackedItems()},l.prototype.totalStackedItemsDuration=function(){var e,t,s,o,i;for(e=0,i=this.stacked_items,(s=0,o=i.length);s<o;s++)t=i[s],t.service&&t.service.listed_duration&&(e+=t.service.listed_duration);return e},l.prototype.clearStackedItemsDateTime=function(){var e,t,s,o,i;for(o=this.stacked_items,i=[],(t=0,s=o.length);t<s;t++)e=o[t],i.push(e.clearDateTime());return i},l.prototype.clearAddress=function(){return delete this.address1,delete this.address2,delete this.address3,delete this.address4,delete this.address5},l}()})}.call(this),function(){var e,t;angular.module("BB.Directives").directive("bbPurchase",function(){return{restrict:"AE",replace:!0,scope:!0,controller:"Purchase",link:function(e,t,s){e.init(e.$eval(s.bbPurchase))}}}),angular.module("BB.Controllers").controller("Purchase",function(s,o,i,n,d,l,c,p,m,u,b,g,h,y,f,v,k,w,S,B,P){var L,D,I,C,A,E,T,M,q,R,O,j,N,F;return s.controller="Purchase",s.is_waitlist=!1,s.make_payment=!1,F=function(e){if(s.bb.company_id=e.id,s.bb.company=new u.Company(e),s.company=s.bb.company,s.bb.item_defaults.company=s.bb.company,e.settings&&(e.settings.merge_resources&&(s.bb.item_defaults.merge_resources=!0),e.settings.merge_people))return s.bb.item_defaults.merge_people=!0},I=function(){return s.fail_msg?y.danger({msg:s.fail_msg}):S.isInternationalizatonEnabled()?B("ERROR.GENERIC",{}).then(function(e){return y.add("danger",{msg:e})}):y.raise("GENERIC")},s.init=function(e){return e||(e={}),s.notLoaded(s),e.move_route&&(s.move_route=e.move_route),e.move_all&&(s.move_all=e.move_all),e.fail_msg&&(s.fail_msg=e.fail_msg),s.bb.total?s.load(s.bb.total.long_id):s.bb.purchase?(s.purchase=s.bb.purchase,s.bookings=s.bb.purchase.bookings,s.purchase.confirm_messages&&(s.messages=s.purchase.confirm_messages),s.cancel_reasons||(s.cancel_reasons=s.bb.cancel_reasons),s.move_reasons||(s.move_reasons=s.bb.move_reasons),s.setLoaded(s)):e.member_sso?h.memberLogin(e).then(function(){return s.load()},function(){return s.setLoaded(s),I()}):s.load()},E=function(e){var t;return t=b.defer(),n.query(e).then(function(e){return t.resolve(e),e.$get("company").then(function(){return function(e){return F(e)}}(this)),s.purchase=e,s.bb.purchase=e,s.price=0!==s.purchase.price},function(e){return s.setLoaded(s),e&&401===e.status?f.isLoggedIn()?I():q():I()}),t.promise},C=function(e){return s.purchase.getBookingsPromise().then(function(e){var t,o,n,d,l;for(s.bookings=e,e[0]&&e[0].getCompanyPromise().then(function(e){return s.purchase.bookings[0].company=e,e.$has("reasons")&&M(e).then(function(){return R(),j(),N(),O()}),e.getAddressPromise().then(function(e){return s.purchase.bookings[0].company.address=e})}),s.setLoaded(s),L(e),D(e),d=s.bookings,l=[],(o=0,n=d.length);o<n;o++)t=d[o],l.push(t.getAnswersPromise().then(function(e){return t.answers=e}));return l},function(){return s.setLoaded(s),I()}),e.$has("client")&&e.$get("client").then(function(){return function(e){return s.setClient(new u.Client(e))}}(this)),s.purchase.getConfirmMessages().then(function(e){return s.purchase.confirm_messages=e,s.messages=e})},s.load=function(e){return s.notLoaded(s),e||(e=T()),s.loaded||!e||o.widget_started.then(function(){return function(){return s.waiting_for_conn_started.then(function(){var t,o,n;return o=A(),o&&i.query(o,{}).then(function(e){return F(e)}),n={purchase_id:e,url_root:s.bb.api_url},t=w.getItem("auth_token"),t&&(n.auth_token=t),E(n).then(function(e){return C(e)})},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")})}}(this),function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")}),s.loaded=!0},L=function(e){var t,o,i,n;if(i=/^.*(?:\?|&)move_booking=(.*?)(?:&|$)/.exec(c.absUrl()),i&&(o=parseInt(i[1])),o&&(n=function(){var s,n,d;for(d=[],s=0,n=e.length;s<n;s++)t=e[s],t.id===o&&d.push(t);return d}(),0<n.length&&s.isMovable(e[0])))return s.move(n[0])},D=function(e){var t;return s.waitlist_bookings=function(){var s,o,n;for(n=[],s=0,o=e.length;s<o;s++)t=e[s],t.on_waitlist&&1===t.settings.sent_waitlist&&n.push(t);return n}()},q=function(){return function(){if(!s.bb.login_required)return window.location=window.location.href+"&login=true"}}(this),A=function(){var e,t;return t=/^.*(?:\?|&)company_id=(.*?)(?:&|$)/.exec(c.absUrl()),t&&(e=t[1]),e},T=function(){var e,t;return t=/^.*(?:\?|&)id=(.*?)(?:&|$)/.exec(c.absUrl()),t||(t=/^.*print_purchase\/(.*?)(?:\?|$)/.exec(c.absUrl())),t||(t=/^.*print_purchase_jl\/(.*?)(?:\?|$)/.exec(c.absUrl())),t?e=t[1]:g("ref")&&(e=g("ref")),g("booking_id")&&(e=g("booking_id")),e},s.move=function(e,t,i){return(null==i&&(i={}),t||(t=s.move_route),s.move_all)?s.moveAll(t,i):(s.notLoaded(s),s.initWidget({company_id:e.company_id,no_route:!0}),p(function(){return function(){return o.connection_started.then(function(){var i,n;return n=[],s.bb.moving_booking=e,s.quickEmptybasket(),i=new u.BasketItem(e,s.bb),i.setSrcBooking(e,s.bb),i.ready=!1,Array.prototype.push.apply(n,i.promises),s.bb.basket.addItem(i),s.setBasketItem(i),b.all(n).then(function(){return s.setLoaded(s),o.$broadcast("booking:move"),s.decideNextPage(t)},function(){return s.setLoaded(s),I()})},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")})}}(this)))},s.moveAll=function(e,t){return null==t&&(t={}),e||(e=s.move_route),s.notLoaded(s),s.initWidget({company_id:s.bookings[0].company_id,no_route:!0}),p(function(){return function(){return o.connection_started.then(function(){var t,o,n,d,l,c;for(l=[],s.bb.moving_booking=1===s.bookings.length?s.bookings[0]:s.purchase,_.every(_.map(s.bookings,function(e){return e.event_id}),function(e){return e===s.bookings[0].event_id})&&(s.bb.moving_purchase=s.purchase),s.quickEmptybasket(),c=s.bookings,(o=0,n=c.length);o<n;o++)t=c[o],d=new u.BasketItem(t,s.bb),d.setSrcBooking(t),d.ready=!1,d.move_done=!1,Array.prototype.push.apply(l,d.promises),s.bb.basket.addItem(d);return s.bb.sortStackedItems(),s.setBasketItem(s.bb.basket.items[0]),b.all(l).then(function(){return s.setLoaded(s),s.decideNextPage(e)},function(){return s.setLoaded(s),I()})},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")})}}(this))},s.bookWaitlistItem=function(e){var t;return s.notLoaded(s),t={purchase:s.purchase,booking:e},n.bookWaitlistItem(t).then(function(t){return s.purchase=t,s.total=s.purchase,s.bb.purchase=t,s.purchase.getBookingsPromise().then(function(t){return s.bookings=t,s.waitlist_bookings=function(){var t,o,n,d;for(n=s.bookings,d=[],(t=0,o=n.length);t<o;t++)e=n[t],e.on_waitlist&&1===e.settings.sent_waitlist&&d.push(e);return d}(),s.purchase.$has("new_payment")&&0<s.purchase.due_now&&(s.make_payment=!0),s.setLoaded(s)},function(){return s.setLoaded(s),I()})},function(){return function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong")}}(this))},s["delete"]=function(t){var i;return i=l.open({templateUrl:s.getPartial("_cancel_modal"),controller:e,resolve:{booking:function(){return t},cancel_reasons:function(){return s.cancel_reasons}}}),i.result.then(function(e){var t,i;return t=null,e.cancel_reason&&(t=e.cancel_reason),i={cancel_reason:t},e.$del("self",{},i).then(function(){return function(){return s.bookings=_.without(s.bookings,e),o.$broadcast("booking:cancelled")}}(this))})},s.deleteAll=function(){var e;return e=l.open({templateUrl:s.getPartial("_cancel_modal"),controller:t,resolve:{purchase:function(){return s.purchase}}}),e.result.then(function(e){return n.deleteAll(e).then(function(e){return s.purchase=e,s.bookings=[],o.$broadcast("booking:cancelled")})})},s.isMovable=function(e){return e.min_cancellation_time?moment().isBefore(e.min_cancellation_time):e.datetime.isAfter(moment())},s.createBasketItem=function(e){var t;return t=new u.BasketItem(e,s.bb),t.setSrcBooking(e),t},s.checkAnswer=function(e){return"boolean"==typeof e.value||"string"==typeof e.value||"number"==typeof e.value},s.changeAttendees=function(e){return s.moveAll(e)},M=function(e){return P.query(e).then(function(e){return s.company_reasons=e,s.company_reasons},function(e){return s.setLoadedAndShowError(s,e,"Sorry, something went wrong retrieving reasons")})},R=function(){return s.cancel_reasons=_.filter(s.company_reasons,function(e){return 3===e.reason_type}),s.cancel_reasons},j=function(){return s.move_reasons=_.filter(s.company_reasons,function(e){return 5===e.reason_type}),s.move_reasons},N=function(){if(s.move_reasons)return s.bb.move_reasons=s.move_reasons},O=function(){if(s.cancel_reasons)return s.bb.cancel_reasons=s.cancel_reasons}}),e=function(e,t,s,o,i,n){return e.controller="ModalDelete",e.booking=o,e.cancel_reasons=n,e.confirmDelete=function(){return i.clear(),s.close(o)},e.cancel=function(){return s.dismiss("cancel")}},t=function(e,t,s,o){return e.controller="ModalDeleteAll",e.purchase=o,e.confirmDelete=function(){return s.close(o)},e.cancel=function(){return s.dismiss("cancel")}}}.call(this),function(){'use strict';var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("Purchase.BookingModel",function(s,o,n,d){var l;return l=function(i){function d(t){this.getSurveyAnswersPromise=e(this.getSurveyAnswersPromise,this),this.getAnswersPromise=e(this.getAnswersPromise,this),d.__super__.constructor.call(this,t),this.ready=!1,this.datetime=moment.parseZone(this.datetime),this.time_zone&&this.datetime.tz(this.time_zone),this.original_datetime=moment(this.datetime),this.end_datetime=moment.parseZone(this.end_datetime),this.time_zone&&this.end_datetime.tz(this.time_zone),this.min_cancellation_time=moment(this.min_cancellation_time),this.min_cancellation_hours=this.datetime.diff(this.min_cancellation_time,"hours")}return t(d,i),d.prototype.getGroup=function(){return this.group?this.group:this._data.$has("event_groups")?this._data.$get("event_groups").then(function(e){return function(t){return e.group=t,e.group}}(this)):void 0},d.prototype.getColour=function(){return this.getGroup()?this.getGroup().colour:"#FFFFFF"},d.prototype.getCompany=function(){return this.company?this.company:this.$has("company")?this._data.$get("company").then(function(e){return function(t){return e.company=new n.Company(t),e.company}}(this)):void 0},d.prototype.getAnswersPromise=function(){var e;return e=s.defer(),null==this.answers?(this.answers=[],this._data.$has("answers")?this._data.$get("answers").then(function(t){return function(s){var o;return t.answers=function(){var e,t,d;for(d=[],e=0,t=s.length;e<t;e++)o=s[e],d.push(new n.Answer(o));return d}(),e.resolve(t.answers)}}(this)):e.resolve([])):e.resolve(this.answers),e.promise},d.prototype.getSurveyAnswersPromise=function(){var e;return e=s.defer(),this.survey_answers&&e.resolve(this.survey_answers),this._data.$has("survey_answers")?this._data.$get("survey_answers").then(function(t){return function(s){var o;return t.survey_answers=function(){var e,t,d;for(d=[],e=0,t=s.length;e<t;e++)o=s[e],d.push(new n.Answer(o));return d}(),e.resolve(t.survey_answers)}}(this)):e.resolve([]),e.promise},d.prototype.answer=function(e){var t,s,o,n;if(null!=this.answers)for(n=this.answers,s=0,o=n.length;s<o;s++){if(t=n[s],t.name&&t.name===e)return t.answer;if(t.question_text&&t.question_text===e)return t.value}else this.getAnswersPromise();return null},d.prototype.getPostData=function(){var e,t,s,o,n,d;if(e={},e.attended=this.attended,e.client_id=this.client_id,e.company_id=this.company_id,e.time=60*this.datetime.hour()+this.datetime.minute(),e.date=this.datetime.toISODate(),e.deleted=this.deleted,e.describe=this.describe,e.duration=this.duration,e.end_datetime=this.end_datetime,e.event_id=this.time&&this.time.event_id&&!this.isEvent()?this.time.event_id:this.event?this.event.id:this.slot_id,e.full_describe=this.full_describe,e.id=this.id,e.min_cancellation_time=this.min_cancellation_time,e.on_waitlist=this.on_waitlist,e.paid=this.paid,e.person_name=this.person_name,e.price=this.price,e.purchase_id=this.purchase_id,e.purchase_ref=this.purchase_ref,e.quantity=this.quantity,e.self=this.self,this.move_item_id&&(e.move_item_id=this.move_item_id),this.srcBooking&&(e.move_item_id=this.srcBooking.id),this.person&&(e.person_id=this.person.id),this.service&&(e.service_id=this.service.id),this.resource&&(e.resource_id=this.resource.id),this.item_details&&(e.questions=this.item_details.getPostData()),this.move_reason&&(e.move_reason=this.move_reason),e.service_name=this.service_name,e.settings=this.settings,this.status&&(e.status=this.status),null!=this.email&&(e.email=this.email),null!=this.email_admin&&(e.email_admin=this.email_admin),this.first_name&&(e.first_name=this.first_name),this.last_name&&(e.last_name=this.last_name),t=[],this.survey_questions){for(e.survey_questions=this.survey_questions,d=this.survey_questions,(s=0,o=d.length);s<o;s++)n=d[s],t.push({value:n.answer,outcome:n.outcome,detail_type_id:n.id,price:n.price});e.survey_answers=t}return e},d.prototype.checkReady=function(){if(this.datetime&&this.id&&this.purchase_ref)return this.ready=!0},d.prototype.printed_price=function(){return 0==parseFloat(this.price)%1?"\xA3"+parseInt(this.price):o.sprintf("\xA3%.2f",parseFloat(this.price))},d.prototype.getDateString=function(){return this.datetime.toISODate()},d.prototype.getTimeInMins=function(){return 60*this.datetime.hour()+this.datetime.minute()},d.prototype.getAttachments=function(){return this.attachments?this.attachments:this.$has("attachments")?this._data.$get("attachments").then(function(e){return function(t){return e.attachments=t.attachments,e.attachments}}(this)):void 0},d.prototype.canCancel=function(){return moment(this.min_cancellation_time).isAfter(moment())},d.prototype.canMove=function(){return this.canCancel()},d.prototype.getAttendeeName=function(){return this.first_name+" "+this.last_name},d.prototype.isEvent=function(){return null!=this.event_chain},d}(d)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("Purchase.CourseBookingModel",function(s,o,i){var n;return n=function(i){function n(t){this.getBookings=e(this.getBookings,this),n.__super__.constructor.call(this,t)}return t(n,i),n.prototype.getBookings=function(){var e;return e=s.defer(),this.bookings&&e.resolve(this.bookings),this._data.$has("bookings")?this._data.$get("bookings").then(function(t){return function(s){var n;return t.bookings=function(){var e,t,d;for(d=[],e=0,t=s.length;e<t;e++)n=s[e],d.push(new o.Purchase.Booking(n));return d}(),t.bookings.sort(function(e,t){return e.datetime.unix()-t.datetime.unix()}),e.resolve(t.bookings)}}(this)):(this.bookings=[],e.resolve(this.bookings)),e.promise},n}(i)})}.call(this),function(){'use strict';var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)s.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},s={}.hasOwnProperty;angular.module("BB.Models").factory("Purchase.TotalModel",function(s,o,n,d,l){var c;return c=function(i){function d(t){this.getConfirmMessages=e(this.getConfirmMessages,this),this.getMember=e(this.getMember,this),this.getClient=e(this.getClient,this),this.getMessages=e(this.getMessages,this),this.getDeals=e(this.getDeals,this),this.getProducts=e(this.getProducts,this),this.getPackages=e(this.getPackages,this),this.getCourseBookingsPromise=e(this.getCourseBookingsPromise,this),this.getBookingsPromise=e(this.getBookingsPromise,this),this.getItems=e(this.getItems,this),d.__super__.constructor.call(this,t),this.getItems().then(function(e){return function(t){return e.items=t}}(this)),this.getClient().then(function(e){return function(t){return e.client=t}}(this)),this.getMember().then(function(e){return function(t){return e.member=t}}(this))}return t(d,i),d.prototype.id=function(){return this.get("id")},d.prototype.icalLink=function(){return this._data.$href("ical")},d.prototype.webcalLink=function(){return this._data.$href("ical")},d.prototype.gcalLink=function(){return this._data.$href("gcal")},d.prototype.getItems=function(){var e;return e=s.defer(),this.items&&e.resolve(this.items),s.all([this.getBookingsPromise(),this.getCourseBookingsPromise(),this.getPackages(),this.getProducts(),this.getDeals()]).then(function(t){var s;return s=_.flatten(t),e.resolve(s)}),e.promise},d.prototype.getBookingsPromise=function(){var e;return e=s.defer(),this.bookings&&e.resolve(this.bookings),this._data.$has("bookings")?this._data.$get("bookings").then(function(t){return function(s){var o;return t.bookings=function(){var e,t,d;for(d=[],e=0,t=s.length;e<t;e++)o=s[e],d.push(new n.Purchase.Booking(o));return d}(),t.bookings.sort(function(e,t){return e.datetime.unix()-t.datetime.unix()}),e.resolve(t.bookings)}}(this)):e.resolve([]),e.promise},d.prototype.getCourseBookingsPromise=function(){var e;return e=s.defer(),this.course_bookings&&e.resolve(this.course_bookings),this._data.$has("course_bookings")?this._data.$get("course_bookings").then(function(t){return function(o){var d;return t.course_bookings=function(){var e,t,s;for(s=[],e=0,t=o.length;e<t;e++)d=o[e],s.push(new n.Purchase.CourseBooking(d));return s}(),s.all(_.map(t.course_bookings,function(e){return e.getBookings()})).then(function(){return e.resolve(t.course_bookings)})}}(this)):e.resolve([]),e.promise},d.prototype.getPackages=function(){var e;return e=s.defer(),this.packages&&e.resolve(this.packages),this._data.$has("packages")?this._data.$get("packages").then(function(t){return function(s){return t.packages=s,e.resolve(t.packages)}}(this)):e.resolve([]),e.promise},d.prototype.getProducts=function(){var e;return e=s.defer(),this.products&&e.resolve(this.products),this._data.$has("products")?this._data.$get("products").then(function(t){return function(s){return t.products=s,e.resolve(t.products)}}(this)):e.resolve([]),e.promise},d.prototype.getDeals=function(){var e;return e=s.defer(),this.deals&&e.resolve(this.deals),this._data.$has("deals")?this._data.$get("deals").then(function(t){return function(s){return t.deals=s,e.resolve(t.deals)}}(this)):e.resolve([]),e.promise},d.prototype.getMessages=function(e,t){var o,n;return n=s.defer(),e=function(){var s,n,d;for(d=[],s=0,n=e.length;s<n;s++)o=e[s],o.message_type===t&&d.push(o);return d}(),0===e.length?n.resolve([]):this.getItems().then(function(t){var s,o,d,l,c,p,m,u,b,g,h;for(b=[],o=0,p=e.length;o<p;o++)for(s=e[o],l=0,m=t.length;l<m;l++)for(d=t[l],g=["company","person","resource","service"],(c=0,u=g.length);c<u;c++)h=g[c],d.$has(h)&&d.$href(h)===s.$href("item")&&-1===b.indexOf(s.message)&&b.push(s.message);return n.resolve(b)}),n.promise},d.prototype.getClient=function(){var e;return e=s.defer(),this._data.$has("client")?this._data.$get("client").then(function(t){return function(s){return t.client=new n.Client(s),e.resolve(t.client)}}(this)):e.reject("No client"),e.promise},d.prototype.getMember=function(){var e;return e=s.defer(),this._data.$has("member")?this._data.$get("member").then(function(t){return function(s){return t.member=new n.Member.Member(s),e.resolve(t.member)}}(this)):e.reject("No member"),e.promise},d.prototype.getConfirmMessages=function(){var e;return e=s.defer(),this._data.$has("confirm_messages")?this._data.$get("confirm_messages").then(function(t){return function(s){return t.getMessages(s,"Confirm").then(function(t){return e.resolve(t)})}}(this)):e.reject("no messages"),e.promise},d.prototype.printed_total_price=function(){return 0==parseFloat(this.total_price)%1?"\xA3"+parseInt(this.total_price):o.sprintf("\xA3%.2f",parseFloat(this.total_price))},d.prototype.newPaymentUrl=function(){if(this._data.$has("new_payment"))return l.trustAsResourceUrl(this._data.$href("new_payment"))},d.prototype.totalDuration=function(){var e,t,s,o,n;for(e=0,n=this.items,(t=0,o=n.length);t<o;t++)s=n[t],s.duration&&(e+=s.duration);return e},d.prototype.containsWaitlistItems=function(){var e,t,s,o,n;for(n=[],o=this.items,(e=0,s=o.length);e<s;e++)t=o[e],!0===t.on_waitlist&&n.push(t);return!!(0<n.length)},d}(d)})}.call(this),function(){'use strict';angular.module("BB.Services").factory("PurchaseBookingService",function(e,t,s){return{update:function(t){var o,i;return i=e.defer(),o=t.getPostData(),t.srcBooking.$put("self",{},o).then(function(){return function(e){return i.resolve(new s.Purchase.Booking(e))}}(this),function(){return function(e){return i.reject(e,new s.Purchase.Booking(t))}}(this)),i.promise},addSurveyAnswersToBooking:function(t){var o,i;return i=e.defer(),o=t.getPostData(),o.notify=!1,o.notify_admin=!1,t.$put("self",{},o).then(function(){return function(e){return i.resolve(new s.Purchase.Booking(e))}}(this),function(){return function(e){return i.reject(e,new s.Purchase.Booking(t))}}(this)),i.promise}}})}.call(this),function(){angular.module("BB.Services").factory("PurchaseService",function(e,t,s,o,i){return{query:function(o){var i,n;return i=e.defer(),n=o.url_root+"/api/v1/purchases/"+o.purchase_id,t.$get(n,o).then(function(e){return e=new s.Purchase.Total(e),i.resolve(e)},function(e){return i.reject(e)}),i.promise},bookingRefQuery:function(o){var n,d;return n=e.defer(),d=new i(o.url_root+"/api/v1/purchases/booking_ref/{booking_ref}{?raw}").fillFromObject(o),t.$get(d,o).then(function(e){return e=new s.Purchase.Total(e),n.resolve(e)},function(e){return n.reject(e)}),n.promise},update:function(t){var o,n,d,l,c,p,m,u,b,g;if(l=e.defer(),!t.purchase)return l.reject("No purchase present"),l.promise;if(d={},t.bookings){for(o=[],b=t.bookings,(c=0,m=b.length);c<m;c++)n=b[c],o.push(n.getPostData());d.bookings=o}if(t.move_reason)for(g=d.bookings,p=0,u=g.length;p<u;p++)n=g[p],n.move_reason=t.move_reason;return t.purchase.$put("self",{},d).then(function(){return function(e){return e=new s.Purchase.Total(e),l.resolve(e)}}(this),function(){return function(e){return l.reject(e)}}(this)),l.promise},bookWaitlistItem:function(o){var i,n,d;return n=e.defer(),o.purchase||o.purchase_id||n.reject("No purchase or purchase_id present"),i={},i.booking_id=o.booking.id,o.purchase?o.purchase.$put("book_waitlist_item",{},i).then(function(){return function(e){return e=new s.Purchase.Total(e),n.resolve(e)}}(this),function(e){return n.reject(e)}):o.purchase_id&&o.url_root&&(d=o.url_root+"/api/v1/purchases/"+o.purchase_id+"/book_waitlist_item",t.$put(d,{},i).then(function(e){return e=new s.Purchase.Total(e),n.resolve(e)},function(e){return n.reject(e)})),n.promise},deleteAll:function(t){var o;return(o=e.defer(),!t)?(o.reject("No purchase present"),o.promise):(t.$del("self").then(function(e){return e=new s.Purchase.Total(e),o.resolve(e)},function(){return function(e){return o.reject(e)}}(this)),o.promise)},deleteItem:function(o){var i,n;return i=e.defer(),n=o.api_url+"/api/v1/purchases/"+o.long_id+"/purchase_item/"+o.purchase_item_id,t.$del(n,{}).then(function(e){return e=new s.Purchase.Total(e),i.resolve(e)},function(e){return i.reject(e)}),i.promise}}})}.call(this);